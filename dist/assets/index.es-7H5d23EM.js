const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/core-CHTdmtIq.js","assets/index-CXk2OvJM.js","assets/index-BywHz2MV.css"])))=>i.map(i=>d[i]);
import{H as L2,c as Xu,a as Ff,t as k2,b as j2,d as N4,e as Uf,f as T4,r as Jr,g as L4,h as k0,p as It,i as k4,B as ue,j as dn,k as j4,l as q4,m as M4,n as z4,_ as H4}from"./index-CXk2OvJM.js";function V4(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}function K4(t,e,r){return t&e^~t&r}function G4(t,e,r){return t&e^t&r^e&r}class Z4 extends L2{constructor(e,r,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=Xu(this.buffer)}update(e){Ff(this),e=k2(e),j2(e);const{view:r,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Xu(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ff(this),N4(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,Uf(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let l=o;l<i;l++)r[l]=0;V4(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Xu(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)a.setUint32(4*l,u[l],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const Qn=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),W4=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ei=new Uint32Array(64);class Y4 extends Z4{constructor(e=32){super(64,e,8,!1),this.A=Qn[0]|0,this.B=Qn[1]|0,this.C=Qn[2]|0,this.D=Qn[3]|0,this.E=Qn[4]|0,this.F=Qn[5]|0,this.G=Qn[6]|0,this.H=Qn[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let l=0;l<16;l++,r+=4)ei[l]=e.getUint32(r,!1);for(let l=16;l<64;l++){const h=ei[l-15],d=ei[l-2],p=Jr(h,7)^Jr(h,18)^h>>>3,w=Jr(d,17)^Jr(d,19)^d>>>10;ei[l]=w+ei[l-7]+p+ei[l-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:f,H:u}=this;for(let l=0;l<64;l++){const h=Jr(a,6)^Jr(a,11)^Jr(a,25),d=u+h+K4(a,c,f)+W4[l]+ei[l]|0,w=(Jr(n,2)^Jr(n,13)^Jr(n,22))+G4(n,i,s)|0;u=f,f=c,c=a,a=o+d|0,o=s,s=i,i=n,n=d+w|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(n,i,s,o,a,c,f,u)}roundClean(){Uf(ei)}destroy(){this.set(0,0,0,0,0,0,0,0),Uf(this.buffer)}}const X4=T4(()=>new Y4);class q2 extends L2{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,L4(e);const n=k2(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Uf(s)}update(e){return Ff(this),this.iHash.update(e),this}digestInto(e){Ff(this),j2(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const M2=(t,e,r)=>new q2(t,e).update(r).digest();M2.create=(t,e)=>new q2(t,e);const re=globalThis||void 0||self;var Oc={exports:{}},w1;function J4(){if(w1)return Oc.exports;w1=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(F,_,N){return Function.prototype.apply.call(F,_,N)},r;t&&typeof t.ownKeys=="function"?r=t.ownKeys:Object.getOwnPropertySymbols?r=function(F){return Object.getOwnPropertyNames(F).concat(Object.getOwnPropertySymbols(F))}:r=function(F){return Object.getOwnPropertyNames(F)};function n(B){console&&console.warn&&console.warn(B)}var i=Number.isNaN||function(F){return F!==F};function s(){s.init.call(this)}Oc.exports=s,Oc.exports.once=D,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(B){if(typeof B!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof B)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(B){if(typeof B!="number"||B<0||i(B))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+B+".");o=B}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(F){if(typeof F!="number"||F<0||i(F))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+F+".");return this._maxListeners=F,this};function c(B){return B._maxListeners===void 0?s.defaultMaxListeners:B._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(F){for(var _=[],N=1;N<arguments.length;N++)_.push(arguments[N]);var P=F==="error",S=this._events;if(S!==void 0)P=P&&S.error===void 0;else if(!P)return!1;if(P){var T;if(_.length>0&&(T=_[0]),T instanceof Error)throw T;var L=new Error("Unhandled error."+(T?" ("+T.message+")":""));throw L.context=T,L}var O=S[F];if(O===void 0)return!1;if(typeof O=="function")e(O,this,_);else for(var x=O.length,$=p(O,x),N=0;N<x;++N)e($[N],this,_);return!0};function f(B,F,_,N){var P,S,T;if(a(_),S=B._events,S===void 0?(S=B._events=Object.create(null),B._eventsCount=0):(S.newListener!==void 0&&(B.emit("newListener",F,_.listener?_.listener:_),S=B._events),T=S[F]),T===void 0)T=S[F]=_,++B._eventsCount;else if(typeof T=="function"?T=S[F]=N?[_,T]:[T,_]:N?T.unshift(_):T.push(_),P=c(B),P>0&&T.length>P&&!T.warned){T.warned=!0;var L=new Error("Possible EventEmitter memory leak detected. "+T.length+" "+String(F)+" listeners added. Use emitter.setMaxListeners() to increase limit");L.name="MaxListenersExceededWarning",L.emitter=B,L.type=F,L.count=T.length,n(L)}return B}s.prototype.addListener=function(F,_){return f(this,F,_,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(F,_){return f(this,F,_,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(B,F,_){var N={fired:!1,wrapFn:void 0,target:B,type:F,listener:_},P=u.bind(N);return P.listener=_,N.wrapFn=P,P}s.prototype.once=function(F,_){return a(_),this.on(F,l(this,F,_)),this},s.prototype.prependOnceListener=function(F,_){return a(_),this.prependListener(F,l(this,F,_)),this},s.prototype.removeListener=function(F,_){var N,P,S,T,L;if(a(_),P=this._events,P===void 0)return this;if(N=P[F],N===void 0)return this;if(N===_||N.listener===_)--this._eventsCount===0?this._events=Object.create(null):(delete P[F],P.removeListener&&this.emit("removeListener",F,N.listener||_));else if(typeof N!="function"){for(S=-1,T=N.length-1;T>=0;T--)if(N[T]===_||N[T].listener===_){L=N[T].listener,S=T;break}if(S<0)return this;S===0?N.shift():w(N,S),N.length===1&&(P[F]=N[0]),P.removeListener!==void 0&&this.emit("removeListener",F,L||_)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(F){var _,N,P;if(N=this._events,N===void 0)return this;if(N.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):N[F]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete N[F]),this;if(arguments.length===0){var S=Object.keys(N),T;for(P=0;P<S.length;++P)T=S[P],T!=="removeListener"&&this.removeAllListeners(T);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(_=N[F],typeof _=="function")this.removeListener(F,_);else if(_!==void 0)for(P=_.length-1;P>=0;P--)this.removeListener(F,_[P]);return this};function h(B,F,_){var N=B._events;if(N===void 0)return[];var P=N[F];return P===void 0?[]:typeof P=="function"?_?[P.listener||P]:[P]:_?m(P):p(P,P.length)}s.prototype.listeners=function(F){return h(this,F,!0)},s.prototype.rawListeners=function(F){return h(this,F,!1)},s.listenerCount=function(B,F){return typeof B.listenerCount=="function"?B.listenerCount(F):d.call(B,F)},s.prototype.listenerCount=d;function d(B){var F=this._events;if(F!==void 0){var _=F[B];if(typeof _=="function")return 1;if(_!==void 0)return _.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]};function p(B,F){for(var _=new Array(F),N=0;N<F;++N)_[N]=B[N];return _}function w(B,F){for(;F+1<B.length;F++)B[F]=B[F+1];B.pop()}function m(B){for(var F=new Array(B.length),_=0;_<F.length;++_)F[_]=B[_].listener||B[_];return F}function D(B,F){return new Promise(function(_,N){function P(T){B.removeListener(F,S),N(T)}function S(){typeof B.removeListener=="function"&&B.removeListener("error",P),_([].slice.call(arguments))}b(B,F,S,{once:!0}),F!=="error"&&C(B,P,{once:!0})})}function C(B,F,_){typeof B.on=="function"&&b(B,"error",F,_)}function b(B,F,_,N){if(typeof B.on=="function")N.once?B.once(F,_):B.on(F,_);else if(typeof B.addEventListener=="function")B.addEventListener(F,function P(S){N.once&&B.removeEventListener(F,P),_(S)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof B)}return Oc.exports}var hr=J4();const j0=k0(hr);var b1=function(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},Q4=(function(){function t(e,r,n){this.name=e,this.version=r,this.os=n,this.type="browser"}return t})(),e5=(function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=It.platform}return t})(),t5=(function(){function t(e,r,n,i){this.name=e,this.version=r,this.os=n,this.bot=i,this.type="bot-device"}return t})(),r5=(function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t})(),n5=(function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t})(),i5=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,s5=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,m1=3,o5=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",i5]],E1=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function a5(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new n5:typeof navigator<"u"?f5(navigator.userAgent):h5()}function c5(t){return t!==""&&o5.reduce(function(e,r){var n=r[0],i=r[1];if(e)return e;var s=i.exec(t);return!!s&&[n,s]},!1)}function f5(t){var e=c5(t);if(!e)return null;var r=e[0],n=e[1];if(r==="searchbot")return new r5;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<m1&&(i=b1(b1([],i,!0),l5(m1-i.length),!0)):i=[];var s=i.join("."),o=u5(t),a=s5.exec(t);return a&&a[1]?new t5(r,s,o,a[1]):new Q4(r,s,o)}function u5(t){for(var e=0,r=E1.length;e<r;e++){var n=E1[e],i=n[0],s=n[1],o=s.exec(t);if(o)return i}return null}function h5(){var t=typeof It<"u"&&It.version;return t?new e5(It.version.slice(1)):null}function l5(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Ju={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var nd=function(t,e){return nd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},nd(t,e)};function d5(t,e){nd(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var id=function(){return id=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},id.apply(this,arguments)};function p5(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function g5(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function y5(t,e){return function(r,n){e(r,n,t)}}function w5(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function b5(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{f(n.next(u))}catch(l){o(l)}}function c(u){try{f(n.throw(u))}catch(l){o(l)}}function f(u){u.done?s(u.value):i(u.value).then(a,c)}f((n=n.apply(t,e||[])).next())})}function m5(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(f){return function(u){return c([f,u])}}function c(f){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=f[0]&2?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[f[0]&2,s.value]),f[0]){case 0:case 1:s=f;break;case 4:return r.label++,{value:f[1],done:!1};case 5:r.label++,i=f[1],f=[0];continue;case 7:f=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(f[0]===6||f[0]===2)){r=0;continue}if(f[0]===3&&(!s||f[1]>s[0]&&f[1]<s[3])){r.label=f[1];break}if(f[0]===6&&r.label<s[1]){r.label=s[1],s=f;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(f);break}s[2]&&r.ops.pop(),r.trys.pop();continue}f=e.call(t,r)}catch(u){f=[6,u],i=0}finally{n=s=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function E5(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function v5(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function sd(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function z2(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function x5(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(z2(arguments[e]));return t}function $5(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n}function Za(t){return this instanceof Za?(this.v=t,this):new Za(t)}function A5(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(h){n[h]&&(i[h]=function(d){return new Promise(function(p,w){s.push([h,d,p,w])>1||a(h,d)})})}function a(h,d){try{c(n[h](d))}catch(p){l(s[0][3],p)}}function c(h){h.value instanceof Za?Promise.resolve(h.value.v).then(f,u):l(s[0][2],h)}function f(h){a("next",h)}function u(h){a("throw",h)}function l(h,d){h(d),s.shift(),s.length&&a(s[0][0],s[0][1])}}function I5(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(o){return(r=!r)?{value:Za(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function B5(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof sd=="function"?sd(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(f){s({value:f,done:a})},o)}}function S5(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function O5(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function _5(t){return t&&t.__esModule?t:{default:t}}function D5(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function F5(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const U5=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return id},__asyncDelegator:I5,__asyncGenerator:A5,__asyncValues:B5,__await:Za,__awaiter:b5,__classPrivateFieldGet:D5,__classPrivateFieldSet:F5,__createBinding:E5,__decorate:g5,__exportStar:v5,__extends:d5,__generator:m5,__importDefault:_5,__importStar:O5,__makeTemplateObject:S5,__metadata:w5,__param:y5,__read:z2,__rest:p5,__spread:x5,__spreadArrays:$5,__values:sd},Symbol.toStringTag,{value:"Module"})),sc=k4(U5);var Qu={},ta={},v1;function C5(){if(v1)return ta;v1=1,Object.defineProperty(ta,"__esModule",{value:!0}),ta.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return ta.delay=t,ta}var Es={},eh={},vs={},x1;function P5(){return x1||(x1=1,Object.defineProperty(vs,"__esModule",{value:!0}),vs.ONE_THOUSAND=vs.ONE_HUNDRED=void 0,vs.ONE_HUNDRED=100,vs.ONE_THOUSAND=1e3),vs}var th={},$1;function R5(){return $1||($1=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365})(th)),th}var A1;function H2(){return A1||(A1=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=sc;e.__exportStar(P5(),t),e.__exportStar(R5(),t)})(eh)),eh}var I1;function N5(){if(I1)return Es;I1=1,Object.defineProperty(Es,"__esModule",{value:!0}),Es.fromMiliseconds=Es.toMiliseconds=void 0;const t=H2();function e(n){return n*t.ONE_THOUSAND}Es.toMiliseconds=e;function r(n){return Math.floor(n/t.ONE_THOUSAND)}return Es.fromMiliseconds=r,Es}var B1;function T5(){return B1||(B1=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=sc;e.__exportStar(C5(),t),e.__exportStar(N5(),t)})(Qu)),Qu}var io={},S1;function L5(){if(S1)return io;S1=1,Object.defineProperty(io,"__esModule",{value:!0}),io.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const n=this.get(r);if(typeof n.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const i=Date.now()-n.started;this.timestamps.set(r,{started:n.started,elapsed:i})}get(r){const n=this.timestamps.get(r);if(typeof n>"u")throw new Error(`No timestamp found for label: ${r}`);return n}elapsed(r){const n=this.get(r);return n.elapsed||Date.now()-n.started}}return io.Watch=t,io.default=t,io}var rh={},ra={},O1;function k5(){if(O1)return ra;O1=1,Object.defineProperty(ra,"__esModule",{value:!0}),ra.IWatch=void 0;class t{}return ra.IWatch=t,ra}var _1;function j5(){return _1||(_1=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),sc.__exportStar(k5(),t)})(rh)),rh}var D1;function q5(){return D1||(D1=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=sc;e.__exportStar(T5(),t),e.__exportStar(L5(),t),e.__exportStar(j5(),t),e.__exportStar(H2(),t)})(Ju)),Ju}var Z=q5(),me={},F1;function V2(){if(F1)return me;F1=1,Object.defineProperty(me,"__esModule",{value:!0}),me.getLocalStorage=me.getLocalStorageOrThrow=me.getCrypto=me.getCryptoOrThrow=me.getLocation=me.getLocationOrThrow=me.getNavigator=me.getNavigatorOrThrow=me.getDocument=me.getDocumentOrThrow=me.getFromWindowOrThrow=me.getFromWindow=void 0;function t(h){let d;return typeof window<"u"&&typeof window[h]<"u"&&(d=window[h]),d}me.getFromWindow=t;function e(h){const d=t(h);if(!d)throw new Error(`${h} is not defined in Window`);return d}me.getFromWindowOrThrow=e;function r(){return e("document")}me.getDocumentOrThrow=r;function n(){return t("document")}me.getDocument=n;function i(){return e("navigator")}me.getNavigatorOrThrow=i;function s(){return t("navigator")}me.getNavigator=s;function o(){return e("location")}me.getLocationOrThrow=o;function a(){return t("location")}me.getLocation=a;function c(){return e("crypto")}me.getCryptoOrThrow=c;function f(){return t("crypto")}me.getCrypto=f;function u(){return e("localStorage")}me.getLocalStorageOrThrow=u;function l(){return t("localStorage")}return me.getLocalStorage=l,me}var ur=V2(),na={},U1;function M5(){if(U1)return na;U1=1,Object.defineProperty(na,"__esModule",{value:!0}),na.getWindowMetadata=void 0;const t=V2();function e(){let r,n;try{r=t.getDocumentOrThrow(),n=t.getLocationOrThrow()}catch{return null}function i(){const d=r.getElementsByTagName("link"),p=[];for(let w=0;w<d.length;w++){const m=d[w],D=m.getAttribute("rel");if(D&&D.toLowerCase().indexOf("icon")>-1){const C=m.getAttribute("href");if(C)if(C.toLowerCase().indexOf("https:")===-1&&C.toLowerCase().indexOf("http:")===-1&&C.indexOf("//")!==0){let b=n.protocol+"//"+n.host;if(C.indexOf("/")===0)b+=C;else{const B=n.pathname.split("/");B.pop();const F=B.join("/");b+=F+"/"+C}p.push(b)}else if(C.indexOf("//")===0){const b=n.protocol+C;p.push(b)}else p.push(C)}}return p}function s(...d){const p=r.getElementsByTagName("meta");for(let w=0;w<p.length;w++){const m=p[w],D=["itemprop","property","name"].map(C=>m.getAttribute(C)).filter(C=>C?d.includes(C):!1);if(D.length&&D){const C=m.getAttribute("content");if(C)return C}}return""}function o(){let d=s("name","og:site_name","og:title","twitter:title");return d||(d=r.title),d}function a(){return s("description","og:description","twitter:description","keywords")}const c=o(),f=a(),u=n.origin,l=i();return{description:f,url:u,icons:l,name:c}}return na.getWindowMetadata=e,na}var K2=M5();/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function z5(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function G2(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function Cf(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function q0(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function od(t){if(!Array.isArray(t))throw new Error("array expected")}function Pf(t,e){if(!G2(!0,e))throw new Error(`${t}: array of strings expected`)}function H5(t,e){if(!G2(!1,e))throw new Error(`${t}: array of numbers expected`)}function V5(...t){const e=s=>s,r=(s,o)=>a=>s(o(a)),n=t.map(s=>s.encode).reduceRight(r,e),i=t.map(s=>s.decode).reduce(r,e);return{encode:n,decode:i}}function K5(t){const e=typeof t=="string"?t.split(""):t,r=e.length;Pf("alphabet",e);const n=new Map(e.map((i,s)=>[i,s]));return{encode:i=>(od(i),i.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${t}`);return e[s]})),decode:i=>(od(i),i.map(s=>{Cf("alphabet.decode",s);const o=n.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${t}`);return o}))}}function G5(t=""){return Cf("join",t),{encode:e=>(Pf("join.decode",e),e.join(t)),decode:e=>(Cf("join.decode",e),e.split(t))}}function Z5(t,e="="){return q0(t),Cf("padding",e),{encode(r){for(Pf("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){Pf("padding.decode",r);let n=r.length;if(n*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;n>0&&r[n-1]===e;n--)if((n-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,n)}}}const Z2=(t,e)=>e===0?t:Z2(e,t%e),Rf=(t,e)=>t+(e-Z2(t,e)),nh=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function C1(t,e,r,n){if(od(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Rf(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${Rf(e,r)}`);let i=0,s=0;const o=nh[e],a=nh[r]-1,c=[];for(const f of t){if(q0(f),f>=o)throw new Error(`convertRadix2: invalid data word=${f} from=${e}`);if(i=i<<e|f,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=r;s-=r)c.push((i>>s-r&a)>>>0);const u=nh[s];if(u===void 0)throw new Error("invalid carry");i&=u-1}if(i=i<<r-s&a,!n&&s>=e)throw new Error("Excess padding");if(!n&&i>0)throw new Error(`Non-zero padding: ${i}`);return n&&s>0&&c.push(i>>>0),c}function W5(t,e=!1){if(q0(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Rf(8,t)>32||Rf(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!z5(r))throw new Error("radix2.encode input should be Uint8Array");return C1(Array.from(r),8,t,!e)},decode:r=>(H5("radix2.decode",r),Uint8Array.from(C1(r,t,8,e)))}}const Y5=V5(W5(5),K5("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Z5(5),G5(""));function X5(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let f=0;f<e.length;f++)e[f]=255;for(let f=0;f<t.length;f++){const u=t.charAt(f),l=u.charCodeAt(0);if(e[l]!==255)throw new TypeError(u+" is ambiguous");e[l]=f}const r=t.length,n=t.charAt(0),i=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function o(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";let u=0,l=0,h=0;const d=f.length;for(;h!==d&&f[h]===0;)h++,u++;const p=(d-h)*s+1>>>0,w=new Uint8Array(p);for(;h!==d;){let C=f[h],b=0;for(let B=p-1;(C!==0||b<l)&&B!==-1;B--,b++)C+=256*w[B]>>>0,w[B]=C%r>>>0,C=C/r>>>0;if(C!==0)throw new Error("Non-zero carry");l=b,h++}let m=p-l;for(;m!==p&&w[m]===0;)m++;let D=n.repeat(u);for(;m<p;++m)D+=t.charAt(w[m]);return D}function a(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;let u=0,l=0,h=0;for(;f[u]===n;)l++,u++;const d=(f.length-u)*i+1>>>0,p=new Uint8Array(d);for(;u<f.length;){const C=f.charCodeAt(u);if(C>255)return;let b=e[C];if(b===255)return;let B=0;for(let F=d-1;(b!==0||B<h)&&F!==-1;F--,B++)b+=r*p[F]>>>0,p[F]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");h=B,u++}let w=d-h;for(;w!==d&&p[w]===0;)w++;const m=new Uint8Array(l+(d-w));let D=l;for(;w!==d;)m[D++]=p[w++];return m}function c(f){const u=a(f);if(u)return u;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var J5="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";X5(J5);function Q5(t){const e=t.length;let r=0,n=0;for(;n<e;){let i=t.charCodeAt(n++);if((i&4294967168)===0){r++;continue}else if((i&4294965248)===0)r+=2;else{if(i>=55296&&i<=56319&&n<e){const s=t.charCodeAt(n);(s&64512)===56320&&(++n,i=((i&1023)<<10)+(s&1023)+65536)}(i&4294901760)===0?r+=3:r+=4}}return r}function ex(t,e,r){const n=t.length;let i=r,s=0;for(;s<n;){let o=t.charCodeAt(s++);if((o&4294967168)===0){e[i++]=o;continue}else if((o&4294965248)===0)e[i++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<n){const a=t.charCodeAt(s);(a&64512)===56320&&(++s,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[i++]=o>>12&15|224,e[i++]=o>>6&63|128):(e[i++]=o>>18&7|240,e[i++]=o>>12&63|128,e[i++]=o>>6&63|128)}e[i++]=o&63|128}}const tx=new TextEncoder,rx=50;function nx(t,e,r){tx.encodeInto(t,e.subarray(r))}function ix(t,e,r){t.length>rx?nx(t,e,r):ex(t,e,r)}const sx=4096;function W2(t,e,r){let n=e;const i=n+r,s=[];let o="";for(;n<i;){const a=t[n++];if((a&128)===0)s.push(a);else if((a&224)===192){const c=t[n++]&63;s.push((a&31)<<6|c)}else if((a&240)===224){const c=t[n++]&63,f=t[n++]&63;s.push((a&31)<<12|c<<6|f)}else if((a&248)===240){const c=t[n++]&63,f=t[n++]&63,u=t[n++]&63;let l=(a&7)<<18|c<<12|f<<6|u;l>65535&&(l-=65536,s.push(l>>>10&1023|55296),l=56320|l&1023),s.push(l)}else s.push(a);s.length>=sx&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}const ox=new TextDecoder,ax=200;function cx(t,e,r){const n=t.subarray(e,e+r);return ox.decode(n)}function fx(t,e,r){return r>ax?cx(t,e,r):W2(t,e,r)}class _c{constructor(e,r){this.type=e,this.data=r}}class sr extends Error{constructor(e){super(e);const r=Object.create(sr.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:sr.name})}}const ia=4294967295;function ux(t,e,r){const n=r/4294967296,i=r;t.setUint32(e,n),t.setUint32(e+4,i)}function Y2(t,e,r){const n=Math.floor(r/4294967296),i=r;t.setUint32(e,n),t.setUint32(e+4,i)}function X2(t,e){const r=t.getInt32(e),n=t.getUint32(e+4);return r*4294967296+n}function hx(t,e){const r=t.getUint32(e),n=t.getUint32(e+4);return r*4294967296+n}const lx=-1,dx=4294967296-1,px=17179869184-1;function gx({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=px)if(e===0&&t<=dx){const r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{const r=t/4294967296,n=t&4294967295,i=new Uint8Array(8),s=new DataView(i.buffer);return s.setUint32(0,e<<2|r&3),s.setUint32(4,n),i}else{const r=new Uint8Array(12),n=new DataView(r.buffer);return n.setUint32(0,e),Y2(n,4,t),r}}function yx(t){const e=t.getTime(),r=Math.floor(e/1e3),n=(e-r*1e3)*1e6,i=Math.floor(n/1e9);return{sec:r+i,nsec:n-i*1e9}}function wx(t){if(t instanceof Date){const e=yx(t);return gx(e)}else return null}function bx(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const r=e.getUint32(0),n=e.getUint32(4),i=(r&3)*4294967296+n,s=r>>>2;return{sec:i,nsec:s}}case 12:{const r=X2(e,4),n=e.getUint32(0);return{sec:r,nsec:n}}default:throw new sr(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function mx(t){const e=bx(t);return new Date(e.sec*1e3+e.nsec/1e6)}const Ex={type:lx,encode:wx,decode:mx};class Nf{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Ex)}register({type:e,encode:r,decode:n}){if(e>=0)this.encoders[e]=r,this.decoders[e]=n;else{const i=-1-e;this.builtInEncoders[i]=r,this.builtInDecoders[i]=n}}tryToEncode(e,r){for(let n=0;n<this.builtInEncoders.length;n++){const i=this.builtInEncoders[n];if(i!=null){const s=i(e,r);if(s!=null){const o=-1-n;return new _c(o,s)}}}for(let n=0;n<this.encoders.length;n++){const i=this.encoders[n];if(i!=null){const s=i(e,r);if(s!=null){const o=n;return new _c(o,s)}}}return e instanceof _c?e:null}decode(e,r,n){const i=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return i?i(e,r,n):new _c(r,e)}}Nf.defaultCodec=new Nf;function vx(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function ad(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):vx(t)?new Uint8Array(t):Uint8Array.from(t)}const xx=100,$x=2048;let Ax=class J2{constructor(e){this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??Nf.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.maxDepth=(e==null?void 0:e.maxDepth)??xx,this.initialBufferSize=(e==null?void 0:e.initialBufferSize)??$x,this.sortKeys=(e==null?void 0:e.sortKeys)??!1,this.forceFloat32=(e==null?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(e==null?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(e==null?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new J2({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){const r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){const r=new ArrayBuffer(e),n=new Uint8Array(r),i=new DataView(r);n.set(this.bytes),this.view=i,this.bytes=n}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const n=Q5(e);this.ensureBufferSizeToWrite(5+n),this.writeStringHeader(n),ix(e,this.bytes,this.pos),this.pos+=n}encodeObject(e,r){const n=this.extensionCodec.tryToEncode(e,this.context);if(n!=null)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);const n=ad(e);this.writeU8a(n)}encodeArray(e,r){const n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<4294967296)this.writeU8(221),this.writeU32(n);else throw new Error(`Too large array: ${n}`);for(const i of e)this.doEncode(i,r+1)}countWithoutUndefined(e,r){let n=0;for(const i of r)e[i]!==void 0&&n++;return n}encodeMap(e,r){const n=Object.keys(e);this.sortKeys&&n.sort();const i=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<4294967296)this.writeU8(223),this.writeU32(i);else throw new Error(`Too large map object: ${i}`);for(const s of n){const o=e[s];this.ignoreUndefined&&o===void 0||(this.encodeString(s),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){const n=e.data(this.pos+6),i=n.length;if(i>=4294967296)throw new Error(`Too large extension object: ${i}`);this.writeU8(201),this.writeU32(i),this.writeI8(e.type),this.writeU8a(n);return}const r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),ux(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Y2(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function Ix(t,e){return new Ax(e).encodeSharedRef(t)}function ih(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const Bx=16,Sx=16;class Ox{constructor(e=Bx,r=Sx){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let n=0;n<this.maxKeyLength;n++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,n){const i=this.caches[n-1];e:for(const s of i){const o=s.bytes;for(let a=0;a<n;a++)if(o[a]!==e[r+a])continue e;return s.str}return null}store(e,r){const n=this.caches[e.length-1],i={bytes:e,str:r};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=i:n.push(i)}decode(e,r,n){const i=this.find(e,r,n);if(i!=null)return this.hit++,i;this.miss++;const s=W2(e,r,n),o=Uint8Array.prototype.slice.call(e,r,r+n);return this.store(o,s),s}}const cd="array",ka="map_key",Q2="map_value",_x=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new sr("The type of key must be string or number but "+typeof t)};class Dx{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const r=this.getUninitializedStateFromPool();r.type=cd,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){const r=this.getUninitializedStateFromPool();r.type=ka,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===cd){const n=e;n.size=0,n.array=void 0,n.position=0,n.type=void 0}if(e.type===ka||e.type===Q2){const n=e;n.size=0,n.map=void 0,n.readCount=0,n.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const sa=-1,M0=new DataView(new ArrayBuffer(0)),Fx=new Uint8Array(M0.buffer);try{M0.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const P1=new RangeError("Insufficient data"),Ux=new Ox;let Cx=class em{constructor(e){this.totalPos=0,this.pos=0,this.view=M0,this.bytes=Fx,this.headByte=sa,this.stack=new Dx,this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??Nf.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.rawStrings=(e==null?void 0:e.rawStrings)??!1,this.maxStrLength=(e==null?void 0:e.maxStrLength)??ia,this.maxBinLength=(e==null?void 0:e.maxBinLength)??ia,this.maxArrayLength=(e==null?void 0:e.maxArrayLength)??ia,this.maxMapLength=(e==null?void 0:e.maxMapLength)??ia,this.maxExtLength=(e==null?void 0:e.maxExtLength)??ia,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:Ux,this.mapKeyConverter=(e==null?void 0:e.mapKeyConverter)??_x}clone(){return new em({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=sa,this.stack.reset()}setBuffer(e){const r=ad(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===sa&&!this.hasRemaining(1))this.setBuffer(e);else{const r=this.bytes.subarray(this.pos),n=ad(e),i=new Uint8Array(r.length+n.length);i.set(r),i.set(n,r.length),this.setBuffer(i)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:r,pos:n}=this;return new RangeError(`Extra ${r.byteLength-n} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,n;for await(const a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{n=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return n}const{headByte:i,pos:s,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${ih(i)} at ${o} (${s} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let n=r,i=-1;for await(const s of e){if(r&&i===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),n&&(i=this.readArraySize(),n=!1,this.complete());try{for(;yield this.doDecodeSync(),--i!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){const i=e-128;if(i!==0){this.pushMapState(i),this.complete();continue e}else r={}}else if(e<160){const i=e-144;if(i!==0){this.pushArrayState(i),this.complete();continue e}else r=[]}else{const i=e-160;r=this.decodeString(i,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){const i=this.lookU8();r=this.decodeString(i,1)}else if(e===218){const i=this.lookU16();r=this.decodeString(i,2)}else if(e===219){const i=this.lookU32();r=this.decodeString(i,4)}else if(e===220){const i=this.readU16();if(i!==0){this.pushArrayState(i),this.complete();continue e}else r=[]}else if(e===221){const i=this.readU32();if(i!==0){this.pushArrayState(i),this.complete();continue e}else r=[]}else if(e===222){const i=this.readU16();if(i!==0){this.pushMapState(i),this.complete();continue e}else r={}}else if(e===223){const i=this.readU32();if(i!==0){this.pushMapState(i),this.complete();continue e}else r={}}else if(e===196){const i=this.lookU8();r=this.decodeBinary(i,1)}else if(e===197){const i=this.lookU16();r=this.decodeBinary(i,2)}else if(e===198){const i=this.lookU32();r=this.decodeBinary(i,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){const i=this.lookU8();r=this.decodeExtension(i,1)}else if(e===200){const i=this.lookU16();r=this.decodeExtension(i,2)}else if(e===201){const i=this.lookU32();r=this.decodeExtension(i,4)}else throw new sr(`Unrecognized type byte: ${ih(e)}`);this.complete();const n=this.stack;for(;n.length>0;){const i=n.top();if(i.type===cd)if(i.array[i.position]=r,i.position++,i.position===i.size)r=i.array,n.release(i);else continue e;else if(i.type===ka){if(r==="__proto__")throw new sr("The key __proto__ is not allowed");i.key=this.mapKeyConverter(r),i.type=Q2;continue e}else if(i.map[i.key]=r,i.readCount++,i.readCount===i.size)r=i.map,n.release(i);else{i.key=null,i.type=ka;continue e}}return r}}readHeadByte(){return this.headByte===sa&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=sa}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new sr(`Unrecognized array type byte: ${ih(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new sr(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new sr(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){var s;if(e>this.maxStrLength)throw new sr(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw P1;const n=this.pos+r;let i;return this.stateIsMapKey()&&((s=this.keyDecoder)!=null&&s.canBeCached(e))?i=this.keyDecoder.decode(this.bytes,n,e):i=fx(this.bytes,n,e),this.pos+=r+e,i}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===ka:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new sr(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw P1;const n=this.pos+r,i=this.bytes.subarray(n,n+e);return this.pos+=r+e,i}decodeExtension(e,r){if(e>this.maxExtLength)throw new sr(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const n=this.view.getInt8(this.pos+r),i=this.decodeBinary(e,r+1);return this.extensionCodec.decode(i,n,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=hx(this.view,this.pos);return this.pos+=8,e}readI64(){const e=X2(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function Px(t,e){return new Cx(e).decode(t)}const Rx=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),Nx=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(n,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function Ws(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Nx(t)}catch{return t}}function Xn(t){return typeof t=="string"?t:Rx(t)||""}function Tx(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function tm(t,...e){if(!Tx(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function R1(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Lx(t,e){tm(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const so=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const sh=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function kx(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function rm(t){return typeof t=="string"&&(t=kx(t)),tm(t),t}let jx=class{clone(){return this._cloneInto()}};function qx(t){const e=n=>t().update(rm(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Mx(t=32){if(so&&typeof so.getRandomValues=="function")return so.getRandomValues(new Uint8Array(t));if(so&&typeof so.randomBytes=="function")return so.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function zx(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}let Hx=class extends jx{constructor(e,r,n,i){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=sh(this.buffer)}update(e){R1(this);const{view:r,buffer:n,blockLen:i}=this;e=rm(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=sh(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){R1(this),Lx(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let l=o;l<i;l++)r[l]=0;zx(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=sh(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)a.setUint32(4*l,u[l],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%r&&e.buffer.set(n),e}};const Dc=BigInt(2**32-1),fd=BigInt(32);function nm(t,e=!1){return e?{h:Number(t&Dc),l:Number(t>>fd&Dc)}:{h:Number(t>>fd&Dc)|0,l:Number(t&Dc)|0}}function Vx(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=nm(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const Kx=(t,e)=>BigInt(t>>>0)<<fd|BigInt(e>>>0),Gx=(t,e,r)=>t>>>r,Zx=(t,e,r)=>t<<32-r|e>>>r,Wx=(t,e,r)=>t>>>r|e<<32-r,Yx=(t,e,r)=>t<<32-r|e>>>r,Xx=(t,e,r)=>t<<64-r|e>>>r-32,Jx=(t,e,r)=>t>>>r-32|e<<64-r,Qx=(t,e)=>e,e$=(t,e)=>t,t$=(t,e,r)=>t<<r|e>>>32-r,r$=(t,e,r)=>e<<r|t>>>32-r,n$=(t,e,r)=>e<<r-32|t>>>64-r,i$=(t,e,r)=>t<<r-32|e>>>64-r;function s$(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const o$=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),a$=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,c$=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),f$=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,u$=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),h$=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,ie={fromBig:nm,split:Vx,toBig:Kx,shrSH:Gx,shrSL:Zx,rotrSH:Wx,rotrSL:Yx,rotrBH:Xx,rotrBL:Jx,rotr32H:Qx,rotr32L:e$,rotlSH:t$,rotlSL:r$,rotlBH:n$,rotlBL:i$,add:s$,add3L:o$,add3H:a$,add4L:c$,add4H:f$,add5H:h$,add5L:u$},[l$,d$]=ie.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),ti=new Uint32Array(80),ri=new Uint32Array(80);let p$=class extends Hx{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:f,El:u,Fh:l,Fl:h,Gh:d,Gl:p,Hh:w,Hl:m}=this;return[e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m]}set(e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=u|0,this.Fh=l|0,this.Fl=h|0,this.Gh=d|0,this.Gl=p|0,this.Hh=w|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)ti[b]=e.getUint32(r),ri[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const B=ti[b-15]|0,F=ri[b-15]|0,_=ie.rotrSH(B,F,1)^ie.rotrSH(B,F,8)^ie.shrSH(B,F,7),N=ie.rotrSL(B,F,1)^ie.rotrSL(B,F,8)^ie.shrSL(B,F,7),P=ti[b-2]|0,S=ri[b-2]|0,T=ie.rotrSH(P,S,19)^ie.rotrBH(P,S,61)^ie.shrSH(P,S,6),L=ie.rotrSL(P,S,19)^ie.rotrBL(P,S,61)^ie.shrSL(P,S,6),O=ie.add4L(N,L,ri[b-7],ri[b-16]),x=ie.add4H(O,_,T,ti[b-7],ti[b-16]);ti[b]=x|0,ri[b]=O|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:f,Dl:u,Eh:l,El:h,Fh:d,Fl:p,Gh:w,Gl:m,Hh:D,Hl:C}=this;for(let b=0;b<80;b++){const B=ie.rotrSH(l,h,14)^ie.rotrSH(l,h,18)^ie.rotrBH(l,h,41),F=ie.rotrSL(l,h,14)^ie.rotrSL(l,h,18)^ie.rotrBL(l,h,41),_=l&d^~l&w,N=h&p^~h&m,P=ie.add5L(C,F,N,d$[b],ri[b]),S=ie.add5H(P,D,B,_,l$[b],ti[b]),T=P|0,L=ie.rotrSH(n,i,28)^ie.rotrBH(n,i,34)^ie.rotrBH(n,i,39),O=ie.rotrSL(n,i,28)^ie.rotrBL(n,i,34)^ie.rotrBL(n,i,39),x=n&s^n&a^s&a,$=i&o^i&c^o&c;D=w|0,C=m|0,w=d|0,m=p|0,d=l|0,p=h|0,{h:l,l:h}=ie.add(f|0,u|0,S|0,T|0),f=a|0,u=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const g=ie.add3L(T,O,$);n=ie.add3H(g,S,L,x),i=g|0}({h:n,l:i}=ie.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=ie.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=ie.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l:u}=ie.add(this.Dh|0,this.Dl|0,f|0,u|0),{h:l,l:h}=ie.add(this.Eh|0,this.El|0,l|0,h|0),{h:d,l:p}=ie.add(this.Fh|0,this.Fl|0,d|0,p|0),{h:w,l:m}=ie.add(this.Gh|0,this.Gl|0,w|0,m|0),{h:D,l:C}=ie.add(this.Hh|0,this.Hl|0,D|0,C|0),this.set(n,i,s,o,a,c,f,u,l,h,d,p,w,m,D,C)}roundClean(){ti.fill(0),ri.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const g$=qx(()=>new p$);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const z0=BigInt(0),im=BigInt(1),y$=BigInt(2);function H0(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function V0(t){if(!H0(t))throw new Error("Uint8Array expected")}function oh(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const w$=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function K0(t){V0(t);let e="";for(let r=0;r<t.length;r++)e+=w$[t[r]];return e}function sm(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?z0:BigInt("0x"+t)}const yn={_0:48,_9:57,A:65,F:70,a:97,f:102};function N1(t){if(t>=yn._0&&t<=yn._9)return t-yn._0;if(t>=yn.A&&t<=yn.F)return t-(yn.A-10);if(t>=yn.a&&t<=yn.f)return t-(yn.a-10)}function om(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=N1(t.charCodeAt(s)),a=N1(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function b$(t){return sm(K0(t))}function Ef(t){return V0(t),sm(K0(Uint8Array.from(t).reverse()))}function am(t,e){return om(t.toString(16).padStart(e*2,"0"))}function ud(t,e){return am(t,e).reverse()}function wn(t,e,r){let n;if(typeof e=="string")try{n=om(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(H0(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function T1(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];V0(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const ah=t=>typeof t=="bigint"&&z0<=t;function m$(t,e,r){return ah(t)&&ah(e)&&ah(r)&&e<=t&&t<r}function oa(t,e,r,n){if(!m$(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function E$(t){let e;for(e=0;t>z0;t>>=im,e+=1);return e}const v$=t=>(y$<<BigInt(t-1))-im,x$={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||H0(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function G0(t,e,r={}){const n=(i,s,o)=>{const a=x$[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function L1(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const ze=BigInt(0),Be=BigInt(1),Bs=BigInt(2),$$=BigInt(3),hd=BigInt(4),k1=BigInt(5),j1=BigInt(8);function Re(t,e){const r=t%e;return r>=ze?r:e+r}function A$(t,e,r){if(e<ze)throw new Error("invalid exponent, negatives unsupported");if(r<=ze)throw new Error("invalid modulus");if(r===Be)return ze;let n=Be;for(;e>ze;)e&Be&&(n=n*t%r),t=t*t%r,e>>=Be;return n}function Qr(t,e,r){let n=t;for(;e-- >ze;)n*=n,n%=r;return n}function q1(t,e){if(t===ze)throw new Error("invert: expected non-zero number");if(e<=ze)throw new Error("invert: expected positive modulus, got "+e);let r=Re(t,e),n=e,i=ze,s=Be;for(;r!==ze;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==Be)throw new Error("invert: does not exist");return Re(i,e)}function I$(t){const e=(t-Be)/Bs;let r,n,i;for(r=t-Be,n=0;r%Bs===ze;r/=Bs,n++);for(i=Bs;i<t&&A$(i,e,t)!==t-Be;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+Be)/hd;return function(a,c){const f=a.pow(c,o);if(!a.eql(a.sqr(f),c))throw new Error("Cannot find square root");return f}}const s=(r+Be)/Bs;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,f=o.pow(o.mul(o.ONE,i),r),u=o.pow(a,s),l=o.pow(a,r);for(;!o.eql(l,o.ONE);){if(o.eql(l,o.ZERO))return o.ZERO;let h=1;for(let p=o.sqr(l);h<c&&!o.eql(p,o.ONE);h++)p=o.sqr(p);const d=o.pow(f,Be<<BigInt(c-h-1));f=o.sqr(d),u=o.mul(u,d),l=o.mul(l,f),c=h}return u}}function B$(t){if(t%hd===$$){const e=(t+Be)/hd;return function(r,n){const i=r.pow(n,e);if(!r.eql(r.sqr(i),n))throw new Error("Cannot find square root");return i}}if(t%j1===k1){const e=(t-k1)/j1;return function(r,n){const i=r.mul(n,Bs),s=r.pow(i,e),o=r.mul(n,s),a=r.mul(r.mul(o,Bs),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return I$(t)}const S$=(t,e)=>(Re(t,e)&Be)===Be,O$=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function _$(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=O$.reduce((n,i)=>(n[i]="function",n),e);return G0(t,r)}function D$(t,e,r){if(r<ze)throw new Error("invalid exponent, negatives unsupported");if(r===ze)return t.ONE;if(r===Be)return e;let n=t.ONE,i=e;for(;r>ze;)r&Be&&(n=t.mul(n,i)),i=t.sqr(i),r>>=Be;return n}function F$(t,e){const r=new Array(e.length),n=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),i=t.inv(n);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),i),r}function cm(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function fm(t,e,r=!1,n={}){if(t<=ze)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=cm(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:v$(i),ZERO:ze,ONE:Be,create:c=>Re(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return ze<=c&&c<t},is0:c=>c===ze,isOdd:c=>(c&Be)===Be,neg:c=>Re(-c,t),eql:(c,f)=>c===f,sqr:c=>Re(c*c,t),add:(c,f)=>Re(c+f,t),sub:(c,f)=>Re(c-f,t),mul:(c,f)=>Re(c*f,t),pow:(c,f)=>D$(a,c,f),div:(c,f)=>Re(c*q1(f,t),t),sqrN:c=>c*c,addN:(c,f)=>c+f,subN:(c,f)=>c-f,mulN:(c,f)=>c*f,inv:c=>q1(c,t),sqrt:n.sqrt||(c=>(o||(o=B$(t)),o(a,c))),invertBatch:c=>F$(a,c),cmov:(c,f,u)=>u?f:c,toBytes:c=>r?ud(c,s):am(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Ef(c):b$(c)}});return Object.freeze(a)}const M1=BigInt(0),Fc=BigInt(1);function ch(t,e){const r=e.negate();return t?r:e}function um(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function fh(t,e){um(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function U$(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function C$(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const uh=new WeakMap,hm=new WeakMap;function hh(t){return hm.get(t)||1}function P$(t,e){return{constTimeNegate:ch,hasPrecomputes(r){return hh(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>M1;)n&Fc&&(i=i.add(s)),s=s.double(),n>>=Fc;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=fh(n,e),o=[];let a=r,c=a;for(let f=0;f<i;f++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){const{windows:s,windowSize:o}=fh(r,e);let a=t.ZERO,c=t.BASE;const f=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<s;h++){const d=h*o;let p=Number(i&f);i>>=l,p>o&&(p-=u,i+=Fc);const w=d,m=d+Math.abs(p)-1,D=h%2!==0,C=p<0;p===0?c=c.add(ch(D,n[w])):a=a.add(ch(C,n[m]))}return{p:a,f:c}},wNAFUnsafe(r,n,i,s=t.ZERO){const{windows:o,windowSize:a}=fh(r,e),c=BigInt(2**r-1),f=2**r,u=BigInt(r);for(let l=0;l<o;l++){const h=l*a;if(i===M1)break;let d=Number(i&c);if(i>>=u,d>a&&(d-=f,i+=Fc),d===0)continue;let p=n[h+Math.abs(d)-1];d<0&&(p=p.negate()),s=s.add(p)}return s},getPrecomputes(r,n,i){let s=uh.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&uh.set(n,i(s))),s},wNAFCached(r,n,i){const s=hh(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=hh(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){um(n,e),hm.set(r,n),uh.delete(r)}}}function R$(t,e,r,n){if(U$(r,t),C$(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=E$(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),f=Math.floor((e.BITS-1)/o)*o;let u=i;for(let l=f;l>=0;l-=o){c.fill(i);for(let d=0;d<n.length;d++){const p=n[d],w=Number(p>>BigInt(l)&BigInt(a));c[w]=c[w].add(r[d])}let h=i;for(let d=c.length-1,p=i;d>0;d--)p=p.add(c[d]),h=h.add(p);if(u=u.add(h),l!==0)for(let d=0;d<o;d++)u=u.double()}return u}function N$(t){return _$(t.Fp),G0(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...cm(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const Or=BigInt(0),Nt=BigInt(1),Uc=BigInt(2),T$=BigInt(8),L$={zip215:!0};function k$(t){const e=N$(t);return G0(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function j$(t){const e=k$(t),{Fp:r,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,f=Uc<<BigInt(a*8)-Nt,u=r.create,l=fm(e.n,e.nBitLength),h=e.uvRatio||((g,y)=>{try{return{isValid:!0,value:r.sqrt(g*r.inv(y))}}catch{return{isValid:!1,value:Or}}}),d=e.adjustScalarBytes||(g=>g),p=e.domain||((g,y,v)=>{if(oh("phflag",v),y.length||v)throw new Error("Contexts/pre-hash are not supported");return g});function w(g,y){oa("coordinate "+g,y,Or,f)}function m(g){if(!(g instanceof b))throw new Error("ExtendedPoint expected")}const D=L1((g,y)=>{const{ex:v,ey:I,ez:E}=g,A=g.is0();y==null&&(y=A?T$:r.inv(E));const U=u(v*y),R=u(I*y),q=u(E*y);if(A)return{x:Or,y:Nt};if(q!==Nt)throw new Error("invZ was invalid");return{x:U,y:R}}),C=L1(g=>{const{a:y,d:v}=e;if(g.is0())throw new Error("bad point: ZERO");const{ex:I,ey:E,ez:A,et:U}=g,R=u(I*I),q=u(E*E),j=u(A*A),k=u(j*j),M=u(R*y),H=u(j*u(M+q)),V=u(k+u(v*u(R*q)));if(H!==V)throw new Error("bad point: equation left != right (1)");const z=u(I*E),K=u(A*U);if(z!==K)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(y,v,I,E){this.ex=y,this.ey=v,this.ez=I,this.et=E,w("x",y),w("y",v),w("z",I),w("t",E),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(y){if(y instanceof b)throw new Error("extended point not allowed");const{x:v,y:I}=y||{};return w("x",v),w("y",I),new b(v,I,Nt,u(v*I))}static normalizeZ(y){const v=r.invertBatch(y.map(I=>I.ez));return y.map((I,E)=>I.toAffine(v[E])).map(b.fromAffine)}static msm(y,v){return R$(b,l,y,v)}_setWindowSize(y){_.setWindowSize(this,y)}assertValidity(){C(this)}equals(y){m(y);const{ex:v,ey:I,ez:E}=this,{ex:A,ey:U,ez:R}=y,q=u(v*R),j=u(A*E),k=u(I*R),M=u(U*E);return q===j&&k===M}is0(){return this.equals(b.ZERO)}negate(){return new b(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:y}=e,{ex:v,ey:I,ez:E}=this,A=u(v*v),U=u(I*I),R=u(Uc*u(E*E)),q=u(y*A),j=v+I,k=u(u(j*j)-A-U),M=q+U,H=M-R,V=q-U,z=u(k*H),K=u(M*V),Q=u(k*V),ee=u(H*M);return new b(z,K,ee,Q)}add(y){m(y);const{a:v,d:I}=e,{ex:E,ey:A,ez:U,et:R}=this,{ex:q,ey:j,ez:k,et:M}=y;if(v===BigInt(-1)){const vr=u((A-E)*(j+q)),xr=u((A+E)*(j-q)),St=u(xr-vr);if(St===Or)return this.double();const $r=u(U*Uc*M),Ar=u(R*Uc*k),Ir=Ar+$r,Br=xr+vr,Sr=Ar-$r,ys=u(Ir*St),ws=u(Br*Sr),bs=u(Ir*Sr),ms=u(St*Br);return new b(ys,ws,ms,bs)}const H=u(E*q),V=u(A*j),z=u(R*I*M),K=u(U*k),Q=u((E+A)*(q+j)-H-V),ee=K-z,ne=K+z,he=u(V-v*H),Bt=u(Q*ee),Rt=u(ne*he),ps=u(Q*he),gs=u(ee*ne);return new b(Bt,Rt,gs,ps)}subtract(y){return this.add(y.negate())}wNAF(y){return _.wNAFCached(this,y,b.normalizeZ)}multiply(y){const v=y;oa("scalar",v,Nt,n);const{p:I,f:E}=this.wNAF(v);return b.normalizeZ([I,E])[0]}multiplyUnsafe(y,v=b.ZERO){const I=y;return oa("scalar",I,Or,n),I===Or?F:this.is0()||I===Nt?this:_.wNAFCachedUnsafe(this,I,b.normalizeZ,v)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return _.unsafeLadder(this,n).is0()}toAffine(y){return D(this,y)}clearCofactor(){const{h:y}=e;return y===Nt?this:this.multiplyUnsafe(y)}static fromHex(y,v=!1){const{d:I,a:E}=e,A=r.BYTES;y=wn("pointHex",y,A),oh("zip215",v);const U=y.slice(),R=y[A-1];U[A-1]=R&-129;const q=Ef(U),j=v?f:r.ORDER;oa("pointHex.y",q,Or,j);const k=u(q*q),M=u(k-Nt),H=u(I*k-E);let{isValid:V,value:z}=h(M,H);if(!V)throw new Error("Point.fromHex: invalid y coordinate");const K=(z&Nt)===Nt,Q=(R&128)!==0;if(!v&&z===Or&&Q)throw new Error("Point.fromHex: x=0 and x_0=1");return Q!==K&&(z=u(-z)),b.fromAffine({x:z,y:q})}static fromPrivateKey(y){return S(y).point}toRawBytes(){const{x:y,y:v}=this.toAffine(),I=ud(v,r.BYTES);return I[I.length-1]|=y&Nt?128:0,I}toHex(){return K0(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,Nt,u(e.Gx*e.Gy)),b.ZERO=new b(Or,Nt,Nt,Or);const{BASE:B,ZERO:F}=b,_=P$(b,a*8);function N(g){return Re(g,n)}function P(g){return N(Ef(g))}function S(g){const y=r.BYTES;g=wn("private key",g,y);const v=wn("hashed private key",s(g),2*y),I=d(v.slice(0,y)),E=v.slice(y,2*y),A=P(I),U=B.multiply(A),R=U.toRawBytes();return{head:I,prefix:E,scalar:A,point:U,pointBytes:R}}function T(g){return S(g).pointBytes}function L(g=new Uint8Array,...y){const v=T1(...y);return P(s(p(v,wn("context",g),!!i)))}function O(g,y,v={}){g=wn("message",g),i&&(g=i(g));const{prefix:I,scalar:E,pointBytes:A}=S(y),U=L(v.context,I,g),R=B.multiply(U).toRawBytes(),q=L(v.context,R,A,g),j=N(U+q*E);oa("signature.s",j,Or,n);const k=T1(R,ud(j,r.BYTES));return wn("result",k,r.BYTES*2)}const x=L$;function $(g,y,v,I=x){const{context:E,zip215:A}=I,U=r.BYTES;g=wn("signature",g,2*U),y=wn("message",y),v=wn("publicKey",v,U),A!==void 0&&oh("zip215",A),i&&(y=i(y));const R=Ef(g.slice(U,2*U));let q,j,k;try{q=b.fromHex(v,A),j=b.fromHex(g.slice(0,U),A),k=B.multiplyUnsafe(R)}catch{return!1}if(!A&&q.isSmallOrder())return!1;const M=L(E,j.toRawBytes(),q.toRawBytes(),y);return j.add(q.multiplyUnsafe(M)).subtract(k).clearCofactor().equals(b.ZERO)}return B._setWindowSize(8),{CURVE:e,getPublicKey:T,sign:O,verify:$,ExtendedPoint:b,utils:{getExtendedPublicKey:S,randomPrivateKey:()=>o(r.BYTES),precompute(g=8,y=b.BASE){return y._setWindowSize(g),y.multiply(BigInt(3)),y}}}}BigInt(0),BigInt(1);const Z0=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),z1=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const q$=BigInt(1),H1=BigInt(2);BigInt(3);const M$=BigInt(5),z$=BigInt(8);function H$(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=Z0,o=t*t%s*t%s,a=Qr(o,H1,s)*o%s,c=Qr(a,q$,s)*t%s,f=Qr(c,M$,s)*c%s,u=Qr(f,e,s)*f%s,l=Qr(u,r,s)*u%s,h=Qr(l,n,s)*l%s,d=Qr(h,i,s)*h%s,p=Qr(d,i,s)*h%s,w=Qr(p,e,s)*f%s;return{pow_p_5_8:Qr(w,H1,s)*t%s,b2:o}}function V$(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function K$(t,e){const r=Z0,n=Re(e*e*e,r),i=Re(n*n*e,r),s=H$(t*i).pow_p_5_8;let o=Re(t*n*s,r);const a=Re(e*o*o,r),c=o,f=Re(o*z1,r),u=a===t,l=a===Re(-t,r),h=a===Re(-t*z1,r);return u&&(o=c),(l||h)&&(o=f),S$(o,r)&&(o=Re(-o,r)),{isValid:u||l,value:o}}const G$=fm(Z0,void 0,!0),Z$={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:G$,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:z$,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:g$,randomBytes:Mx,adjustScalarBytes:V$,uvRatio:K$};j$(Z$);function W$(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),f=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var w=0,m=0,D=0,C=p.length;D!==C&&p[D]===0;)D++,w++;for(var b=(C-D)*u+1>>>0,B=new Uint8Array(b);D!==C;){for(var F=p[D],_=0,N=b-1;(F!==0||_<m)&&N!==-1;N--,_++)F+=256*B[N]>>>0,B[N]=F%a>>>0,F=F/a>>>0;if(F!==0)throw new Error("Non-zero carry");m=_,D++}for(var P=b-m;P!==b&&B[P]===0;)P++;for(var S=c.repeat(w);P<b;++P)S+=t.charAt(B[P]);return S}function h(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var w=0;if(p[w]!==" "){for(var m=0,D=0;p[w]===c;)m++,w++;for(var C=(p.length-w)*f+1>>>0,b=new Uint8Array(C);p[w];){var B=r[p.charCodeAt(w)];if(B===255)return;for(var F=0,_=C-1;(B!==0||F<D)&&_!==-1;_--,F++)B+=a*b[_]>>>0,b[_]=B%256>>>0,B=B/256>>>0;if(B!==0)throw new Error("Non-zero carry");D=F,w++}if(p[w]!==" "){for(var N=C-D;N!==C&&b[N]===0;)N++;for(var P=new Uint8Array(m+(C-N)),S=m;N!==C;)P[S++]=b[N++];return P}}}function d(p){var w=h(p);if(w)return w;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:h,decode:d}}var Y$=W$,X$=Y$;const lm=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},J$=t=>new TextEncoder().encode(t),Q$=t=>new TextDecoder().decode(t);let e7=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},t7=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return dm(this,e)}},r7=class{constructor(e){this.decoders=e}or(e){return dm(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const dm=(t,e)=>new r7({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let n7=class{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new e7(e,r,n),this.decoder=new t7(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const pu=({name:t,prefix:e,encode:r,decode:n})=>new n7(t,e,r,n),oc=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=X$(r,e);return pu({prefix:t,name:e,encode:n,decode:s=>lm(i(s))})},i7=(t,e,r,n)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,f=0;for(let u=0;u<s;++u){const l=i[t[u]];if(l===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|l,a+=r,a>=8&&(a-=8,o[f++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},s7=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},tt=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>pu({prefix:e,name:t,encode(i){return s7(i,n,r)},decode(i){return i7(i,n,r,t)}}),o7=pu({prefix:"\0",name:"identity",encode:t=>Q$(t),decode:t=>J$(t)});var a7=Object.freeze({__proto__:null,identity:o7});const c7=tt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var f7=Object.freeze({__proto__:null,base2:c7});const u7=tt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var h7=Object.freeze({__proto__:null,base8:u7});const l7=oc({prefix:"9",name:"base10",alphabet:"0123456789"});var d7=Object.freeze({__proto__:null,base10:l7});const p7=tt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),g7=tt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var y7=Object.freeze({__proto__:null,base16:p7,base16upper:g7});const w7=tt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),b7=tt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),m7=tt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),E7=tt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),v7=tt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),x7=tt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),$7=tt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),A7=tt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),I7=tt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var B7=Object.freeze({__proto__:null,base32:w7,base32upper:b7,base32pad:m7,base32padupper:E7,base32hex:v7,base32hexupper:x7,base32hexpad:$7,base32hexpadupper:A7,base32z:I7});const S7=oc({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),O7=oc({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var _7=Object.freeze({__proto__:null,base36:S7,base36upper:O7});const D7=oc({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),F7=oc({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var U7=Object.freeze({__proto__:null,base58btc:D7,base58flickr:F7});const C7=tt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),P7=tt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),R7=tt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),N7=tt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var T7=Object.freeze({__proto__:null,base64:C7,base64pad:P7,base64url:R7,base64urlpad:N7});const pm=Array.from(""),L7=pm.reduce((t,e,r)=>(t[r]=e,t),[]),k7=pm.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function j7(t){return t.reduce((e,r)=>(e+=L7[r],e),"")}function q7(t){const e=[];for(const r of t){const n=k7[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const M7=pu({prefix:"",name:"base256emoji",encode:j7,decode:q7});var z7=Object.freeze({__proto__:null,base256emoji:M7}),H7=gm,V1=128,V7=-128,K7=Math.pow(2,31);function gm(t,e,r){e=e||[],r=r||0;for(var n=r;t>=K7;)e[r++]=t&255|V1,t/=128;for(;t&V7;)e[r++]=t&255|V1,t>>>=7;return e[r]=t|0,gm.bytes=r-n+1,e}var G7=ld,Z7=128,K1=127;function ld(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw ld.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&K1)<<i:(o&K1)*Math.pow(2,i),i+=7}while(o>=Z7);return ld.bytes=s-n,r}var W7=Math.pow(2,7),Y7=Math.pow(2,14),X7=Math.pow(2,21),J7=Math.pow(2,28),Q7=Math.pow(2,35),e9=Math.pow(2,42),t9=Math.pow(2,49),r9=Math.pow(2,56),n9=Math.pow(2,63),i9=function(t){return t<W7?1:t<Y7?2:t<X7?3:t<J7?4:t<Q7?5:t<e9?6:t<t9?7:t<r9?8:t<n9?9:10},s9={encode:H7,decode:G7,encodingLength:i9},ym=s9;const G1=(t,e,r=0)=>(ym.encode(t,e,r),e),Z1=t=>ym.encodingLength(t),dd=(t,e)=>{const r=e.byteLength,n=Z1(t),i=n+Z1(r),s=new Uint8Array(i+r);return G1(t,s,0),G1(r,s,n),s.set(e,i),new o9(t,r,e,s)};let o9=class{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}};const wm=({name:t,code:e,encode:r})=>new a9(t,e,r);let a9=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?dd(this.code,r):r.then(n=>dd(this.code,n))}else throw Error("Unknown type, must be binary type")}};const bm=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),c9=wm({name:"sha2-256",code:18,encode:bm("SHA-256")}),f9=wm({name:"sha2-512",code:19,encode:bm("SHA-512")});var u9=Object.freeze({__proto__:null,sha256:c9,sha512:f9});const mm=0,h9="identity",Em=lm,l9=t=>dd(mm,Em(t)),d9={code:mm,name:h9,encode:Em,digest:l9};var p9=Object.freeze({__proto__:null,identity:d9});new TextEncoder,new TextDecoder;({...a7,...f7,...h7,...d7,...y7,...B7,..._7,...U7,...T7,...z7});({...u9,...p9});function g9(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),f=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var w=0,m=0,D=0,C=p.length;D!==C&&p[D]===0;)D++,w++;for(var b=(C-D)*u+1>>>0,B=new Uint8Array(b);D!==C;){for(var F=p[D],_=0,N=b-1;(F!==0||_<m)&&N!==-1;N--,_++)F+=256*B[N]>>>0,B[N]=F%a>>>0,F=F/a>>>0;if(F!==0)throw new Error("Non-zero carry");m=_,D++}for(var P=b-m;P!==b&&B[P]===0;)P++;for(var S=c.repeat(w);P<b;++P)S+=t.charAt(B[P]);return S}function h(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var w=0;if(p[w]!==" "){for(var m=0,D=0;p[w]===c;)m++,w++;for(var C=(p.length-w)*f+1>>>0,b=new Uint8Array(C);p[w];){var B=r[p.charCodeAt(w)];if(B===255)return;for(var F=0,_=C-1;(B!==0||F<D)&&_!==-1;_--,F++)B+=a*b[_]>>>0,b[_]=B%256>>>0,B=B/256>>>0;if(B!==0)throw new Error("Non-zero carry");D=F,w++}if(p[w]!==" "){for(var N=C-D;N!==C&&b[N]===0;)N++;for(var P=new Uint8Array(m+(C-N)),S=m;N!==C;)P[S++]=b[N++];return P}}}function d(p){var w=h(p);if(w)return w;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:h,decode:d}}var y9=g9,w9=y9;const b9=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},m9=t=>new TextEncoder().encode(t),E9=t=>new TextDecoder().decode(t);class v9{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class x9{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return vm(this,e)}}class $9{constructor(e){this.decoders=e}or(e){return vm(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const vm=(t,e)=>new $9({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class A9{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new v9(e,r,n),this.decoder=new x9(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const gu=({name:t,prefix:e,encode:r,decode:n})=>new A9(t,e,r,n),ac=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=w9(r,e);return gu({prefix:t,name:e,encode:n,decode:s=>b9(i(s))})},I9=(t,e,r,n)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,f=0;for(let u=0;u<s;++u){const l=i[t[u]];if(l===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|l,a+=r,a>=8&&(a-=8,o[f++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},B9=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},rt=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>gu({prefix:e,name:t,encode(i){return B9(i,n,r)},decode(i){return I9(i,n,r,t)}}),S9=gu({prefix:"\0",name:"identity",encode:t=>E9(t),decode:t=>m9(t)}),O9=Object.freeze(Object.defineProperty({__proto__:null,identity:S9},Symbol.toStringTag,{value:"Module"})),_9=rt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),D9=Object.freeze(Object.defineProperty({__proto__:null,base2:_9},Symbol.toStringTag,{value:"Module"})),F9=rt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),U9=Object.freeze(Object.defineProperty({__proto__:null,base8:F9},Symbol.toStringTag,{value:"Module"})),C9=ac({prefix:"9",name:"base10",alphabet:"0123456789"}),P9=Object.freeze(Object.defineProperty({__proto__:null,base10:C9},Symbol.toStringTag,{value:"Module"})),R9=rt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),N9=rt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),T9=Object.freeze(Object.defineProperty({__proto__:null,base16:R9,base16upper:N9},Symbol.toStringTag,{value:"Module"})),L9=rt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),k9=rt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),j9=rt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),q9=rt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),M9=rt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),z9=rt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),H9=rt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),V9=rt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),K9=rt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),G9=Object.freeze(Object.defineProperty({__proto__:null,base32:L9,base32hex:M9,base32hexpad:H9,base32hexpadupper:V9,base32hexupper:z9,base32pad:j9,base32padupper:q9,base32upper:k9,base32z:K9},Symbol.toStringTag,{value:"Module"})),Z9=ac({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),W9=ac({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Y9=Object.freeze(Object.defineProperty({__proto__:null,base36:Z9,base36upper:W9},Symbol.toStringTag,{value:"Module"})),X9=ac({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),J9=ac({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Q9=Object.freeze(Object.defineProperty({__proto__:null,base58btc:X9,base58flickr:J9},Symbol.toStringTag,{value:"Module"})),eA=rt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),tA=rt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),rA=rt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),nA=rt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),iA=Object.freeze(Object.defineProperty({__proto__:null,base64:eA,base64pad:tA,base64url:rA,base64urlpad:nA},Symbol.toStringTag,{value:"Module"})),xm=Array.from(""),sA=xm.reduce((t,e,r)=>(t[r]=e,t),[]),oA=xm.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function aA(t){return t.reduce((e,r)=>(e+=sA[r],e),"")}function cA(t){const e=[];for(const r of t){const n=oA[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const fA=gu({prefix:"",name:"base256emoji",encode:aA,decode:cA}),uA=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:fA},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Tf={...O9,...D9,...U9,...P9,...T9,...G9,...Y9,...Q9,...iA,...uA},hA={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var lh,W1;function $m(){if(W1)return lh;W1=1;const t="Input must be an string, Buffer or Uint8Array";function e(o){let a;if(o instanceof Uint8Array)a=o;else if(typeof o=="string")a=new TextEncoder().encode(o);else throw new Error(t);return a}function r(o){return Array.prototype.map.call(o,function(a){return(a<16?"0":"")+a.toString(16)}).join("")}function n(o){return(4294967296+o).toString(16).substring(1)}function i(o,a,c){let f=`
`+o+" = ";for(let u=0;u<a.length;u+=2){if(c===32)f+=n(a[u]).toUpperCase(),f+=" ",f+=n(a[u+1]).toUpperCase();else if(c===64)f+=n(a[u+1]).toUpperCase(),f+=n(a[u]).toUpperCase();else throw new Error("Invalid size "+c);u%6===4?f+=`
`+new Array(o.length+4).join(" "):u<a.length-2&&(f+=" ")}console.log(f)}function s(o,a,c){let f=new Date().getTime();const u=new Uint8Array(a);for(let h=0;h<a;h++)u[h]=h%256;const l=new Date().getTime();console.log("Generated random input in "+(l-f)+"ms"),f=l;for(let h=0;h<c;h++){const d=o(u),p=new Date().getTime(),w=p-f;f=p,console.log("Hashed in "+w+"ms: "+d.substring(0,20)+"..."),console.log(Math.round(a/(1<<20)/(w/1e3)*100)/100+" MB PER SECOND")}}return lh={normalizeInput:e,toHex:r,debugPrint:i,testSpeed:s},lh}var dh,Y1;function lA(){if(Y1)return dh;Y1=1;const t=$m();function e(D,C,b){const B=D[C]+D[b];let F=D[C+1]+D[b+1];B>=4294967296&&F++,D[C]=B,D[C+1]=F}function r(D,C,b,B){let F=D[C]+b;b<0&&(F+=4294967296);let _=D[C+1]+B;F>=4294967296&&_++,D[C]=F,D[C+1]=_}function n(D,C){return D[C]^D[C+1]<<8^D[C+2]<<16^D[C+3]<<24}function i(D,C,b,B,F,_){const N=f[F],P=f[F+1],S=f[_],T=f[_+1];e(c,D,C),r(c,D,N,P);let L=c[B]^c[D],O=c[B+1]^c[D+1];c[B]=O,c[B+1]=L,e(c,b,B),L=c[C]^c[b],O=c[C+1]^c[b+1],c[C]=L>>>24^O<<8,c[C+1]=O>>>24^L<<8,e(c,D,C),r(c,D,S,T),L=c[B]^c[D],O=c[B+1]^c[D+1],c[B]=L>>>16^O<<16,c[B+1]=O>>>16^L<<16,e(c,b,B),L=c[C]^c[b],O=c[C+1]^c[b+1],c[C]=O>>>31^L<<1,c[C+1]=L>>>31^O<<1}const s=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],a=new Uint8Array(o.map(function(D){return D*2})),c=new Uint32Array(32),f=new Uint32Array(32);function u(D,C){let b=0;for(b=0;b<16;b++)c[b]=D.h[b],c[b+16]=s[b];for(c[24]=c[24]^D.t,c[25]=c[25]^D.t/4294967296,C&&(c[28]=~c[28],c[29]=~c[29]),b=0;b<32;b++)f[b]=n(D.b,4*b);for(b=0;b<12;b++)i(0,8,16,24,a[b*16+0],a[b*16+1]),i(2,10,18,26,a[b*16+2],a[b*16+3]),i(4,12,20,28,a[b*16+4],a[b*16+5]),i(6,14,22,30,a[b*16+6],a[b*16+7]),i(0,10,20,30,a[b*16+8],a[b*16+9]),i(2,12,22,24,a[b*16+10],a[b*16+11]),i(4,14,16,26,a[b*16+12],a[b*16+13]),i(6,8,18,28,a[b*16+14],a[b*16+15]);for(b=0;b<16;b++)D.h[b]=D.h[b]^c[b]^c[b+16]}const l=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function h(D,C,b,B){if(D===0||D>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(C&&C.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(b&&b.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(B&&B.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const F={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:D};l.fill(0),l[0]=D,C&&(l[1]=C.length),l[2]=1,l[3]=1,b&&l.set(b,32),B&&l.set(B,48);for(let _=0;_<16;_++)F.h[_]=s[_]^n(l,_*4);return C&&(d(F,C),F.c=128),F}function d(D,C){for(let b=0;b<C.length;b++)D.c===128&&(D.t+=D.c,u(D,!1),D.c=0),D.b[D.c++]=C[b]}function p(D){for(D.t+=D.c;D.c<128;)D.b[D.c++]=0;u(D,!0);const C=new Uint8Array(D.outlen);for(let b=0;b<D.outlen;b++)C[b]=D.h[b>>2]>>8*(b&3);return C}function w(D,C,b,B,F){b=b||64,D=t.normalizeInput(D),B&&(B=t.normalizeInput(B)),F&&(F=t.normalizeInput(F));const _=h(b,C,B,F);return d(_,D),p(_)}function m(D,C,b,B,F){const _=w(D,C,b,B,F);return t.toHex(_)}return dh={blake2b:w,blake2bHex:m,blake2bInit:h,blake2bUpdate:d,blake2bFinal:p},dh}var ph,X1;function dA(){if(X1)return ph;X1=1;const t=$m();function e(p,w){return p[w]^p[w+1]<<8^p[w+2]<<16^p[w+3]<<24}function r(p,w,m,D,C,b){o[p]=o[p]+o[w]+C,o[D]=n(o[D]^o[p],16),o[m]=o[m]+o[D],o[w]=n(o[w]^o[m],12),o[p]=o[p]+o[w]+b,o[D]=n(o[D]^o[p],8),o[m]=o[m]+o[D],o[w]=n(o[w]^o[m],7)}function n(p,w){return p>>>w^p<<32-w}const i=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),s=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),o=new Uint32Array(16),a=new Uint32Array(16);function c(p,w){let m=0;for(m=0;m<8;m++)o[m]=p.h[m],o[m+8]=i[m];for(o[12]^=p.t,o[13]^=p.t/4294967296,w&&(o[14]=~o[14]),m=0;m<16;m++)a[m]=e(p.b,4*m);for(m=0;m<10;m++)r(0,4,8,12,a[s[m*16+0]],a[s[m*16+1]]),r(1,5,9,13,a[s[m*16+2]],a[s[m*16+3]]),r(2,6,10,14,a[s[m*16+4]],a[s[m*16+5]]),r(3,7,11,15,a[s[m*16+6]],a[s[m*16+7]]),r(0,5,10,15,a[s[m*16+8]],a[s[m*16+9]]),r(1,6,11,12,a[s[m*16+10]],a[s[m*16+11]]),r(2,7,8,13,a[s[m*16+12]],a[s[m*16+13]]),r(3,4,9,14,a[s[m*16+14]],a[s[m*16+15]]);for(m=0;m<8;m++)p.h[m]^=o[m]^o[m+8]}function f(p,w){if(!(p>0&&p<=32))throw new Error("Incorrect output length, should be in [1, 32]");const m=w?w.length:0;if(w&&!(m>0&&m<=32))throw new Error("Incorrect key length, should be in [1, 32]");const D={h:new Uint32Array(i),b:new Uint8Array(64),c:0,t:0,outlen:p};return D.h[0]^=16842752^m<<8^p,m>0&&(u(D,w),D.c=64),D}function u(p,w){for(let m=0;m<w.length;m++)p.c===64&&(p.t+=p.c,c(p,!1),p.c=0),p.b[p.c++]=w[m]}function l(p){for(p.t+=p.c;p.c<64;)p.b[p.c++]=0;c(p,!0);const w=new Uint8Array(p.outlen);for(let m=0;m<p.outlen;m++)w[m]=p.h[m>>2]>>8*(m&3)&255;return w}function h(p,w,m){m=m||32,p=t.normalizeInput(p);const D=f(m,w);return u(D,p),l(D)}function d(p,w,m){const D=h(p,w,m);return t.toHex(D)}return ph={blake2s:h,blake2sHex:d,blake2sInit:f,blake2sUpdate:u,blake2sFinal:l},ph}var gh,J1;function pA(){if(J1)return gh;J1=1;const t=lA(),e=dA();return gh={blake2b:t.blake2b,blake2bHex:t.blake2bHex,blake2bInit:t.blake2bInit,blake2bUpdate:t.blake2bUpdate,blake2bFinal:t.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal},gh}var gA=pA();function Q1(t,e=[]){const r=[];return Object.keys(t).forEach(n=>{if(e.length&&!e.includes(n))return;const i=t[n];r.push(...i.accounts)}),r}const Cc=BigInt(2**32-1),eg=BigInt(32);function Am(t,e=!1){return e?{h:Number(t&Cc),l:Number(t>>eg&Cc)}:{h:Number(t>>eg&Cc)|0,l:Number(t&Cc)|0}}function Im(t,e=!1){const r=t.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=Am(t[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const tg=(t,e,r)=>t>>>r,rg=(t,e,r)=>t<<32-r|e>>>r,Ri=(t,e,r)=>t>>>r|e<<32-r,Ni=(t,e,r)=>t<<32-r|e>>>r,Sa=(t,e,r)=>t<<64-r|e>>>r-32,Oa=(t,e,r)=>t>>>r-32|e<<64-r,yA=(t,e)=>e,wA=(t,e)=>t,bA=(t,e,r)=>t<<r|e>>>32-r,mA=(t,e,r)=>e<<r|t>>>32-r,EA=(t,e,r)=>e<<r-32|t>>>64-r,vA=(t,e,r)=>t<<r-32|e>>>64-r;function Lr(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const W0=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Y0=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,xA=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),$A=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,AA=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),IA=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,oo=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function yu(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function rs(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Vr(t,...e){if(!yu(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Bm(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");rs(t.outputLen),rs(t.blockLen)}function ns(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function X0(t,e){Vr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Wa(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Kr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function yh(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function en(t,e){return t<<32-e|t>>>e}const Sm=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Om(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Un=Sm?t=>t:t=>Om(t);function BA(t){for(let e=0;e<t.length;e++)t[e]=Om(t[e]);return t}const Ti=Sm?t=>t:BA,_m=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",SA=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Uo(t){if(Vr(t),_m)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=SA[t[r]];return e}const bn={_0:48,_9:57,A:65,F:70,a:97,f:102};function ng(t){if(t>=bn._0&&t<=bn._9)return t-bn._0;if(t>=bn.A&&t<=bn.F)return t-(bn.A-10);if(t>=bn.a&&t<=bn.f)return t-(bn.a-10)}function Lf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(_m)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=ng(t.charCodeAt(s)),a=ng(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function Dm(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Zn(t){return typeof t=="string"&&(t=Dm(t)),Vr(t),t}function Gi(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Vr(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}let wu=class{};function cc(t){const e=n=>t().update(Zn(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function OA(t){const e=(n,i)=>t(i).update(Zn(n)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}function J0(t=32){if(oo&&typeof oo.getRandomValues=="function")return oo.getRandomValues(new Uint8Array(t));if(oo&&typeof oo.randomBytes=="function")return Uint8Array.from(oo.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const _A=BigInt(0),aa=BigInt(1),DA=BigInt(2),FA=BigInt(7),UA=BigInt(256),CA=BigInt(113),Fm=[],Um=[],Cm=[];for(let t=0,e=aa,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],Fm.push(2*(5*n+r)),Um.push((t+1)*(t+2)/2%64);let i=_A;for(let s=0;s<7;s++)e=(e<<aa^(e>>FA)*CA)%UA,e&DA&&(i^=aa<<(aa<<BigInt(s))-aa);Cm.push(i)}const Pm=Im(Cm,!0),PA=Pm[0],RA=Pm[1],ig=(t,e,r)=>r>32?EA(t,e,r):bA(t,e,r),sg=(t,e,r)=>r>32?vA(t,e,r):mA(t,e,r);function NA(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,f=r[c],u=r[c+1],l=ig(f,u,1)^r[a],h=sg(f,u,1)^r[a+1];for(let d=0;d<50;d+=10)t[o+d]^=l,t[o+d+1]^=h}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=Um[o],c=ig(i,s,a),f=sg(i,s,a),u=Fm[o];i=t[u],s=t[u+1],t[u]=c,t[u+1]=f}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=PA[n],t[1]^=RA[n]}Kr(r)}let TA=class Rm extends wu{constructor(e,r,n,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,rs(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Wa(this.state)}clone(){return this._cloneInto()}keccak(){Ti(this.state32),NA(this.state32,this.rounds),Ti(this.state32),this.posOut=0,this.pos=0}update(e){ns(this),e=Zn(e),Vr(e);const{blockLen:r,state:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){ns(this,!1),Vr(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return rs(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(X0(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Kr(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new Rm(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}};const LA=(t,e,r)=>cc(()=>new TA(e,t,r));LA(1,136,256/8);function kA(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}function jA(t,e,r){return t&e^~t&r}function qA(t,e,r){return t&e^t&r^e&r}let Nm=class extends wu{constructor(e,r,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=yh(this.buffer)}update(e){ns(this),e=Zn(e),Vr(e);const{view:r,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=yh(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ns(this),X0(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,Kr(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let l=o;l<i;l++)r[l]=0;kA(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=yh(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)a.setUint32(4*l,u[l],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const ni=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),at=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),ct=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),MA=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ii=new Uint32Array(64);let zA=class extends Nm{constructor(e=32){super(64,e,8,!1),this.A=ni[0]|0,this.B=ni[1]|0,this.C=ni[2]|0,this.D=ni[3]|0,this.E=ni[4]|0,this.F=ni[5]|0,this.G=ni[6]|0,this.H=ni[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let l=0;l<16;l++,r+=4)ii[l]=e.getUint32(r,!1);for(let l=16;l<64;l++){const h=ii[l-15],d=ii[l-2],p=en(h,7)^en(h,18)^h>>>3,w=en(d,17)^en(d,19)^d>>>10;ii[l]=w+ii[l-7]+p+ii[l-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:f,H:u}=this;for(let l=0;l<64;l++){const h=en(a,6)^en(a,11)^en(a,25),d=u+h+jA(a,c,f)+MA[l]+ii[l]|0,p=(en(n,2)^en(n,13)^en(n,22))+qA(n,i,s)|0;u=f,f=c,c=a,a=o+d|0,o=s,s=i,i=n,n=d+p|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(n,i,s,o,a,c,f,u)}roundClean(){Kr(ii)}destroy(){this.set(0,0,0,0,0,0,0,0),Kr(this.buffer)}};const Tm=Im(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),HA=Tm[0],VA=Tm[1],si=new Uint32Array(80),oi=new Uint32Array(80);let Q0=class extends Nm{constructor(e=64){super(128,e,16,!1),this.Ah=ct[0]|0,this.Al=ct[1]|0,this.Bh=ct[2]|0,this.Bl=ct[3]|0,this.Ch=ct[4]|0,this.Cl=ct[5]|0,this.Dh=ct[6]|0,this.Dl=ct[7]|0,this.Eh=ct[8]|0,this.El=ct[9]|0,this.Fh=ct[10]|0,this.Fl=ct[11]|0,this.Gh=ct[12]|0,this.Gl=ct[13]|0,this.Hh=ct[14]|0,this.Hl=ct[15]|0}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:f,El:u,Fh:l,Fl:h,Gh:d,Gl:p,Hh:w,Hl:m}=this;return[e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m]}set(e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=u|0,this.Fh=l|0,this.Fl=h|0,this.Gh=d|0,this.Gl=p|0,this.Hh=w|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)si[b]=e.getUint32(r),oi[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const B=si[b-15]|0,F=oi[b-15]|0,_=Ri(B,F,1)^Ri(B,F,8)^tg(B,F,7),N=Ni(B,F,1)^Ni(B,F,8)^rg(B,F,7),P=si[b-2]|0,S=oi[b-2]|0,T=Ri(P,S,19)^Sa(P,S,61)^tg(P,S,6),L=Ni(P,S,19)^Oa(P,S,61)^rg(P,S,6),O=xA(N,L,oi[b-7],oi[b-16]),x=$A(O,_,T,si[b-7],si[b-16]);si[b]=x|0,oi[b]=O|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:f,Dl:u,Eh:l,El:h,Fh:d,Fl:p,Gh:w,Gl:m,Hh:D,Hl:C}=this;for(let b=0;b<80;b++){const B=Ri(l,h,14)^Ri(l,h,18)^Sa(l,h,41),F=Ni(l,h,14)^Ni(l,h,18)^Oa(l,h,41),_=l&d^~l&w,N=h&p^~h&m,P=AA(C,F,N,VA[b],oi[b]),S=IA(P,D,B,_,HA[b],si[b]),T=P|0,L=Ri(n,i,28)^Sa(n,i,34)^Sa(n,i,39),O=Ni(n,i,28)^Oa(n,i,34)^Oa(n,i,39),x=n&s^n&a^s&a,$=i&o^i&c^o&c;D=w|0,C=m|0,w=d|0,m=p|0,d=l|0,p=h|0,{h:l,l:h}=Lr(f|0,u|0,S|0,T|0),f=a|0,u=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const g=W0(T,O,$);n=Y0(g,S,L,x),i=g|0}({h:n,l:i}=Lr(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=Lr(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Lr(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l:u}=Lr(this.Dh|0,this.Dl|0,f|0,u|0),{h:l,l:h}=Lr(this.Eh|0,this.El|0,l|0,h|0),{h:d,l:p}=Lr(this.Fh|0,this.Fl|0,d|0,p|0),{h:w,l:m}=Lr(this.Gh|0,this.Gl|0,w|0,m|0),{h:D,l:C}=Lr(this.Hh|0,this.Hl|0,D|0,C|0),this.set(n,i,s,o,a,c,f,u,l,h,d,p,w,m,D,C)}roundClean(){Kr(si,oi)}destroy(){Kr(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},KA=class extends Q0{constructor(){super(48),this.Ah=at[0]|0,this.Al=at[1]|0,this.Bh=at[2]|0,this.Bl=at[3]|0,this.Ch=at[4]|0,this.Cl=at[5]|0,this.Dh=at[6]|0,this.Dl=at[7]|0,this.Eh=at[8]|0,this.El=at[9]|0,this.Fh=at[10]|0,this.Fl=at[11]|0,this.Gh=at[12]|0,this.Gl=at[13]|0,this.Hh=at[14]|0,this.Hl=at[15]|0}};const ft=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);let GA=class extends Q0{constructor(){super(32),this.Ah=ft[0]|0,this.Al=ft[1]|0,this.Bh=ft[2]|0,this.Bl=ft[3]|0,this.Ch=ft[4]|0,this.Cl=ft[5]|0,this.Dh=ft[6]|0,this.Dl=ft[7]|0,this.Eh=ft[8]|0,this.El=ft[9]|0,this.Fh=ft[10]|0,this.Fl=ft[11]|0,this.Gh=ft[12]|0,this.Gl=ft[13]|0,this.Hh=ft[14]|0,this.Hl=ft[15]|0}};const ZA=cc(()=>new zA),WA=cc(()=>new Q0),YA=cc(()=>new KA);cc(()=>new GA);const XA=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Fe=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),W=new Uint32Array(32);function ai(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=W[2*t],f=W[2*t+1],u=W[2*e],l=W[2*e+1],h=W[2*r],d=W[2*r+1],p=W[2*n],w=W[2*n+1],m=W0(c,u,o);f=Y0(m,f,l,a),c=m|0,{Dh:w,Dl:p}={Dh:w^f,Dl:p^c},{Dh:w,Dl:p}={Dh:yA(w,p),Dl:wA(w)},{h:d,l:h}=Lr(d,h,w,p),{Bh:l,Bl:u}={Bh:l^d,Bl:u^h},{Bh:l,Bl:u}={Bh:Ri(l,u,24),Bl:Ni(l,u,24)},W[2*t]=c,W[2*t+1]=f,W[2*e]=u,W[2*e+1]=l,W[2*r]=h,W[2*r+1]=d,W[2*n]=p,W[2*n+1]=w}function ci(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=W[2*t],f=W[2*t+1],u=W[2*e],l=W[2*e+1],h=W[2*r],d=W[2*r+1],p=W[2*n],w=W[2*n+1],m=W0(c,u,o);f=Y0(m,f,l,a),c=m|0,{Dh:w,Dl:p}={Dh:w^f,Dl:p^c},{Dh:w,Dl:p}={Dh:Ri(w,p,16),Dl:Ni(w,p,16)},{h:d,l:h}=Lr(d,h,w,p),{Bh:l,Bl:u}={Bh:l^d,Bl:u^h},{Bh:l,Bl:u}={Bh:Sa(l,u,63),Bl:Oa(l,u,63)},W[2*t]=c,W[2*t+1]=f,W[2*e]=u,W[2*e+1]=l,W[2*r]=h,W[2*r+1]=d,W[2*n]=p,W[2*n+1]=w}function JA(t,e={},r,n,i){if(rs(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}let QA=class extends wu{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,rs(e),rs(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=Wa(this.buffer)}update(e){ns(this),e=Zn(e),Vr(e);const{blockLen:r,buffer:n,buffer32:i}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===r&&(Ti(i),this.compress(i,0,!1),Ti(i),this.pos=0);const f=Math.min(r-this.pos,s-c),u=o+c;if(f===r&&!(u%4)&&c+f<s){const l=new Uint32Array(a,u,Math.floor((s-c)/4));Ti(l);for(let h=0;c+r<s;h+=i.length,c+=r)this.length+=r,this.compress(l,h,!1);Ti(l);continue}n.set(e.subarray(c,c+f),this.pos),this.pos+=f,this.length+=f,c+=f}return this}digestInto(e){ns(this),X0(e,this);const{pos:r,buffer32:n}=this;this.finished=!0,Kr(this.buffer.subarray(r)),Ti(n),this.compress(n,0,!0),Ti(n);const i=Wa(e);this.get().forEach((s,o)=>i[o]=Un(s))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){const{buffer:r,length:n,finished:i,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=s,e.finished=i,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}},eI=class extends QA{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=Fe[0]|0,this.v0h=Fe[1]|0,this.v1l=Fe[2]|0,this.v1h=Fe[3]|0,this.v2l=Fe[4]|0,this.v2h=Fe[5]|0,this.v3l=Fe[6]|0,this.v3h=Fe[7]|0,this.v4l=Fe[8]|0,this.v4h=Fe[9]|0,this.v5l=Fe[10]|0,this.v5h=Fe[11]|0,this.v6l=Fe[12]|0,this.v6h=Fe[13]|0,this.v7l=Fe[14]|0,this.v7h=Fe[15]|0,JA(r,e,64,16,16);let{key:n,personalization:i,salt:s}=e,o=0;if(n!==void 0&&(n=Zn(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=Zn(s);const a=Wa(s);this.v4l^=Un(a[0]),this.v4h^=Un(a[1]),this.v5l^=Un(a[2]),this.v5h^=Un(a[3])}if(i!==void 0){i=Zn(i);const a=Wa(i);this.v6l^=Un(a[0]),this.v6h^=Un(a[1]),this.v7l^=Un(a[2]),this.v7h^=Un(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:n,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:f,v4h:u,v5l:l,v5h:h,v6l:d,v6h:p,v7l:w,v7h:m}=this;return[e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m]}set(e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m){this.v0l=e|0,this.v0h=r|0,this.v1l=n|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=f|0,this.v4h=u|0,this.v5l=l|0,this.v5h=h|0,this.v6l=d|0,this.v6h=p|0,this.v7l=w|0,this.v7h=m|0}compress(e,r,n){this.get().forEach((c,f)=>W[f]=c),W.set(Fe,16);let{h:i,l:s}=Am(BigInt(this.length));W[24]=Fe[8]^s,W[25]=Fe[9]^i,n&&(W[28]=~W[28],W[29]=~W[29]);let o=0;const a=XA;for(let c=0;c<12;c++)ai(0,4,8,12,e,r+2*a[o++]),ci(0,4,8,12,e,r+2*a[o++]),ai(1,5,9,13,e,r+2*a[o++]),ci(1,5,9,13,e,r+2*a[o++]),ai(2,6,10,14,e,r+2*a[o++]),ci(2,6,10,14,e,r+2*a[o++]),ai(3,7,11,15,e,r+2*a[o++]),ci(3,7,11,15,e,r+2*a[o++]),ai(0,5,10,15,e,r+2*a[o++]),ci(0,5,10,15,e,r+2*a[o++]),ai(1,6,11,12,e,r+2*a[o++]),ci(1,6,11,12,e,r+2*a[o++]),ai(2,7,8,13,e,r+2*a[o++]),ci(2,7,8,13,e,r+2*a[o++]),ai(3,4,9,14,e,r+2*a[o++]),ci(3,4,9,14,e,r+2*a[o++]);this.v0l^=W[0]^W[16],this.v0h^=W[1]^W[17],this.v1l^=W[2]^W[18],this.v1h^=W[3]^W[19],this.v2l^=W[4]^W[20],this.v2h^=W[5]^W[21],this.v3l^=W[6]^W[22],this.v3h^=W[7]^W[23],this.v4l^=W[8]^W[24],this.v4h^=W[9]^W[25],this.v5l^=W[10]^W[26],this.v5h^=W[11]^W[27],this.v6l^=W[12]^W[28],this.v6h^=W[13]^W[29],this.v7l^=W[14]^W[30],this.v7h^=W[15]^W[31],Kr(W)}destroy(){this.destroyed=!0,Kr(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};OA(t=>new eI(t));/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function Lm(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function pd(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function wh(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function zt(t,...e){if(!Lm(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function og(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function tI(t,e){zt(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Ji(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function zo(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function rI(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const nI=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function iI(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function gd(t){if(typeof t=="string")t=iI(t);else if(Lm(t))t=yd(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function sI(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function oI(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const aI=(t,e)=>{function r(n,...i){if(zt(n),!nI)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const f=i[0];if(!f)throw new Error("nonce / iv required");t.varSizeNonce?zt(f):zt(f,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&zt(i[1]);const o=e(n,...i),a=(f,u)=>{if(u!==void 0){if(f!==2)throw new Error("cipher output not supported");zt(u)}};let c=!1;return{encrypt(f,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,zt(f),a(o.encrypt.length,u),o.encrypt(f,u)},decrypt(f,u){if(zt(f),s&&f.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,u),o.decrypt(f,u)}}}return Object.assign(r,t),r};function ag(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!fI(e))throw new Error("invalid output, must be aligned");return e}function cg(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function cI(t,e,r){pd(r);const n=new Uint8Array(16),i=rI(n);return cg(i,0,BigInt(e),r),cg(i,8,BigInt(t),r),n}function fI(t){return t.byteOffset%4===0}function yd(t){return Uint8Array.from(t)}const km=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),uI=km("expand 16-byte k"),hI=km("expand 32-byte k"),lI=Ji(uI),dI=Ji(hI);function le(t,e){return t<<e|t>>>32-e}function wd(t){return t.byteOffset%4===0}const Pc=64,pI=16,jm=2**32-1,fg=new Uint32Array;function gI(t,e,r,n,i,s,o,a){const c=i.length,f=new Uint8Array(Pc),u=Ji(f),l=wd(i)&&wd(s),h=l?Ji(i):fg,d=l?Ji(s):fg;for(let p=0;p<c;o++){if(t(e,r,n,u,o,a),o>=jm)throw new Error("arx: counter overflow");const w=Math.min(Pc,c-p);if(l&&w===Pc){const m=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let D=0,C;D<pI;D++)C=m+D,d[C]=h[C]^u[D];p+=Pc;continue}for(let m=0,D;m<w;m++)D=p+m,s[D]=i[D]^f[m];p+=w}}function yI(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=sI({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return wh(i),wh(o),pd(s),pd(r),(a,c,f,u,l=0)=>{zt(a),zt(c),zt(f);const h=f.length;if(u===void 0&&(u=new Uint8Array(h)),zt(u),wh(l),l<0||l>=jm)throw new Error("arx: counter overflow");if(u.length<h)throw new Error(`arx: output (${u.length}) is shorter than data (${h})`);const d=[];let p=a.length,w,m;if(p===32)d.push(w=yd(a)),m=dI;else if(p===16&&r)w=new Uint8Array(32),w.set(a),w.set(a,16),m=lI,d.push(w);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);wd(c)||d.push(c=yd(c));const D=Ji(w);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(m,D,Ji(c.subarray(0,16)),D),c=c.subarray(16)}const C=16-i;if(C!==c.length)throw new Error(`arx: nonce must be ${C} or 16 bytes`);if(C!==12){const B=new Uint8Array(12);B.set(c,s?0:12-c.length),c=B,d.push(c)}const b=Ji(c);return gI(t,m,D,b,f,u,l,o),zo(...d),u}}const Ge=(t,e)=>t[e++]&255|(t[e++]&255)<<8;let wI=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=gd(e),zt(e,32);const r=Ge(e,0),n=Ge(e,2),i=Ge(e,4),s=Ge(e,6),o=Ge(e,8),a=Ge(e,10),c=Ge(e,12),f=Ge(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|f<<8)&8191,this.r[9]=f>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Ge(e,16+2*u)}process(e,r,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],f=o[2],u=o[3],l=o[4],h=o[5],d=o[6],p=o[7],w=o[8],m=o[9],D=Ge(e,r+0),C=Ge(e,r+2),b=Ge(e,r+4),B=Ge(e,r+6),F=Ge(e,r+8),_=Ge(e,r+10),N=Ge(e,r+12),P=Ge(e,r+14);let S=s[0]+(D&8191),T=s[1]+((D>>>13|C<<3)&8191),L=s[2]+((C>>>10|b<<6)&8191),O=s[3]+((b>>>7|B<<9)&8191),x=s[4]+((B>>>4|F<<12)&8191),$=s[5]+(F>>>1&8191),g=s[6]+((F>>>14|_<<2)&8191),y=s[7]+((_>>>11|N<<5)&8191),v=s[8]+((N>>>8|P<<8)&8191),I=s[9]+(P>>>5|i),E=0,A=E+S*a+T*(5*m)+L*(5*w)+O*(5*p)+x*(5*d);E=A>>>13,A&=8191,A+=$*(5*h)+g*(5*l)+y*(5*u)+v*(5*f)+I*(5*c),E+=A>>>13,A&=8191;let U=E+S*c+T*a+L*(5*m)+O*(5*w)+x*(5*p);E=U>>>13,U&=8191,U+=$*(5*d)+g*(5*h)+y*(5*l)+v*(5*u)+I*(5*f),E+=U>>>13,U&=8191;let R=E+S*f+T*c+L*a+O*(5*m)+x*(5*w);E=R>>>13,R&=8191,R+=$*(5*p)+g*(5*d)+y*(5*h)+v*(5*l)+I*(5*u),E+=R>>>13,R&=8191;let q=E+S*u+T*f+L*c+O*a+x*(5*m);E=q>>>13,q&=8191,q+=$*(5*w)+g*(5*p)+y*(5*d)+v*(5*h)+I*(5*l),E+=q>>>13,q&=8191;let j=E+S*l+T*u+L*f+O*c+x*a;E=j>>>13,j&=8191,j+=$*(5*m)+g*(5*w)+y*(5*p)+v*(5*d)+I*(5*h),E+=j>>>13,j&=8191;let k=E+S*h+T*l+L*u+O*f+x*c;E=k>>>13,k&=8191,k+=$*a+g*(5*m)+y*(5*w)+v*(5*p)+I*(5*d),E+=k>>>13,k&=8191;let M=E+S*d+T*h+L*l+O*u+x*f;E=M>>>13,M&=8191,M+=$*c+g*a+y*(5*m)+v*(5*w)+I*(5*p),E+=M>>>13,M&=8191;let H=E+S*p+T*d+L*h+O*l+x*u;E=H>>>13,H&=8191,H+=$*f+g*c+y*a+v*(5*m)+I*(5*w),E+=H>>>13,H&=8191;let V=E+S*w+T*p+L*d+O*h+x*l;E=V>>>13,V&=8191,V+=$*u+g*f+y*c+v*a+I*(5*m),E+=V>>>13,V&=8191;let z=E+S*m+T*w+L*p+O*d+x*h;E=z>>>13,z&=8191,z+=$*l+g*u+y*f+v*c+I*a,E+=z>>>13,z&=8191,E=(E<<2)+E|0,E=E+A|0,A=E&8191,E=E>>>13,U+=E,s[0]=A,s[1]=U,s[2]=R,s[3]=q,s[4]=j,s[5]=k,s[6]=M,s[7]=H,s[8]=V,s[9]=z}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;zo(n)}update(e){og(this),e=gd(e),zt(e);const{buffer:r,blockLen:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){zo(this.h,this.r,this.buffer,this.pad)}digestInto(e){og(this),tI(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:i}=this;if(i){for(r[i++]=1;i<16;i++)r[i]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}};function bI(t){const e=(n,i)=>t(i).update(gd(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const mI=bI(t=>new wI(t));function EI(t,e,r,n,i,s=20){let o=t[0],a=t[1],c=t[2],f=t[3],u=e[0],l=e[1],h=e[2],d=e[3],p=e[4],w=e[5],m=e[6],D=e[7],C=i,b=r[0],B=r[1],F=r[2],_=o,N=a,P=c,S=f,T=u,L=l,O=h,x=d,$=p,g=w,y=m,v=D,I=C,E=b,A=B,U=F;for(let q=0;q<s;q+=2)_=_+T|0,I=le(I^_,16),$=$+I|0,T=le(T^$,12),_=_+T|0,I=le(I^_,8),$=$+I|0,T=le(T^$,7),N=N+L|0,E=le(E^N,16),g=g+E|0,L=le(L^g,12),N=N+L|0,E=le(E^N,8),g=g+E|0,L=le(L^g,7),P=P+O|0,A=le(A^P,16),y=y+A|0,O=le(O^y,12),P=P+O|0,A=le(A^P,8),y=y+A|0,O=le(O^y,7),S=S+x|0,U=le(U^S,16),v=v+U|0,x=le(x^v,12),S=S+x|0,U=le(U^S,8),v=v+U|0,x=le(x^v,7),_=_+L|0,U=le(U^_,16),y=y+U|0,L=le(L^y,12),_=_+L|0,U=le(U^_,8),y=y+U|0,L=le(L^y,7),N=N+O|0,I=le(I^N,16),v=v+I|0,O=le(O^v,12),N=N+O|0,I=le(I^N,8),v=v+I|0,O=le(O^v,7),P=P+x|0,E=le(E^P,16),$=$+E|0,x=le(x^$,12),P=P+x|0,E=le(E^P,8),$=$+E|0,x=le(x^$,7),S=S+T|0,A=le(A^S,16),g=g+A|0,T=le(T^g,12),S=S+T|0,A=le(A^S,8),g=g+A|0,T=le(T^g,7);let R=0;n[R++]=o+_|0,n[R++]=a+N|0,n[R++]=c+P|0,n[R++]=f+S|0,n[R++]=u+T|0,n[R++]=l+L|0,n[R++]=h+O|0,n[R++]=d+x|0,n[R++]=p+$|0,n[R++]=w+g|0,n[R++]=m+y|0,n[R++]=D+v|0,n[R++]=C+I|0,n[R++]=b+E|0,n[R++]=B+A|0,n[R++]=F+U|0}const vI=yI(EI,{counterRight:!1,counterLength:4,allowShortKeys:!1}),xI=new Uint8Array(16),ug=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(xI.subarray(r))},$I=new Uint8Array(32);function hg(t,e,r,n,i){const s=t(e,r,$I),o=mI.create(s);i&&ug(o,i),ug(o,n);const a=cI(n.length,i?i.length:0,!0);o.update(a);const c=o.digest();return zo(s,a),c}const AI=t=>(e,r,n)=>({encrypt(i,s){const o=i.length;s=ag(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=hg(t,e,r,a,n);return s.set(c,o),zo(c),s},decrypt(i,s){s=ag(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=hg(t,e,r,o,n);if(!oI(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,r,s,s,1),zo(c),s}});aI({blockSize:64,nonceLength:12,tagLength:16},AI(vI));let qm=class extends wu{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Bm(e);const n=Zn(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Kr(s)}update(e){return ns(this),this.iHash.update(e),this}digestInto(e){ns(this),Vr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Mm=(t,e,r)=>new qm(t,e).update(r).digest();Mm.create=(t,e)=>new qm(t,e);Uint8Array.from([0]);const ep=BigInt(0),bd=BigInt(1);function kf(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function Us(t,e,r=""){const n=yu(t),i=t==null?void 0:t.length,s=e!==void 0;if(!n||s&&i!==e){const o=r&&`"${r}" `,a=s?` of length ${e}`:"",c=n?`length=${i}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function Rc(t){const e=t.toString(16);return e.length&1?"0"+e:e}function zm(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?ep:BigInt("0x"+t)}function bu(t){return zm(Uo(t))}function jf(t){return Vr(t),zm(Uo(Uint8Array.from(t).reverse()))}function tp(t,e){return Lf(t.toString(16).padStart(e*2,"0"))}function rp(t,e){return tp(t,e).reverse()}function vt(t,e,r){let n;if(typeof e=="string")try{n=Lf(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(yu(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}const bh=t=>typeof t=="bigint"&&ep<=t;function II(t,e,r){return bh(t)&&bh(e)&&bh(r)&&e<=t&&t<r}function md(t,e,r,n){if(!II(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Hm(t){let e;for(e=0;t>ep;t>>=bd,e+=1);return e}const fc=t=>(bd<<BigInt(t))-bd;function BI(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const n=h=>new Uint8Array(h),i=h=>Uint8Array.of(h);let s=n(t),o=n(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},f=(...h)=>r(o,s,...h),u=(h=n(0))=>{o=f(i(0),h),s=f(),h.length!==0&&(o=f(i(1),h),s=f())},l=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const d=[];for(;h<e;){s=f();const p=s.slice();d.push(p),h+=s.length}return Gi(...d)};return(h,d)=>{c(),u(h);let p;for(;!(p=d(l()));)u();return c(),p}}function mu(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(i,s,o){const a=t[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>n(i,s,!1)),Object.entries(r).forEach(([i,s])=>n(i,s,!0))}function lg(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const Wt=BigInt(0),Ot=BigInt(1),Cs=BigInt(2),Vm=BigInt(3),Km=BigInt(4),Gm=BigInt(5),SI=BigInt(7),Zm=BigInt(8),OI=BigInt(9),Wm=BigInt(16);function or(t,e){const r=t%e;return r>=Wt?r:e+r}function Pr(t,e,r){let n=t;for(;e-- >Wt;)n*=n,n%=r;return n}function dg(t,e){if(t===Wt)throw new Error("invert: expected non-zero number");if(e<=Wt)throw new Error("invert: expected positive modulus, got "+e);let r=or(t,e),n=e,i=Wt,s=Ot;for(;r!==Wt;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==Ot)throw new Error("invert: does not exist");return or(i,e)}function np(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function Ym(t,e){const r=(t.ORDER+Ot)/Km,n=t.pow(e,r);return np(t,n,e),n}function _I(t,e){const r=(t.ORDER-Gm)/Zm,n=t.mul(e,Cs),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,Cs),i),a=t.mul(s,t.sub(o,t.ONE));return np(t,a,e),a}function DI(t){const e=us(t),r=Xm(t),n=r(e,e.neg(e.ONE)),i=r(e,n),s=r(e,e.neg(n)),o=(t+SI)/Wm;return(a,c)=>{let f=a.pow(c,o),u=a.mul(f,n);const l=a.mul(f,i),h=a.mul(f,s),d=a.eql(a.sqr(u),c),p=a.eql(a.sqr(l),c);f=a.cmov(f,u,d),u=a.cmov(h,l,p);const w=a.eql(a.sqr(u),c),m=a.cmov(f,u,w);return np(a,m,c),m}}function Xm(t){if(t<Vm)throw new Error("sqrt is not defined for small field");let e=t-Ot,r=0;for(;e%Cs===Wt;)e/=Cs,r++;let n=Cs;const i=us(t);for(;pg(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Ym;let s=i.pow(n,e);const o=(e+Ot)/Cs;return function(a,c){if(a.is0(c))return c;if(pg(a,c)!==1)throw new Error("Cannot find square root");let f=r,u=a.mul(a.ONE,s),l=a.pow(c,e),h=a.pow(c,o);for(;!a.eql(l,a.ONE);){if(a.is0(l))return a.ZERO;let d=1,p=a.sqr(l);for(;!a.eql(p,a.ONE);)if(d++,p=a.sqr(p),d===f)throw new Error("Cannot find square root");const w=Ot<<BigInt(f-d-1),m=a.pow(u,w);f=d,u=a.sqr(m),l=a.mul(l,u),h=a.mul(h,m)}return h}}function FI(t){return t%Km===Vm?Ym:t%Zm===Gm?_I:t%Wm===OI?DI(t):Xm(t)}const UI=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function CI(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=UI.reduce((n,i)=>(n[i]="function",n),e);return mu(t,r),t}function PI(t,e,r){if(r<Wt)throw new Error("invalid exponent, negatives unsupported");if(r===Wt)return t.ONE;if(r===Ot)return e;let n=t.ONE,i=e;for(;r>Wt;)r&Ot&&(n=t.mul(n,i)),i=t.sqr(i),r>>=Ot;return n}function Jm(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),s),n}function pg(t,e){const r=(t.ORDER-Ot)/Cs,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function Qm(t,e){e!==void 0&&rs(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function us(t,e,r=!1,n={}){if(t<=Wt)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const h=e;h.BITS&&(i=h.BITS),h.sqrt&&(s=h.sqrt),typeof h.isLE=="boolean"&&(r=h.isLE),typeof h.modFromBytes=="boolean"&&(o=h.modFromBytes),a=h.allowedLengths}else typeof e=="number"&&(i=e),n.sqrt&&(s=n.sqrt);const{nBitLength:c,nByteLength:f}=Qm(t,i);if(f>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const l=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:f,MASK:fc(c),ZERO:Wt,ONE:Ot,allowedLengths:a,create:h=>or(h,t),isValid:h=>{if(typeof h!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof h);return Wt<=h&&h<t},is0:h=>h===Wt,isValidNot0:h=>!l.is0(h)&&l.isValid(h),isOdd:h=>(h&Ot)===Ot,neg:h=>or(-h,t),eql:(h,d)=>h===d,sqr:h=>or(h*h,t),add:(h,d)=>or(h+d,t),sub:(h,d)=>or(h-d,t),mul:(h,d)=>or(h*d,t),pow:(h,d)=>PI(l,h,d),div:(h,d)=>or(h*dg(d,t),t),sqrN:h=>h*h,addN:(h,d)=>h+d,subN:(h,d)=>h-d,mulN:(h,d)=>h*d,inv:h=>dg(h,t),sqrt:s||(h=>(u||(u=FI(t)),u(l,h))),toBytes:h=>r?rp(h,f):tp(h,f),fromBytes:(h,d=!0)=>{if(a){if(!a.includes(h.length)||h.length>f)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+h.length);const w=new Uint8Array(f);w.set(h,r?0:w.length-h.length),h=w}if(h.length!==f)throw new Error("Field.fromBytes: expected "+f+" bytes, got "+h.length);let p=r?jf(h):bu(h);if(o&&(p=or(p,t)),!d&&!l.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:h=>Jm(l,h),cmov:(h,d,p)=>p?d:h});return Object.freeze(l)}function e3(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function t3(t){const e=e3(t);return e+Math.ceil(e/2)}function RI(t,e,r=!1){const n=t.length,i=e3(e),s=t3(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?jf(t):bu(t),a=or(o,e-Ot)+Ot;return r?rp(a,i):tp(a,i)}const Ho=BigInt(0),Ps=BigInt(1);function qf(t,e){const r=e.negate();return t?r:e}function mh(t,e){const r=Jm(t.Fp,e.map(n=>n.Z));return e.map((n,i)=>t.fromAffine(n.toAffine(r[i])))}function r3(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Eh(t,e){r3(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=fc(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function gg(t,e,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(t&i),c=t>>o;a>n&&(a-=s,c+=Ps);const f=e*n,u=f+Math.abs(a)-1,l=a===0,h=a<0,d=e%2!==0;return{nextN:c,offset:u,isZero:l,isNeg:h,isNegF:d,offsetF:f}}function NI(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function TI(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const vh=new WeakMap,n3=new WeakMap;function xh(t){return n3.get(t)||1}function yg(t){if(t!==Ho)throw new Error("invalid wNAF")}let LI=class{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let i=e;for(;r>Ho;)r&Ps&&(n=n.add(i)),i=i.double(),r>>=Ps;return n}precomputeWindow(e,r){const{windows:n,windowSize:i}=Eh(r,this.bits),s=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,s.push(a);for(let f=1;f<i;f++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=Eh(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:f,isZero:u,isNeg:l,isNegF:h,offsetF:d}=gg(n,a,o);n=c,u?s=s.add(qf(h,r[d])):i=i.add(qf(l,r[f]))}return yg(n),{p:i,f:s}}wNAFUnsafe(e,r,n,i=this.ZERO){const s=Eh(e,this.bits);for(let o=0;o<s.windows&&n!==Ho;o++){const{nextN:a,offset:c,isZero:f,isNeg:u}=gg(n,o,s);if(n=a,!f){const l=r[c];i=i.add(u?l.negate():l)}}return yg(n),i}getPrecomputes(e,r,n){let i=vh.get(r);return i||(i=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(i=n(i)),vh.set(r,i))),i}cached(e,r,n){const i=xh(e);return this.wNAF(i,this.getPrecomputes(i,e,n),r)}unsafe(e,r,n,i){const s=xh(e);return s===1?this._unsafeLadder(e,r,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,n),r,i)}createCache(e,r){r3(r,this.bits),n3.set(e,r),vh.delete(e)}hasCache(e){return xh(e)!==1}};function kI(t,e,r,n){let i=e,s=t.ZERO,o=t.ZERO;for(;r>Ho||n>Ho;)r&Ps&&(s=s.add(i)),n&Ps&&(o=o.add(i)),i=i.double(),r>>=Ps,n>>=Ps;return{p1:s,p2:o}}function jI(t,e,r,n){NI(r,t),TI(n,e);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Hm(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const f=fc(c),u=new Array(Number(f)+1).fill(o),l=Math.floor((e.BITS-1)/c)*c;let h=o;for(let d=l;d>=0;d-=c){u.fill(o);for(let w=0;w<s;w++){const m=n[w],D=Number(m>>BigInt(d)&f);u[D]=u[D].add(r[w])}let p=o;for(let w=u.length-1,m=o;w>0;w--)m=m.add(u[w]),p=p.add(m);if(h=h.add(p),d!==0)for(let w=0;w<c;w++)h=h.double()}return h}function wg(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return CI(e),e}else return us(t,{isLE:r})}function qI(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>Ho))throw new Error(`CURVE.${a} must be positive bigint`)}const i=wg(e.p,r.Fp,n),s=wg(e.n,r.Fn,n),o=["Gx","Gy","a","b"];for(const a of o)if(!i.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),Dm("HashToScalar-");const ca=BigInt(0),ao=BigInt(1),Nc=BigInt(2);function MI(t){return mu(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function zI(t){const e=MI(t),{P:r,type:n,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||J0,f=a?255:448,u=a?32:56,l=BigInt(a?9:5),h=BigInt(a?121665:39081),d=a?Nc**BigInt(254):Nc**BigInt(447),p=a?BigInt(8)*Nc**BigInt(251)-ao:BigInt(4)*Nc**BigInt(445)-ao,w=d+p+ao,m=O=>or(O,r),D=C(l);function C(O){return rp(m(O),u)}function b(O){const x=vt("u coordinate",O,u);return a&&(x[31]&=127),m(jf(x))}function B(O){return jf(i(vt("scalar",O,u)))}function F(O,x){const $=P(b(x),B(O));if($===ca)throw new Error("invalid private or public key received");return C($)}function _(O){return F(O,D)}function N(O,x,$){const g=m(O*(x-$));return x=m(x-g),$=m($+g),{x_2:x,x_3:$}}function P(O,x){md("u",O,ca,r),md("scalar",x,d,w);const $=x,g=O;let y=ao,v=ca,I=O,E=ao,A=ca;for(let R=BigInt(f-1);R>=ca;R--){const q=$>>R&ao;A^=q,{x_2:y,x_3:I}=N(A,y,I),{x_2:v,x_3:E}=N(A,v,E),A=q;const j=y+v,k=m(j*j),M=y-v,H=m(M*M),V=k-H,z=I+E,K=I-E,Q=m(K*j),ee=m(z*M),ne=Q+ee,he=Q-ee;I=m(ne*ne),E=m(g*m(he*he)),y=m(k*H),v=m(V*(k+m(h*V)))}({x_2:y,x_3:I}=N(A,y,I)),{x_2:v,x_3:E}=N(A,v,E);const U=s(v);return m(y*U)}const S={secretKey:u,publicKey:u,seed:u},T=(O=c(u))=>(Vr(O,S.seed),O);function L(O){const x=T(O);return{secretKey:x,publicKey:_(x)}}return{keygen:L,getSharedSecret:(O,x)=>F(O,x),getPublicKey:O=>_(O),scalarMult:F,scalarMultBase:_,utils:{randomSecretKey:T,randomPrivateKey:T},GuBytes:D.slice(),lengths:S}}const HI=BigInt(1),bg=BigInt(2),VI=BigInt(3),KI=BigInt(5);BigInt(8);const i3=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),GI={p:i3,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function ZI(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=i3,o=t*t%s*t%s,a=Pr(o,bg,s)*o%s,c=Pr(a,HI,s)*t%s,f=Pr(c,KI,s)*c%s,u=Pr(f,e,s)*f%s,l=Pr(u,r,s)*u%s,h=Pr(l,n,s)*l%s,d=Pr(h,i,s)*h%s,p=Pr(d,i,s)*h%s,w=Pr(p,e,s)*f%s;return{pow_p_5_8:Pr(w,bg,s)*t%s,b2:o}}function WI(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const YI=us(GI.p,{isLE:!0});(()=>{const t=YI.ORDER;return zI({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:n}=ZI(e);return or(Pr(r,VI,t)*n,t)},adjustScalarBytes:WI})})();const mg=(t,e)=>(t+(t>=0?e:-e)/s3)/e;function XI(t,e,r){const[[n,i],[s,o]]=e,a=mg(o*t,r),c=mg(-i*t,r);let f=t-a*n-c*s,u=-a*i-c*o;const l=f<Hn,h=u<Hn;l&&(f=-f),h&&(u=-u);const d=fc(Math.ceil(Hm(r)/2))+Co;if(f<Hn||f>=d||u<Hn||u>=d)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:l,k1:f,k2neg:h,k2:u}}function Ed(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function $h(t,e){const r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return kf(r.lowS,"lowS"),kf(r.prehash,"prehash"),r.format!==void 0&&Ed(r.format),r}let JI=class extends Error{constructor(e=""){super(e)}};const Ln={Err:JI,_tlv:{encode:(t,e)=>{const{Err:r}=Ln;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=Rc(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?Rc(i.length/2|128):"";return Rc(t)+s+i+e},decode(t,e){const{Err:r}=Ln;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const f=e.subarray(n,n+c);if(f.length!==c)throw new r("tlv.decode: length bytes not complete");if(f[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of f)o=o<<8|u;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=Ln;if(t<Hn)throw new e("integer: negative integers are not allowed");let r=Rc(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Ln;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return bu(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=Ln,i=vt("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:f,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(f)}},hexFromSig(t){const{_tlv:e,_int:r}=Ln,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}},Hn=BigInt(0),Co=BigInt(1),s3=BigInt(2),Tc=BigInt(3),QI=BigInt(4);function Io(t,e){const{BYTES:r}=t;let n;if(typeof e=="bigint")n=e;else{let i=vt("private key",e);try{n=t.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function eB(t,e={}){const r=qI("weierstrass",t,e),{Fp:n,Fn:i}=r;let s=r.CURVE;const{h:o,n:a}=s;mu(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const f=a3(n,i);function u(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function l(O,x,$){const{x:g,y}=x.toAffine(),v=n.toBytes(g);if(kf($,"isCompressed"),$){u();const I=!n.isOdd(y);return Gi(o3(I),v)}else return Gi(Uint8Array.of(4),v,n.toBytes(y))}function h(O){Us(O,void 0,"Point");const{publicKey:x,publicKeyUncompressed:$}=f,g=O.length,y=O[0],v=O.subarray(1);if(g===x&&(y===2||y===3)){const I=n.fromBytes(v);if(!n.isValid(I))throw new Error("bad point: is not on curve, wrong x");const E=w(I);let A;try{A=n.sqrt(E)}catch(R){const q=R instanceof Error?": "+R.message:"";throw new Error("bad point: is not on curve, sqrt error"+q)}u();const U=n.isOdd(A);return(y&1)===1!==U&&(A=n.neg(A)),{x:I,y:A}}else if(g===$&&y===4){const I=n.BYTES,E=n.fromBytes(v.subarray(0,I)),A=n.fromBytes(v.subarray(I,I*2));if(!m(E,A))throw new Error("bad point: is not on curve");return{x:E,y:A}}else throw new Error(`bad point: got length ${g}, expected compressed=${x} or uncompressed=${$}`)}const d=e.toBytes||l,p=e.fromBytes||h;function w(O){const x=n.sqr(O),$=n.mul(x,O);return n.add(n.add($,n.mul(O,s.a)),s.b)}function m(O,x){const $=n.sqr(x),g=w(O);return n.eql($,g)}if(!m(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const D=n.mul(n.pow(s.a,Tc),QI),C=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(D,C)))throw new Error("bad curve params: a or b");function b(O,x,$=!1){if(!n.isValid(x)||$&&n.is0(x))throw new Error(`bad point coordinate ${O}`);return x}function B(O){if(!(O instanceof S))throw new Error("ProjectivePoint expected")}function F(O){if(!c||!c.basises)throw new Error("no endo");return XI(O,c.basises,i.ORDER)}const _=lg((O,x)=>{const{X:$,Y:g,Z:y}=O;if(n.eql(y,n.ONE))return{x:$,y:g};const v=O.is0();x==null&&(x=v?n.ONE:n.inv(y));const I=n.mul($,x),E=n.mul(g,x),A=n.mul(y,x);if(v)return{x:n.ZERO,y:n.ZERO};if(!n.eql(A,n.ONE))throw new Error("invZ was invalid");return{x:I,y:E}}),N=lg(O=>{if(O.is0()){if(e.allowInfinityPoint&&!n.is0(O.Y))return;throw new Error("bad point: ZERO")}const{x,y:$}=O.toAffine();if(!n.isValid(x)||!n.isValid($))throw new Error("bad point: x or y not field elements");if(!m(x,$))throw new Error("bad point: equation left != right");if(!O.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function P(O,x,$,g,y){return $=new S(n.mul($.X,O),$.Y,$.Z),x=qf(g,x),$=qf(y,$),x.add($)}class S{constructor(x,$,g){this.X=b("x",x),this.Y=b("y",$,!0),this.Z=b("z",g),Object.freeze(this)}static CURVE(){return s}static fromAffine(x){const{x:$,y:g}=x||{};if(!x||!n.isValid($)||!n.isValid(g))throw new Error("invalid affine point");if(x instanceof S)throw new Error("projective point not allowed");return n.is0($)&&n.is0(g)?S.ZERO:new S($,g,n.ONE)}static fromBytes(x){const $=S.fromAffine(p(Us(x,void 0,"point")));return $.assertValidity(),$}static fromHex(x){return S.fromBytes(vt("pointHex",x))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(x=8,$=!0){return L.createCache(this,x),$||this.multiply(Tc),this}assertValidity(){N(this)}hasEvenY(){const{y:x}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(x)}equals(x){B(x);const{X:$,Y:g,Z:y}=this,{X:v,Y:I,Z:E}=x,A=n.eql(n.mul($,E),n.mul(v,y)),U=n.eql(n.mul(g,E),n.mul(I,y));return A&&U}negate(){return new S(this.X,n.neg(this.Y),this.Z)}double(){const{a:x,b:$}=s,g=n.mul($,Tc),{X:y,Y:v,Z:I}=this;let E=n.ZERO,A=n.ZERO,U=n.ZERO,R=n.mul(y,y),q=n.mul(v,v),j=n.mul(I,I),k=n.mul(y,v);return k=n.add(k,k),U=n.mul(y,I),U=n.add(U,U),E=n.mul(x,U),A=n.mul(g,j),A=n.add(E,A),E=n.sub(q,A),A=n.add(q,A),A=n.mul(E,A),E=n.mul(k,E),U=n.mul(g,U),j=n.mul(x,j),k=n.sub(R,j),k=n.mul(x,k),k=n.add(k,U),U=n.add(R,R),R=n.add(U,R),R=n.add(R,j),R=n.mul(R,k),A=n.add(A,R),j=n.mul(v,I),j=n.add(j,j),R=n.mul(j,k),E=n.sub(E,R),U=n.mul(j,q),U=n.add(U,U),U=n.add(U,U),new S(E,A,U)}add(x){B(x);const{X:$,Y:g,Z:y}=this,{X:v,Y:I,Z:E}=x;let A=n.ZERO,U=n.ZERO,R=n.ZERO;const q=s.a,j=n.mul(s.b,Tc);let k=n.mul($,v),M=n.mul(g,I),H=n.mul(y,E),V=n.add($,g),z=n.add(v,I);V=n.mul(V,z),z=n.add(k,M),V=n.sub(V,z),z=n.add($,y);let K=n.add(v,E);return z=n.mul(z,K),K=n.add(k,H),z=n.sub(z,K),K=n.add(g,y),A=n.add(I,E),K=n.mul(K,A),A=n.add(M,H),K=n.sub(K,A),R=n.mul(q,z),A=n.mul(j,H),R=n.add(A,R),A=n.sub(M,R),R=n.add(M,R),U=n.mul(A,R),M=n.add(k,k),M=n.add(M,k),H=n.mul(q,H),z=n.mul(j,z),M=n.add(M,H),H=n.sub(k,H),H=n.mul(q,H),z=n.add(z,H),k=n.mul(M,z),U=n.add(U,k),k=n.mul(K,z),A=n.mul(V,A),A=n.sub(A,k),k=n.mul(V,M),R=n.mul(K,R),R=n.add(R,k),new S(A,U,R)}subtract(x){return this.add(x.negate())}is0(){return this.equals(S.ZERO)}multiply(x){const{endo:$}=e;if(!i.isValidNot0(x))throw new Error("invalid scalar: out of range");let g,y;const v=I=>L.cached(this,I,E=>mh(S,E));if($){const{k1neg:I,k1:E,k2neg:A,k2:U}=F(x),{p:R,f:q}=v(E),{p:j,f:k}=v(U);y=q.add(k),g=P($.beta,R,j,I,A)}else{const{p:I,f:E}=v(x);g=I,y=E}return mh(S,[g,y])[0]}multiplyUnsafe(x){const{endo:$}=e,g=this;if(!i.isValid(x))throw new Error("invalid scalar: out of range");if(x===Hn||g.is0())return S.ZERO;if(x===Co)return g;if(L.hasCache(this))return this.multiply(x);if($){const{k1neg:y,k1:v,k2neg:I,k2:E}=F(x),{p1:A,p2:U}=kI(S,g,v,E);return P($.beta,A,U,y,I)}else return L.unsafe(g,x)}multiplyAndAddUnsafe(x,$,g){const y=this.multiplyUnsafe($).add(x.multiplyUnsafe(g));return y.is0()?void 0:y}toAffine(x){return _(this,x)}isTorsionFree(){const{isTorsionFree:x}=e;return o===Co?!0:x?x(S,this):L.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:x}=e;return o===Co?this:x?x(S,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(x=!0){return kf(x,"isCompressed"),this.assertValidity(),d(S,this,x)}toHex(x=!0){return Uo(this.toBytes(x))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(x=!0){return this.toBytes(x)}_setWindowSize(x){this.precompute(x)}static normalizeZ(x){return mh(S,x)}static msm(x,$){return jI(S,i,x,$)}static fromPrivateKey(x){return S.BASE.multiply(Io(i,x))}}S.BASE=new S(s.Gx,s.Gy,n.ONE),S.ZERO=new S(n.ZERO,n.ONE,n.ZERO),S.Fp=n,S.Fn=i;const T=i.BITS,L=new LI(S,e.endo?Math.ceil(T/2):T);return S.BASE.precompute(8),S}function o3(t){return Uint8Array.of(t?2:3)}function a3(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function tB(t,e={}){const{Fn:r}=t,n=e.randomBytes||J0,i=Object.assign(a3(t.Fp,r),{seed:t3(r.ORDER)});function s(h){try{return!!Io(r,h)}catch{return!1}}function o(h,d){const{publicKey:p,publicKeyUncompressed:w}=i;try{const m=h.length;return d===!0&&m!==p||d===!1&&m!==w?!1:!!t.fromBytes(h)}catch{return!1}}function a(h=n(i.seed)){return RI(Us(h,i.seed,"seed"),r.ORDER)}function c(h,d=!0){return t.BASE.multiply(Io(r,h)).toBytes(d)}function f(h){const d=a(h);return{secretKey:d,publicKey:c(d)}}function u(h){if(typeof h=="bigint")return!1;if(h instanceof t)return!0;const{secretKey:d,publicKey:p,publicKeyUncompressed:w}=i;if(r.allowedLengths||d===p)return;const m=vt("key",h).length;return m===p||m===w}function l(h,d,p=!0){if(u(h)===!0)throw new Error("first arg must be private key");if(u(d)===!1)throw new Error("second arg must be public key");const w=Io(r,h);return t.fromHex(d).multiply(w).toBytes(p)}return Object.freeze({getPublicKey:c,getSharedSecret:l,keygen:f,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:h=>Io(r,h),precompute(h=8,d=t.BASE){return d.precompute(h,!1)}},lengths:i})}function rB(t,e,r={}){Bm(e),mu(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=r.randomBytes||J0,i=r.hmac||(($,...g)=>Mm(e,$,Gi(...g))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:f,getPublicKey:u,getSharedSecret:l,utils:h,lengths:d}=tB(t,r),p={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},w="compact";function m($){const g=a>>Co;return $>g}function D($,g){if(!o.isValidNot0(g))throw new Error(`invalid signature ${$}: out of range 1..Point.Fn.ORDER`);return g}function C($,g){Ed(g);const y=d.signature,v=g==="compact"?y:g==="recovered"?y+1:void 0;return Us($,v,`${g} signature`)}class b{constructor(g,y,v){this.r=D("r",g),this.s=D("s",y),v!=null&&(this.recovery=v),Object.freeze(this)}static fromBytes(g,y=w){C(g,y);let v;if(y==="der"){const{r:U,s:R}=Ln.toSig(Us(g));return new b(U,R)}y==="recovered"&&(v=g[0],y="compact",g=g.subarray(1));const I=o.BYTES,E=g.subarray(0,I),A=g.subarray(I,I*2);return new b(o.fromBytes(E),o.fromBytes(A),v)}static fromHex(g,y){return this.fromBytes(Lf(g),y)}addRecoveryBit(g){return new b(this.r,this.s,g)}recoverPublicKey(g){const y=s.ORDER,{r:v,s:I,recovery:E}=this;if(E==null||![0,1,2,3].includes(E))throw new Error("recovery id invalid");if(a*s3<y&&E>1)throw new Error("recovery id is ambiguous for h>1 curve");const A=E===2||E===3?v+a:v;if(!s.isValid(A))throw new Error("recovery id 2 or 3 invalid");const U=s.toBytes(A),R=t.fromBytes(Gi(o3((E&1)===0),U)),q=o.inv(A),j=F(vt("msgHash",g)),k=o.create(-j*q),M=o.create(I*q),H=t.BASE.multiplyUnsafe(k).add(R.multiplyUnsafe(M));if(H.is0())throw new Error("point at infinify");return H.assertValidity(),H}hasHighS(){return m(this.s)}toBytes(g=w){if(Ed(g),g==="der")return Lf(Ln.hexFromSig(this));const y=o.toBytes(this.r),v=o.toBytes(this.s);if(g==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Gi(Uint8Array.of(this.recovery),y,v)}return Gi(y,v)}toHex(g){return Uo(this.toBytes(g))}assertValidity(){}static fromCompact(g){return b.fromBytes(vt("sig",g),"compact")}static fromDER(g){return b.fromBytes(vt("sig",g),"der")}normalizeS(){return this.hasHighS()?new b(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Uo(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Uo(this.toBytes("compact"))}}const B=r.bits2int||function($){if($.length>8192)throw new Error("input is too large");const g=bu($),y=$.length*8-c;return y>0?g>>BigInt(y):g},F=r.bits2int_modN||function($){return o.create(B($))},_=fc(c);function N($){return md("num < 2^"+c,$,Hn,_),o.toBytes($)}function P($,g){return Us($,void 0,"message"),g?Us(e($),void 0,"prehashed message"):$}function S($,g,y){if(["recovered","canonical"].some(M=>M in y))throw new Error("sign() legacy options not supported");const{lowS:v,prehash:I,extraEntropy:E}=$h(y,p);$=P($,I);const A=F($),U=Io(o,g),R=[N(U),N(A)];if(E!=null&&E!==!1){const M=E===!0?n(d.secretKey):E;R.push(vt("extraEntropy",M))}const q=Gi(...R),j=A;function k(M){const H=B(M);if(!o.isValidNot0(H))return;const V=o.inv(H),z=t.BASE.multiply(H).toAffine(),K=o.create(z.x);if(K===Hn)return;const Q=o.create(V*o.create(j+K*U));if(Q===Hn)return;let ee=(z.x===K?0:2)|Number(z.y&Co),ne=Q;return v&&m(Q)&&(ne=o.neg(Q),ee^=1),new b(K,ne,ee)}return{seed:q,k2sig:k}}function T($,g,y={}){$=vt("message",$);const{seed:v,k2sig:I}=S($,g,y);return BI(e.outputLen,o.BYTES,i)(v,I)}function L($){let g;const y=typeof $=="string"||yu($),v=!y&&$!==null&&typeof $=="object"&&typeof $.r=="bigint"&&typeof $.s=="bigint";if(!y&&!v)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(v)g=new b($.r,$.s);else if(y){try{g=b.fromBytes(vt("sig",$),"der")}catch(I){if(!(I instanceof Ln.Err))throw I}if(!g)try{g=b.fromBytes(vt("sig",$),"compact")}catch{return!1}}return g||!1}function O($,g,y,v={}){const{lowS:I,prehash:E,format:A}=$h(v,p);if(y=vt("publicKey",y),g=P(vt("message",g),E),"strict"in v)throw new Error("options.strict was renamed to lowS");const U=A===void 0?L($):b.fromBytes(vt("sig",$),A);if(U===!1)return!1;try{const R=t.fromBytes(y);if(I&&U.hasHighS())return!1;const{r:q,s:j}=U,k=F(g),M=o.inv(j),H=o.create(k*M),V=o.create(q*M),z=t.BASE.multiplyUnsafe(H).add(R.multiplyUnsafe(V));return z.is0()?!1:o.create(z.x)===q}catch{return!1}}function x($,g,y={}){const{prehash:v}=$h(y,p);return g=P(g,v),b.fromBytes($,"recovered").recoverPublicKey(g).toBytes()}return Object.freeze({keygen:f,getPublicKey:u,getSharedSecret:l,utils:h,lengths:d,Point:t,sign:T,verify:O,recoverPublicKey:x,Signature:b,hash:e})}function nB(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=us(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),s={Fp:r,Fn:i,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function iB(t){const{CURVE:e,curveOpts:r}=nB(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function sB(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,Qm(r.Fn.ORDER,r.Fn.BITS))})}function oB(t){const{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:i}=iB(t),s=eB(e,r),o=rB(s,n,i);return sB(t,o)}function vd(t,e){const r=n=>oB({...t,hash:n});return{...r(e),create:r}}const c3={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},f3={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},u3={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},aB=us(c3.p),cB=us(f3.p),fB=us(u3.p);vd({...c3,Fp:aB,lowS:!1},ZA);vd({...f3,Fp:cB,lowS:!1},YA),vd({...u3,Fp:fB,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},WA);const uB={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function hB(t,e){const{message:r,code:n}=uB[t];return{message:r,code:n}}function xd(t,e){return!!Array.isArray(t)}class Js{}let lB=class extends Js{constructor(e){super()}};const Eg=Z.FIVE_SECONDS,Qs={pulse:"heartbeat_pulse"};let dB=class h3 extends lB{constructor(e){super(e),this.events=new hr.EventEmitter,this.interval=Eg,this.interval=(e==null?void 0:e.interval)||Eg}static async init(e){const r=new h3(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),Z.toMiliseconds(this.interval))}pulse(){this.events.emit(Qs.pulse)}};const pB=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,gB=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,yB=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function wB(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){bB(t);return}return e}function bB(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function Lc(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!yB.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(pB.test(t)||gB.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,wB)}return JSON.parse(t)}catch(n){if(e.strict)throw n;return t}}function mB(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function je(t,...e){try{return mB(t(...e))}catch(r){return Promise.reject(r)}}function EB(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function vB(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function vf(t){if(EB(t))return String(t);if(vB(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return vf(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const $d="base64:";function xB(t){return typeof t=="string"?t:$d+IB(t)}function $B(t){return typeof t!="string"||!t.startsWith($d)?t:AB(t.slice($d.length))}function AB(t){return globalThis.Buffer?ue.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function IB(t){return globalThis.Buffer?ue.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Mt(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function BB(...t){return Mt(t.join(":"))}function kc(t){return t=Mt(t),t?t+":":""}function SB(t,e){if(e===void 0)return!0;let r=0,n=t.indexOf(":");for(;n>-1;)r++,n=t.indexOf(":",n+1);return r<=e}function OB(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const _B="memory",DB=()=>{const t=new Map;return{name:_B,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function FB(t={}){const e={mounts:{"":t.driver||DB()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=f=>{for(const u of e.mountpoints)if(f.startsWith(u))return{base:u,relativeKey:f.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:f,driver:e.mounts[""]}},n=(f,u)=>e.mountpoints.filter(l=>l.startsWith(f)||u&&f.startsWith(l)).map(l=>({relativeBase:f.length>l.length?f.slice(l.length):void 0,mountpoint:l,driver:e.mounts[l]})),i=(f,u)=>{if(e.watching){u=Mt(u);for(const l of e.watchListeners)l(f,u)}},s=async()=>{if(!e.watching){e.watching=!0;for(const f in e.mounts)e.unwatch[f]=await vg(e.mounts[f],i,f)}},o=async()=>{if(e.watching){for(const f in e.unwatch)await e.unwatch[f]();e.unwatch={},e.watching=!1}},a=(f,u,l)=>{const h=new Map,d=p=>{let w=h.get(p.base);return w||(w={driver:p.driver,base:p.base,items:[]},h.set(p.base,w)),w};for(const p of f){const w=typeof p=="string",m=Mt(w?p:p.key),D=w?void 0:p.value,C=w||!p.options?u:{...u,...p.options},b=r(m);d(b).items.push({key:m,value:D,relativeKey:b.relativeKey,options:C})}return Promise.all([...h.values()].map(p=>l(p))).then(p=>p.flat())},c={hasItem(f,u={}){f=Mt(f);const{relativeKey:l,driver:h}=r(f);return je(h.hasItem,l,u)},getItem(f,u={}){f=Mt(f);const{relativeKey:l,driver:h}=r(f);return je(h.getItem,l,u).then(d=>Lc(d))},getItems(f,u={}){return a(f,u,l=>l.driver.getItems?je(l.driver.getItems,l.items.map(h=>({key:h.relativeKey,options:h.options})),u).then(h=>h.map(d=>({key:BB(l.base,d.key),value:Lc(d.value)}))):Promise.all(l.items.map(h=>je(l.driver.getItem,h.relativeKey,h.options).then(d=>({key:h.key,value:Lc(d)})))))},getItemRaw(f,u={}){f=Mt(f);const{relativeKey:l,driver:h}=r(f);return h.getItemRaw?je(h.getItemRaw,l,u):je(h.getItem,l,u).then(d=>$B(d))},async setItem(f,u,l={}){if(u===void 0)return c.removeItem(f);f=Mt(f);const{relativeKey:h,driver:d}=r(f);d.setItem&&(await je(d.setItem,h,vf(u),l),d.watch||i("update",f))},async setItems(f,u){await a(f,u,async l=>{if(l.driver.setItems)return je(l.driver.setItems,l.items.map(h=>({key:h.relativeKey,value:vf(h.value),options:h.options})),u);l.driver.setItem&&await Promise.all(l.items.map(h=>je(l.driver.setItem,h.relativeKey,vf(h.value),h.options)))})},async setItemRaw(f,u,l={}){if(u===void 0)return c.removeItem(f,l);f=Mt(f);const{relativeKey:h,driver:d}=r(f);if(d.setItemRaw)await je(d.setItemRaw,h,u,l);else if(d.setItem)await je(d.setItem,h,xB(u),l);else return;d.watch||i("update",f)},async removeItem(f,u={}){typeof u=="boolean"&&(u={removeMeta:u}),f=Mt(f);const{relativeKey:l,driver:h}=r(f);h.removeItem&&(await je(h.removeItem,l,u),(u.removeMeta||u.removeMata)&&await je(h.removeItem,l+"$",u),h.watch||i("remove",f))},async getMeta(f,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),f=Mt(f);const{relativeKey:l,driver:h}=r(f),d=Object.create(null);if(h.getMeta&&Object.assign(d,await je(h.getMeta,l,u)),!u.nativeOnly){const p=await je(h.getItem,l+"$",u).then(w=>Lc(w));p&&typeof p=="object"&&(typeof p.atime=="string"&&(p.atime=new Date(p.atime)),typeof p.mtime=="string"&&(p.mtime=new Date(p.mtime)),Object.assign(d,p))}return d},setMeta(f,u,l={}){return this.setItem(f+"$",u,l)},removeMeta(f,u={}){return this.removeItem(f+"$",u)},async getKeys(f,u={}){var m;f=kc(f);const l=n(f,!0);let h=[];const d=[];let p=!0;for(const D of l){(m=D.driver.flags)!=null&&m.maxDepth||(p=!1);const C=await je(D.driver.getKeys,D.relativeBase,u);for(const b of C){const B=D.mountpoint+Mt(b);h.some(F=>B.startsWith(F))||d.push(B)}h=[D.mountpoint,...h.filter(b=>!b.startsWith(D.mountpoint))]}const w=u.maxDepth!==void 0&&!p;return d.filter(D=>(!w||SB(D,u.maxDepth))&&OB(D,f))},async clear(f,u={}){f=kc(f),await Promise.all(n(f,!1).map(async l=>{if(l.driver.clear)return je(l.driver.clear,l.relativeBase,u);if(l.driver.removeItem){const h=await l.driver.getKeys(l.relativeBase||"",u);return Promise.all(h.map(d=>l.driver.removeItem(d,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(f=>xg(f)))},async watch(f){return await s(),e.watchListeners.push(f),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==f),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(f,u){if(f=kc(f),f&&e.mounts[f])throw new Error(`already mounted at ${f}`);return f&&(e.mountpoints.push(f),e.mountpoints.sort((l,h)=>h.length-l.length)),e.mounts[f]=u,e.watching&&Promise.resolve(vg(u,i,f)).then(l=>{e.unwatch[f]=l}).catch(console.error),c},async unmount(f,u=!0){var l,h;f=kc(f),!(!f||!e.mounts[f])&&(e.watching&&f in e.unwatch&&((h=(l=e.unwatch)[f])==null||h.call(l),delete e.unwatch[f]),u&&await xg(e.mounts[f]),e.mountpoints=e.mountpoints.filter(d=>d!==f),delete e.mounts[f])},getMount(f=""){f=Mt(f)+":";const u=r(f);return{driver:u.driver,base:u.base}},getMounts(f="",u={}){return f=Mt(f),n(f,u.parents).map(h=>({driver:h.driver,base:h.mountpoint}))},keys:(f,u={})=>c.getKeys(f,u),get:(f,u={})=>c.getItem(f,u),set:(f,u,l={})=>c.setItem(f,u,l),has:(f,u={})=>c.hasItem(f,u),del:(f,u={})=>c.removeItem(f,u),remove:(f,u={})=>c.removeItem(f,u)};return c}function vg(t,e,r){return t.watch?t.watch((n,i)=>e(n,r+i)):()=>{}}async function xg(t){typeof t.dispose=="function"&&await je(t.dispose)}function eo(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function l3(t,e){let r;const n=()=>{if(r)return r;const i=indexedDB.open(t);return i.onupgradeneeded=()=>i.result.createObjectStore(e),r=eo(i),r.then(s=>{s.onclose=()=>r=void 0},()=>{}),r};return(i,s)=>n().then(o=>s(o.transaction(e,i).objectStore(e)))}let Ah;function uc(){return Ah||(Ah=l3("keyval-store","keyval")),Ah}function $g(t,e=uc()){return e("readonly",r=>eo(r.get(t)))}function UB(t,e,r=uc()){return r("readwrite",n=>(n.put(e,t),eo(n.transaction)))}function CB(t,e=uc()){return e("readwrite",r=>(r.delete(t),eo(r.transaction)))}function PB(t=uc()){return t("readwrite",e=>(e.clear(),eo(e.transaction)))}function RB(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},eo(t.transaction)}function NB(t=uc()){return t("readonly",e=>{if(e.getAllKeys)return eo(e.getAllKeys());const r=[];return RB(e,n=>r.push(n.key)).then(()=>r)})}const TB="idb-keyval";var LB=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=i=>e+i;let n;return t.dbName&&t.storeName&&(n=l3(t.dbName,t.storeName)),{name:TB,options:t,async hasItem(i){return!(typeof await $g(r(i),n)>"u")},async getItem(i){return await $g(r(i),n)??null},setItem(i,s){return UB(r(i),s,n)},removeItem(i){return CB(r(i),n)},getKeys(){return NB(n)},clear(){return PB(n)}}};const kB="WALLET_CONNECT_V2_INDEXED_DB",jB="keyvaluestorage";let qB=class{constructor(){this.indexedDb=FB({driver:LB({dbName:kB,storeName:jB})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,Xn(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Ih=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof re<"u"?re:typeof self<"u"?self:{},xf={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,n){this[r]=String(n)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Ih<"u"&&Ih.localStorage?xf.exports=Ih.localStorage:typeof window<"u"&&window.localStorage?xf.exports=window.localStorage:xf.exports=new e})();function MB(t){var e;return[t[0],Ws((e=t[1])!=null?e:"")]}let zB=class{constructor(){this.localStorage=xf.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(MB)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return Ws(r)}async setItem(e,r){this.localStorage.setItem(e,Xn(r))}async removeItem(e){this.localStorage.removeItem(e)}};const HB="wc_storage_version",Ag=1,VB=async(t,e,r)=>{const n=HB,i=await e.getItem(n);if(i&&i>=Ag){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const f=await t.getItem(a);await e.setItem(a,f),o.push(a)}}await e.setItem(n,Ag),r(e),KB(t,o)},KB=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let GB=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new zB;this.storage=e;try{const r=new qB;VB(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var Bh,Ig;function ZB(){if(Ig)return Bh;Ig=1;function t(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Bh=e;function e(r,n,i){var s=i&&i.stringify||t,o=1;if(typeof r=="object"&&r!==null){var a=n.length+o;if(a===1)return r;var c=new Array(a);c[0]=s(r);for(var f=1;f<a;f++)c[f]=s(n[f]);return c.join(" ")}if(typeof r!="string")return r;var u=n.length;if(u===0)return r;for(var l="",h=1-o,d=-1,p=r&&r.length||0,w=0;w<p;){if(r.charCodeAt(w)===37&&w+1<p){switch(d=d>-1?d:0,r.charCodeAt(w+1)){case 100:case 102:if(h>=u||n[h]==null)break;d<w&&(l+=r.slice(d,w)),l+=Number(n[h]),d=w+2,w++;break;case 105:if(h>=u||n[h]==null)break;d<w&&(l+=r.slice(d,w)),l+=Math.floor(Number(n[h])),d=w+2,w++;break;case 79:case 111:case 106:if(h>=u||n[h]===void 0)break;d<w&&(l+=r.slice(d,w));var m=typeof n[h];if(m==="string"){l+="'"+n[h]+"'",d=w+2,w++;break}if(m==="function"){l+=n[h].name||"<anonymous>",d=w+2,w++;break}l+=s(n[h]),d=w+2,w++;break;case 115:if(h>=u)break;d<w&&(l+=r.slice(d,w)),l+=String(n[h]),d=w+2,w++;break;case 37:d<w&&(l+=r.slice(d,w)),l+="%",d=w+2,w++,h--;break}++h}++w}return d===-1?r:(d<p&&(l+=r.slice(d)),l)}return Bh}var Sh,Bg;function WB(){if(Bg)return Sh;Bg=1;const t=ZB();Sh=i;const e=F().console||{},r={mapHttpRequest:p,mapHttpResponse:p,wrapRequestSerializer:w,wrapResponseSerializer:w,wrapErrorSerializer:w,req:p,res:p,err:h};function n(_,N){return Array.isArray(_)?_.filter(function(S){return S!=="!stdSerializers.err"}):_===!0?Object.keys(N):!1}function i(_){_=_||{},_.browser=_.browser||{};const N=_.browser.transmit;if(N&&typeof N.send!="function")throw Error("pino: transmit option must have a send function");const P=_.browser.write||e;_.browser.write&&(_.browser.asObject=!0);const S=_.serializers||{},T=n(_.browser.serialize,S);let L=_.browser.serialize;Array.isArray(_.browser.serialize)&&_.browser.serialize.indexOf("!stdSerializers.err")>-1&&(L=!1);const O=["error","fatal","warn","info","debug","trace"];typeof P=="function"&&(P.error=P.fatal=P.warn=P.info=P.debug=P.trace=P),_.enabled===!1&&(_.level="silent");const x=_.level||"info",$=Object.create(P);$.log||($.log=m),Object.defineProperty($,"levelVal",{get:y}),Object.defineProperty($,"level",{get:v,set:I});const g={transmit:N,serialize:T,asObject:_.browser.asObject,levels:O,timestamp:d(_)};$.levels=i.levels,$.level=x,$.setMaxListeners=$.getMaxListeners=$.emit=$.addListener=$.on=$.prependListener=$.once=$.prependOnceListener=$.removeListener=$.removeAllListeners=$.listeners=$.listenerCount=$.eventNames=$.write=$.flush=m,$.serializers=S,$._serialize=T,$._stdErrSerialize=L,$.child=E,N&&($._logEvent=l());function y(){return this.level==="silent"?1/0:this.levels.values[this.level]}function v(){return this._level}function I(A){if(A!=="silent"&&!this.levels.values[A])throw Error("unknown level "+A);this._level=A,s(g,$,"error","log"),s(g,$,"fatal","error"),s(g,$,"warn","error"),s(g,$,"info","log"),s(g,$,"debug","log"),s(g,$,"trace","log")}function E(A,U){if(!A)throw new Error("missing bindings for child Pino");U=U||{},T&&A.serializers&&(U.serializers=A.serializers);const R=U.serializers;if(T&&R){var q=Object.assign({},S,R),j=_.browser.serialize===!0?Object.keys(q):T;delete A.serializers,c([A],j,q,this._stdErrSerialize)}function k(M){this._childLevel=(M._childLevel|0)+1,this.error=f(M,A,"error"),this.fatal=f(M,A,"fatal"),this.warn=f(M,A,"warn"),this.info=f(M,A,"info"),this.debug=f(M,A,"debug"),this.trace=f(M,A,"trace"),q&&(this.serializers=q,this._serialize=j),N&&(this._logEvent=l([].concat(M._logEvent.bindings,A)))}return k.prototype=this,new k(this)}return $}i.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},i.stdSerializers=r,i.stdTimeFunctions=Object.assign({},{nullTime:D,epochTime:C,unixTime:b,isoTime:B});function s(_,N,P,S){const T=Object.getPrototypeOf(N);N[P]=N.levelVal>N.levels.values[P]?m:T[P]?T[P]:e[P]||e[S]||m,o(_,N,P)}function o(_,N,P){!_.transmit&&N[P]===m||(N[P]=(function(S){return function(){const L=_.timestamp(),O=new Array(arguments.length),x=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var $=0;$<O.length;$++)O[$]=arguments[$];if(_.serialize&&!_.asObject&&c(O,this._serialize,this.serializers,this._stdErrSerialize),_.asObject?S.call(x,a(this,P,O,L)):S.apply(x,O),_.transmit){const g=_.transmit.level||N.level,y=i.levels.values[g],v=i.levels.values[P];if(v<y)return;u(this,{ts:L,methodLevel:P,methodValue:v,transmitValue:i.levels.values[_.transmit.level||N.level],send:_.transmit.send,val:N.levelVal},O)}}})(N[P]))}function a(_,N,P,S){_._serialize&&c(P,_._serialize,_.serializers,_._stdErrSerialize);const T=P.slice();let L=T[0];const O={};S&&(O.time=S),O.level=i.levels.values[N];let x=(_._childLevel|0)+1;if(x<1&&(x=1),L!==null&&typeof L=="object"){for(;x--&&typeof T[0]=="object";)Object.assign(O,T.shift());L=T.length?t(T.shift(),T):void 0}else typeof L=="string"&&(L=t(T.shift(),T));return L!==void 0&&(O.msg=L),O}function c(_,N,P,S){for(const T in _)if(S&&_[T]instanceof Error)_[T]=i.stdSerializers.err(_[T]);else if(typeof _[T]=="object"&&!Array.isArray(_[T]))for(const L in _[T])N&&N.indexOf(L)>-1&&L in P&&(_[T][L]=P[L](_[T][L]))}function f(_,N,P){return function(){const S=new Array(1+arguments.length);S[0]=N;for(var T=1;T<S.length;T++)S[T]=arguments[T-1];return _[P].apply(this,S)}}function u(_,N,P){const S=N.send,T=N.ts,L=N.methodLevel,O=N.methodValue,x=N.val,$=_._logEvent.bindings;c(P,_._serialize||Object.keys(_.serializers),_.serializers,_._stdErrSerialize===void 0?!0:_._stdErrSerialize),_._logEvent.ts=T,_._logEvent.messages=P.filter(function(g){return $.indexOf(g)===-1}),_._logEvent.level.label=L,_._logEvent.level.value=O,S(L,_._logEvent,x),_._logEvent=l($)}function l(_){return{ts:0,messages:[],bindings:_||[],level:{label:"",value:0}}}function h(_){const N={type:_.constructor.name,msg:_.message,stack:_.stack};for(const P in _)N[P]===void 0&&(N[P]=_[P]);return N}function d(_){return typeof _.timestamp=="function"?_.timestamp:_.timestamp===!1?D:C}function p(){return{}}function w(_){return _}function m(){}function D(){return!1}function C(){return Date.now()}function b(){return Math.round(Date.now()/1e3)}function B(){return new Date(Date.now()).toISOString()}function F(){function _(N){return typeof N<"u"&&N}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return _(self)||_(window)||_(this)||{}}}return Sh}var Ao=WB();const hc=k0(Ao),YB={level:"info"},lc="custom_context",ip=1e3*1024;let XB=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Sg=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new XB(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}},d3=class{constructor(e,r=ip){this.level=e??"error",this.levelValue=Ao.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new Sg(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===Ao.levels.values.error?console.error(e):r===Ao.levels.values.warn?console.warn(e):r===Ao.levels.values.debug?console.debug(e):r===Ao.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Xn({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new Sg(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(Xn({extraMetadata:e})),new Blob(r,{type:"application/json"})}},JB=class{constructor(e,r=ip){this.baseChunkLogger=new d3(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=r,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}},QB=class{constructor(e,r=ip){this.baseChunkLogger=new d3(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var eS=Object.defineProperty,tS=Object.defineProperties,rS=Object.getOwnPropertyDescriptors,Og=Object.getOwnPropertySymbols,nS=Object.prototype.hasOwnProperty,iS=Object.prototype.propertyIsEnumerable,_g=(t,e,r)=>e in t?eS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mf=(t,e)=>{for(var r in e||(e={}))nS.call(e,r)&&_g(t,r,e[r]);if(Og)for(var r of Og(e))iS.call(e,r)&&_g(t,r,e[r]);return t},zf=(t,e)=>tS(t,rS(e));function Eu(t){return zf(Mf({},t),{level:(t==null?void 0:t.level)||YB.level})}function sS(t,e=lc){return t[e]||""}function oS(t,e,r=lc){return t[r]=e,t}function tr(t,e=lc){let r="";return typeof t.bindings>"u"?r=sS(t,e):r=t.bindings().context||"",r}function aS(t,e,r=lc){const n=tr(t,r);return n.trim()?`${n}/${e}`:e}function Pt(t,e,r=lc){const n=aS(t,e,r),i=t.child({context:n});return oS(i,n,r)}function cS(t){var e,r;const n=new JB((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:hc(zf(Mf({},t.opts),{level:"trace",browser:zf(Mf({},(r=t.opts)==null?void 0:r.browser),{write:i=>n.write(i)})})),chunkLoggerController:n}}function fS(t){var e;const r=new QB((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:hc(zf(Mf({},t.opts),{level:"trace"}),r),chunkLoggerController:r}}function uS(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?cS(t):fS(t)}var hS=Object.defineProperty,lS=(t,e,r)=>e in t?hS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Dg=(t,e,r)=>lS(t,typeof e!="symbol"?e+"":e,r);let dS=class extends Js{constructor(e){super(),this.opts=e,Dg(this,"protocol","wc"),Dg(this,"version",2)}};var pS=Object.defineProperty,gS=(t,e,r)=>e in t?pS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yS=(t,e,r)=>gS(t,e+"",r);let wS=class extends Js{constructor(e,r){super(),this.core=e,this.logger=r,yS(this,"records",new Map)}},bS=class{constructor(e,r){this.logger=e,this.core=r}},mS=class extends Js{constructor(e,r){super(),this.relayer=e,this.logger=r}},ES=class extends Js{constructor(e){super()}},vS=class{constructor(e,r,n,i){this.core=e,this.logger=r,this.name=n}},xS=class extends Js{constructor(e,r){super(),this.relayer=e,this.logger=r}},$S=class extends Js{constructor(e,r){super(),this.core=e,this.logger=r}},AS=class{constructor(e,r,n){this.core=e,this.logger=r,this.store=n}},IS=class{constructor(e,r){this.projectId=e,this.logger=r}},BS=class{constructor(e,r,n){this.core=e,this.logger=r,this.telemetryEnabled=n}};function SS(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function p3(t,...e){if(!SS(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Fg(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function OS(t,e){p3(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const co=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Oh=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function _S(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function g3(t){return typeof t=="string"&&(t=_S(t)),p3(t),t}let DS=class{clone(){return this._cloneInto()}};function FS(t){const e=n=>t().update(g3(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function y3(t=32){if(co&&typeof co.getRandomValues=="function")return co.getRandomValues(new Uint8Array(t));if(co&&typeof co.randomBytes=="function")return co.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function US(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}let CS=class extends DS{constructor(e,r,n,i){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Oh(this.buffer)}update(e){Fg(this);const{view:r,buffer:n,blockLen:i}=this;e=g3(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Oh(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Fg(this),OS(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let l=o;l<i;l++)r[l]=0;US(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Oh(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)a.setUint32(4*l,u[l],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%r&&e.buffer.set(n),e}};const jc=BigInt(2**32-1),Ad=BigInt(32);function w3(t,e=!1){return e?{h:Number(t&jc),l:Number(t>>Ad&jc)}:{h:Number(t>>Ad&jc)|0,l:Number(t&jc)|0}}function PS(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=w3(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const RS=(t,e)=>BigInt(t>>>0)<<Ad|BigInt(e>>>0),NS=(t,e,r)=>t>>>r,TS=(t,e,r)=>t<<32-r|e>>>r,LS=(t,e,r)=>t>>>r|e<<32-r,kS=(t,e,r)=>t<<32-r|e>>>r,jS=(t,e,r)=>t<<64-r|e>>>r-32,qS=(t,e,r)=>t>>>r-32|e<<64-r,MS=(t,e)=>e,zS=(t,e)=>t,HS=(t,e,r)=>t<<r|e>>>32-r,VS=(t,e,r)=>e<<r|t>>>32-r,KS=(t,e,r)=>e<<r-32|t>>>64-r,GS=(t,e,r)=>t<<r-32|e>>>64-r;function ZS(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const WS=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),YS=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,XS=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),JS=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,QS=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),eO=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,se={fromBig:w3,split:PS,toBig:RS,shrSH:NS,shrSL:TS,rotrSH:LS,rotrSL:kS,rotrBH:jS,rotrBL:qS,rotr32H:MS,rotr32L:zS,rotlSH:HS,rotlSL:VS,rotlBH:KS,rotlBL:GS,add:ZS,add3L:WS,add3H:YS,add4L:XS,add4H:JS,add5H:eO,add5L:QS},[tO,rO]=se.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),fi=new Uint32Array(80),ui=new Uint32Array(80);let nO=class extends CS{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:f,El:u,Fh:l,Fl:h,Gh:d,Gl:p,Hh:w,Hl:m}=this;return[e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m]}set(e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=u|0,this.Fh=l|0,this.Fl=h|0,this.Gh=d|0,this.Gl=p|0,this.Hh=w|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)fi[b]=e.getUint32(r),ui[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const B=fi[b-15]|0,F=ui[b-15]|0,_=se.rotrSH(B,F,1)^se.rotrSH(B,F,8)^se.shrSH(B,F,7),N=se.rotrSL(B,F,1)^se.rotrSL(B,F,8)^se.shrSL(B,F,7),P=fi[b-2]|0,S=ui[b-2]|0,T=se.rotrSH(P,S,19)^se.rotrBH(P,S,61)^se.shrSH(P,S,6),L=se.rotrSL(P,S,19)^se.rotrBL(P,S,61)^se.shrSL(P,S,6),O=se.add4L(N,L,ui[b-7],ui[b-16]),x=se.add4H(O,_,T,fi[b-7],fi[b-16]);fi[b]=x|0,ui[b]=O|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:f,Dl:u,Eh:l,El:h,Fh:d,Fl:p,Gh:w,Gl:m,Hh:D,Hl:C}=this;for(let b=0;b<80;b++){const B=se.rotrSH(l,h,14)^se.rotrSH(l,h,18)^se.rotrBH(l,h,41),F=se.rotrSL(l,h,14)^se.rotrSL(l,h,18)^se.rotrBL(l,h,41),_=l&d^~l&w,N=h&p^~h&m,P=se.add5L(C,F,N,rO[b],ui[b]),S=se.add5H(P,D,B,_,tO[b],fi[b]),T=P|0,L=se.rotrSH(n,i,28)^se.rotrBH(n,i,34)^se.rotrBH(n,i,39),O=se.rotrSL(n,i,28)^se.rotrBL(n,i,34)^se.rotrBL(n,i,39),x=n&s^n&a^s&a,$=i&o^i&c^o&c;D=w|0,C=m|0,w=d|0,m=p|0,d=l|0,p=h|0,{h:l,l:h}=se.add(f|0,u|0,S|0,T|0),f=a|0,u=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const g=se.add3L(T,O,$);n=se.add3H(g,S,L,x),i=g|0}({h:n,l:i}=se.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=se.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=se.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l:u}=se.add(this.Dh|0,this.Dl|0,f|0,u|0),{h:l,l:h}=se.add(this.Eh|0,this.El|0,l|0,h|0),{h:d,l:p}=se.add(this.Fh|0,this.Fl|0,d|0,p|0),{h:w,l:m}=se.add(this.Gh|0,this.Gl|0,w|0,m|0),{h:D,l:C}=se.add(this.Hh|0,this.Hl|0,D|0,C|0),this.set(n,i,s,o,a,c,f,u,l,h,d,p,w,m,D,C)}roundClean(){fi.fill(0),ui.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const iO=FS(()=>new nO);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const sp=BigInt(0),b3=BigInt(1),sO=BigInt(2);function op(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ap(t){if(!op(t))throw new Error("Uint8Array expected")}function _h(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const oO=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function cp(t){ap(t);let e="";for(let r=0;r<t.length;r++)e+=oO[t[r]];return e}function m3(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?sp:BigInt("0x"+t)}const mn={_0:48,_9:57,A:65,F:70,a:97,f:102};function Ug(t){if(t>=mn._0&&t<=mn._9)return t-mn._0;if(t>=mn.A&&t<=mn.F)return t-(mn.A-10);if(t>=mn.a&&t<=mn.f)return t-(mn.a-10)}function E3(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=Ug(t.charCodeAt(s)),a=Ug(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function aO(t){return m3(cp(t))}function $f(t){return ap(t),m3(cp(Uint8Array.from(t).reverse()))}function v3(t,e){return E3(t.toString(16).padStart(e*2,"0"))}function Id(t,e){return v3(t,e).reverse()}function En(t,e,r){let n;if(typeof e=="string")try{n=E3(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(op(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function Cg(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];ap(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const Dh=t=>typeof t=="bigint"&&sp<=t;function cO(t,e,r){return Dh(t)&&Dh(e)&&Dh(r)&&e<=t&&t<r}function fa(t,e,r,n){if(!cO(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function fO(t){let e;for(e=0;t>sp;t>>=b3,e+=1);return e}const uO=t=>(sO<<BigInt(t-1))-b3,hO={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||op(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function fp(t,e,r={}){const n=(i,s,o)=>{const a=hO[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function Pg(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const He=BigInt(0),Se=BigInt(1),Ss=BigInt(2),lO=BigInt(3),Bd=BigInt(4),Rg=BigInt(5),Ng=BigInt(8);function Ne(t,e){const r=t%e;return r>=He?r:e+r}function dO(t,e,r){if(e<He)throw new Error("invalid exponent, negatives unsupported");if(r<=He)throw new Error("invalid modulus");if(r===Se)return He;let n=Se;for(;e>He;)e&Se&&(n=n*t%r),t=t*t%r,e>>=Se;return n}function tn(t,e,r){let n=t;for(;e-- >He;)n*=n,n%=r;return n}function Tg(t,e){if(t===He)throw new Error("invert: expected non-zero number");if(e<=He)throw new Error("invert: expected positive modulus, got "+e);let r=Ne(t,e),n=e,i=He,s=Se;for(;r!==He;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==Se)throw new Error("invert: does not exist");return Ne(i,e)}function pO(t){const e=(t-Se)/Ss;let r,n,i;for(r=t-Se,n=0;r%Ss===He;r/=Ss,n++);for(i=Ss;i<t&&dO(i,e,t)!==t-Se;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+Se)/Bd;return function(a,c){const f=a.pow(c,o);if(!a.eql(a.sqr(f),c))throw new Error("Cannot find square root");return f}}const s=(r+Se)/Ss;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,f=o.pow(o.mul(o.ONE,i),r),u=o.pow(a,s),l=o.pow(a,r);for(;!o.eql(l,o.ONE);){if(o.eql(l,o.ZERO))return o.ZERO;let h=1;for(let p=o.sqr(l);h<c&&!o.eql(p,o.ONE);h++)p=o.sqr(p);const d=o.pow(f,Se<<BigInt(c-h-1));f=o.sqr(d),u=o.mul(u,d),l=o.mul(l,f),c=h}return u}}function gO(t){if(t%Bd===lO){const e=(t+Se)/Bd;return function(r,n){const i=r.pow(n,e);if(!r.eql(r.sqr(i),n))throw new Error("Cannot find square root");return i}}if(t%Ng===Rg){const e=(t-Rg)/Ng;return function(r,n){const i=r.mul(n,Ss),s=r.pow(i,e),o=r.mul(n,s),a=r.mul(r.mul(o,Ss),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return pO(t)}const yO=(t,e)=>(Ne(t,e)&Se)===Se,wO=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function bO(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=wO.reduce((n,i)=>(n[i]="function",n),e);return fp(t,r)}function mO(t,e,r){if(r<He)throw new Error("invalid exponent, negatives unsupported");if(r===He)return t.ONE;if(r===Se)return e;let n=t.ONE,i=e;for(;r>He;)r&Se&&(n=t.mul(n,i)),i=t.sqr(i),r>>=Se;return n}function EO(t,e){const r=new Array(e.length),n=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),i=t.inv(n);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),i),r}function x3(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function $3(t,e,r=!1,n={}){if(t<=He)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=x3(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:uO(i),ZERO:He,ONE:Se,create:c=>Ne(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return He<=c&&c<t},is0:c=>c===He,isOdd:c=>(c&Se)===Se,neg:c=>Ne(-c,t),eql:(c,f)=>c===f,sqr:c=>Ne(c*c,t),add:(c,f)=>Ne(c+f,t),sub:(c,f)=>Ne(c-f,t),mul:(c,f)=>Ne(c*f,t),pow:(c,f)=>mO(a,c,f),div:(c,f)=>Ne(c*Tg(f,t),t),sqrN:c=>c*c,addN:(c,f)=>c+f,subN:(c,f)=>c-f,mulN:(c,f)=>c*f,inv:c=>Tg(c,t),sqrt:n.sqrt||(c=>(o||(o=gO(t)),o(a,c))),invertBatch:c=>EO(a,c),cmov:(c,f,u)=>u?f:c,toBytes:c=>r?Id(c,s):v3(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?$f(c):aO(c)}});return Object.freeze(a)}const Lg=BigInt(0),qc=BigInt(1);function Fh(t,e){const r=e.negate();return t?r:e}function A3(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Uh(t,e){A3(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function vO(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function xO(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Ch=new WeakMap,I3=new WeakMap;function Ph(t){return I3.get(t)||1}function $O(t,e){return{constTimeNegate:Fh,hasPrecomputes(r){return Ph(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Lg;)n&qc&&(i=i.add(s)),s=s.double(),n>>=qc;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=Uh(n,e),o=[];let a=r,c=a;for(let f=0;f<i;f++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){const{windows:s,windowSize:o}=Uh(r,e);let a=t.ZERO,c=t.BASE;const f=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<s;h++){const d=h*o;let p=Number(i&f);i>>=l,p>o&&(p-=u,i+=qc);const w=d,m=d+Math.abs(p)-1,D=h%2!==0,C=p<0;p===0?c=c.add(Fh(D,n[w])):a=a.add(Fh(C,n[m]))}return{p:a,f:c}},wNAFUnsafe(r,n,i,s=t.ZERO){const{windows:o,windowSize:a}=Uh(r,e),c=BigInt(2**r-1),f=2**r,u=BigInt(r);for(let l=0;l<o;l++){const h=l*a;if(i===Lg)break;let d=Number(i&c);if(i>>=u,d>a&&(d-=f,i+=qc),d===0)continue;let p=n[h+Math.abs(d)-1];d<0&&(p=p.negate()),s=s.add(p)}return s},getPrecomputes(r,n,i){let s=Ch.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&Ch.set(n,i(s))),s},wNAFCached(r,n,i){const s=Ph(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=Ph(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){A3(n,e),I3.set(r,n),Ch.delete(r)}}}function AO(t,e,r,n){if(vO(r,t),xO(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=fO(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),f=Math.floor((e.BITS-1)/o)*o;let u=i;for(let l=f;l>=0;l-=o){c.fill(i);for(let d=0;d<n.length;d++){const p=n[d],w=Number(p>>BigInt(l)&BigInt(a));c[w]=c[w].add(r[d])}let h=i;for(let d=c.length-1,p=i;d>0;d--)p=p.add(c[d]),h=h.add(p);if(u=u.add(h),l!==0)for(let d=0;d<o;d++)u=u.double()}return u}function IO(t){return bO(t.Fp),fp(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...x3(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const _r=BigInt(0),Tt=BigInt(1),Mc=BigInt(2),BO=BigInt(8),SO={zip215:!0};function OO(t){const e=IO(t);return fp(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function _O(t){const e=OO(t),{Fp:r,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,f=Mc<<BigInt(a*8)-Tt,u=r.create,l=$3(e.n,e.nBitLength),h=e.uvRatio||((g,y)=>{try{return{isValid:!0,value:r.sqrt(g*r.inv(y))}}catch{return{isValid:!1,value:_r}}}),d=e.adjustScalarBytes||(g=>g),p=e.domain||((g,y,v)=>{if(_h("phflag",v),y.length||v)throw new Error("Contexts/pre-hash are not supported");return g});function w(g,y){fa("coordinate "+g,y,_r,f)}function m(g){if(!(g instanceof b))throw new Error("ExtendedPoint expected")}const D=Pg((g,y)=>{const{ex:v,ey:I,ez:E}=g,A=g.is0();y==null&&(y=A?BO:r.inv(E));const U=u(v*y),R=u(I*y),q=u(E*y);if(A)return{x:_r,y:Tt};if(q!==Tt)throw new Error("invZ was invalid");return{x:U,y:R}}),C=Pg(g=>{const{a:y,d:v}=e;if(g.is0())throw new Error("bad point: ZERO");const{ex:I,ey:E,ez:A,et:U}=g,R=u(I*I),q=u(E*E),j=u(A*A),k=u(j*j),M=u(R*y),H=u(j*u(M+q)),V=u(k+u(v*u(R*q)));if(H!==V)throw new Error("bad point: equation left != right (1)");const z=u(I*E),K=u(A*U);if(z!==K)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(y,v,I,E){this.ex=y,this.ey=v,this.ez=I,this.et=E,w("x",y),w("y",v),w("z",I),w("t",E),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(y){if(y instanceof b)throw new Error("extended point not allowed");const{x:v,y:I}=y||{};return w("x",v),w("y",I),new b(v,I,Tt,u(v*I))}static normalizeZ(y){const v=r.invertBatch(y.map(I=>I.ez));return y.map((I,E)=>I.toAffine(v[E])).map(b.fromAffine)}static msm(y,v){return AO(b,l,y,v)}_setWindowSize(y){_.setWindowSize(this,y)}assertValidity(){C(this)}equals(y){m(y);const{ex:v,ey:I,ez:E}=this,{ex:A,ey:U,ez:R}=y,q=u(v*R),j=u(A*E),k=u(I*R),M=u(U*E);return q===j&&k===M}is0(){return this.equals(b.ZERO)}negate(){return new b(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:y}=e,{ex:v,ey:I,ez:E}=this,A=u(v*v),U=u(I*I),R=u(Mc*u(E*E)),q=u(y*A),j=v+I,k=u(u(j*j)-A-U),M=q+U,H=M-R,V=q-U,z=u(k*H),K=u(M*V),Q=u(k*V),ee=u(H*M);return new b(z,K,ee,Q)}add(y){m(y);const{a:v,d:I}=e,{ex:E,ey:A,ez:U,et:R}=this,{ex:q,ey:j,ez:k,et:M}=y;if(v===BigInt(-1)){const vr=u((A-E)*(j+q)),xr=u((A+E)*(j-q)),St=u(xr-vr);if(St===_r)return this.double();const $r=u(U*Mc*M),Ar=u(R*Mc*k),Ir=Ar+$r,Br=xr+vr,Sr=Ar-$r,ys=u(Ir*St),ws=u(Br*Sr),bs=u(Ir*Sr),ms=u(St*Br);return new b(ys,ws,ms,bs)}const H=u(E*q),V=u(A*j),z=u(R*I*M),K=u(U*k),Q=u((E+A)*(q+j)-H-V),ee=K-z,ne=K+z,he=u(V-v*H),Bt=u(Q*ee),Rt=u(ne*he),ps=u(Q*he),gs=u(ee*ne);return new b(Bt,Rt,gs,ps)}subtract(y){return this.add(y.negate())}wNAF(y){return _.wNAFCached(this,y,b.normalizeZ)}multiply(y){const v=y;fa("scalar",v,Tt,n);const{p:I,f:E}=this.wNAF(v);return b.normalizeZ([I,E])[0]}multiplyUnsafe(y,v=b.ZERO){const I=y;return fa("scalar",I,_r,n),I===_r?F:this.is0()||I===Tt?this:_.wNAFCachedUnsafe(this,I,b.normalizeZ,v)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return _.unsafeLadder(this,n).is0()}toAffine(y){return D(this,y)}clearCofactor(){const{h:y}=e;return y===Tt?this:this.multiplyUnsafe(y)}static fromHex(y,v=!1){const{d:I,a:E}=e,A=r.BYTES;y=En("pointHex",y,A),_h("zip215",v);const U=y.slice(),R=y[A-1];U[A-1]=R&-129;const q=$f(U),j=v?f:r.ORDER;fa("pointHex.y",q,_r,j);const k=u(q*q),M=u(k-Tt),H=u(I*k-E);let{isValid:V,value:z}=h(M,H);if(!V)throw new Error("Point.fromHex: invalid y coordinate");const K=(z&Tt)===Tt,Q=(R&128)!==0;if(!v&&z===_r&&Q)throw new Error("Point.fromHex: x=0 and x_0=1");return Q!==K&&(z=u(-z)),b.fromAffine({x:z,y:q})}static fromPrivateKey(y){return S(y).point}toRawBytes(){const{x:y,y:v}=this.toAffine(),I=Id(v,r.BYTES);return I[I.length-1]|=y&Tt?128:0,I}toHex(){return cp(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,Tt,u(e.Gx*e.Gy)),b.ZERO=new b(_r,Tt,Tt,_r);const{BASE:B,ZERO:F}=b,_=$O(b,a*8);function N(g){return Ne(g,n)}function P(g){return N($f(g))}function S(g){const y=r.BYTES;g=En("private key",g,y);const v=En("hashed private key",s(g),2*y),I=d(v.slice(0,y)),E=v.slice(y,2*y),A=P(I),U=B.multiply(A),R=U.toRawBytes();return{head:I,prefix:E,scalar:A,point:U,pointBytes:R}}function T(g){return S(g).pointBytes}function L(g=new Uint8Array,...y){const v=Cg(...y);return P(s(p(v,En("context",g),!!i)))}function O(g,y,v={}){g=En("message",g),i&&(g=i(g));const{prefix:I,scalar:E,pointBytes:A}=S(y),U=L(v.context,I,g),R=B.multiply(U).toRawBytes(),q=L(v.context,R,A,g),j=N(U+q*E);fa("signature.s",j,_r,n);const k=Cg(R,Id(j,r.BYTES));return En("result",k,r.BYTES*2)}const x=SO;function $(g,y,v,I=x){const{context:E,zip215:A}=I,U=r.BYTES;g=En("signature",g,2*U),y=En("message",y),v=En("publicKey",v,U),A!==void 0&&_h("zip215",A),i&&(y=i(y));const R=$f(g.slice(U,2*U));let q,j,k;try{q=b.fromHex(v,A),j=b.fromHex(g.slice(0,U),A),k=B.multiplyUnsafe(R)}catch{return!1}if(!A&&q.isSmallOrder())return!1;const M=L(E,j.toRawBytes(),q.toRawBytes(),y);return j.add(q.multiplyUnsafe(M)).subtract(k).clearCofactor().equals(b.ZERO)}return B._setWindowSize(8),{CURVE:e,getPublicKey:T,sign:O,verify:$,ExtendedPoint:b,utils:{getExtendedPublicKey:S,randomPrivateKey:()=>o(r.BYTES),precompute(g=8,y=b.BASE){return y._setWindowSize(g),y.multiply(BigInt(3)),y}}}}BigInt(0),BigInt(1);const up=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),kg=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const DO=BigInt(1),jg=BigInt(2);BigInt(3);const FO=BigInt(5),UO=BigInt(8);function CO(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=up,o=t*t%s*t%s,a=tn(o,jg,s)*o%s,c=tn(a,DO,s)*t%s,f=tn(c,FO,s)*c%s,u=tn(f,e,s)*f%s,l=tn(u,r,s)*u%s,h=tn(l,n,s)*l%s,d=tn(h,i,s)*h%s,p=tn(d,i,s)*h%s,w=tn(p,e,s)*f%s;return{pow_p_5_8:tn(w,jg,s)*t%s,b2:o}}function PO(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function RO(t,e){const r=up,n=Ne(e*e*e,r),i=Ne(n*n*e,r),s=CO(t*i).pow_p_5_8;let o=Ne(t*n*s,r);const a=Ne(e*o*o,r),c=o,f=Ne(o*kg,r),u=a===t,l=a===Ne(-t,r),h=a===Ne(-t*kg,r);return u&&(o=c),(l||h)&&(o=f),yO(o,r)&&(o=Ne(-o,r)),{isValid:u||l,value:o}}const NO=$3(up,void 0,!0),TO={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:NO,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:UO,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:iO,randomBytes:y3,adjustScalarBytes:PO,uvRatio:RO},B3=_O(TO),LO="EdDSA",kO="JWT",Hf=".",vu="base64url",S3="utf8",O3="utf8",jO=":",qO="did",MO="key",qg="base58btc",zO="z",HO="K36",VO=32;function hp(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function _3(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?hp(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function D3(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=_3(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return hp(r)}function KO(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),f=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var w=0,m=0,D=0,C=p.length;D!==C&&p[D]===0;)D++,w++;for(var b=(C-D)*u+1>>>0,B=new Uint8Array(b);D!==C;){for(var F=p[D],_=0,N=b-1;(F!==0||_<m)&&N!==-1;N--,_++)F+=256*B[N]>>>0,B[N]=F%a>>>0,F=F/a>>>0;if(F!==0)throw new Error("Non-zero carry");m=_,D++}for(var P=b-m;P!==b&&B[P]===0;)P++;for(var S=c.repeat(w);P<b;++P)S+=t.charAt(B[P]);return S}function h(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var w=0;if(p[w]!==" "){for(var m=0,D=0;p[w]===c;)m++,w++;for(var C=(p.length-w)*f+1>>>0,b=new Uint8Array(C);p[w];){var B=r[p.charCodeAt(w)];if(B===255)return;for(var F=0,_=C-1;(B!==0||F<D)&&_!==-1;_--,F++)B+=a*b[_]>>>0,b[_]=B%256>>>0,B=B/256>>>0;if(B!==0)throw new Error("Non-zero carry");D=F,w++}if(p[w]!==" "){for(var N=C-D;N!==C&&b[N]===0;)N++;for(var P=new Uint8Array(m+(C-N)),S=m;N!==C;)P[S++]=b[N++];return P}}}function d(p){var w=h(p);if(w)return w;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:h,decode:d}}var GO=KO,ZO=GO;const F3=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},WO=t=>new TextEncoder().encode(t),YO=t=>new TextDecoder().decode(t);let XO=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},JO=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return U3(this,e)}},QO=class{constructor(e){this.decoders=e}or(e){return U3(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const U3=(t,e)=>new QO({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let e_=class{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new XO(e,r,n),this.decoder=new JO(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const xu=({name:t,prefix:e,encode:r,decode:n})=>new e_(t,e,r,n),dc=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=ZO(r,e);return xu({prefix:t,name:e,encode:n,decode:s=>F3(i(s))})},t_=(t,e,r,n)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,f=0;for(let u=0;u<s;++u){const l=i[t[u]];if(l===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|l,a+=r,a>=8&&(a-=8,o[f++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},r_=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},nt=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>xu({prefix:e,name:t,encode(i){return r_(i,n,r)},decode(i){return t_(i,n,r,t)}}),n_=xu({prefix:"\0",name:"identity",encode:t=>YO(t),decode:t=>WO(t)});var i_=Object.freeze({__proto__:null,identity:n_});const s_=nt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var o_=Object.freeze({__proto__:null,base2:s_});const a_=nt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var c_=Object.freeze({__proto__:null,base8:a_});const f_=dc({prefix:"9",name:"base10",alphabet:"0123456789"});var u_=Object.freeze({__proto__:null,base10:f_});const h_=nt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),l_=nt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var d_=Object.freeze({__proto__:null,base16:h_,base16upper:l_});const p_=nt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),g_=nt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),y_=nt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),w_=nt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),b_=nt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),m_=nt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),E_=nt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),v_=nt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),x_=nt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var $_=Object.freeze({__proto__:null,base32:p_,base32upper:g_,base32pad:y_,base32padupper:w_,base32hex:b_,base32hexupper:m_,base32hexpad:E_,base32hexpadupper:v_,base32z:x_});const A_=dc({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),I_=dc({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var B_=Object.freeze({__proto__:null,base36:A_,base36upper:I_});const S_=dc({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),O_=dc({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var __=Object.freeze({__proto__:null,base58btc:S_,base58flickr:O_});const D_=nt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),F_=nt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),U_=nt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),C_=nt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var P_=Object.freeze({__proto__:null,base64:D_,base64pad:F_,base64url:U_,base64urlpad:C_});const C3=Array.from(""),R_=C3.reduce((t,e,r)=>(t[r]=e,t),[]),N_=C3.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function T_(t){return t.reduce((e,r)=>(e+=R_[r],e),"")}function L_(t){const e=[];for(const r of t){const n=N_[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const k_=xu({prefix:"",name:"base256emoji",encode:T_,decode:L_});var j_=Object.freeze({__proto__:null,base256emoji:k_}),q_=P3,Mg=128,M_=-128,z_=Math.pow(2,31);function P3(t,e,r){e=e||[],r=r||0;for(var n=r;t>=z_;)e[r++]=t&255|Mg,t/=128;for(;t&M_;)e[r++]=t&255|Mg,t>>>=7;return e[r]=t|0,P3.bytes=r-n+1,e}var H_=Sd,V_=128,zg=127;function Sd(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw Sd.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&zg)<<i:(o&zg)*Math.pow(2,i),i+=7}while(o>=V_);return Sd.bytes=s-n,r}var K_=Math.pow(2,7),G_=Math.pow(2,14),Z_=Math.pow(2,21),W_=Math.pow(2,28),Y_=Math.pow(2,35),X_=Math.pow(2,42),J_=Math.pow(2,49),Q_=Math.pow(2,56),eD=Math.pow(2,63),tD=function(t){return t<K_?1:t<G_?2:t<Z_?3:t<W_?4:t<Y_?5:t<X_?6:t<J_?7:t<Q_?8:t<eD?9:10},rD={encode:q_,decode:H_,encodingLength:tD},R3=rD;const Hg=(t,e,r=0)=>(R3.encode(t,e,r),e),Vg=t=>R3.encodingLength(t),Od=(t,e)=>{const r=e.byteLength,n=Vg(t),i=n+Vg(r),s=new Uint8Array(i+r);return Hg(t,s,0),Hg(r,s,n),s.set(e,i),new nD(t,r,e,s)};let nD=class{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}};const N3=({name:t,code:e,encode:r})=>new iD(t,e,r);let iD=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Od(this.code,r):r.then(n=>Od(this.code,n))}else throw Error("Unknown type, must be binary type")}};const T3=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),sD=N3({name:"sha2-256",code:18,encode:T3("SHA-256")}),oD=N3({name:"sha2-512",code:19,encode:T3("SHA-512")});var aD=Object.freeze({__proto__:null,sha256:sD,sha512:oD});const L3=0,cD="identity",k3=F3,fD=t=>Od(L3,k3(t)),uD={code:L3,name:cD,encode:k3,digest:fD};var hD=Object.freeze({__proto__:null,identity:uD});new TextEncoder,new TextDecoder;const Kg={...i_,...o_,...c_,...u_,...d_,...$_,...B_,...__,...P_,...j_};({...aD,...hD});function j3(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const Gg=j3("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Rh=j3("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=_3(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),q3={utf8:Gg,"utf-8":Gg,hex:Kg.base16,latin1:Rh,ascii:Rh,binary:Rh,...Kg};function $u(t,e="utf8"){const r=q3[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function Jo(t,e="utf8"){const r=q3[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?hp(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Zg(t){return Ws($u(Jo(t,vu),S3))}function Vf(t){return $u(Jo(Xn(t),S3),vu)}function M3(t){const e=Jo(HO,qg),r=zO+$u(D3([e,t]),qg);return[qO,MO,r].join(jO)}function lD(t){return $u(t,vu)}function dD(t){return Jo(t,vu)}function pD(t){return Jo([Vf(t.header),Vf(t.payload)].join(Hf),O3)}function gD(t){return[Vf(t.header),Vf(t.payload),lD(t.signature)].join(Hf)}function _d(t){const e=t.split(Hf),r=Zg(e[0]),n=Zg(e[1]),i=dD(e[2]),s=Jo(e.slice(0,2).join(Hf),O3);return{header:r,payload:n,signature:i,data:s}}function Wg(t=y3(VO)){const e=B3.getPublicKey(t);return{secretKey:D3([t,e]),publicKey:e}}async function yD(t,e,r,n,i=Z.fromMiliseconds(Date.now())){const s={alg:LO,typ:kO},o=M3(n.publicKey),a=i+r,c={iss:o,sub:t,aud:e,iat:i,exp:a},f=pD({header:s,payload:c}),u=B3.sign(f,n.secretKey.slice(0,32));return gD({header:s,payload:c,signature:u})}function wD(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let f=0;f<e.length;f++)e[f]=255;for(let f=0;f<t.length;f++){const u=t.charAt(f),l=u.charCodeAt(0);if(e[l]!==255)throw new TypeError(u+" is ambiguous");e[l]=f}const r=t.length,n=t.charAt(0),i=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function o(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";let u=0,l=0,h=0;const d=f.length;for(;h!==d&&f[h]===0;)h++,u++;const p=(d-h)*s+1>>>0,w=new Uint8Array(p);for(;h!==d;){let C=f[h],b=0;for(let B=p-1;(C!==0||b<l)&&B!==-1;B--,b++)C+=256*w[B]>>>0,w[B]=C%r>>>0,C=C/r>>>0;if(C!==0)throw new Error("Non-zero carry");l=b,h++}let m=p-l;for(;m!==p&&w[m]===0;)m++;let D=n.repeat(u);for(;m<p;++m)D+=t.charAt(w[m]);return D}function a(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;let u=0,l=0,h=0;for(;f[u]===n;)l++,u++;const d=(f.length-u)*i+1>>>0,p=new Uint8Array(d);for(;u<f.length;){const C=f.charCodeAt(u);if(C>255)return;let b=e[C];if(b===255)return;let B=0;for(let F=d-1;(b!==0||B<h)&&F!==-1;F--,B++)b+=r*p[F]>>>0,p[F]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");h=B,u++}let w=d-h;for(;w!==d&&p[w]===0;)w++;const m=new Uint8Array(l+(d-w));let D=l;for(;w!==d;)m[D++]=p[w++];return m}function c(f){const u=a(f);if(u)return u;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var bD="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";wD(bD);function lp(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function z3(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?lp(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ja(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=z3(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return lp(r)}function H3(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const Yg=H3("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Nh=H3("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=z3(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),V3={utf8:Yg,"utf-8":Yg,hex:Tf.base16,latin1:Nh,ascii:Nh,binary:Nh,...Tf};function mr(t,e="utf8"){const r=V3[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?lp(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function er(t,e="utf8"){const r=V3[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}var mD={};const ED="ReactNative",zr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},vD="js";function Kf(){return typeof It<"u"&&typeof It.versions<"u"&&typeof It.versions.node<"u"}function to(){return!ur.getDocument()&&!!ur.getNavigator()&&navigator.product===ED}function xD(){return to()&&typeof re<"u"&&typeof(re==null?void 0:re.Platform)<"u"&&(re==null?void 0:re.Platform.OS)==="android"}function $D(){return to()&&typeof re<"u"&&typeof(re==null?void 0:re.Platform)<"u"&&(re==null?void 0:re.Platform.OS)==="ios"}function pc(){return!Kf()&&!!ur.getNavigator()&&!!ur.getDocument()}function Au(){return to()?zr.reactNative:Kf()?zr.node:pc()?zr.browser:zr.unknown}function Xg(){var t;try{return to()&&typeof re<"u"&&typeof(re==null?void 0:re.Application)<"u"?(t=re.Application)==null?void 0:t.applicationId:void 0}catch{return}}function AD(t,e){const r=new URLSearchParams(t);return Object.entries(e).sort(([n],[i])=>n.localeCompare(i)).forEach(([n,i])=>{i!=null&&r.set(n,String(i))}),r.toString()}function ID(){return K2.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function BD(){if(Au()===zr.reactNative&&typeof re<"u"&&typeof(re==null?void 0:re.Platform)<"u"){const{OS:r,Version:n}=re.Platform;return[r,n].join("-")}const t=a5();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function SD(){var t;const e=Au();return e===zr.browser?[e,((t=ur.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function K3(t,e,r){const n=BD(),i=SD();return[[t,e].join("-"),[vD,r].join("-"),n,i].join("/")}function OD({protocol:t,version:e,relayUrl:r,sdkVersion:n,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const f=r.split("?"),u=K3(t,e,n),l={auth:i,ua:u,projectId:s,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},h=AD(f[1]||"",l);return f[0]+"?"+h}function Dd(t){return Object.fromEntries(t.entries())}function Fd(t){return new Map(Object.entries(t))}function _D(t=Z.FIVE_MINUTES,e){const r=Z.toMiliseconds(t||Z.FIVE_MINUTES);let n,i,s,o;return{resolve:a=>{s&&n&&(clearTimeout(s),n(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const f=new Error(e);o=Promise.reject(f),c(f)},r),n=a,i=c})}}function pn(t,e,r){return new Promise(async(n,i)=>{const s=setTimeout(()=>i(new Error(r)),e);try{const o=await t;n(o)}catch(o){i(o)}clearTimeout(s)})}function G3(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function DD(t){return G3("topic",t)}function FD(t){return G3("id",t)}function UD(t){const[e,r]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")n.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return n}function qa(t,e){return Z.fromMiliseconds(Date.now()+Z.toMiliseconds(t))}function Jg(t){return Date.now()>=Z.toMiliseconds(t)}function Th(t,e){return`${t}${e?`:${e}`:""}`}function Qg(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Z3(){return typeof It<"u"&&mD.IS_VITEST==="true"}function W3(t){return ue.from(t,"base64").toString("utf-8")}function CD(t){return new Promise(e=>setTimeout(e,t))}const zc=BigInt(2**32-1),ey=BigInt(32);function Y3(t,e=!1){return e?{h:Number(t&zc),l:Number(t>>ey&zc)}:{h:Number(t>>ey&zc)|0,l:Number(t&zc)|0}}function X3(t,e=!1){const r=t.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=Y3(t[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const ty=(t,e,r)=>t>>>r,ry=(t,e,r)=>t<<32-r|e>>>r,Li=(t,e,r)=>t>>>r|e<<32-r,ki=(t,e,r)=>t<<32-r|e>>>r,_a=(t,e,r)=>t<<64-r|e>>>r-32,Da=(t,e,r)=>t>>>r-32|e<<64-r,PD=(t,e)=>e,RD=(t,e)=>t,ND=(t,e,r)=>t<<r|e>>>32-r,TD=(t,e,r)=>e<<r|t>>>32-r,LD=(t,e,r)=>e<<r-32|t>>>64-r,kD=(t,e,r)=>t<<r-32|e>>>64-r;function kr(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const dp=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),pp=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,jD=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),qD=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,MD=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),zD=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,fo=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Iu(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Jn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Gr(t,...e){if(!Iu(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Bu(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Jn(t.outputLen),Jn(t.blockLen)}function is(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function gp(t,e){Gr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Ya(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Er(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Lh(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function rn(t,e){return t<<32-e|t>>>e}const J3=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Q3(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Cn=J3?t=>t:t=>Q3(t);function HD(t){for(let e=0;e<t.length;e++)t[e]=Q3(t[e]);return t}const ji=J3?t=>t:HD,eE=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",VD=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Po(t){if(Gr(t),eE)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=VD[t[r]];return e}const vn={_0:48,_9:57,A:65,F:70,a:97,f:102};function ny(t){if(t>=vn._0&&t<=vn._9)return t-vn._0;if(t>=vn.A&&t<=vn.F)return t-(vn.A-10);if(t>=vn.a&&t<=vn.f)return t-(vn.a-10)}function Gf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(eE)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=ny(t.charCodeAt(s)),a=ny(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function tE(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Hr(t){return typeof t=="string"&&(t=tE(t)),Gr(t),t}function Zi(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Gr(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}let Su=class{};function gc(t){const e=n=>t().update(Hr(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function KD(t){const e=(n,i)=>t(i).update(Hr(n)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}function ro(t=32){if(fo&&typeof fo.getRandomValues=="function")return fo.getRandomValues(new Uint8Array(t));if(fo&&typeof fo.randomBytes=="function")return Uint8Array.from(fo.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const GD=BigInt(0),ua=BigInt(1),ZD=BigInt(2),WD=BigInt(7),YD=BigInt(256),XD=BigInt(113),rE=[],nE=[],iE=[];for(let t=0,e=ua,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],rE.push(2*(5*n+r)),nE.push((t+1)*(t+2)/2%64);let i=GD;for(let s=0;s<7;s++)e=(e<<ua^(e>>WD)*XD)%YD,e&ZD&&(i^=ua<<(ua<<BigInt(s))-ua);iE.push(i)}const sE=X3(iE,!0),JD=sE[0],QD=sE[1],iy=(t,e,r)=>r>32?LD(t,e,r):ND(t,e,r),sy=(t,e,r)=>r>32?kD(t,e,r):TD(t,e,r);function eF(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,f=r[c],u=r[c+1],l=iy(f,u,1)^r[a],h=sy(f,u,1)^r[a+1];for(let d=0;d<50;d+=10)t[o+d]^=l,t[o+d+1]^=h}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=nE[o],c=iy(i,s,a),f=sy(i,s,a),u=rE[o];i=t[u],s=t[u+1],t[u]=c,t[u+1]=f}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=JD[n],t[1]^=QD[n]}Er(r)}let tF=class oE extends Su{constructor(e,r,n,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,Jn(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Ya(this.state)}clone(){return this._cloneInto()}keccak(){ji(this.state32),eF(this.state32,this.rounds),ji(this.state32),this.posOut=0,this.pos=0}update(e){is(this),e=Hr(e),Gr(e);const{blockLen:r,state:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){is(this,!1),Gr(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Jn(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(gp(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Er(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new oE(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}};const rF=(t,e,r)=>gc(()=>new tF(e,t,r));rF(1,136,256/8);function nF(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}function iF(t,e,r){return t&e^~t&r}function sF(t,e,r){return t&e^t&r^e&r}let aE=class extends Su{constructor(e,r,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=Lh(this.buffer)}update(e){is(this),e=Hr(e),Gr(e);const{view:r,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Lh(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){is(this),gp(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,Er(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let l=o;l<i;l++)r[l]=0;nF(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Lh(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)a.setUint32(4*l,u[l],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const hi=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ut=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),ht=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),oF=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),li=new Uint32Array(64);let aF=class extends aE{constructor(e=32){super(64,e,8,!1),this.A=hi[0]|0,this.B=hi[1]|0,this.C=hi[2]|0,this.D=hi[3]|0,this.E=hi[4]|0,this.F=hi[5]|0,this.G=hi[6]|0,this.H=hi[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let l=0;l<16;l++,r+=4)li[l]=e.getUint32(r,!1);for(let l=16;l<64;l++){const h=li[l-15],d=li[l-2],p=rn(h,7)^rn(h,18)^h>>>3,w=rn(d,17)^rn(d,19)^d>>>10;li[l]=w+li[l-7]+p+li[l-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:f,H:u}=this;for(let l=0;l<64;l++){const h=rn(a,6)^rn(a,11)^rn(a,25),d=u+h+iF(a,c,f)+oF[l]+li[l]|0,p=(rn(n,2)^rn(n,13)^rn(n,22))+sF(n,i,s)|0;u=f,f=c,c=a,a=o+d|0,o=s,s=i,i=n,n=d+p|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(n,i,s,o,a,c,f,u)}roundClean(){Er(li)}destroy(){this.set(0,0,0,0,0,0,0,0),Er(this.buffer)}};const cE=X3(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),cF=cE[0],fF=cE[1],di=new Uint32Array(80),pi=new Uint32Array(80);let yp=class extends aE{constructor(e=64){super(128,e,16,!1),this.Ah=ht[0]|0,this.Al=ht[1]|0,this.Bh=ht[2]|0,this.Bl=ht[3]|0,this.Ch=ht[4]|0,this.Cl=ht[5]|0,this.Dh=ht[6]|0,this.Dl=ht[7]|0,this.Eh=ht[8]|0,this.El=ht[9]|0,this.Fh=ht[10]|0,this.Fl=ht[11]|0,this.Gh=ht[12]|0,this.Gl=ht[13]|0,this.Hh=ht[14]|0,this.Hl=ht[15]|0}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:f,El:u,Fh:l,Fl:h,Gh:d,Gl:p,Hh:w,Hl:m}=this;return[e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m]}set(e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=u|0,this.Fh=l|0,this.Fl=h|0,this.Gh=d|0,this.Gl=p|0,this.Hh=w|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)di[b]=e.getUint32(r),pi[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const B=di[b-15]|0,F=pi[b-15]|0,_=Li(B,F,1)^Li(B,F,8)^ty(B,F,7),N=ki(B,F,1)^ki(B,F,8)^ry(B,F,7),P=di[b-2]|0,S=pi[b-2]|0,T=Li(P,S,19)^_a(P,S,61)^ty(P,S,6),L=ki(P,S,19)^Da(P,S,61)^ry(P,S,6),O=jD(N,L,pi[b-7],pi[b-16]),x=qD(O,_,T,di[b-7],di[b-16]);di[b]=x|0,pi[b]=O|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:f,Dl:u,Eh:l,El:h,Fh:d,Fl:p,Gh:w,Gl:m,Hh:D,Hl:C}=this;for(let b=0;b<80;b++){const B=Li(l,h,14)^Li(l,h,18)^_a(l,h,41),F=ki(l,h,14)^ki(l,h,18)^Da(l,h,41),_=l&d^~l&w,N=h&p^~h&m,P=MD(C,F,N,fF[b],pi[b]),S=zD(P,D,B,_,cF[b],di[b]),T=P|0,L=Li(n,i,28)^_a(n,i,34)^_a(n,i,39),O=ki(n,i,28)^Da(n,i,34)^Da(n,i,39),x=n&s^n&a^s&a,$=i&o^i&c^o&c;D=w|0,C=m|0,w=d|0,m=p|0,d=l|0,p=h|0,{h:l,l:h}=kr(f|0,u|0,S|0,T|0),f=a|0,u=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const g=dp(T,O,$);n=pp(g,S,L,x),i=g|0}({h:n,l:i}=kr(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=kr(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=kr(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l:u}=kr(this.Dh|0,this.Dl|0,f|0,u|0),{h:l,l:h}=kr(this.Eh|0,this.El|0,l|0,h|0),{h:d,l:p}=kr(this.Fh|0,this.Fl|0,d|0,p|0),{h:w,l:m}=kr(this.Gh|0,this.Gl|0,w|0,m|0),{h:D,l:C}=kr(this.Hh|0,this.Hl|0,D|0,C|0),this.set(n,i,s,o,a,c,f,u,l,h,d,p,w,m,D,C)}roundClean(){Er(di,pi)}destroy(){Er(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},uF=class extends yp{constructor(){super(48),this.Ah=ut[0]|0,this.Al=ut[1]|0,this.Bh=ut[2]|0,this.Bl=ut[3]|0,this.Ch=ut[4]|0,this.Cl=ut[5]|0,this.Dh=ut[6]|0,this.Dl=ut[7]|0,this.Eh=ut[8]|0,this.El=ut[9]|0,this.Fh=ut[10]|0,this.Fl=ut[11]|0,this.Gh=ut[12]|0,this.Gl=ut[13]|0,this.Hh=ut[14]|0,this.Hl=ut[15]|0}};const lt=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);let hF=class extends yp{constructor(){super(32),this.Ah=lt[0]|0,this.Al=lt[1]|0,this.Bh=lt[2]|0,this.Bl=lt[3]|0,this.Ch=lt[4]|0,this.Cl=lt[5]|0,this.Dh=lt[6]|0,this.Dl=lt[7]|0,this.Eh=lt[8]|0,this.El=lt[9]|0,this.Fh=lt[10]|0,this.Fl=lt[11]|0,this.Gh=lt[12]|0,this.Gl=lt[13]|0,this.Hh=lt[14]|0,this.Hl=lt[15]|0}};const fE=gc(()=>new aF),lF=gc(()=>new yp),dF=gc(()=>new uF);gc(()=>new hF);const pF=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Ue=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),Y=new Uint32Array(32);function gi(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=Y[2*t],f=Y[2*t+1],u=Y[2*e],l=Y[2*e+1],h=Y[2*r],d=Y[2*r+1],p=Y[2*n],w=Y[2*n+1],m=dp(c,u,o);f=pp(m,f,l,a),c=m|0,{Dh:w,Dl:p}={Dh:w^f,Dl:p^c},{Dh:w,Dl:p}={Dh:PD(w,p),Dl:RD(w)},{h:d,l:h}=kr(d,h,w,p),{Bh:l,Bl:u}={Bh:l^d,Bl:u^h},{Bh:l,Bl:u}={Bh:Li(l,u,24),Bl:ki(l,u,24)},Y[2*t]=c,Y[2*t+1]=f,Y[2*e]=u,Y[2*e+1]=l,Y[2*r]=h,Y[2*r+1]=d,Y[2*n]=p,Y[2*n+1]=w}function yi(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=Y[2*t],f=Y[2*t+1],u=Y[2*e],l=Y[2*e+1],h=Y[2*r],d=Y[2*r+1],p=Y[2*n],w=Y[2*n+1],m=dp(c,u,o);f=pp(m,f,l,a),c=m|0,{Dh:w,Dl:p}={Dh:w^f,Dl:p^c},{Dh:w,Dl:p}={Dh:Li(w,p,16),Dl:ki(w,p,16)},{h:d,l:h}=kr(d,h,w,p),{Bh:l,Bl:u}={Bh:l^d,Bl:u^h},{Bh:l,Bl:u}={Bh:_a(l,u,63),Bl:Da(l,u,63)},Y[2*t]=c,Y[2*t+1]=f,Y[2*e]=u,Y[2*e+1]=l,Y[2*r]=h,Y[2*r+1]=d,Y[2*n]=p,Y[2*n+1]=w}function gF(t,e={},r,n,i){if(Jn(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}let yF=class extends Su{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Jn(e),Jn(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=Ya(this.buffer)}update(e){is(this),e=Hr(e),Gr(e);const{blockLen:r,buffer:n,buffer32:i}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===r&&(ji(i),this.compress(i,0,!1),ji(i),this.pos=0);const f=Math.min(r-this.pos,s-c),u=o+c;if(f===r&&!(u%4)&&c+f<s){const l=new Uint32Array(a,u,Math.floor((s-c)/4));ji(l);for(let h=0;c+r<s;h+=i.length,c+=r)this.length+=r,this.compress(l,h,!1);ji(l);continue}n.set(e.subarray(c,c+f),this.pos),this.pos+=f,this.length+=f,c+=f}return this}digestInto(e){is(this),gp(e,this);const{pos:r,buffer32:n}=this;this.finished=!0,Er(this.buffer.subarray(r)),ji(n),this.compress(n,0,!0),ji(n);const i=Ya(e);this.get().forEach((s,o)=>i[o]=Cn(s))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){const{buffer:r,length:n,finished:i,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=s,e.finished=i,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}},wF=class extends yF{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=Ue[0]|0,this.v0h=Ue[1]|0,this.v1l=Ue[2]|0,this.v1h=Ue[3]|0,this.v2l=Ue[4]|0,this.v2h=Ue[5]|0,this.v3l=Ue[6]|0,this.v3h=Ue[7]|0,this.v4l=Ue[8]|0,this.v4h=Ue[9]|0,this.v5l=Ue[10]|0,this.v5h=Ue[11]|0,this.v6l=Ue[12]|0,this.v6h=Ue[13]|0,this.v7l=Ue[14]|0,this.v7h=Ue[15]|0,gF(r,e,64,16,16);let{key:n,personalization:i,salt:s}=e,o=0;if(n!==void 0&&(n=Hr(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=Hr(s);const a=Ya(s);this.v4l^=Cn(a[0]),this.v4h^=Cn(a[1]),this.v5l^=Cn(a[2]),this.v5h^=Cn(a[3])}if(i!==void 0){i=Hr(i);const a=Ya(i);this.v6l^=Cn(a[0]),this.v6h^=Cn(a[1]),this.v7l^=Cn(a[2]),this.v7h^=Cn(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:n,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:f,v4h:u,v5l:l,v5h:h,v6l:d,v6h:p,v7l:w,v7h:m}=this;return[e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m]}set(e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m){this.v0l=e|0,this.v0h=r|0,this.v1l=n|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=f|0,this.v4h=u|0,this.v5l=l|0,this.v5h=h|0,this.v6l=d|0,this.v6h=p|0,this.v7l=w|0,this.v7h=m|0}compress(e,r,n){this.get().forEach((c,f)=>Y[f]=c),Y.set(Ue,16);let{h:i,l:s}=Y3(BigInt(this.length));Y[24]=Ue[8]^s,Y[25]=Ue[9]^i,n&&(Y[28]=~Y[28],Y[29]=~Y[29]);let o=0;const a=pF;for(let c=0;c<12;c++)gi(0,4,8,12,e,r+2*a[o++]),yi(0,4,8,12,e,r+2*a[o++]),gi(1,5,9,13,e,r+2*a[o++]),yi(1,5,9,13,e,r+2*a[o++]),gi(2,6,10,14,e,r+2*a[o++]),yi(2,6,10,14,e,r+2*a[o++]),gi(3,7,11,15,e,r+2*a[o++]),yi(3,7,11,15,e,r+2*a[o++]),gi(0,5,10,15,e,r+2*a[o++]),yi(0,5,10,15,e,r+2*a[o++]),gi(1,6,11,12,e,r+2*a[o++]),yi(1,6,11,12,e,r+2*a[o++]),gi(2,7,8,13,e,r+2*a[o++]),yi(2,7,8,13,e,r+2*a[o++]),gi(3,4,9,14,e,r+2*a[o++]),yi(3,4,9,14,e,r+2*a[o++]);this.v0l^=Y[0]^Y[16],this.v0h^=Y[1]^Y[17],this.v1l^=Y[2]^Y[18],this.v1h^=Y[3]^Y[19],this.v2l^=Y[4]^Y[20],this.v2h^=Y[5]^Y[21],this.v3l^=Y[6]^Y[22],this.v3h^=Y[7]^Y[23],this.v4l^=Y[8]^Y[24],this.v4h^=Y[9]^Y[25],this.v5l^=Y[10]^Y[26],this.v5h^=Y[11]^Y[27],this.v6l^=Y[12]^Y[28],this.v6h^=Y[13]^Y[29],this.v7l^=Y[14]^Y[30],this.v7h^=Y[15]^Y[31],Er(Y)}destroy(){this.destroyed=!0,Er(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};KD(t=>new wF(t));/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function uE(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ud(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function kh(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Ht(t,...e){if(!uE(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function oy(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function bF(t,e){Ht(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Qi(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Vo(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function mF(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const EF=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function vF(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Cd(t){if(typeof t=="string")t=vF(t);else if(uE(t))t=Pd(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function xF(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function $F(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const AF=(t,e)=>{function r(n,...i){if(Ht(n),!EF)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const f=i[0];if(!f)throw new Error("nonce / iv required");t.varSizeNonce?Ht(f):Ht(f,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&Ht(i[1]);const o=e(n,...i),a=(f,u)=>{if(u!==void 0){if(f!==2)throw new Error("cipher output not supported");Ht(u)}};let c=!1;return{encrypt(f,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Ht(f),a(o.encrypt.length,u),o.encrypt(f,u)},decrypt(f,u){if(Ht(f),s&&f.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,u),o.decrypt(f,u)}}}return Object.assign(r,t),r};function ay(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!BF(e))throw new Error("invalid output, must be aligned");return e}function cy(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function IF(t,e,r){Ud(r);const n=new Uint8Array(16),i=mF(n);return cy(i,0,BigInt(e),r),cy(i,8,BigInt(t),r),n}function BF(t){return t.byteOffset%4===0}function Pd(t){return Uint8Array.from(t)}const hE=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),SF=hE("expand 16-byte k"),OF=hE("expand 32-byte k"),_F=Qi(SF),DF=Qi(OF);function de(t,e){return t<<e|t>>>32-e}function Rd(t){return t.byteOffset%4===0}const Hc=64,FF=16,lE=2**32-1,fy=new Uint32Array;function UF(t,e,r,n,i,s,o,a){const c=i.length,f=new Uint8Array(Hc),u=Qi(f),l=Rd(i)&&Rd(s),h=l?Qi(i):fy,d=l?Qi(s):fy;for(let p=0;p<c;o++){if(t(e,r,n,u,o,a),o>=lE)throw new Error("arx: counter overflow");const w=Math.min(Hc,c-p);if(l&&w===Hc){const m=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let D=0,C;D<FF;D++)C=m+D,d[C]=h[C]^u[D];p+=Hc;continue}for(let m=0,D;m<w;m++)D=p+m,s[D]=i[D]^f[m];p+=w}}function CF(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=xF({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return kh(i),kh(o),Ud(s),Ud(r),(a,c,f,u,l=0)=>{Ht(a),Ht(c),Ht(f);const h=f.length;if(u===void 0&&(u=new Uint8Array(h)),Ht(u),kh(l),l<0||l>=lE)throw new Error("arx: counter overflow");if(u.length<h)throw new Error(`arx: output (${u.length}) is shorter than data (${h})`);const d=[];let p=a.length,w,m;if(p===32)d.push(w=Pd(a)),m=DF;else if(p===16&&r)w=new Uint8Array(32),w.set(a),w.set(a,16),m=_F,d.push(w);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);Rd(c)||d.push(c=Pd(c));const D=Qi(w);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(m,D,Qi(c.subarray(0,16)),D),c=c.subarray(16)}const C=16-i;if(C!==c.length)throw new Error(`arx: nonce must be ${C} or 16 bytes`);if(C!==12){const B=new Uint8Array(12);B.set(c,s?0:12-c.length),c=B,d.push(c)}const b=Qi(c);return UF(t,m,D,b,f,u,l,o),Vo(...d),u}}const Ze=(t,e)=>t[e++]&255|(t[e++]&255)<<8;let PF=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Cd(e),Ht(e,32);const r=Ze(e,0),n=Ze(e,2),i=Ze(e,4),s=Ze(e,6),o=Ze(e,8),a=Ze(e,10),c=Ze(e,12),f=Ze(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|f<<8)&8191,this.r[9]=f>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Ze(e,16+2*u)}process(e,r,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],f=o[2],u=o[3],l=o[4],h=o[5],d=o[6],p=o[7],w=o[8],m=o[9],D=Ze(e,r+0),C=Ze(e,r+2),b=Ze(e,r+4),B=Ze(e,r+6),F=Ze(e,r+8),_=Ze(e,r+10),N=Ze(e,r+12),P=Ze(e,r+14);let S=s[0]+(D&8191),T=s[1]+((D>>>13|C<<3)&8191),L=s[2]+((C>>>10|b<<6)&8191),O=s[3]+((b>>>7|B<<9)&8191),x=s[4]+((B>>>4|F<<12)&8191),$=s[5]+(F>>>1&8191),g=s[6]+((F>>>14|_<<2)&8191),y=s[7]+((_>>>11|N<<5)&8191),v=s[8]+((N>>>8|P<<8)&8191),I=s[9]+(P>>>5|i),E=0,A=E+S*a+T*(5*m)+L*(5*w)+O*(5*p)+x*(5*d);E=A>>>13,A&=8191,A+=$*(5*h)+g*(5*l)+y*(5*u)+v*(5*f)+I*(5*c),E+=A>>>13,A&=8191;let U=E+S*c+T*a+L*(5*m)+O*(5*w)+x*(5*p);E=U>>>13,U&=8191,U+=$*(5*d)+g*(5*h)+y*(5*l)+v*(5*u)+I*(5*f),E+=U>>>13,U&=8191;let R=E+S*f+T*c+L*a+O*(5*m)+x*(5*w);E=R>>>13,R&=8191,R+=$*(5*p)+g*(5*d)+y*(5*h)+v*(5*l)+I*(5*u),E+=R>>>13,R&=8191;let q=E+S*u+T*f+L*c+O*a+x*(5*m);E=q>>>13,q&=8191,q+=$*(5*w)+g*(5*p)+y*(5*d)+v*(5*h)+I*(5*l),E+=q>>>13,q&=8191;let j=E+S*l+T*u+L*f+O*c+x*a;E=j>>>13,j&=8191,j+=$*(5*m)+g*(5*w)+y*(5*p)+v*(5*d)+I*(5*h),E+=j>>>13,j&=8191;let k=E+S*h+T*l+L*u+O*f+x*c;E=k>>>13,k&=8191,k+=$*a+g*(5*m)+y*(5*w)+v*(5*p)+I*(5*d),E+=k>>>13,k&=8191;let M=E+S*d+T*h+L*l+O*u+x*f;E=M>>>13,M&=8191,M+=$*c+g*a+y*(5*m)+v*(5*w)+I*(5*p),E+=M>>>13,M&=8191;let H=E+S*p+T*d+L*h+O*l+x*u;E=H>>>13,H&=8191,H+=$*f+g*c+y*a+v*(5*m)+I*(5*w),E+=H>>>13,H&=8191;let V=E+S*w+T*p+L*d+O*h+x*l;E=V>>>13,V&=8191,V+=$*u+g*f+y*c+v*a+I*(5*m),E+=V>>>13,V&=8191;let z=E+S*m+T*w+L*p+O*d+x*h;E=z>>>13,z&=8191,z+=$*l+g*u+y*f+v*c+I*a,E+=z>>>13,z&=8191,E=(E<<2)+E|0,E=E+A|0,A=E&8191,E=E>>>13,U+=E,s[0]=A,s[1]=U,s[2]=R,s[3]=q,s[4]=j,s[5]=k,s[6]=M,s[7]=H,s[8]=V,s[9]=z}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;Vo(n)}update(e){oy(this),e=Cd(e),Ht(e);const{buffer:r,blockLen:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Vo(this.h,this.r,this.buffer,this.pad)}digestInto(e){oy(this),bF(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:i}=this;if(i){for(r[i++]=1;i<16;i++)r[i]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}};function RF(t){const e=(n,i)=>t(i).update(Cd(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const NF=RF(t=>new PF(t));function TF(t,e,r,n,i,s=20){let o=t[0],a=t[1],c=t[2],f=t[3],u=e[0],l=e[1],h=e[2],d=e[3],p=e[4],w=e[5],m=e[6],D=e[7],C=i,b=r[0],B=r[1],F=r[2],_=o,N=a,P=c,S=f,T=u,L=l,O=h,x=d,$=p,g=w,y=m,v=D,I=C,E=b,A=B,U=F;for(let q=0;q<s;q+=2)_=_+T|0,I=de(I^_,16),$=$+I|0,T=de(T^$,12),_=_+T|0,I=de(I^_,8),$=$+I|0,T=de(T^$,7),N=N+L|0,E=de(E^N,16),g=g+E|0,L=de(L^g,12),N=N+L|0,E=de(E^N,8),g=g+E|0,L=de(L^g,7),P=P+O|0,A=de(A^P,16),y=y+A|0,O=de(O^y,12),P=P+O|0,A=de(A^P,8),y=y+A|0,O=de(O^y,7),S=S+x|0,U=de(U^S,16),v=v+U|0,x=de(x^v,12),S=S+x|0,U=de(U^S,8),v=v+U|0,x=de(x^v,7),_=_+L|0,U=de(U^_,16),y=y+U|0,L=de(L^y,12),_=_+L|0,U=de(U^_,8),y=y+U|0,L=de(L^y,7),N=N+O|0,I=de(I^N,16),v=v+I|0,O=de(O^v,12),N=N+O|0,I=de(I^N,8),v=v+I|0,O=de(O^v,7),P=P+x|0,E=de(E^P,16),$=$+E|0,x=de(x^$,12),P=P+x|0,E=de(E^P,8),$=$+E|0,x=de(x^$,7),S=S+T|0,A=de(A^S,16),g=g+A|0,T=de(T^g,12),S=S+T|0,A=de(A^S,8),g=g+A|0,T=de(T^g,7);let R=0;n[R++]=o+_|0,n[R++]=a+N|0,n[R++]=c+P|0,n[R++]=f+S|0,n[R++]=u+T|0,n[R++]=l+L|0,n[R++]=h+O|0,n[R++]=d+x|0,n[R++]=p+$|0,n[R++]=w+g|0,n[R++]=m+y|0,n[R++]=D+v|0,n[R++]=C+I|0,n[R++]=b+E|0,n[R++]=B+A|0,n[R++]=F+U|0}const LF=CF(TF,{counterRight:!1,counterLength:4,allowShortKeys:!1}),kF=new Uint8Array(16),uy=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(kF.subarray(r))},jF=new Uint8Array(32);function hy(t,e,r,n,i){const s=t(e,r,jF),o=NF.create(s);i&&uy(o,i),uy(o,n);const a=IF(n.length,i?i.length:0,!0);o.update(a);const c=o.digest();return Vo(s,a),c}const qF=t=>(e,r,n)=>({encrypt(i,s){const o=i.length;s=ay(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=hy(t,e,r,a,n);return s.set(c,o),Vo(c),s},decrypt(i,s){s=ay(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=hy(t,e,r,o,n);if(!$F(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,r,s,s,1),Vo(c),s}}),dE=AF({blockSize:64,nonceLength:12,tagLength:16},qF(LF));let pE=class extends Su{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Bu(e);const n=Hr(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Er(s)}update(e){return is(this),this.iHash.update(e),this}digestInto(e){is(this),Gr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Ou=(t,e,r)=>new pE(t,e).update(r).digest();Ou.create=(t,e)=>new pE(t,e);function MF(t,e,r){return Bu(t),r===void 0&&(r=new Uint8Array(t.outputLen)),Ou(t,Hr(r),Hr(e))}const jh=Uint8Array.from([0]),ly=Uint8Array.of();function zF(t,e,r,n=32){Bu(t),Jn(n);const i=t.outputLen;if(n>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(n/i);r===void 0&&(r=ly);const o=new Uint8Array(s*i),a=Ou.create(t,e),c=a._cloneInto(),f=new Uint8Array(a.outputLen);for(let u=0;u<s;u++)jh[0]=u+1,c.update(u===0?ly:f).update(r).update(jh).digestInto(f),o.set(f,i*u),a._cloneInto(c);return a.destroy(),c.destroy(),Er(f,jh),o.slice(0,n)}const HF=(t,e,r,n,i)=>zF(t,MF(t,e,r),n,i),_u=fE,wp=BigInt(0),Nd=BigInt(1);function Zf(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function Rs(t,e,r=""){const n=Iu(t),i=t==null?void 0:t.length,s=e!==void 0;if(!n||s&&i!==e){const o=r&&`"${r}" `,a=s?` of length ${e}`:"",c=n?`length=${i}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function Vc(t){const e=t.toString(16);return e.length&1?"0"+e:e}function gE(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?wp:BigInt("0x"+t)}function Du(t){return gE(Po(t))}function Wf(t){return Gr(t),gE(Po(Uint8Array.from(t).reverse()))}function bp(t,e){return Gf(t.toString(16).padStart(e*2,"0"))}function mp(t,e){return bp(t,e).reverse()}function xt(t,e,r){let n;if(typeof e=="string")try{n=Gf(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Iu(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}const qh=t=>typeof t=="bigint"&&wp<=t;function VF(t,e,r){return qh(t)&&qh(e)&&qh(r)&&e<=t&&t<r}function Td(t,e,r,n){if(!VF(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function yE(t){let e;for(e=0;t>wp;t>>=Nd,e+=1);return e}const yc=t=>(Nd<<BigInt(t))-Nd;function KF(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const n=h=>new Uint8Array(h),i=h=>Uint8Array.of(h);let s=n(t),o=n(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},f=(...h)=>r(o,s,...h),u=(h=n(0))=>{o=f(i(0),h),s=f(),h.length!==0&&(o=f(i(1),h),s=f())},l=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const d=[];for(;h<e;){s=f();const p=s.slice();d.push(p),h+=s.length}return Zi(...d)};return(h,d)=>{c(),u(h);let p;for(;!(p=d(l()));)u();return c(),p}}function Fu(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(i,s,o){const a=t[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>n(i,s,!1)),Object.entries(r).forEach(([i,s])=>n(i,s,!0))}function dy(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const Yt=BigInt(0),_t=BigInt(1),Ns=BigInt(2),wE=BigInt(3),bE=BigInt(4),mE=BigInt(5),GF=BigInt(7),EE=BigInt(8),ZF=BigInt(9),vE=BigInt(16);function ar(t,e){const r=t%e;return r>=Yt?r:e+r}function Rr(t,e,r){let n=t;for(;e-- >Yt;)n*=n,n%=r;return n}function py(t,e){if(t===Yt)throw new Error("invert: expected non-zero number");if(e<=Yt)throw new Error("invert: expected positive modulus, got "+e);let r=ar(t,e),n=e,i=Yt,s=_t;for(;r!==Yt;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==_t)throw new Error("invert: does not exist");return ar(i,e)}function Ep(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function xE(t,e){const r=(t.ORDER+_t)/bE,n=t.pow(e,r);return Ep(t,n,e),n}function WF(t,e){const r=(t.ORDER-mE)/EE,n=t.mul(e,Ns),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,Ns),i),a=t.mul(s,t.sub(o,t.ONE));return Ep(t,a,e),a}function YF(t){const e=hs(t),r=$E(t),n=r(e,e.neg(e.ONE)),i=r(e,n),s=r(e,e.neg(n)),o=(t+GF)/vE;return(a,c)=>{let f=a.pow(c,o),u=a.mul(f,n);const l=a.mul(f,i),h=a.mul(f,s),d=a.eql(a.sqr(u),c),p=a.eql(a.sqr(l),c);f=a.cmov(f,u,d),u=a.cmov(h,l,p);const w=a.eql(a.sqr(u),c),m=a.cmov(f,u,w);return Ep(a,m,c),m}}function $E(t){if(t<wE)throw new Error("sqrt is not defined for small field");let e=t-_t,r=0;for(;e%Ns===Yt;)e/=Ns,r++;let n=Ns;const i=hs(t);for(;gy(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return xE;let s=i.pow(n,e);const o=(e+_t)/Ns;return function(a,c){if(a.is0(c))return c;if(gy(a,c)!==1)throw new Error("Cannot find square root");let f=r,u=a.mul(a.ONE,s),l=a.pow(c,e),h=a.pow(c,o);for(;!a.eql(l,a.ONE);){if(a.is0(l))return a.ZERO;let d=1,p=a.sqr(l);for(;!a.eql(p,a.ONE);)if(d++,p=a.sqr(p),d===f)throw new Error("Cannot find square root");const w=_t<<BigInt(f-d-1),m=a.pow(u,w);f=d,u=a.sqr(m),l=a.mul(l,u),h=a.mul(h,m)}return h}}function XF(t){return t%bE===wE?xE:t%EE===mE?WF:t%vE===ZF?YF(t):$E(t)}const JF=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function QF(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=JF.reduce((n,i)=>(n[i]="function",n),e);return Fu(t,r),t}function eU(t,e,r){if(r<Yt)throw new Error("invalid exponent, negatives unsupported");if(r===Yt)return t.ONE;if(r===_t)return e;let n=t.ONE,i=e;for(;r>Yt;)r&_t&&(n=t.mul(n,i)),i=t.sqr(i),r>>=_t;return n}function AE(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),s),n}function gy(t,e){const r=(t.ORDER-_t)/Ns,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function IE(t,e){e!==void 0&&Jn(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function hs(t,e,r=!1,n={}){if(t<=Yt)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const h=e;h.BITS&&(i=h.BITS),h.sqrt&&(s=h.sqrt),typeof h.isLE=="boolean"&&(r=h.isLE),typeof h.modFromBytes=="boolean"&&(o=h.modFromBytes),a=h.allowedLengths}else typeof e=="number"&&(i=e),n.sqrt&&(s=n.sqrt);const{nBitLength:c,nByteLength:f}=IE(t,i);if(f>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const l=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:f,MASK:yc(c),ZERO:Yt,ONE:_t,allowedLengths:a,create:h=>ar(h,t),isValid:h=>{if(typeof h!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof h);return Yt<=h&&h<t},is0:h=>h===Yt,isValidNot0:h=>!l.is0(h)&&l.isValid(h),isOdd:h=>(h&_t)===_t,neg:h=>ar(-h,t),eql:(h,d)=>h===d,sqr:h=>ar(h*h,t),add:(h,d)=>ar(h+d,t),sub:(h,d)=>ar(h-d,t),mul:(h,d)=>ar(h*d,t),pow:(h,d)=>eU(l,h,d),div:(h,d)=>ar(h*py(d,t),t),sqrN:h=>h*h,addN:(h,d)=>h+d,subN:(h,d)=>h-d,mulN:(h,d)=>h*d,inv:h=>py(h,t),sqrt:s||(h=>(u||(u=XF(t)),u(l,h))),toBytes:h=>r?mp(h,f):bp(h,f),fromBytes:(h,d=!0)=>{if(a){if(!a.includes(h.length)||h.length>f)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+h.length);const w=new Uint8Array(f);w.set(h,r?0:w.length-h.length),h=w}if(h.length!==f)throw new Error("Field.fromBytes: expected "+f+" bytes, got "+h.length);let p=r?Wf(h):Du(h);if(o&&(p=ar(p,t)),!d&&!l.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:h=>AE(l,h),cmov:(h,d,p)=>p?d:h});return Object.freeze(l)}function BE(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function SE(t){const e=BE(t);return e+Math.ceil(e/2)}function tU(t,e,r=!1){const n=t.length,i=BE(e),s=SE(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?Wf(t):Du(t),a=ar(o,e-_t)+_t;return r?mp(a,i):bp(a,i)}const Ko=BigInt(0),Ts=BigInt(1);function Yf(t,e){const r=e.negate();return t?r:e}function Mh(t,e){const r=AE(t.Fp,e.map(n=>n.Z));return e.map((n,i)=>t.fromAffine(n.toAffine(r[i])))}function OE(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function zh(t,e){OE(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=yc(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function yy(t,e,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(t&i),c=t>>o;a>n&&(a-=s,c+=Ts);const f=e*n,u=f+Math.abs(a)-1,l=a===0,h=a<0,d=e%2!==0;return{nextN:c,offset:u,isZero:l,isNeg:h,isNegF:d,offsetF:f}}function rU(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function nU(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Hh=new WeakMap,_E=new WeakMap;function Vh(t){return _E.get(t)||1}function wy(t){if(t!==Ko)throw new Error("invalid wNAF")}let iU=class{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let i=e;for(;r>Ko;)r&Ts&&(n=n.add(i)),i=i.double(),r>>=Ts;return n}precomputeWindow(e,r){const{windows:n,windowSize:i}=zh(r,this.bits),s=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,s.push(a);for(let f=1;f<i;f++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=zh(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:f,isZero:u,isNeg:l,isNegF:h,offsetF:d}=yy(n,a,o);n=c,u?s=s.add(Yf(h,r[d])):i=i.add(Yf(l,r[f]))}return wy(n),{p:i,f:s}}wNAFUnsafe(e,r,n,i=this.ZERO){const s=zh(e,this.bits);for(let o=0;o<s.windows&&n!==Ko;o++){const{nextN:a,offset:c,isZero:f,isNeg:u}=yy(n,o,s);if(n=a,!f){const l=r[c];i=i.add(u?l.negate():l)}}return wy(n),i}getPrecomputes(e,r,n){let i=Hh.get(r);return i||(i=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(i=n(i)),Hh.set(r,i))),i}cached(e,r,n){const i=Vh(e);return this.wNAF(i,this.getPrecomputes(i,e,n),r)}unsafe(e,r,n,i){const s=Vh(e);return s===1?this._unsafeLadder(e,r,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,n),r,i)}createCache(e,r){OE(r,this.bits),_E.set(e,r),Hh.delete(e)}hasCache(e){return Vh(e)!==1}};function sU(t,e,r,n){let i=e,s=t.ZERO,o=t.ZERO;for(;r>Ko||n>Ko;)r&Ts&&(s=s.add(i)),n&Ts&&(o=o.add(i)),i=i.double(),r>>=Ts,n>>=Ts;return{p1:s,p2:o}}function oU(t,e,r,n){rU(r,t),nU(n,e);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=yE(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const f=yc(c),u=new Array(Number(f)+1).fill(o),l=Math.floor((e.BITS-1)/c)*c;let h=o;for(let d=l;d>=0;d-=c){u.fill(o);for(let w=0;w<s;w++){const m=n[w],D=Number(m>>BigInt(d)&f);u[D]=u[D].add(r[w])}let p=o;for(let w=u.length-1,m=o;w>0;w--)m=m.add(u[w]),p=p.add(m);if(h=h.add(p),d!==0)for(let w=0;w<c;w++)h=h.double()}return h}function by(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return QF(e),e}else return hs(t,{isLE:r})}function aU(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>Ko))throw new Error(`CURVE.${a} must be positive bigint`)}const i=by(e.p,r.Fp,n),s=by(e.n,r.Fn,n),o=["Gx","Gy","a","b"];for(const a of o)if(!i.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),tE("HashToScalar-");const ha=BigInt(0),uo=BigInt(1),Kc=BigInt(2);function cU(t){return Fu(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function fU(t){const e=cU(t),{P:r,type:n,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||ro,f=a?255:448,u=a?32:56,l=BigInt(a?9:5),h=BigInt(a?121665:39081),d=a?Kc**BigInt(254):Kc**BigInt(447),p=a?BigInt(8)*Kc**BigInt(251)-uo:BigInt(4)*Kc**BigInt(445)-uo,w=d+p+uo,m=O=>ar(O,r),D=C(l);function C(O){return mp(m(O),u)}function b(O){const x=xt("u coordinate",O,u);return a&&(x[31]&=127),m(Wf(x))}function B(O){return Wf(i(xt("scalar",O,u)))}function F(O,x){const $=P(b(x),B(O));if($===ha)throw new Error("invalid private or public key received");return C($)}function _(O){return F(O,D)}function N(O,x,$){const g=m(O*(x-$));return x=m(x-g),$=m($+g),{x_2:x,x_3:$}}function P(O,x){Td("u",O,ha,r),Td("scalar",x,d,w);const $=x,g=O;let y=uo,v=ha,I=O,E=uo,A=ha;for(let R=BigInt(f-1);R>=ha;R--){const q=$>>R&uo;A^=q,{x_2:y,x_3:I}=N(A,y,I),{x_2:v,x_3:E}=N(A,v,E),A=q;const j=y+v,k=m(j*j),M=y-v,H=m(M*M),V=k-H,z=I+E,K=I-E,Q=m(K*j),ee=m(z*M),ne=Q+ee,he=Q-ee;I=m(ne*ne),E=m(g*m(he*he)),y=m(k*H),v=m(V*(k+m(h*V)))}({x_2:y,x_3:I}=N(A,y,I)),{x_2:v,x_3:E}=N(A,v,E);const U=s(v);return m(y*U)}const S={secretKey:u,publicKey:u,seed:u},T=(O=c(u))=>(Gr(O,S.seed),O);function L(O){const x=T(O);return{secretKey:x,publicKey:_(x)}}return{keygen:L,getSharedSecret:(O,x)=>F(O,x),getPublicKey:O=>_(O),scalarMult:F,scalarMultBase:_,utils:{randomSecretKey:T,randomPrivateKey:T},GuBytes:D.slice(),lengths:S}}const uU=BigInt(1),my=BigInt(2),hU=BigInt(3),lU=BigInt(5);BigInt(8);const DE=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),dU={p:DE,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function pU(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=DE,o=t*t%s*t%s,a=Rr(o,my,s)*o%s,c=Rr(a,uU,s)*t%s,f=Rr(c,lU,s)*c%s,u=Rr(f,e,s)*f%s,l=Rr(u,r,s)*u%s,h=Rr(l,n,s)*l%s,d=Rr(h,i,s)*h%s,p=Rr(d,i,s)*h%s,w=Rr(p,e,s)*f%s;return{pow_p_5_8:Rr(w,my,s)*t%s,b2:o}}function gU(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const yU=hs(dU.p,{isLE:!0}),Ld=(()=>{const t=yU.ORDER;return fU({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:n}=pU(e);return ar(Rr(r,hU,t)*n,t)},adjustScalarBytes:gU})})(),Ey=(t,e)=>(t+(t>=0?e:-e)/FE)/e;function wU(t,e,r){const[[n,i],[s,o]]=e,a=Ey(o*t,r),c=Ey(-i*t,r);let f=t-a*n-c*s,u=-a*i-c*o;const l=f<Vn,h=u<Vn;l&&(f=-f),h&&(u=-u);const d=yc(Math.ceil(yE(r)/2))+Ro;if(f<Vn||f>=d||u<Vn||u>=d)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:l,k1:f,k2neg:h,k2:u}}function kd(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function Kh(t,e){const r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return Zf(r.lowS,"lowS"),Zf(r.prehash,"prehash"),r.format!==void 0&&kd(r.format),r}let bU=class extends Error{constructor(e=""){super(e)}};const kn={Err:bU,_tlv:{encode:(t,e)=>{const{Err:r}=kn;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=Vc(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?Vc(i.length/2|128):"";return Vc(t)+s+i+e},decode(t,e){const{Err:r}=kn;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const f=e.subarray(n,n+c);if(f.length!==c)throw new r("tlv.decode: length bytes not complete");if(f[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of f)o=o<<8|u;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=kn;if(t<Vn)throw new e("integer: negative integers are not allowed");let r=Vc(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=kn;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Du(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=kn,i=xt("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:f,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(f)}},hexFromSig(t){const{_tlv:e,_int:r}=kn,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}},Vn=BigInt(0),Ro=BigInt(1),FE=BigInt(2),Gc=BigInt(3),mU=BigInt(4);function Bo(t,e){const{BYTES:r}=t;let n;if(typeof e=="bigint")n=e;else{let i=xt("private key",e);try{n=t.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function EU(t,e={}){const r=aU("weierstrass",t,e),{Fp:n,Fn:i}=r;let s=r.CURVE;const{h:o,n:a}=s;Fu(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const f=CE(n,i);function u(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function l(O,x,$){const{x:g,y}=x.toAffine(),v=n.toBytes(g);if(Zf($,"isCompressed"),$){u();const I=!n.isOdd(y);return Zi(UE(I),v)}else return Zi(Uint8Array.of(4),v,n.toBytes(y))}function h(O){Rs(O,void 0,"Point");const{publicKey:x,publicKeyUncompressed:$}=f,g=O.length,y=O[0],v=O.subarray(1);if(g===x&&(y===2||y===3)){const I=n.fromBytes(v);if(!n.isValid(I))throw new Error("bad point: is not on curve, wrong x");const E=w(I);let A;try{A=n.sqrt(E)}catch(R){const q=R instanceof Error?": "+R.message:"";throw new Error("bad point: is not on curve, sqrt error"+q)}u();const U=n.isOdd(A);return(y&1)===1!==U&&(A=n.neg(A)),{x:I,y:A}}else if(g===$&&y===4){const I=n.BYTES,E=n.fromBytes(v.subarray(0,I)),A=n.fromBytes(v.subarray(I,I*2));if(!m(E,A))throw new Error("bad point: is not on curve");return{x:E,y:A}}else throw new Error(`bad point: got length ${g}, expected compressed=${x} or uncompressed=${$}`)}const d=e.toBytes||l,p=e.fromBytes||h;function w(O){const x=n.sqr(O),$=n.mul(x,O);return n.add(n.add($,n.mul(O,s.a)),s.b)}function m(O,x){const $=n.sqr(x),g=w(O);return n.eql($,g)}if(!m(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const D=n.mul(n.pow(s.a,Gc),mU),C=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(D,C)))throw new Error("bad curve params: a or b");function b(O,x,$=!1){if(!n.isValid(x)||$&&n.is0(x))throw new Error(`bad point coordinate ${O}`);return x}function B(O){if(!(O instanceof S))throw new Error("ProjectivePoint expected")}function F(O){if(!c||!c.basises)throw new Error("no endo");return wU(O,c.basises,i.ORDER)}const _=dy((O,x)=>{const{X:$,Y:g,Z:y}=O;if(n.eql(y,n.ONE))return{x:$,y:g};const v=O.is0();x==null&&(x=v?n.ONE:n.inv(y));const I=n.mul($,x),E=n.mul(g,x),A=n.mul(y,x);if(v)return{x:n.ZERO,y:n.ZERO};if(!n.eql(A,n.ONE))throw new Error("invZ was invalid");return{x:I,y:E}}),N=dy(O=>{if(O.is0()){if(e.allowInfinityPoint&&!n.is0(O.Y))return;throw new Error("bad point: ZERO")}const{x,y:$}=O.toAffine();if(!n.isValid(x)||!n.isValid($))throw new Error("bad point: x or y not field elements");if(!m(x,$))throw new Error("bad point: equation left != right");if(!O.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function P(O,x,$,g,y){return $=new S(n.mul($.X,O),$.Y,$.Z),x=Yf(g,x),$=Yf(y,$),x.add($)}class S{constructor(x,$,g){this.X=b("x",x),this.Y=b("y",$,!0),this.Z=b("z",g),Object.freeze(this)}static CURVE(){return s}static fromAffine(x){const{x:$,y:g}=x||{};if(!x||!n.isValid($)||!n.isValid(g))throw new Error("invalid affine point");if(x instanceof S)throw new Error("projective point not allowed");return n.is0($)&&n.is0(g)?S.ZERO:new S($,g,n.ONE)}static fromBytes(x){const $=S.fromAffine(p(Rs(x,void 0,"point")));return $.assertValidity(),$}static fromHex(x){return S.fromBytes(xt("pointHex",x))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(x=8,$=!0){return L.createCache(this,x),$||this.multiply(Gc),this}assertValidity(){N(this)}hasEvenY(){const{y:x}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(x)}equals(x){B(x);const{X:$,Y:g,Z:y}=this,{X:v,Y:I,Z:E}=x,A=n.eql(n.mul($,E),n.mul(v,y)),U=n.eql(n.mul(g,E),n.mul(I,y));return A&&U}negate(){return new S(this.X,n.neg(this.Y),this.Z)}double(){const{a:x,b:$}=s,g=n.mul($,Gc),{X:y,Y:v,Z:I}=this;let E=n.ZERO,A=n.ZERO,U=n.ZERO,R=n.mul(y,y),q=n.mul(v,v),j=n.mul(I,I),k=n.mul(y,v);return k=n.add(k,k),U=n.mul(y,I),U=n.add(U,U),E=n.mul(x,U),A=n.mul(g,j),A=n.add(E,A),E=n.sub(q,A),A=n.add(q,A),A=n.mul(E,A),E=n.mul(k,E),U=n.mul(g,U),j=n.mul(x,j),k=n.sub(R,j),k=n.mul(x,k),k=n.add(k,U),U=n.add(R,R),R=n.add(U,R),R=n.add(R,j),R=n.mul(R,k),A=n.add(A,R),j=n.mul(v,I),j=n.add(j,j),R=n.mul(j,k),E=n.sub(E,R),U=n.mul(j,q),U=n.add(U,U),U=n.add(U,U),new S(E,A,U)}add(x){B(x);const{X:$,Y:g,Z:y}=this,{X:v,Y:I,Z:E}=x;let A=n.ZERO,U=n.ZERO,R=n.ZERO;const q=s.a,j=n.mul(s.b,Gc);let k=n.mul($,v),M=n.mul(g,I),H=n.mul(y,E),V=n.add($,g),z=n.add(v,I);V=n.mul(V,z),z=n.add(k,M),V=n.sub(V,z),z=n.add($,y);let K=n.add(v,E);return z=n.mul(z,K),K=n.add(k,H),z=n.sub(z,K),K=n.add(g,y),A=n.add(I,E),K=n.mul(K,A),A=n.add(M,H),K=n.sub(K,A),R=n.mul(q,z),A=n.mul(j,H),R=n.add(A,R),A=n.sub(M,R),R=n.add(M,R),U=n.mul(A,R),M=n.add(k,k),M=n.add(M,k),H=n.mul(q,H),z=n.mul(j,z),M=n.add(M,H),H=n.sub(k,H),H=n.mul(q,H),z=n.add(z,H),k=n.mul(M,z),U=n.add(U,k),k=n.mul(K,z),A=n.mul(V,A),A=n.sub(A,k),k=n.mul(V,M),R=n.mul(K,R),R=n.add(R,k),new S(A,U,R)}subtract(x){return this.add(x.negate())}is0(){return this.equals(S.ZERO)}multiply(x){const{endo:$}=e;if(!i.isValidNot0(x))throw new Error("invalid scalar: out of range");let g,y;const v=I=>L.cached(this,I,E=>Mh(S,E));if($){const{k1neg:I,k1:E,k2neg:A,k2:U}=F(x),{p:R,f:q}=v(E),{p:j,f:k}=v(U);y=q.add(k),g=P($.beta,R,j,I,A)}else{const{p:I,f:E}=v(x);g=I,y=E}return Mh(S,[g,y])[0]}multiplyUnsafe(x){const{endo:$}=e,g=this;if(!i.isValid(x))throw new Error("invalid scalar: out of range");if(x===Vn||g.is0())return S.ZERO;if(x===Ro)return g;if(L.hasCache(this))return this.multiply(x);if($){const{k1neg:y,k1:v,k2neg:I,k2:E}=F(x),{p1:A,p2:U}=sU(S,g,v,E);return P($.beta,A,U,y,I)}else return L.unsafe(g,x)}multiplyAndAddUnsafe(x,$,g){const y=this.multiplyUnsafe($).add(x.multiplyUnsafe(g));return y.is0()?void 0:y}toAffine(x){return _(this,x)}isTorsionFree(){const{isTorsionFree:x}=e;return o===Ro?!0:x?x(S,this):L.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:x}=e;return o===Ro?this:x?x(S,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(x=!0){return Zf(x,"isCompressed"),this.assertValidity(),d(S,this,x)}toHex(x=!0){return Po(this.toBytes(x))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(x=!0){return this.toBytes(x)}_setWindowSize(x){this.precompute(x)}static normalizeZ(x){return Mh(S,x)}static msm(x,$){return oU(S,i,x,$)}static fromPrivateKey(x){return S.BASE.multiply(Bo(i,x))}}S.BASE=new S(s.Gx,s.Gy,n.ONE),S.ZERO=new S(n.ZERO,n.ONE,n.ZERO),S.Fp=n,S.Fn=i;const T=i.BITS,L=new iU(S,e.endo?Math.ceil(T/2):T);return S.BASE.precompute(8),S}function UE(t){return Uint8Array.of(t?2:3)}function CE(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function vU(t,e={}){const{Fn:r}=t,n=e.randomBytes||ro,i=Object.assign(CE(t.Fp,r),{seed:SE(r.ORDER)});function s(h){try{return!!Bo(r,h)}catch{return!1}}function o(h,d){const{publicKey:p,publicKeyUncompressed:w}=i;try{const m=h.length;return d===!0&&m!==p||d===!1&&m!==w?!1:!!t.fromBytes(h)}catch{return!1}}function a(h=n(i.seed)){return tU(Rs(h,i.seed,"seed"),r.ORDER)}function c(h,d=!0){return t.BASE.multiply(Bo(r,h)).toBytes(d)}function f(h){const d=a(h);return{secretKey:d,publicKey:c(d)}}function u(h){if(typeof h=="bigint")return!1;if(h instanceof t)return!0;const{secretKey:d,publicKey:p,publicKeyUncompressed:w}=i;if(r.allowedLengths||d===p)return;const m=xt("key",h).length;return m===p||m===w}function l(h,d,p=!0){if(u(h)===!0)throw new Error("first arg must be private key");if(u(d)===!1)throw new Error("second arg must be public key");const w=Bo(r,h);return t.fromHex(d).multiply(w).toBytes(p)}return Object.freeze({getPublicKey:c,getSharedSecret:l,keygen:f,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:h=>Bo(r,h),precompute(h=8,d=t.BASE){return d.precompute(h,!1)}},lengths:i})}function xU(t,e,r={}){Bu(e),Fu(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=r.randomBytes||ro,i=r.hmac||(($,...g)=>Ou(e,$,Zi(...g))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:f,getPublicKey:u,getSharedSecret:l,utils:h,lengths:d}=vU(t,r),p={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},w="compact";function m($){const g=a>>Ro;return $>g}function D($,g){if(!o.isValidNot0(g))throw new Error(`invalid signature ${$}: out of range 1..Point.Fn.ORDER`);return g}function C($,g){kd(g);const y=d.signature,v=g==="compact"?y:g==="recovered"?y+1:void 0;return Rs($,v,`${g} signature`)}class b{constructor(g,y,v){this.r=D("r",g),this.s=D("s",y),v!=null&&(this.recovery=v),Object.freeze(this)}static fromBytes(g,y=w){C(g,y);let v;if(y==="der"){const{r:U,s:R}=kn.toSig(Rs(g));return new b(U,R)}y==="recovered"&&(v=g[0],y="compact",g=g.subarray(1));const I=o.BYTES,E=g.subarray(0,I),A=g.subarray(I,I*2);return new b(o.fromBytes(E),o.fromBytes(A),v)}static fromHex(g,y){return this.fromBytes(Gf(g),y)}addRecoveryBit(g){return new b(this.r,this.s,g)}recoverPublicKey(g){const y=s.ORDER,{r:v,s:I,recovery:E}=this;if(E==null||![0,1,2,3].includes(E))throw new Error("recovery id invalid");if(a*FE<y&&E>1)throw new Error("recovery id is ambiguous for h>1 curve");const A=E===2||E===3?v+a:v;if(!s.isValid(A))throw new Error("recovery id 2 or 3 invalid");const U=s.toBytes(A),R=t.fromBytes(Zi(UE((E&1)===0),U)),q=o.inv(A),j=F(xt("msgHash",g)),k=o.create(-j*q),M=o.create(I*q),H=t.BASE.multiplyUnsafe(k).add(R.multiplyUnsafe(M));if(H.is0())throw new Error("point at infinify");return H.assertValidity(),H}hasHighS(){return m(this.s)}toBytes(g=w){if(kd(g),g==="der")return Gf(kn.hexFromSig(this));const y=o.toBytes(this.r),v=o.toBytes(this.s);if(g==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Zi(Uint8Array.of(this.recovery),y,v)}return Zi(y,v)}toHex(g){return Po(this.toBytes(g))}assertValidity(){}static fromCompact(g){return b.fromBytes(xt("sig",g),"compact")}static fromDER(g){return b.fromBytes(xt("sig",g),"der")}normalizeS(){return this.hasHighS()?new b(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Po(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Po(this.toBytes("compact"))}}const B=r.bits2int||function($){if($.length>8192)throw new Error("input is too large");const g=Du($),y=$.length*8-c;return y>0?g>>BigInt(y):g},F=r.bits2int_modN||function($){return o.create(B($))},_=yc(c);function N($){return Td("num < 2^"+c,$,Vn,_),o.toBytes($)}function P($,g){return Rs($,void 0,"message"),g?Rs(e($),void 0,"prehashed message"):$}function S($,g,y){if(["recovered","canonical"].some(M=>M in y))throw new Error("sign() legacy options not supported");const{lowS:v,prehash:I,extraEntropy:E}=Kh(y,p);$=P($,I);const A=F($),U=Bo(o,g),R=[N(U),N(A)];if(E!=null&&E!==!1){const M=E===!0?n(d.secretKey):E;R.push(xt("extraEntropy",M))}const q=Zi(...R),j=A;function k(M){const H=B(M);if(!o.isValidNot0(H))return;const V=o.inv(H),z=t.BASE.multiply(H).toAffine(),K=o.create(z.x);if(K===Vn)return;const Q=o.create(V*o.create(j+K*U));if(Q===Vn)return;let ee=(z.x===K?0:2)|Number(z.y&Ro),ne=Q;return v&&m(Q)&&(ne=o.neg(Q),ee^=1),new b(K,ne,ee)}return{seed:q,k2sig:k}}function T($,g,y={}){$=xt("message",$);const{seed:v,k2sig:I}=S($,g,y);return KF(e.outputLen,o.BYTES,i)(v,I)}function L($){let g;const y=typeof $=="string"||Iu($),v=!y&&$!==null&&typeof $=="object"&&typeof $.r=="bigint"&&typeof $.s=="bigint";if(!y&&!v)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(v)g=new b($.r,$.s);else if(y){try{g=b.fromBytes(xt("sig",$),"der")}catch(I){if(!(I instanceof kn.Err))throw I}if(!g)try{g=b.fromBytes(xt("sig",$),"compact")}catch{return!1}}return g||!1}function O($,g,y,v={}){const{lowS:I,prehash:E,format:A}=Kh(v,p);if(y=xt("publicKey",y),g=P(xt("message",g),E),"strict"in v)throw new Error("options.strict was renamed to lowS");const U=A===void 0?L($):b.fromBytes(xt("sig",$),A);if(U===!1)return!1;try{const R=t.fromBytes(y);if(I&&U.hasHighS())return!1;const{r:q,s:j}=U,k=F(g),M=o.inv(j),H=o.create(k*M),V=o.create(q*M),z=t.BASE.multiplyUnsafe(H).add(R.multiplyUnsafe(V));return z.is0()?!1:o.create(z.x)===q}catch{return!1}}function x($,g,y={}){const{prehash:v}=Kh(y,p);return g=P(g,v),b.fromBytes($,"recovered").recoverPublicKey(g).toBytes()}return Object.freeze({keygen:f,getPublicKey:u,getSharedSecret:l,utils:h,lengths:d,Point:t,sign:T,verify:O,recoverPublicKey:x,Signature:b,hash:e})}function $U(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=hs(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),s={Fp:r,Fn:i,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function AU(t){const{CURVE:e,curveOpts:r}=$U(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function IU(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,IE(r.Fn.ORDER,r.Fn.BITS))})}function BU(t){const{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:i}=AU(t),s=EU(e,r),o=xU(s,n,i);return IU(t,o)}function jd(t,e){const r=n=>BU({...t,hash:n});return{...r(e),create:r}}const PE={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},RE={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},NE={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},SU=hs(PE.p),OU=hs(RE.p),_U=hs(NE.p),DU=jd({...PE,Fp:SU,lowS:!1},fE);jd({...RE,Fp:OU,lowS:!1},dF),jd({...NE,Fp:_U,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},lF);const FU=DU,TE="base10",Dt="base16",Ks="base64pad",vp="base64url",wc="utf8",LE=0,Qo=1,Uu=2,UU=0,vy=1,Ma=12,xp=32;function CU(){const t=Ld.utils.randomPrivateKey(),e=Ld.getPublicKey(t);return{privateKey:er(t,Dt),publicKey:er(e,Dt)}}function qd(){const t=ro(xp);return er(t,Dt)}function PU(t,e){const r=Ld.getSharedSecret(mr(t,Dt),mr(e,Dt)),n=HF(_u,r,void 0,void 0,xp);return er(n,Dt)}function RU(t){const e=_u(mr(t,Dt));return er(e,Dt)}function Af(t){const e=_u(mr(t,wc));return er(e,Dt)}function kE(t){return mr(`${t}`,TE)}function Ys(t){return Number(er(t,TE))}function jE(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function qE(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function NU(t){const e=kE(typeof t.type<"u"?t.type:LE);if(Ys(e)===Qo&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?mr(t.senderPublicKey,Dt):void 0,n=typeof t.iv<"u"?mr(t.iv,Dt):ro(Ma),i=mr(t.symKey,Dt),s=dE(i,n).encrypt(mr(t.message,wc)),o=ME({type:e,sealed:s,iv:n,senderPublicKey:r});return t.encoding===vp?jE(o):o}function TU(t){const e=mr(t.symKey,Dt),{sealed:r,iv:n}=Xa({encoded:t.encoded,encoding:t.encoding}),i=dE(e,n).decrypt(r);if(i===null)throw new Error("Failed to decrypt");return er(i,wc)}function LU(t,e){const r=kE(Uu),n=ro(Ma),i=mr(t,wc),s=ME({type:r,sealed:i,iv:n});return e===vp?jE(s):s}function kU(t,e){const{sealed:r}=Xa({encoded:t,encoding:e});return er(r,wc)}function ME(t){if(Ys(t.type)===Uu)return er(ja([t.type,t.sealed]),Ks);if(Ys(t.type)===Qo){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return er(ja([t.type,t.senderPublicKey,t.iv,t.sealed]),Ks)}return er(ja([t.type,t.iv,t.sealed]),Ks)}function Xa(t){const e=(t.encoding||Ks)===vp?qE(t.encoded):t.encoded,r=mr(e,Ks),n=r.slice(UU,vy),i=vy;if(Ys(n)===Qo){const c=i+xp,f=c+Ma,u=r.slice(i,c),l=r.slice(c,f),h=r.slice(f);return{type:n,sealed:h,iv:l,senderPublicKey:u}}if(Ys(n)===Uu){const c=r.slice(i),f=ro(Ma);return{type:n,sealed:c,iv:f}}const s=i+Ma,o=r.slice(i,s),a=r.slice(s);return{type:n,sealed:a,iv:o}}function jU(t,e){const r=Xa({encoded:t,encoding:e==null?void 0:e.encoding});return zE({type:Ys(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?er(r.senderPublicKey,Dt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function zE(t){const e=(t==null?void 0:t.type)||LE;if(e===Qo){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function xy(t){return t.type===Qo&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function $y(t){return t.type===Uu}function qU(t){const e=ue.from(t.x,"base64"),r=ue.from(t.y,"base64");return ja([new Uint8Array([4]),e,r])}function MU(t,e){const[r,n,i]=t.split("."),s=ue.from(qE(i),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${r}.${n}`,f=_u(c),u=qU(e);if(!FU.verify(ja([o,a]),f,u))throw new Error("Invalid signature");return _d(t).payload}const zU="irn";function Xf(t){return(t==null?void 0:t.relay)||{protocol:zU}}function So(t){const e=hA[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var HU=Object.defineProperty,VU=Object.defineProperties,KU=Object.getOwnPropertyDescriptors,Ay=Object.getOwnPropertySymbols,GU=Object.prototype.hasOwnProperty,ZU=Object.prototype.propertyIsEnumerable,Iy=(t,e,r)=>e in t?HU(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gh=(t,e)=>{for(var r in e||(e={}))GU.call(e,r)&&Iy(t,r,e[r]);if(Ay)for(var r of Ay(e))ZU.call(e,r)&&Iy(t,r,e[r]);return t},WU=(t,e)=>VU(t,KU(e));function YU(t,e="-"){const r={},n="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(n)){const s=i.replace(n,""),o=t[i];r[s]=o}}),r}function By(t){if(!t.includes("wc:")){const f=W3(t);f!=null&&f.includes("wc:")&&(t=f)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,n=t.substring(0,e),i=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(s),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:n,topic:XU(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:YU(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function XU(t){return t.startsWith("//")?t.substring(2):t}function JU(t,e="-"){const r="relay",n={};return Object.keys(t).forEach(i=>{const s=i,o=r+e+s;t[s]&&(n[o]=t[s])}),n}function Sy(t){const e=new URLSearchParams,r=Gh(Gh(WU(Gh({},JU(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(r).sort(([n],[i])=>n.localeCompare(i)).forEach(([n,i])=>{i!==void 0&&e.append(n,String(i))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}const QU={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},eC={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function we(t,e){const{message:r,code:n}=eC[t];return{message:e?`${r} ${e}`:r,code:n}}function Fa(t,e){const{message:r,code:n}=QU[t];return{message:e?`${r} ${e}`:r,code:n}}function Ua(t){return typeof t>"u"}function HE(t,e){return typeof t=="string"&&!!t.trim().length}function tC(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(HE(t,!1)){if(e(t))return!0;const r=W3(t);return e(r)}}catch{}return!1}function rC(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function nC(t){return t==null?void 0:t.topic}function Zh(t){return typeof t<"u"&&typeof t!==null}function Oy(){const t=Au();return new Promise(e=>{switch(t){case zr.browser:e(iC());break;case zr.reactNative:e(sC());break;case zr.node:e(oC());break;default:e(!0)}})}function iC(){return pc()&&(navigator==null?void 0:navigator.onLine)}async function sC(){if(to()&&typeof re<"u"&&re!=null&&re.NetInfo){const t=await(re==null?void 0:re.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function oC(){return!0}function aC(t){switch(Au()){case zr.browser:cC(t);break;case zr.reactNative:fC(t);break}}function cC(t){!to()&&pc()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function fC(t){to()&&typeof re<"u"&&re!=null&&re.NetInfo&&(re==null||re.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}function uC(){var t;return pc()&&ur.getDocument()?((t=ur.getDocument())==null?void 0:t.visibilityState)==="visible":!0}const hC="PARSE_ERROR",lC="INVALID_REQUEST",dC="METHOD_NOT_FOUND",pC="INVALID_PARAMS",VE="INTERNAL_ERROR",$p="SERVER_ERROR",gC=[-32700,-32600,-32601,-32602,-32603],za={[hC]:{code:-32700,message:"Parse error"},[lC]:{code:-32600,message:"Invalid Request"},[dC]:{code:-32601,message:"Method not found"},[pC]:{code:-32602,message:"Invalid params"},[VE]:{code:-32603,message:"Internal error"},[$p]:{code:-32e3,message:"Server error"}},KE=$p;function yC(t){return gC.includes(t)}function _y(t){return Object.keys(za).includes(t)?za[t]:za[KE]}function wC(t){const e=Object.values(za).find(r=>r.code===t);return e||za[KE]}function GE(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var Wh={},xn={},Dy;function bC(){if(Dy)return xn;Dy=1,Object.defineProperty(xn,"__esModule",{value:!0}),xn.isBrowserCryptoAvailable=xn.getSubtleCrypto=xn.getBrowerCrypto=void 0;function t(){return(dn===null||dn===void 0?void 0:dn.crypto)||(dn===null||dn===void 0?void 0:dn.msCrypto)||{}}xn.getBrowerCrypto=t;function e(){const n=t();return n.subtle||n.webkitSubtle}xn.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return xn.isBrowserCryptoAvailable=r,xn}var $n={},Fy;function mC(){if(Fy)return $n;Fy=1,Object.defineProperty($n,"__esModule",{value:!0}),$n.isBrowser=$n.isNode=$n.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}$n.isReactNative=t;function e(){return typeof It<"u"&&typeof It.versions<"u"&&typeof It.versions.node<"u"}$n.isNode=e;function r(){return!t()&&!e()}return $n.isBrowser=r,$n}var Uy;function EC(){return Uy||(Uy=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=sc;e.__exportStar(bC(),t),e.__exportStar(mC(),t)})(Wh)),Wh}var vC=EC();function hn(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function Xi(t=6){return BigInt(hn(t))}function Mr(t,e,r){return{id:r||hn(),jsonrpc:"2.0",method:t,params:e}}function Ja(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Cu(t,e,r){return{id:t,jsonrpc:"2.0",error:xC(e)}}function xC(t,e){return typeof t>"u"?_y(VE):(typeof t=="string"&&(t=Object.assign(Object.assign({},_y($p)),{message:t})),yC(t.code)&&(t=wC(t.code)),t)}class $C{}class AC extends $C{constructor(){super()}}class IC extends AC{constructor(e){super()}}const BC="^https?:",SC="^wss?:";function OC(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function ZE(t,e){const r=OC(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function Cy(t){return ZE(t,BC)}function Py(t){return ZE(t,SC)}function _C(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function WE(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Ap(t){return WE(t)&&"method"in t}function Pu(t){return WE(t)&&(ln(t)||br(t))}function ln(t){return"result"in t}function br(t){return"error"in t}let Ip=class extends IC{constructor(e){super(e),this.events=new hr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Mr(e.method,e.params||[],e.id||Xi().toString()),r)}async requestStrict(e,r){return new Promise(async(n,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${e.id}`,s=>{br(s)?i(s.error):n(s.result)});try{await this.connection.send(e,r)}catch(s){i(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Pu(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};var Yh,Ry;function DC(){return Ry||(Ry=1,Yh=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}),Yh}const FC=()=>typeof WebSocket<"u"?WebSocket:typeof re<"u"&&typeof re.WebSocket<"u"?re.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:DC(),UC=()=>typeof WebSocket<"u"||typeof re<"u"&&typeof re.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Ny=t=>t.split("?")[0],Ty=10,CC=FC();let PC=class{constructor(e){if(this.url=e,this.events=new hr.EventEmitter,this.registering=!1,!Py(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Xn(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!Py(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,n)=>{const i=vC.isReactNative()?void 0:{rejectUnauthorized:!_C(e)},s=new CC(e,[],i);UC()?s.onerror=o=>{const a=o;n(this.emitError(a.error))}:s.on("error",o=>{n(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Ws(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const n=this.parseError(r),i=n.message||n.toString(),s=Cu(e,i);this.events.emit("payload",s)}parseError(e,r=this.url){return GE(e,Ny(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Ty&&this.events.setMaxListeners(Ty)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${Ny(this.url)}`));return this.events.emit("register_error",r),r}};var RC={};const YE="wc",XE=2,Md="core",gn=`${YE}@2:${Md}:`,NC={logger:"error"},TC={database:":memory:"},LC="crypto",Ly="client_ed25519_seed",kC=Z.ONE_DAY,jC="keychain",qC="0.3",MC="messages",zC="0.3",HC=Z.SIX_HOURS,VC="publisher",JE="irn",KC="error",QE="wss://relay.walletconnect.org",GC="relayer",Ie={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},ZC="_subscription",lr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},WC=.1,zd="2.21.10",$e={link_mode:"link_mode",relay:"relay"},If={inbound:"inbound",outbound:"outbound"},YC="0.3",XC="WALLETCONNECT_CLIENT_ID",ky="WALLETCONNECT_LINK_MODE_APPS",ir={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},JC="subscription",QC="0.3",eP="pairing",tP="0.3",la={wc_pairingDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:0},res:{ttl:Z.ONE_DAY,prompt:!1,tag:0}}},Os={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Dr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},rP="history",nP="0.3",iP="expirer",yr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},sP="0.3",oP="verify-api",aP="https://verify.walletconnect.com",e8="https://verify.walletconnect.org",Ha=e8,cP=`${Ha}/v3`,fP=[aP,e8],uP="echo",hP="https://echo.walletconnect.com",un={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Pn={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},wi={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},da={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},xs={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},pa={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},lP=.1,dP="event-client",pP=86400,gP="https://pulse.walletconnect.org/batch";function yP(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),f=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var w=0,m=0,D=0,C=p.length;D!==C&&p[D]===0;)D++,w++;for(var b=(C-D)*u+1>>>0,B=new Uint8Array(b);D!==C;){for(var F=p[D],_=0,N=b-1;(F!==0||_<m)&&N!==-1;N--,_++)F+=256*B[N]>>>0,B[N]=F%a>>>0,F=F/a>>>0;if(F!==0)throw new Error("Non-zero carry");m=_,D++}for(var P=b-m;P!==b&&B[P]===0;)P++;for(var S=c.repeat(w);P<b;++P)S+=t.charAt(B[P]);return S}function h(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var w=0;if(p[w]!==" "){for(var m=0,D=0;p[w]===c;)m++,w++;for(var C=(p.length-w)*f+1>>>0,b=new Uint8Array(C);p[w];){var B=r[p.charCodeAt(w)];if(B===255)return;for(var F=0,_=C-1;(B!==0||F<D)&&_!==-1;_--,F++)B+=a*b[_]>>>0,b[_]=B%256>>>0,B=B/256>>>0;if(B!==0)throw new Error("Non-zero carry");D=F,w++}if(p[w]!==" "){for(var N=C-D;N!==C&&b[N]===0;)N++;for(var P=new Uint8Array(m+(C-N)),S=m;N!==C;)P[S++]=b[N++];return P}}}function d(p){var w=h(p);if(w)return w;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:h,decode:d}}var wP=yP,bP=wP;const t8=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},mP=t=>new TextEncoder().encode(t),EP=t=>new TextDecoder().decode(t);let vP=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},xP=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return r8(this,e)}},$P=class{constructor(e){this.decoders=e}or(e){return r8(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const r8=(t,e)=>new $P({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let AP=class{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new vP(e,r,n),this.decoder=new xP(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Ru=({name:t,prefix:e,encode:r,decode:n})=>new AP(t,e,r,n),bc=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=bP(r,e);return Ru({prefix:t,name:e,encode:n,decode:s=>t8(i(s))})},IP=(t,e,r,n)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,f=0;for(let u=0;u<s;++u){const l=i[t[u]];if(l===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|l,a+=r,a>=8&&(a-=8,o[f++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},BP=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},it=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Ru({prefix:e,name:t,encode(i){return BP(i,n,r)},decode(i){return IP(i,n,r,t)}}),SP=Ru({prefix:"\0",name:"identity",encode:t=>EP(t),decode:t=>mP(t)});var OP=Object.freeze({__proto__:null,identity:SP});const _P=it({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var DP=Object.freeze({__proto__:null,base2:_P});const FP=it({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var UP=Object.freeze({__proto__:null,base8:FP});const CP=bc({prefix:"9",name:"base10",alphabet:"0123456789"});var PP=Object.freeze({__proto__:null,base10:CP});const RP=it({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),NP=it({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var TP=Object.freeze({__proto__:null,base16:RP,base16upper:NP});const LP=it({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),kP=it({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),jP=it({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),qP=it({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),MP=it({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),zP=it({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),HP=it({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),VP=it({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),KP=it({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var GP=Object.freeze({__proto__:null,base32:LP,base32upper:kP,base32pad:jP,base32padupper:qP,base32hex:MP,base32hexupper:zP,base32hexpad:HP,base32hexpadupper:VP,base32z:KP});const ZP=bc({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),WP=bc({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var YP=Object.freeze({__proto__:null,base36:ZP,base36upper:WP});const XP=bc({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),JP=bc({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var QP=Object.freeze({__proto__:null,base58btc:XP,base58flickr:JP});const eR=it({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),tR=it({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),rR=it({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),nR=it({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var iR=Object.freeze({__proto__:null,base64:eR,base64pad:tR,base64url:rR,base64urlpad:nR});const n8=Array.from(""),sR=n8.reduce((t,e,r)=>(t[r]=e,t),[]),oR=n8.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function aR(t){return t.reduce((e,r)=>(e+=sR[r],e),"")}function cR(t){const e=[];for(const r of t){const n=oR[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const fR=Ru({prefix:"",name:"base256emoji",encode:aR,decode:cR});var uR=Object.freeze({__proto__:null,base256emoji:fR}),hR=i8,jy=128,lR=-128,dR=Math.pow(2,31);function i8(t,e,r){e=e||[],r=r||0;for(var n=r;t>=dR;)e[r++]=t&255|jy,t/=128;for(;t&lR;)e[r++]=t&255|jy,t>>>=7;return e[r]=t|0,i8.bytes=r-n+1,e}var pR=Hd,gR=128,qy=127;function Hd(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw Hd.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&qy)<<i:(o&qy)*Math.pow(2,i),i+=7}while(o>=gR);return Hd.bytes=s-n,r}var yR=Math.pow(2,7),wR=Math.pow(2,14),bR=Math.pow(2,21),mR=Math.pow(2,28),ER=Math.pow(2,35),vR=Math.pow(2,42),xR=Math.pow(2,49),$R=Math.pow(2,56),AR=Math.pow(2,63),IR=function(t){return t<yR?1:t<wR?2:t<bR?3:t<mR?4:t<ER?5:t<vR?6:t<xR?7:t<$R?8:t<AR?9:10},BR={encode:hR,decode:pR,encodingLength:IR},s8=BR;const My=(t,e,r=0)=>(s8.encode(t,e,r),e),zy=t=>s8.encodingLength(t),Vd=(t,e)=>{const r=e.byteLength,n=zy(t),i=n+zy(r),s=new Uint8Array(i+r);return My(t,s,0),My(r,s,n),s.set(e,i),new SR(t,r,e,s)};let SR=class{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}};const o8=({name:t,code:e,encode:r})=>new OR(t,e,r);let OR=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Vd(this.code,r):r.then(n=>Vd(this.code,n))}else throw Error("Unknown type, must be binary type")}};const a8=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),_R=o8({name:"sha2-256",code:18,encode:a8("SHA-256")}),DR=o8({name:"sha2-512",code:19,encode:a8("SHA-512")});var FR=Object.freeze({__proto__:null,sha256:_R,sha512:DR});const c8=0,UR="identity",f8=t8,CR=t=>Vd(c8,f8(t)),PR={code:c8,name:UR,encode:f8,digest:CR};var RR=Object.freeze({__proto__:null,identity:PR});new TextEncoder,new TextDecoder;const Hy={...OP,...DP,...UP,...PP,...TP,...GP,...YP,...QP,...iR,...uR};({...FR,...RR});function u8(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function NR(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?u8(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function h8(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const Vy=h8("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Xh=h8("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=NR(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),TR={utf8:Vy,"utf-8":Vy,hex:Hy.base16,latin1:Xh,ascii:Xh,binary:Xh,...Hy};function LR(t,e="utf8"){const r=TR[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?u8(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var kR=Object.defineProperty,jR=(t,e,r)=>e in t?kR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,nn=(t,e,r)=>jR(t,typeof e!="symbol"?e+"":e,r);let qR=class{constructor(e,r){this.core=e,this.logger=r,nn(this,"keychain",new Map),nn(this,"name",jC),nn(this,"version",qC),nn(this,"initialized",!1),nn(this,"storagePrefix",gn),nn(this,"init",async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}}),nn(this,"has",n=>(this.isInitialized(),this.keychain.has(n))),nn(this,"set",async(n,i)=>{this.isInitialized(),this.keychain.set(n,i),await this.persist()}),nn(this,"get",n=>{this.isInitialized();const i=this.keychain.get(n);if(typeof i>"u"){const{message:s}=we("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(s)}return i}),nn(this,"del",async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()}),this.core=e,this.logger=Pt(r,this.name)}get context(){return tr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Dd(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Fd(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=we("NOT_INITIALIZED",this.name);throw new Error(e)}}};var MR=Object.defineProperty,zR=(t,e,r)=>e in t?MR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,We=(t,e,r)=>zR(t,typeof e!="symbol"?e+"":e,r);let HR=class{constructor(e,r,n){this.core=e,this.logger=r,We(this,"name",LC),We(this,"keychain"),We(this,"randomSessionIdentifier",qd()),We(this,"initialized",!1),We(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),We(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),We(this,"getClientId",async()=>{this.isInitialized();const i=await this.getClientSeed(),s=Wg(i);return M3(s.publicKey)}),We(this,"generateKeyPair",()=>{this.isInitialized();const i=CU();return this.setPrivateKey(i.publicKey,i.privateKey)}),We(this,"signJWT",async i=>{this.isInitialized();const s=await this.getClientSeed(),o=Wg(s),a=this.randomSessionIdentifier;return await yD(a,i,kC,o)}),We(this,"generateSharedKey",(i,s,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=PU(a,s);return this.setSymKey(c,o)}),We(this,"setSymKey",async(i,s)=>{this.isInitialized();const o=s||RU(i);return await this.keychain.set(o,i),o}),We(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),We(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),We(this,"encode",async(i,s,o)=>{this.isInitialized();const a=zE(o),c=Xn(s);if($y(a))return LU(c,o==null?void 0:o.encoding);if(xy(a)){const h=a.senderPublicKey,d=a.receiverPublicKey;i=await this.generateSharedKey(h,d)}const f=this.getSymKey(i),{type:u,senderPublicKey:l}=a;return NU({type:u,symKey:f,message:c,senderPublicKey:l,encoding:o==null?void 0:o.encoding})}),We(this,"decode",async(i,s,o)=>{this.isInitialized();const a=jU(s,o);if($y(a)){const c=kU(s,o==null?void 0:o.encoding);return Ws(c)}if(xy(a)){const c=a.receiverPublicKey,f=a.senderPublicKey;i=await this.generateSharedKey(c,f)}try{const c=this.getSymKey(i),f=TU({symKey:c,encoded:s,encoding:o==null?void 0:o.encoding});return Ws(f)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),We(this,"getPayloadType",(i,s=Ks)=>{const o=Xa({encoded:i,encoding:s});return Ys(o.type)}),We(this,"getPayloadSenderPublicKey",(i,s=Ks)=>{const o=Xa({encoded:i,encoding:s});return o.senderPublicKey?er(o.senderPublicKey,Dt):void 0}),this.core=e,this.logger=Pt(r,this.name),this.keychain=n||new qR(this.core,this.logger)}get context(){return tr(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Ly)}catch{e=qd(),await this.keychain.set(Ly,e)}return LR(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=we("NOT_INITIALIZED",this.name);throw new Error(e)}}};var VR=Object.defineProperty,KR=Object.defineProperties,GR=Object.getOwnPropertyDescriptors,Ky=Object.getOwnPropertySymbols,ZR=Object.prototype.hasOwnProperty,WR=Object.prototype.propertyIsEnumerable,Kd=(t,e,r)=>e in t?VR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,YR=(t,e)=>{for(var r in e||(e={}))ZR.call(e,r)&&Kd(t,r,e[r]);if(Ky)for(var r of Ky(e))WR.call(e,r)&&Kd(t,r,e[r]);return t},XR=(t,e)=>KR(t,GR(e)),rr=(t,e,r)=>Kd(t,typeof e!="symbol"?e+"":e,r);class JR extends bS{constructor(e,r){super(e,r),this.logger=e,this.core=r,rr(this,"messages",new Map),rr(this,"messagesWithoutClientAck",new Map),rr(this,"name",MC),rr(this,"version",zC),rr(this,"initialized",!1),rr(this,"storagePrefix",gn),rr(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}}),rr(this,"set",async(n,i,s)=>{this.isInitialized();const o=Af(i);let a=this.messages.get(n);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(n,a),s===If.inbound){const c=this.messagesWithoutClientAck.get(n)||{};this.messagesWithoutClientAck.set(n,XR(YR({},c),{[o]:i}))}return await this.persist(),o}),rr(this,"get",n=>{this.isInitialized();let i=this.messages.get(n);return typeof i>"u"&&(i={}),i}),rr(this,"getWithoutAck",n=>{this.isInitialized();const i={};for(const s of n){const o=this.messagesWithoutClientAck.get(s)||{};i[s]=Object.values(o)}return i}),rr(this,"has",(n,i)=>{this.isInitialized();const s=this.get(n),o=Af(i);return typeof s[o]<"u"}),rr(this,"ack",async(n,i)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(n);if(typeof s>"u")return;const o=Af(i);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(n):this.messagesWithoutClientAck.set(n,s),await this.persist()}),rr(this,"del",async n=>{this.isInitialized(),this.messages.delete(n),this.messagesWithoutClientAck.delete(n),await this.persist()}),this.logger=Pt(e,this.name),this.core=r}get context(){return tr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Dd(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Dd(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Fd(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Fd(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=we("NOT_INITIALIZED",this.name);throw new Error(e)}}}var QR=Object.defineProperty,eN=Object.defineProperties,tN=Object.getOwnPropertyDescriptors,Gy=Object.getOwnPropertySymbols,rN=Object.prototype.hasOwnProperty,nN=Object.prototype.propertyIsEnumerable,Gd=(t,e,r)=>e in t?QR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ho=(t,e)=>{for(var r in e||(e={}))rN.call(e,r)&&Gd(t,r,e[r]);if(Gy)for(var r of Gy(e))nN.call(e,r)&&Gd(t,r,e[r]);return t},Zy=(t,e)=>eN(t,tN(e)),dr=(t,e,r)=>Gd(t,typeof e!="symbol"?e+"":e,r);let iN=class extends mS{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,dr(this,"events",new hr.EventEmitter),dr(this,"name",VC),dr(this,"queue",new Map),dr(this,"publishTimeout",Z.toMiliseconds(Z.ONE_MINUTE)),dr(this,"initialPublishTimeout",Z.toMiliseconds(Z.ONE_SECOND*15)),dr(this,"needsTransportRestart",!1),dr(this,"publish",async(n,i,s)=>{var o,a,c,f,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:i,opts:s}});const l=(s==null?void 0:s.ttl)||HC,h=(s==null?void 0:s.prompt)||!1,d=(s==null?void 0:s.tag)||0,p=(s==null?void 0:s.id)||Xi().toString(),w=So(Xf().protocol),m={id:p,method:(s==null?void 0:s.publishMethod)||w.publish,params:ho({topic:n,message:i,ttl:l,prompt:h,tag:d,attestation:s==null?void 0:s.attestation},s==null?void 0:s.tvf)},D=`Failed to publish payload, please try again. id:${p} tag:${d}`;try{Ua((o=m.params)==null?void 0:o.prompt)&&((a=m.params)==null||delete a.prompt),Ua((c=m.params)==null?void 0:c.tag)&&((f=m.params)==null||delete f.tag);const C=new Promise(async b=>{const B=({id:_})=>{var N;((N=m.id)==null?void 0:N.toString())===_.toString()&&(this.removeRequestFromQueue(_),this.relayer.events.removeListener(Ie.publish,B),b())};this.relayer.events.on(Ie.publish,B);const F=pn(new Promise((_,N)=>{this.rpcPublish(m,s).then(_).catch(P=>{this.logger.warn(P,P==null?void 0:P.message),N(P)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${p} tag:${d}`);try{await F,this.events.removeListener(Ie.publish,B)}catch(_){this.queue.set(p,{request:m,opts:s,attempt:1}),this.logger.warn(_,_==null?void 0:_.message)}});this.logger.trace({type:"method",method:"publish",params:{id:p,topic:n,message:i,opts:s}}),await pn(C,this.publishTimeout,D)}catch(C){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(C),(u=s==null?void 0:s.internal)!=null&&u.throwOnFailedPublish)throw C}finally{this.queue.delete(p)}}),dr(this,"publishCustom",async n=>{var i,s,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:n});const{payload:f,opts:u={}}=n,{attestation:l,tvf:h,publishMethod:d,prompt:p,tag:w,ttl:m=Z.FIVE_MINUTES}=u,D=u.id||Xi().toString(),C=So(Xf().protocol),b=d||C.publish,B={id:D,method:b,params:ho(Zy(ho({},f),{ttl:m,prompt:p,tag:w,attestation:l}),h)},F=`Failed to publish custom payload, please try again. id:${D} tag:${w}`;try{Ua((i=B.params)==null?void 0:i.prompt)&&((s=B.params)==null||delete s.prompt),Ua((o=B.params)==null?void 0:o.tag)&&((a=B.params)==null||delete a.tag);const _=new Promise(async N=>{const P=({id:T})=>{var L;((L=B.id)==null?void 0:L.toString())===T.toString()&&(this.removeRequestFromQueue(T),this.relayer.events.removeListener(Ie.publish,P),N())};this.relayer.events.on(Ie.publish,P);const S=pn(new Promise((T,L)=>{this.rpcPublish(B,u).then(T).catch(O=>{this.logger.warn(O,O==null?void 0:O.message),L(O)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${b} id:${D} tag:${w}`);try{await S,this.events.removeListener(Ie.publish,P)}catch(T){this.queue.set(D,{request:B,opts:u,attempt:1}),this.logger.warn(T,T==null?void 0:T.message)}});this.logger.trace({type:"method",method:"publish",params:{id:D,payload:f,opts:u}}),await pn(_,this.publishTimeout,F)}catch(_){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(_),(c=u==null?void 0:u.internal)!=null&&c.throwOnFailedPublish)throw _}finally{this.queue.delete(D)}}),dr(this,"on",(n,i)=>{this.events.on(n,i)}),dr(this,"once",(n,i)=>{this.events.once(n,i)}),dr(this,"off",(n,i)=>{this.events.off(n,i)}),dr(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.relayer=e,this.logger=Pt(r,this.name),this.registerEventListeners()}get context(){return tr(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const n=await this.relayer.request(e);return this.relayer.events.emit(Ie.publish,ho(ho({},e),r)),this.logger.debug("Successfully Published Payload"),n}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var n;const i=e.attempt+1;this.queue.set(r,Zy(ho({},e),{attempt:i})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(n=e.request.params)==null?void 0:n.tag}, attempt: ${i}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Qs.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ie.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ie.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}};var sN=Object.defineProperty,oN=(t,e,r)=>e in t?sN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lo=(t,e,r)=>oN(t,typeof e!="symbol"?e+"":e,r);let aN=class{constructor(){lo(this,"map",new Map),lo(this,"set",(e,r)=>{const n=this.get(e);this.exists(e,r)||this.map.set(e,[...n,r])}),lo(this,"get",e=>this.map.get(e)||[]),lo(this,"exists",(e,r)=>this.get(e).includes(r)),lo(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,r))return;const i=n.filter(s=>s!==r);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),lo(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}};var cN=Object.defineProperty,fN=Object.defineProperties,uN=Object.getOwnPropertyDescriptors,Wy=Object.getOwnPropertySymbols,hN=Object.prototype.hasOwnProperty,lN=Object.prototype.propertyIsEnumerable,Zd=(t,e,r)=>e in t?cN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ga=(t,e)=>{for(var r in e||(e={}))hN.call(e,r)&&Zd(t,r,e[r]);if(Wy)for(var r of Wy(e))lN.call(e,r)&&Zd(t,r,e[r]);return t},Jh=(t,e)=>fN(t,uN(e)),Ee=(t,e,r)=>Zd(t,typeof e!="symbol"?e+"":e,r);let dN=class extends xS{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,Ee(this,"subscriptions",new Map),Ee(this,"topicMap",new aN),Ee(this,"events",new hr.EventEmitter),Ee(this,"name",JC),Ee(this,"version",QC),Ee(this,"pending",new Map),Ee(this,"cached",[]),Ee(this,"initialized",!1),Ee(this,"storagePrefix",gn),Ee(this,"subscribeTimeout",Z.toMiliseconds(Z.ONE_MINUTE)),Ee(this,"initialSubscribeTimeout",Z.toMiliseconds(Z.ONE_SECOND*15)),Ee(this,"clientId"),Ee(this,"batchSubscribeTopicsLimit",500),Ee(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Ee(this,"subscribe",async(n,i)=>{var s;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}});try{const o=Xf(i),a={topic:n,relay:o,transportType:i==null?void 0:i.transportType};(s=i==null?void 0:i.internal)!=null&&s.skipSubscribe||this.pending.set(n,a);const c=await this.rpcSubscribe(n,o,i);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),Ee(this,"unsubscribe",async(n,i)=>{this.isInitialized(),typeof(i==null?void 0:i.id)<"u"?await this.unsubscribeById(n,i.id,i):await this.unsubscribeByTopic(n,i)}),Ee(this,"isSubscribed",n=>new Promise(i=>{i(this.topicMap.topics.includes(n))})),Ee(this,"isKnownTopic",n=>new Promise(i=>{i(this.topicMap.topics.includes(n)||this.pending.has(n)||this.cached.some(s=>s.topic===n))})),Ee(this,"on",(n,i)=>{this.events.on(n,i)}),Ee(this,"once",(n,i)=>{this.events.once(n,i)}),Ee(this,"off",(n,i)=>{this.events.off(n,i)}),Ee(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),Ee(this,"start",async()=>{await this.onConnect()}),Ee(this,"stop",async()=>{await this.onDisconnect()}),Ee(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Ee(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const n=[];this.pending.forEach(i=>{n.push(i)}),await this.batchSubscribe(n)}),Ee(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Qs.pulse,async()=>{await this.checkPending()}),this.events.on(ir.created,async n=>{const i=ir.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()}),this.events.on(ir.deleted,async n=>{const i=ir.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()})}),this.relayer=e,this.logger=Pt(r,this.name),this.clientId=""}get context(){return tr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let n=!1;try{n=this.getSubscription(e).topic===r}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const n=this.topicMap.get(e);await Promise.all(n.map(async i=>await this.unsubscribeById(e,i,r)))}async unsubscribeById(e,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}});try{const i=Xf(n);await this.restartToComplete({topic:e,id:r,relay:i}),await this.rpcUnsubscribe(e,r,i);const s=Fa("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,r,n){var i,s;const o=await this.getSubscriptionId(e);if((i=n==null?void 0:n.internal)!=null&&i.skipSubscribe)return o;(!n||(n==null?void 0:n.transportType)===$e.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const a={method:So(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(s=n==null?void 0:n.internal)==null?void 0:s.throwOnFailedPublish;try{if((n==null?void 0:n.transportType)===$e.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(l=>this.logger.warn(l))},Z.toMiliseconds(Z.ONE_SECOND)),o;const f=new Promise(async l=>{const h=d=>{d.topic===e&&(this.events.removeListener(ir.created,h),l(d.id))};this.events.on(ir.created,h);try{const d=await pn(new Promise((p,w)=>{this.relayer.request(a).catch(m=>{this.logger.warn(m,m==null?void 0:m.message),w(m)}).then(p)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(ir.created,h),l(d)}catch{}}),u=await pn(f,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return u?o:null}catch(f){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ie.connection_stalled),c)throw f}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,n={method:So(r.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await pn(new Promise(i=>{this.relayer.request(n).catch(s=>this.logger.warn(s)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(Ie.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,n={method:So(r.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let i;try{i=await await pn(new Promise((s,o)=>{this.relayer.request(n).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(Ie.connection_stalled)}return i}rpcUnsubscribe(e,r,n){const i={method:So(n.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,r){this.setSubscription(e,Jh(ga({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,ga({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,ga({},r)),this.topicMap.set(r.topic,e),this.events.emit(ir.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:n}=we("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(ir.deleted,Jh(ga({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(ir.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<r;n++){const i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(ir.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var n;return r.topic===((n=this.subscriptions.get(r.id))==null?void 0:n.topic)})){const{message:r}=we("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>Jh(ga({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await CD(Z.toMiliseconds(Z.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=we("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Af(e+await this.getClientId())}};var pN=Object.defineProperty,Yy=Object.getOwnPropertySymbols,gN=Object.prototype.hasOwnProperty,yN=Object.prototype.propertyIsEnumerable,Wd=(t,e,r)=>e in t?pN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Xy=(t,e)=>{for(var r in e||(e={}))gN.call(e,r)&&Wd(t,r,e[r]);if(Yy)for(var r of Yy(e))yN.call(e,r)&&Wd(t,r,e[r]);return t},pe=(t,e,r)=>Wd(t,typeof e!="symbol"?e+"":e,r);class wN extends ES{constructor(e){super(e),pe(this,"protocol","wc"),pe(this,"version",2),pe(this,"core"),pe(this,"logger"),pe(this,"events",new hr.EventEmitter),pe(this,"provider"),pe(this,"messages"),pe(this,"subscriber"),pe(this,"publisher"),pe(this,"name",GC),pe(this,"transportExplicitlyClosed",!1),pe(this,"initialized",!1),pe(this,"connectionAttemptInProgress",!1),pe(this,"relayUrl"),pe(this,"projectId"),pe(this,"packageName"),pe(this,"bundleId"),pe(this,"hasExperiencedNetworkDisruption",!1),pe(this,"pingTimeout"),pe(this,"heartBeatTimeout",Z.toMiliseconds(Z.THIRTY_SECONDS+Z.FIVE_SECONDS)),pe(this,"reconnectTimeout"),pe(this,"connectPromise"),pe(this,"reconnectInProgress",!1),pe(this,"requestsInFlight",[]),pe(this,"connectTimeout",Z.toMiliseconds(Z.ONE_SECOND*15)),pe(this,"request",async r=>{var n,i;this.logger.debug("Publishing Request Payload");const s=r.id||Xi().toString();await this.toEstablishConnection();try{this.logger.trace({id:s,method:r.method,topic:(n=r.params)==null?void 0:n.topic},"relayer.request - publishing...");const o=`${s}:${((i=r.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${s}`),o}}),pe(this,"resetPingTimeout",()=>{Kf()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,n,i,s;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(i=(n=(r=this.provider)==null?void 0:r.connection)==null?void 0:n.socket)==null?void 0:i.terminate)==null||s.call(i)}catch(o){this.logger.warn(o,o==null?void 0:o.message)}},this.heartBeatTimeout))}),pe(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),pe(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(Ie.connect)}),pe(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),pe(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(Ie.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),pe(this,"registerProviderListeners",()=>{this.provider.on(lr.payload,this.onPayloadHandler),this.provider.on(lr.connect,this.onConnectHandler),this.provider.on(lr.disconnect,this.onDisconnectHandler),this.provider.on(lr.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Pt(e.logger,this.name):hc(Eu({level:e.logger||KC})),this.messages=new JR(this.logger,e.core),this.subscriber=new dN(this,this.logger),this.publisher=new iN(this,this.logger),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||QE,xD()?this.packageName=Xg():$D()&&(this.bundleId=Xg()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e==null?void 0:e.message))}get context(){return tr(this.logger)}get connected(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===1||!1}get connecting(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,n){this.isInitialized(),await this.publisher.publish(e,r,n),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:$e.relay},If.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var n,i,s;this.isInitialized(),(!(r!=null&&r.transportType)||(r==null?void 0:r.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((n=r==null?void 0:r.internal)==null?void 0:n.throwOnFailedPublish)>"u"?!0:(i=r==null?void 0:r.internal)==null?void 0:i.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const f=u=>{u.topic===e&&(this.subscriber.off(ir.created,f),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(ir.created,f)}),new Promise(async(u,l)=>{a=await this.subscriber.subscribe(e,Xy({internal:{throwOnFailedPublish:o}},r)).catch(h=>{o&&l(h)})||a,u()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await pn(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,n)=>{await this.connect(e).then(r).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Oy())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((n,i)=>n.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const n of r)try{await this.onMessageEvent(n)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+(i==null?void 0:i.message))}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:n}=e;if(!r.sessionExists){const i=qa(Z.FIVE_MINUTES),s={topic:n,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,s)}this.events.emit(Ie.message,e),await this.recordMessageEvent(e,If.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(n,i)=>{const s=()=>{i(new Error("Connection interrupted while trying to connect"))};this.provider.once(lr.disconnect,s),await pn(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(lr.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(lr.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(lr.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,n()})}catch(n){await this.subscriber.stop();const i=n;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(n=>setTimeout(n,Z.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,n,i,s;if(Kf())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((s=(i=(n=this.provider)==null?void 0:n.connection)==null?void 0:i.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Ip(new PC(OD({sdkVersion:zd,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:n,message:i}=e;await this.messages.set(n,i,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const i=this.messages.has(r,n);return i&&this.logger.warn(`Ignoring duplicate message: ${n}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Ap(e)){if(!e.method.endsWith(ZC))return;const r=e.params,{topic:n,message:i,publishedAt:s,attestation:o}=r.data,a={topic:n,message:i,publishedAt:s,transportType:$e.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Xy({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Pu(e)&&this.events.emit(Ie.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,If.inbound),this.events.emit(Ie.message,e))}async acknowledgePayload(e){const r=Ja(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(lr.payload,this.onPayloadHandler),this.provider.off(lr.connect,this.onConnectHandler),this.provider.off(lr.disconnect,this.onDisconnectHandler),this.provider.off(lr.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Oy();aC(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(n=>this.logger.error(n,n==null?void 0:n.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Qs.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&uC())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r==null?void 0:r.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(Ie.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},Z.toMiliseconds(WC)))))}isInitialized(){if(!this.initialized){const{message:e}=we("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function bN(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function Jy(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Qy(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const mN="[object RegExp]",EN="[object String]",vN="[object Number]",xN="[object Boolean]",ew="[object Arguments]",$N="[object Symbol]",AN="[object Date]",IN="[object Map]",BN="[object Set]",SN="[object Array]",ON="[object Function]",_N="[object ArrayBuffer]",Qh="[object Object]",DN="[object Error]",FN="[object DataView]",UN="[object Uint8Array]",CN="[object Uint8ClampedArray]",PN="[object Uint16Array]",RN="[object Uint32Array]",NN="[object BigUint64Array]",TN="[object Int8Array]",LN="[object Int16Array]",kN="[object Int32Array]",jN="[object BigInt64Array]",qN="[object Float32Array]",MN="[object Float64Array]";function zN(){}function tw(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function HN(t,e,r){return Ca(t,e,void 0,void 0,void 0,void 0,r)}function Ca(t,e,r,n,i,s,o){const a=o(t,e,r,n,i,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Va(t,e,s,o)}return Va(t,e,s,o)}function Va(t,e,r,n){if(Object.is(t,e))return!0;let i=Qy(t),s=Qy(e);if(i===ew&&(i=Qh),s===ew&&(s=Qh),i!==s)return!1;switch(i){case EN:return t.toString()===e.toString();case vN:{const c=t.valueOf(),f=e.valueOf();return bN(c,f)}case xN:case AN:case $N:return Object.is(t.valueOf(),e.valueOf());case mN:return t.source===e.source&&t.flags===e.flags;case ON:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(i){case IN:{if(t.size!==e.size)return!1;for(const[c,f]of t.entries())if(!e.has(c)||!Ca(f,e.get(c),c,t,e,r,n))return!1;return!0}case BN:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),f=Array.from(e.values());for(let u=0;u<c.length;u++){const l=c[u],h=f.findIndex(d=>Ca(l,d,void 0,t,e,r,n));if(h===-1)return!1;f.splice(h,1)}return!0}case SN:case UN:case CN:case PN:case RN:case NN:case TN:case LN:case kN:case jN:case qN:case MN:{if(typeof ue<"u"&&ue.isBuffer(t)!==ue.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Ca(t[c],e[c],c,t,e,r,n))return!1;return!0}case _N:return t.byteLength!==e.byteLength?!1:Va(new Uint8Array(t),new Uint8Array(e),r,n);case FN:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Va(new Uint8Array(t),new Uint8Array(e),r,n);case DN:return t.name===e.name&&t.message===e.message;case Qh:{if(!(Va(t.constructor,e.constructor,r,n)||tw(t)&&tw(e)))return!1;const c=[...Object.keys(t),...Jy(t)],f=[...Object.keys(e),...Jy(e)];if(c.length!==f.length)return!1;for(let u=0;u<c.length;u++){const l=c[u],h=t[l];if(!Object.hasOwn(e,l))return!1;const d=e[l];if(!Ca(h,d,l,t,e,r,n))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function VN(t,e){return HN(t,e,zN)}var KN=Object.defineProperty,rw=Object.getOwnPropertySymbols,GN=Object.prototype.hasOwnProperty,ZN=Object.prototype.propertyIsEnumerable,Yd=(t,e,r)=>e in t?KN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,nw=(t,e)=>{for(var r in e||(e={}))GN.call(e,r)&&Yd(t,r,e[r]);if(rw)for(var r of rw(e))ZN.call(e,r)&&Yd(t,r,e[r]);return t},Lt=(t,e,r)=>Yd(t,typeof e!="symbol"?e+"":e,r);let no=class extends vS{constructor(e,r,n,i=gn,s=void 0){super(e,r,n,i),this.core=e,this.logger=r,this.name=n,Lt(this,"map",new Map),Lt(this,"version",YC),Lt(this,"cached",[]),Lt(this,"initialized",!1),Lt(this,"getKey"),Lt(this,"storagePrefix",gn),Lt(this,"recentlyDeleted",[]),Lt(this,"recentlyDeletedLimit",200),Lt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ua(o)?this.map.set(this.getKey(o),o):rC(o)?this.map.set(o.id,o):nC(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Lt(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Lt(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Lt(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>VN(a[c],o[c]))):this.values)),Lt(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=nw(nw({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Lt(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Pt(r,this.name),this.storagePrefix=i,this.getKey=s}get context(){return tr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:i}=we("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:n}=we("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=we("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=we("NOT_INITIALIZED",this.name);throw new Error(e)}}};var WN=Object.defineProperty,YN=(t,e,r)=>e in t?WN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ce=(t,e,r)=>YN(t,typeof e!="symbol"?e+"":e,r);let XN=class{constructor(e,r){this.core=e,this.logger=r,ce(this,"name",eP),ce(this,"version",tP),ce(this,"events",new j0),ce(this,"pairings"),ce(this,"initialized",!1),ce(this,"storagePrefix",gn),ce(this,"ignoredPayloadTypes",[Qo]),ce(this,"registeredMethods",[]),ce(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),ce(this,"register",({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]}),ce(this,"create",async n=>{this.isInitialized();const i=qd(),s=await this.core.crypto.setSymKey(i),o=qa(Z.FIVE_MINUTES),a={protocol:JE},c={topic:s,expiry:o,relay:a,active:!1,methods:n==null?void 0:n.methods},f=Sy({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:n==null?void 0:n.methods});return this.events.emit(Os.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:n==null?void 0:n.transportType,internal:n==null?void 0:n.internal}),{topic:s,uri:f}}),ce(this,"pair",async n=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:n==null?void 0:n.uri,trace:[un.pairing_started]}});this.isValidPair(n,i);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:f}=By(n.uri);i.props.properties.topic=s,i.addTrace(un.pairing_uri_validation_success),i.addTrace(un.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(s)){if(u=this.pairings.get(s),i.addTrace(un.existing_pairing),u.active)throw i.setError(Pn.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);i.addTrace(un.pairing_not_expired)}const l=c||qa(Z.FIVE_MINUTES),h={topic:s,relay:a,expiry:l,active:!1,methods:f};this.core.expirer.set(s,l),await this.pairings.set(s,h),i.addTrace(un.store_new_pairing),n.activatePairing&&await this.activate({topic:s}),this.events.emit(Os.create,h),i.addTrace(un.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),i.addTrace(un.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(Pn.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(d){throw i.setError(Pn.subscribe_pairing_topic_failure),d}return i.addTrace(un.subscribe_pairing_topic_success),h}),ce(this,"activate",async({topic:n})=>{this.isInitialized();const i=qa(Z.FIVE_MINUTES);this.core.expirer.set(n,i),await this.pairings.update(n,{active:!0,expiry:i})}),ce(this,"ping",async n=>{this.isInitialized(),await this.isValidPing(n),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=n;if(this.pairings.keys.includes(i)){const s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=_D();this.events.once(Th("pairing_ping",s),({error:f})=>{f?c(f):a()}),await o()}}),ce(this,"updateExpiry",async({topic:n,expiry:i})=>{this.isInitialized(),await this.pairings.update(n,{expiry:i})}),ce(this,"updateMetadata",async({topic:n,metadata:i})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:i})}),ce(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),ce(this,"disconnect",async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:i}=n;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",Fa("USER_DISCONNECTED")),await this.deletePairing(i))}),ce(this,"formatUriFromPairing",n=>{this.isInitialized();const{topic:i,relay:s,expiry:o,methods:a}=n,c=this.core.crypto.keychain.get(i);return Sy({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),ce(this,"sendRequest",async(n,i,s)=>{const o=Mr(i,s),a=await this.core.crypto.encode(n,o),c=la[i].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id}),ce(this,"sendResult",async(n,i,s)=>{const o=Ja(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,f=la[c].res;await this.core.relayer.publish(i,a,f),await this.core.history.resolve(o)}),ce(this,"sendError",async(n,i,s)=>{const o=Cu(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,f=la[c]?la[c].res:la.unregistered_method.res;await this.core.relayer.publish(i,a,f),await this.core.history.resolve(o)}),ce(this,"deletePairing",async(n,i)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,Fa("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),i?Promise.resolve():this.core.expirer.del(n)])}),ce(this,"cleanup",async()=>{const n=this.pairings.getAll().filter(i=>Jg(i.expiry));await Promise.all(n.map(i=>this.deletePairing(i.topic)))}),ce(this,"onRelayEventRequest",async n=>{const{topic:i,payload:s}=n;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,s);default:return await this.onUnknownRpcMethodRequest(i,s)}}),ce(this,"onRelayEventResponse",async n=>{const{topic:i,payload:s}=n,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}}),ce(this,"onPairingPingRequest",async(n,i)=>{const{id:s}=i;try{this.isValidPing({topic:n}),await this.sendResult(s,n,!0),this.events.emit(Os.ping,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),ce(this,"onPairingPingResponse",(n,i)=>{const{id:s}=i;setTimeout(()=>{ln(i)?this.events.emit(Th("pairing_ping",s),{}):br(i)&&this.events.emit(Th("pairing_ping",s),{error:i.error})},500)}),ce(this,"onPairingDeleteRequest",async(n,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Os.delete,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),ce(this,"onUnknownRpcMethodRequest",async(n,i)=>{const{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=Fa("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,n,a),this.logger.error(a)}catch(a){await this.sendError(s,n,a),this.logger.error(a)}}),ce(this,"onUnknownRpcMethodResponse",n=>{this.registeredMethods.includes(n)||this.logger.error(Fa("WC_METHOD_UNSUPPORTED",n))}),ce(this,"isValidPair",(n,i)=>{var s;if(!Zh(n)){const{message:a}=we("MISSING_OR_INVALID",`pair() params: ${n}`);throw i.setError(Pn.malformed_pairing_uri),new Error(a)}if(!tC(n.uri)){const{message:a}=we("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw i.setError(Pn.malformed_pairing_uri),new Error(a)}const o=By(n==null?void 0:n.uri);if(!((s=o==null?void 0:o.relay)!=null&&s.protocol)){const{message:a}=we("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(Pn.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=we("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(Pn.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&Z.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){i.setError(Pn.pairing_expired);const{message:a}=we("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),ce(this,"isValidPing",async n=>{if(!Zh(n)){const{message:s}=we("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),ce(this,"isValidDisconnect",async n=>{if(!Zh(n)){const{message:s}=we("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),ce(this,"isValidPairingTopic",async n=>{if(!HE(n)){const{message:i}=we("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(i)}if(!this.pairings.keys.includes(n)){const{message:i}=we("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(i)}if(Jg(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:i}=we("EXPIRED",`pairing topic: ${n}`);throw new Error(i)}}),this.core=e,this.logger=Pt(r,this.name),this.pairings=new no(this.core,this.logger,this.name,this.storagePrefix)}get context(){return tr(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=we("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Ie.message,async e=>{const{topic:r,message:n,transportType:i}=e;if(this.pairings.keys.includes(r)&&i!==$e.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{const s=await this.core.crypto.decode(r,n);Ap(s)?(this.core.history.set(r,s),await this.onRelayEventRequest({topic:r,payload:s})):Pu(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id)),await this.core.relayer.messages.ack(r,n)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(yr.expired,async e=>{const{topic:r}=UD(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Os.expire,{topic:r}))})}};var JN=Object.defineProperty,QN=(t,e,r)=>e in t?JN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ye=(t,e,r)=>QN(t,typeof e!="symbol"?e+"":e,r);let eT=class extends wS{constructor(e,r){super(e,r),this.core=e,this.logger=r,Ye(this,"records",new Map),Ye(this,"events",new hr.EventEmitter),Ye(this,"name",rP),Ye(this,"version",nP),Ye(this,"cached",[]),Ye(this,"initialized",!1),Ye(this,"storagePrefix",gn),Ye(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ye(this,"set",(n,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:i,chainId:s}),this.records.has(i.id))return;const o={id:i.id,topic:n,request:{method:i.method,params:i.params||null},chainId:s,expiry:qa(Z.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Dr.created,o)}),Ye(this,"resolve",async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const i=await this.getRecord(n.id);typeof i.response>"u"&&(i.response=br(n)?{error:n.error}:{result:n.result},this.records.set(i.id,i),this.persist(),this.events.emit(Dr.updated,i))}),Ye(this,"get",async(n,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:i}),await this.getRecord(i))),Ye(this,"delete",(n,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===n){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(Dr.deleted,s)}}),this.persist()}),Ye(this,"exists",async(n,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===n:!1)),Ye(this,"on",(n,i)=>{this.events.on(n,i)}),Ye(this,"once",(n,i)=>{this.events.once(n,i)}),Ye(this,"off",(n,i)=>{this.events.off(n,i)}),Ye(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=Pt(r,this.name)}get context(){return tr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:Mr(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:n}=we("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Dr.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=we("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Dr.created,e=>{const r=Dr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(Dr.updated,e=>{const r=Dr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(Dr.deleted,e=>{const r=Dr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(Qs.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{Z.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(Dr.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=we("NOT_INITIALIZED",this.name);throw new Error(e)}}};var tT=Object.defineProperty,rT=(t,e,r)=>e in t?tT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,dt=(t,e,r)=>rT(t,typeof e!="symbol"?e+"":e,r);let nT=class extends $S{constructor(e,r){super(e,r),this.core=e,this.logger=r,dt(this,"expirations",new Map),dt(this,"events",new hr.EventEmitter),dt(this,"name",iP),dt(this,"version",sP),dt(this,"cached",[]),dt(this,"initialized",!1),dt(this,"storagePrefix",gn),dt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),dt(this,"has",n=>{try{const i=this.formatTarget(n);return typeof this.getExpiration(i)<"u"}catch{return!1}}),dt(this,"set",(n,i)=>{this.isInitialized();const s=this.formatTarget(n),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(yr.created,{target:s,expiration:o})}),dt(this,"get",n=>{this.isInitialized();const i=this.formatTarget(n);return this.getExpiration(i)}),dt(this,"del",n=>{if(this.isInitialized(),this.has(n)){const i=this.formatTarget(n),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(yr.deleted,{target:i,expiration:s})}}),dt(this,"on",(n,i)=>{this.events.on(n,i)}),dt(this,"once",(n,i)=>{this.events.once(n,i)}),dt(this,"off",(n,i)=>{this.events.off(n,i)}),dt(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=Pt(r,this.name)}get context(){return tr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return DD(e);if(typeof e=="number")return FD(e);const{message:r}=we("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(yr.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=we("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:n}=we("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(n),new Error(n)}return r}checkExpiry(e,r){const{expiry:n}=r;Z.toMiliseconds(n)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(yr.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Qs.pulse,()=>this.checkExpirations()),this.events.on(yr.created,e=>{const r=yr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(yr.expired,e=>{const r=yr.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(yr.deleted,e=>{const r=yr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=we("NOT_INITIALIZED",this.name);throw new Error(e)}}};var iT=Object.defineProperty,sT=(t,e,r)=>e in t?iT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,De=(t,e,r)=>sT(t,typeof e!="symbol"?e+"":e,r);class oT extends AS{constructor(e,r,n){super(e,r,n),this.core=e,this.logger=r,this.store=n,De(this,"name",oP),De(this,"abortController"),De(this,"isDevEnv"),De(this,"verifyUrlV3",cP),De(this,"storagePrefix",gn),De(this,"version",XE),De(this,"publicKey"),De(this,"fetchPromise"),De(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&Z.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),De(this,"register",async i=>{if(!pc()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const f=ur.getDocument(),u=this.startAbortTimer(Z.ONE_SECOND*5),l=await new Promise((h,d)=>{const p=()=>{window.removeEventListener("message",m),f.body.removeChild(w),d("attestation aborted")};this.abortController.signal.addEventListener("abort",p);const w=f.createElement("iframe");w.src=c,w.style.display="none",w.addEventListener("error",p,{signal:this.abortController.signal});const m=D=>{if(D.data&&typeof D.data=="string")try{const C=JSON.parse(D.data);if(C.type==="verify_attestation"){if(_d(C.attestation).payload.id!==o)return;clearInterval(u),f.body.removeChild(w),this.abortController.signal.removeEventListener("abort",p),window.removeEventListener("message",m),h(C.attestation===null?"":C.attestation)}}catch(C){this.logger.warn(C)}};f.body.appendChild(w),window.addEventListener("message",m,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",l),l}catch(f){this.logger.warn(f)}return""}),De(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=i;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(_d(s).payload.id!==a)return;const f=await this.isValidJwtAttestation(s);if(f){if(!f.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return f}}if(!o)return;const c=this.getVerifyUrl(i==null?void 0:i.verifyUrl);return this.fetchAttestation(o,c)}),De(this,"fetchAttestation",async(i,s)=>{this.logger.debug(`resolving attestation: ${i} from url: ${s}`);const o=this.startAbortTimer(Z.ONE_SECOND*5),a=await fetch(`${s}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),De(this,"getVerifyUrl",i=>{let s=i||Ha;return fP.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${Ha}`),s=Ha),s}),De(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(Z.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await s.json()}catch(i){this.logger.warn(i)}}),De(this,"persistPublicKey",async i=>{this.logger.debug("persisting public key to local storage",i),await this.store.setItem(this.storeKey,i),this.publicKey=i}),De(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),De(this,"isValidJwtAttestation",async i=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(i,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),De(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),De(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),De(this,"validateAttestation",(i,s)=>{const o=MU(i,s.publicKey),a={hasExpired:Z.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Pt(r,this.name),this.abortController=new AbortController,this.isDevEnv=Z3(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return tr(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),Z.toMiliseconds(e))}}var aT=Object.defineProperty,cT=(t,e,r)=>e in t?aT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,iw=(t,e,r)=>cT(t,typeof e!="symbol"?e+"":e,r);let fT=class extends IS{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,iw(this,"context",uP),iw(this,"registerDeviceToken",async n=>{const{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=n,c=`${hP}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})}),this.logger=Pt(r,this.context)}};var uT=Object.defineProperty,sw=Object.getOwnPropertySymbols,hT=Object.prototype.hasOwnProperty,lT=Object.prototype.propertyIsEnumerable,Xd=(t,e,r)=>e in t?uT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ya=(t,e)=>{for(var r in e||(e={}))hT.call(e,r)&&Xd(t,r,e[r]);if(sw)for(var r of sw(e))lT.call(e,r)&&Xd(t,r,e[r]);return t},ke=(t,e,r)=>Xd(t,typeof e!="symbol"?e+"":e,r);let dT=class extends BS{constructor(e,r,n=!0){super(e,r,n),this.core=e,this.logger=r,ke(this,"context",dP),ke(this,"storagePrefix",gn),ke(this,"storageVersion",lP),ke(this,"events",new Map),ke(this,"shouldPersist",!1),ke(this,"init",async()=>{if(!Z3())try{const i={eventId:Qg(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:K3(this.core.relayer.protocol,this.core.relayer.version,zd)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),ke(this,"createEvent",i=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=i,f=Qg(),u=this.core.projectId||"",l=Date.now(),h=ya({eventId:f,timestamp:l,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(f));return this.telemetryEnabled&&(this.events.set(f,h),this.shouldPersist=!0),h}),ke(this,"getEvent",i=>{const{eventId:s,topic:o}=i;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return ya(ya({},a),this.setMethods(a.eventId))}),ke(this,"deleteEvent",i=>{const{eventId:s}=i;this.events.delete(s),this.shouldPersist=!0}),ke(this,"setEventListeners",()=>{this.core.heartbeat.on(Qs.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{Z.fromMiliseconds(Date.now())-Z.fromMiliseconds(i.timestamp)>pP&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),ke(this,"setMethods",i=>({addTrace:s=>this.addTrace(i,s),setError:s=>this.setError(i,s)})),ke(this,"addTrace",(i,s)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(s),this.events.set(i,o),this.shouldPersist=!0)}),ke(this,"setError",(i,s)=>{const o=this.events.get(i);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),ke(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),ke(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(s=>{this.events.set(s.eventId,ya(ya({},s),this.setMethods(s.eventId)))})}catch(i){this.logger.warn(i)}}),ke(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[s,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const s of i)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),ke(this,"sendEvent",async i=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${gP}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${zd}${s}`,{method:"POST",body:JSON.stringify(i)})}),ke(this,"getAppDomain",()=>ID().url),this.logger=Pt(r,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}};var pT=Object.defineProperty,ow=Object.getOwnPropertySymbols,gT=Object.prototype.hasOwnProperty,yT=Object.prototype.propertyIsEnumerable,Jd=(t,e,r)=>e in t?pT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,aw=(t,e)=>{for(var r in e||(e={}))gT.call(e,r)&&Jd(t,r,e[r]);if(ow)for(var r of ow(e))yT.call(e,r)&&Jd(t,r,e[r]);return t},xe=(t,e,r)=>Jd(t,typeof e!="symbol"?e+"":e,r);let wT=class l8 extends dS{constructor(e){var r;super(e),xe(this,"protocol",YE),xe(this,"version",XE),xe(this,"name",Md),xe(this,"relayUrl"),xe(this,"projectId"),xe(this,"customStoragePrefix"),xe(this,"events",new hr.EventEmitter),xe(this,"logger"),xe(this,"heartbeat"),xe(this,"relayer"),xe(this,"crypto"),xe(this,"storage"),xe(this,"history"),xe(this,"expirer"),xe(this,"pairing"),xe(this,"verify"),xe(this,"echoClient"),xe(this,"linkModeSupportedApps"),xe(this,"eventClient"),xe(this,"initialized",!1),xe(this,"logChunkController"),xe(this,"on",(a,c)=>this.events.on(a,c)),xe(this,"once",(a,c)=>this.events.once(a,c)),xe(this,"off",(a,c)=>this.events.off(a,c)),xe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),xe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:f})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:$e.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:f})});const n=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||QE,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=Eu({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:NC.logger,name:Md}),{logger:s,chunkLoggerController:o}=uS({opts:i,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Pt(s,this.name),this.heartbeat=new dB,this.crypto=new HR(this,this.logger,e==null?void 0:e.keychain),this.history=new eT(this,this.logger),this.expirer=new nT(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new GB(aw(aw({},TC),e==null?void 0:e.storageOptions)),this.relayer=new wN({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new XN(this,this.logger),this.verify=new oT(this,this.logger,this.storage),this.echoClient=new fT(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new dT(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new l8(e);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(XC,n),r}get context(){return tr(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(ky,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(ky)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,n=`${r}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[n]=e}catch(n){console.warn("Failed to set global WalletConnect core",n)}}isGlobalCoreDisabled(){try{return typeof It<"u"&&RC.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const bT=wT;var mT=Object.defineProperty,ET=(t,e,r)=>e in t?mT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,cw=(t,e,r)=>ET(t,typeof e!="symbol"?e+"":e,r);let vT=class{constructor(e){this.opts=e,cw(this,"protocol","wc"),cw(this,"version",2)}},xT=class{constructor(e){this.client=e}};const $T="0.1.1";function AT(){return $T}class Ae extends Error{constructor(e,r={}){const n=(()=>{var c;if(r.cause instanceof Ae){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:(c=r.cause)!=null&&c.message?r.cause.message:r.details})(),i=r.cause instanceof Ae&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${i??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...n||i?["",n?`Details: ${n}`:void 0,i?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${AT()}`}),this.cause=r.cause,this.details=n,this.docs=o,this.docsPath=i,this.shortMessage=e}walk(e){return d8(this,e)}}function d8(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?d8(t.cause,e):e?null:t}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Bp=BigInt(0),Qd=BigInt(1);function mc(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Sp(t){if(!mc(t))throw new Error("Uint8Array expected")}function Qa(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function Zc(t){const e=t.toString(16);return e.length&1?"0"+e:e}function p8(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Bp:BigInt("0x"+t)}const g8=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",IT=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ec(t){if(Sp(t),g8)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=IT[t[r]];return e}const An={_0:48,_9:57,A:65,F:70,a:97,f:102};function fw(t){if(t>=An._0&&t<=An._9)return t-An._0;if(t>=An.A&&t<=An.F)return t-(An.A-10);if(t>=An.a&&t<=An.f)return t-(An.a-10)}function Jf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(g8)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=fw(t.charCodeAt(s)),a=fw(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function Gs(t){return p8(ec(t))}function y8(t){return Sp(t),p8(ec(Uint8Array.from(t).reverse()))}function Ec(t,e){return Jf(t.toString(16).padStart(e*2,"0"))}function w8(t,e){return Ec(t,e).reverse()}function wr(t,e,r){let n;if(typeof e=="string")try{n=Jf(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(mc(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function Qf(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Sp(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const el=t=>typeof t=="bigint"&&Bp<=t;function Op(t,e,r){return el(t)&&el(e)&&el(r)&&e<=t&&t<r}function No(t,e,r,n){if(!Op(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function BT(t){let e;for(e=0;t>Bp;t>>=Qd,e+=1);return e}const Nu=t=>(Qd<<BigInt(t))-Qd,tl=t=>new Uint8Array(t),uw=t=>Uint8Array.from(t);function ST(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=tl(t),i=tl(t),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...l)=>r(i,n,...l),c=(l=tl(0))=>{i=a(uw([0]),l),n=a(),l.length!==0&&(i=a(uw([1]),l),n=a())},f=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let l=0;const h=[];for(;l<e;){n=a();const d=n.slice();h.push(d),l+=n.length}return Qf(...h)};return(l,h)=>{o(),c(l);let d;for(;!(d=h(f()));)c();return o(),d}}const OT={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||mc(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Tu(t,e,r={}){const n=(i,s,o)=>{const a=OT[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function hw(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}function _T(t,e){if(gw(t)>e)throw new YT({givenSize:gw(t),maxSize:e})}const In={zero:48,nine:57,A:65,F:70,a:97,f:102};function lw(t){if(t>=In.zero&&t<=In.nine)return t-In.zero;if(t>=In.A&&t<=In.F)return t-(In.A-10);if(t>=In.a&&t<=In.f)return t-(In.a-10)}function DT(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;if(t.length>n)throw new XT({size:t.length,targetSize:n,type:"Bytes"});const i=new Uint8Array(n);for(let s=0;s<n;s++){const o=r==="right";i[o?s:n-s-1]=t[o?s:t.length-s-1]}return i}function b8(t,e){if(ss(t)>e)throw new jT({givenSize:ss(t),maxSize:e})}function FT(t,e){if(typeof e=="number"&&e>0&&e>ss(t)-1)throw new v8({offset:e,position:"start",size:ss(t)})}function UT(t,e,r){if(typeof e=="number"&&typeof r=="number"&&ss(t)!==r-e)throw new v8({offset:r,position:"end",size:ss(t)})}function m8(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;const i=t.replace("0x","");if(i.length>n*2)throw new qT({size:Math.ceil(i.length/2),targetSize:n,type:"Hex"});return`0x${i[r==="right"?"padEnd":"padStart"](n*2,"0")}`}const CT="#__bigint";function _p(t,e,r){return JSON.stringify(t,(n,i)=>typeof i=="bigint"?i.toString()+CT:i,r)}const PT=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function RT(t,e={}){const{strict:r=!1}=e;if(!t)throw new dw(t);if(typeof t!="string")throw new dw(t);if(r&&!/^0x[0-9a-fA-F]*$/.test(t))throw new pw(t);if(!t.startsWith("0x"))throw new pw(t)}function NT(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function Dp(t){return t instanceof Uint8Array?eu(t):Array.isArray(t)?eu(new Uint8Array(t)):t}function eu(t,e={}){let r="";for(let i=0;i<t.length;i++)r+=PT[t[i]];const n=`0x${r}`;return typeof e.size=="number"?(b8(n,e.size),E8(n,e.size)):n}function rl(t,e={}){const{signed:r,size:n}=e,i=BigInt(t);let s;n?r?s=(1n<<BigInt(n)*8n-1n)-1n:s=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&i>s||i<o){const f=typeof t=="bigint"?"n":"";throw new kT({max:s?`${s}${f}`:void 0,min:`${o}${f}`,signed:r,size:n,value:`${t}${f}`})}const c=`0x${(r&&i<0?(1n<<BigInt(n*8))+BigInt(i):i).toString(16)}`;return n?TT(c,n):c}function TT(t,e){return m8(t,{dir:"left",size:e})}function E8(t,e){return m8(t,{dir:"right",size:e})}function Tn(t,e,r,n={}){const{strict:i}=n;FT(t,e);const s=`0x${t.replace("0x","").slice((e??0)*2,(r??t.length)*2)}`;return i&&UT(s,e,r),s}function ss(t){return Math.ceil((t.length-2)/2)}function LT(t,e={}){const{strict:r=!1}=e;try{return RT(t,{strict:r}),!0}catch{return!1}}class kT extends Ae{constructor({max:e,min:r,signed:n,size:i,value:s}){super(`Number \`${s}\` is not in safe${i?` ${i*8}-bit`:""}${n?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class dw extends Ae{constructor(e){super(`Value \`${typeof e=="object"?_p(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class pw extends Ae{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let jT=class extends Ae{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}};class v8 extends Ae{constructor({offset:e,position:r,size:n}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}let qT=class extends Ae{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const MT=new TextEncoder;function zT(t){if(!(t instanceof Uint8Array)){if(!t)throw new Wc(t);if(typeof t!="object")throw new Wc(t);if(!("BYTES_PER_ELEMENT"in t))throw new Wc(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new Wc(t)}}function HT(t){return t instanceof Uint8Array?t:typeof t=="string"?KT(t):VT(t)}function VT(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function KT(t,e={}){const{size:r}=e;let n=t;r&&(b8(t,r),n=E8(t,r));let i=n.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const f=lw(i.charCodeAt(c++)),u=lw(i.charCodeAt(c++));if(f===void 0||u===void 0)throw new Ae(`Invalid byte sequence ("${i[c-2]}${i[c-1]}" in "${i}").`);o[a]=f*16+u}return o}function GT(t,e={}){const{size:r}=e,n=MT.encode(t);return typeof r=="number"?(_T(n,r),ZT(n,r)):n}function ZT(t,e){return DT(t,{dir:"right",size:e})}function gw(t){return t.length}function WT(t){try{return zT(t),!0}catch{return!1}}class Wc extends Ae{constructor(e){super(`Value \`${typeof e=="object"?_p(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class YT extends Ae{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class XT extends Ae{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function x8(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,n=j4(HT(t));return r==="Bytes"?n:eu(n)}class JT extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}const QT={checksum:new JT(8192)},nl=QT.checksum;function $8(t,e={}){const{compressed:r}=e,{prefix:n,x:i,y:s}=t;if(r===!1||typeof i=="bigint"&&typeof s=="bigint"){if(n!==4)throw new yw({prefix:n,cause:new sL});return}if(r===!0||typeof i=="bigint"&&typeof s>"u"){if(n!==3&&n!==2)throw new yw({prefix:n,cause:new iL});return}throw new nL({publicKey:t})}function eL(t){const e=(()=>{if(LT(t))return A8(t);if(WT(t))return tL(t);const{prefix:r,x:n,y:i}=t;return typeof n=="bigint"&&typeof i=="bigint"?{prefix:r??4,x:n,y:i}:{prefix:r,x:n}})();return $8(e),e}function tL(t){return A8(eu(t))}function A8(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new oL({publicKey:t});if(t.length===130){const n=BigInt(Tn(t,0,32)),i=BigInt(Tn(t,32,64));return{prefix:4,x:n,y:i}}if(t.length===132){const n=Number(Tn(t,0,1)),i=BigInt(Tn(t,1,33)),s=BigInt(Tn(t,33,65));return{prefix:n,x:i,y:s}}const e=Number(Tn(t,0,1)),r=BigInt(Tn(t,1,33));return{prefix:e,x:r}}function rL(t,e={}){$8(t);const{prefix:r,x:n,y:i}=t,{includePrefix:s=!0}=e;return NT(s?rl(r,{size:1}):"0x",rl(n,{size:32}),typeof i=="bigint"?rl(i,{size:32}):"0x")}class nL extends Ae{constructor({publicKey:e}){super(`Value \`${_p(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class yw extends Ae{constructor({prefix:e,cause:r}){super(`Prefix "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class iL extends Ae{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class sL extends Ae{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let oL=class extends Ae{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${ss(Dp(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const aL=/^0x[a-fA-F0-9]{40}$/;function I8(t,e={}){const{strict:r=!0}=e;if(!aL.test(t))throw new ww({address:t,cause:new uL});if(r){if(t.toLowerCase()===t)return;if(B8(t)!==t)throw new ww({address:t,cause:new hL})}}function B8(t){if(nl.has(t))return nl.get(t);I8(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=x8(GT(e),{as:"Bytes"}),n=e.split("");for(let s=0;s<40;s+=2)r[s>>1]>>4>=8&&n[s]&&(n[s]=n[s].toUpperCase()),(r[s>>1]&15)>=8&&n[s+1]&&(n[s+1]=n[s+1].toUpperCase());const i=`0x${n.join("")}`;return nl.set(t,i),i}function cL(t,e={}){const{checksum:r=!1}=e;return I8(t),r?B8(t):t}function fL(t,e={}){const r=x8(`0x${rL(t).slice(4)}`).substring(26);return cL(`0x${r}`,e)}class ww extends Ae{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class uL extends Ae{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class hL extends Ae{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Xt=BigInt(0),Ft=BigInt(1),Ls=BigInt(2),lL=BigInt(3),S8=BigInt(4),O8=BigInt(5),_8=BigInt(8);function Vt(t,e){const r=t%e;return r>=Xt?r:e+r}function pr(t,e,r){let n=t;for(;e-- >Xt;)n*=n,n%=r;return n}function e0(t,e){if(t===Xt)throw new Error("invert: expected non-zero number");if(e<=Xt)throw new Error("invert: expected positive modulus, got "+e);let r=Vt(t,e),n=e,i=Xt,s=Ft;for(;r!==Xt;){const a=n/r,c=n%r,f=i-s*a;n=r,r=c,i=s,s=f}if(n!==Ft)throw new Error("invert: does not exist");return Vt(i,e)}function D8(t,e){const r=(t.ORDER+Ft)/S8,n=t.pow(e,r);if(!t.eql(t.sqr(n),e))throw new Error("Cannot find square root");return n}function dL(t,e){const r=(t.ORDER-O8)/_8,n=t.mul(e,Ls),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,Ls),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function pL(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Ft,r=0;for(;e%Ls===Xt;)e/=Ls,r++;let n=Ls;const i=Fp(t);for(;bw(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return D8;let s=i.pow(n,e);const o=(e+Ft)/Ls;return function(c,f){if(c.is0(f))return f;if(bw(c,f)!==1)throw new Error("Cannot find square root");let u=r,l=c.mul(c.ONE,s),h=c.pow(f,e),d=c.pow(f,o);for(;!c.eql(h,c.ONE);){if(c.is0(h))return c.ZERO;let p=1,w=c.sqr(h);for(;!c.eql(w,c.ONE);)if(p++,w=c.sqr(w),p===u)throw new Error("Cannot find square root");const m=Ft<<BigInt(u-p-1),D=c.pow(l,m);u=p,l=c.sqr(D),h=c.mul(h,l),d=c.mul(d,D)}return d}}function gL(t){return t%S8===lL?D8:t%_8===O8?dL:pL(t)}const yL=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function wL(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=yL.reduce((n,i)=>(n[i]="function",n),e);return Tu(t,r)}function bL(t,e,r){if(r<Xt)throw new Error("invalid exponent, negatives unsupported");if(r===Xt)return t.ONE;if(r===Ft)return e;let n=t.ONE,i=e;for(;r>Xt;)r&Ft&&(n=t.mul(n,i)),i=t.sqr(i),r>>=Ft;return n}function F8(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),s),n}function bw(t,e){const r=(t.ORDER-Ft)/Ls,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function U8(t,e){e!==void 0&&q4(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Fp(t,e,r=!1,n={}){if(t<=Xt)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=U8(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:Nu(i),ZERO:Xt,ONE:Ft,create:c=>Vt(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Xt<=c&&c<t},is0:c=>c===Xt,isOdd:c=>(c&Ft)===Ft,neg:c=>Vt(-c,t),eql:(c,f)=>c===f,sqr:c=>Vt(c*c,t),add:(c,f)=>Vt(c+f,t),sub:(c,f)=>Vt(c-f,t),mul:(c,f)=>Vt(c*f,t),pow:(c,f)=>bL(a,c,f),div:(c,f)=>Vt(c*e0(f,t),t),sqrN:c=>c*c,addN:(c,f)=>c+f,subN:(c,f)=>c-f,mulN:(c,f)=>c*f,inv:c=>e0(c,t),sqrt:n.sqrt||(c=>(o||(o=gL(t)),o(a,c))),toBytes:c=>r?w8(c,s):Ec(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?y8(c):Gs(c)},invertBatch:c=>F8(a,c),cmov:(c,f,u)=>u?f:c});return Object.freeze(a)}function C8(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function P8(t){const e=C8(t);return e+Math.ceil(e/2)}function mL(t,e,r=!1){const n=t.length,i=C8(e),s=P8(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?y8(t):Gs(t),a=Vt(o,e-Ft)+Ft;return r?w8(a,i):Ec(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const mw=BigInt(0),t0=BigInt(1);function il(t,e){const r=e.negate();return t?r:e}function R8(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function sl(t,e){R8(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=Nu(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function Ew(t,e,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(t&i),c=t>>o;a>n&&(a-=s,c+=t0);const f=e*n,u=f+Math.abs(a)-1,l=a===0,h=a<0,d=e%2!==0;return{nextN:c,offset:u,isZero:l,isNeg:h,isNegF:d,offsetF:f}}function EL(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function vL(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const ol=new WeakMap,N8=new WeakMap;function al(t){return N8.get(t)||1}function xL(t,e){return{constTimeNegate:il,hasPrecomputes(r){return al(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>mw;)n&t0&&(i=i.add(s)),s=s.double(),n>>=t0;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=sl(n,e),o=[];let a=r,c=a;for(let f=0;f<i;f++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){let s=t.ZERO,o=t.BASE;const a=sl(r,e);for(let c=0;c<a.windows;c++){const{nextN:f,offset:u,isZero:l,isNeg:h,isNegF:d,offsetF:p}=Ew(i,c,a);i=f,l?o=o.add(il(d,n[p])):s=s.add(il(h,n[u]))}return{p:s,f:o}},wNAFUnsafe(r,n,i,s=t.ZERO){const o=sl(r,e);for(let a=0;a<o.windows&&i!==mw;a++){const{nextN:c,offset:f,isZero:u,isNeg:l}=Ew(i,a,o);if(i=c,!u){const h=n[f];s=s.add(l?h.negate():h)}}return s},getPrecomputes(r,n,i){let s=ol.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&ol.set(n,i(s))),s},wNAFCached(r,n,i){const s=al(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=al(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){R8(n,e),N8.set(r,n),ol.delete(r)}}}function $L(t,e,r,n){EL(r,t),vL(n,e);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=BT(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const f=Nu(c),u=new Array(Number(f)+1).fill(o),l=Math.floor((e.BITS-1)/c)*c;let h=o;for(let d=l;d>=0;d-=c){u.fill(o);for(let w=0;w<s;w++){const m=n[w],D=Number(m>>BigInt(d)&f);u[D]=u[D].add(r[w])}let p=o;for(let w=u.length-1,m=o;w>0;w--)m=m.add(u[w]),p=p.add(m);if(h=h.add(p),d!==0)for(let w=0;w<c;w++)h=h.double()}return h}function T8(t){return wL(t.Fp),Tu(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...U8(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function vw(t){t.lowS!==void 0&&Qa("lowS",t.lowS),t.prehash!==void 0&&Qa("prehash",t.prehash)}function AL(t){const e=T8(t);Tu(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:n,a:i}=e;if(r){if(!n.eql(i,n.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class IL extends Error{constructor(e=""){super(e)}}const jn={Err:IL,_tlv:{encode:(t,e)=>{const{Err:r}=jn;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=Zc(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?Zc(i.length/2|128):"";return Zc(t)+s+i+e},decode(t,e){const{Err:r}=jn;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const f=e.subarray(n,n+c);if(f.length!==c)throw new r("tlv.decode: length bytes not complete");if(f[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of f)o=o<<8|u;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=jn;if(t<zn)throw new e("integer: negative integers are not allowed");let r=Zc(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=jn;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Gs(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=jn,i=wr("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:f,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(f)}},hexFromSig(t){const{_tlv:e,_int:r}=jn,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}};function cl(t,e){return ec(Ec(t,e))}const zn=BigInt(0),qe=BigInt(1);BigInt(2);const fl=BigInt(3),BL=BigInt(4);function SL(t){const e=AL(t),{Fp:r}=e,n=Fp(e.n,e.nBitLength),i=e.toBytes||((b,B,F)=>{const _=B.toAffine();return Qf(Uint8Array.from([4]),r.toBytes(_.x),r.toBytes(_.y))}),s=e.fromBytes||(b=>{const B=b.subarray(1),F=r.fromBytes(B.subarray(0,r.BYTES)),_=r.fromBytes(B.subarray(r.BYTES,2*r.BYTES));return{x:F,y:_}});function o(b){const{a:B,b:F}=e,_=r.sqr(b),N=r.mul(_,b);return r.add(r.add(N,r.mul(b,B)),F)}function a(b,B){const F=r.sqr(B),_=o(b);return r.eql(F,_)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,fl),BL),f=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,f)))throw new Error("bad curve params: a or b");function u(b){return Op(b,qe,e.n)}function l(b){const{allowedPrivateKeyLengths:B,nByteLength:F,wrapPrivateKey:_,n:N}=e;if(B&&typeof b!="bigint"){if(mc(b)&&(b=ec(b)),typeof b!="string"||!B.includes(b.length))throw new Error("invalid private key");b=b.padStart(F*2,"0")}let P;try{P=typeof b=="bigint"?b:Gs(wr("private key",b,F))}catch{throw new Error("invalid private key, expected hex or "+F+" bytes, got "+typeof b)}return _&&(P=Vt(P,N)),No("private key",P,qe,N),P}function h(b){if(!(b instanceof w))throw new Error("ProjectivePoint expected")}const d=hw((b,B)=>{const{px:F,py:_,pz:N}=b;if(r.eql(N,r.ONE))return{x:F,y:_};const P=b.is0();B==null&&(B=P?r.ONE:r.inv(N));const S=r.mul(F,B),T=r.mul(_,B),L=r.mul(N,B);if(P)return{x:r.ZERO,y:r.ZERO};if(!r.eql(L,r.ONE))throw new Error("invZ was invalid");return{x:S,y:T}}),p=hw(b=>{if(b.is0()){if(e.allowInfinityPoint&&!r.is0(b.py))return;throw new Error("bad point: ZERO")}const{x:B,y:F}=b.toAffine();if(!r.isValid(B)||!r.isValid(F))throw new Error("bad point: x or y not FE");if(!a(B,F))throw new Error("bad point: equation left != right");if(!b.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class w{constructor(B,F,_){if(B==null||!r.isValid(B))throw new Error("x required");if(F==null||!r.isValid(F)||r.is0(F))throw new Error("y required");if(_==null||!r.isValid(_))throw new Error("z required");this.px=B,this.py=F,this.pz=_,Object.freeze(this)}static fromAffine(B){const{x:F,y:_}=B||{};if(!B||!r.isValid(F)||!r.isValid(_))throw new Error("invalid affine point");if(B instanceof w)throw new Error("projective point not allowed");const N=P=>r.eql(P,r.ZERO);return N(F)&&N(_)?w.ZERO:new w(F,_,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(B){const F=F8(r,B.map(_=>_.pz));return B.map((_,N)=>_.toAffine(F[N])).map(w.fromAffine)}static fromHex(B){const F=w.fromAffine(s(wr("pointHex",B)));return F.assertValidity(),F}static fromPrivateKey(B){return w.BASE.multiply(l(B))}static msm(B,F){return $L(w,n,B,F)}_setWindowSize(B){C.setWindowSize(this,B)}assertValidity(){p(this)}hasEvenY(){const{y:B}=this.toAffine();if(r.isOdd)return!r.isOdd(B);throw new Error("Field doesn't support isOdd")}equals(B){h(B);const{px:F,py:_,pz:N}=this,{px:P,py:S,pz:T}=B,L=r.eql(r.mul(F,T),r.mul(P,N)),O=r.eql(r.mul(_,T),r.mul(S,N));return L&&O}negate(){return new w(this.px,r.neg(this.py),this.pz)}double(){const{a:B,b:F}=e,_=r.mul(F,fl),{px:N,py:P,pz:S}=this;let T=r.ZERO,L=r.ZERO,O=r.ZERO,x=r.mul(N,N),$=r.mul(P,P),g=r.mul(S,S),y=r.mul(N,P);return y=r.add(y,y),O=r.mul(N,S),O=r.add(O,O),T=r.mul(B,O),L=r.mul(_,g),L=r.add(T,L),T=r.sub($,L),L=r.add($,L),L=r.mul(T,L),T=r.mul(y,T),O=r.mul(_,O),g=r.mul(B,g),y=r.sub(x,g),y=r.mul(B,y),y=r.add(y,O),O=r.add(x,x),x=r.add(O,x),x=r.add(x,g),x=r.mul(x,y),L=r.add(L,x),g=r.mul(P,S),g=r.add(g,g),x=r.mul(g,y),T=r.sub(T,x),O=r.mul(g,$),O=r.add(O,O),O=r.add(O,O),new w(T,L,O)}add(B){h(B);const{px:F,py:_,pz:N}=this,{px:P,py:S,pz:T}=B;let L=r.ZERO,O=r.ZERO,x=r.ZERO;const $=e.a,g=r.mul(e.b,fl);let y=r.mul(F,P),v=r.mul(_,S),I=r.mul(N,T),E=r.add(F,_),A=r.add(P,S);E=r.mul(E,A),A=r.add(y,v),E=r.sub(E,A),A=r.add(F,N);let U=r.add(P,T);return A=r.mul(A,U),U=r.add(y,I),A=r.sub(A,U),U=r.add(_,N),L=r.add(S,T),U=r.mul(U,L),L=r.add(v,I),U=r.sub(U,L),x=r.mul($,A),L=r.mul(g,I),x=r.add(L,x),L=r.sub(v,x),x=r.add(v,x),O=r.mul(L,x),v=r.add(y,y),v=r.add(v,y),I=r.mul($,I),A=r.mul(g,A),v=r.add(v,I),I=r.sub(y,I),I=r.mul($,I),A=r.add(A,I),y=r.mul(v,A),O=r.add(O,y),y=r.mul(U,A),L=r.mul(E,L),L=r.sub(L,y),y=r.mul(E,v),x=r.mul(U,x),x=r.add(x,y),new w(L,O,x)}subtract(B){return this.add(B.negate())}is0(){return this.equals(w.ZERO)}wNAF(B){return C.wNAFCached(this,B,w.normalizeZ)}multiplyUnsafe(B){const{endo:F,n:_}=e;No("scalar",B,zn,_);const N=w.ZERO;if(B===zn)return N;if(this.is0()||B===qe)return this;if(!F||C.hasPrecomputes(this))return C.wNAFCachedUnsafe(this,B,w.normalizeZ);let{k1neg:P,k1:S,k2neg:T,k2:L}=F.splitScalar(B),O=N,x=N,$=this;for(;S>zn||L>zn;)S&qe&&(O=O.add($)),L&qe&&(x=x.add($)),$=$.double(),S>>=qe,L>>=qe;return P&&(O=O.negate()),T&&(x=x.negate()),x=new w(r.mul(x.px,F.beta),x.py,x.pz),O.add(x)}multiply(B){const{endo:F,n:_}=e;No("scalar",B,qe,_);let N,P;if(F){const{k1neg:S,k1:T,k2neg:L,k2:O}=F.splitScalar(B);let{p:x,f:$}=this.wNAF(T),{p:g,f:y}=this.wNAF(O);x=C.constTimeNegate(S,x),g=C.constTimeNegate(L,g),g=new w(r.mul(g.px,F.beta),g.py,g.pz),N=x.add(g),P=$.add(y)}else{const{p:S,f:T}=this.wNAF(B);N=S,P=T}return w.normalizeZ([N,P])[0]}multiplyAndAddUnsafe(B,F,_){const N=w.BASE,P=(T,L)=>L===zn||L===qe||!T.equals(N)?T.multiplyUnsafe(L):T.multiply(L),S=P(this,F).add(P(B,_));return S.is0()?void 0:S}toAffine(B){return d(this,B)}isTorsionFree(){const{h:B,isTorsionFree:F}=e;if(B===qe)return!0;if(F)return F(w,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:B,clearCofactor:F}=e;return B===qe?this:F?F(w,this):this.multiplyUnsafe(e.h)}toRawBytes(B=!0){return Qa("isCompressed",B),this.assertValidity(),i(w,this,B)}toHex(B=!0){return Qa("isCompressed",B),ec(this.toRawBytes(B))}}w.BASE=new w(e.Gx,e.Gy,r.ONE),w.ZERO=new w(r.ZERO,r.ONE,r.ZERO);const{endo:m,nBitLength:D}=e,C=xL(w,m?Math.ceil(D/2):D);return{CURVE:e,ProjectivePoint:w,normPrivateKeyToScalar:l,weierstrassEquation:o,isWithinCurveOrder:u}}function OL(t){const e=T8(t);return Tu(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function _L(t){const e=OL(t),{Fp:r,n,nByteLength:i,nBitLength:s}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(g){return Vt(g,n)}function f(g){return e0(g,n)}const{ProjectivePoint:u,normPrivateKeyToScalar:l,weierstrassEquation:h,isWithinCurveOrder:d}=SL({...e,toBytes(g,y,v){const I=y.toAffine(),E=r.toBytes(I.x),A=Qf;return Qa("isCompressed",v),v?A(Uint8Array.from([y.hasEvenY()?2:3]),E):A(Uint8Array.from([4]),E,r.toBytes(I.y))},fromBytes(g){const y=g.length,v=g[0],I=g.subarray(1);if(y===o&&(v===2||v===3)){const E=Gs(I);if(!Op(E,qe,r.ORDER))throw new Error("Point is not on curve");const A=h(E);let U;try{U=r.sqrt(A)}catch(j){const k=j instanceof Error?": "+j.message:"";throw new Error("Point is not on curve"+k)}const R=(U&qe)===qe;return(v&1)===1!==R&&(U=r.neg(U)),{x:E,y:U}}else if(y===a&&v===4){const E=r.fromBytes(I.subarray(0,r.BYTES)),A=r.fromBytes(I.subarray(r.BYTES,2*r.BYTES));return{x:E,y:A}}else{const E=o,A=a;throw new Error("invalid Point, expected length of "+E+", or uncompressed "+A+", got "+y)}}});function p(g){const y=n>>qe;return g>y}function w(g){return p(g)?c(-g):g}const m=(g,y,v)=>Gs(g.slice(y,v));class D{constructor(y,v,I){No("r",y,qe,n),No("s",v,qe,n),this.r=y,this.s=v,I!=null&&(this.recovery=I),Object.freeze(this)}static fromCompact(y){const v=i;return y=wr("compactSignature",y,v*2),new D(m(y,0,v),m(y,v,2*v))}static fromDER(y){const{r:v,s:I}=jn.toSig(wr("DER",y));return new D(v,I)}assertValidity(){}addRecoveryBit(y){return new D(this.r,this.s,y)}recoverPublicKey(y){const{r:v,s:I,recovery:E}=this,A=N(wr("msgHash",y));if(E==null||![0,1,2,3].includes(E))throw new Error("recovery id invalid");const U=E===2||E===3?v+e.n:v;if(U>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const R=(E&1)===0?"02":"03",q=u.fromHex(R+cl(U,r.BYTES)),j=f(U),k=c(-A*j),M=c(I*j),H=u.BASE.multiplyAndAddUnsafe(q,k,M);if(!H)throw new Error("point at infinify");return H.assertValidity(),H}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new D(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Jf(this.toDERHex())}toDERHex(){return jn.hexFromSig(this)}toCompactRawBytes(){return Jf(this.toCompactHex())}toCompactHex(){const y=i;return cl(this.r,y)+cl(this.s,y)}}const C={isValidPrivateKey(g){try{return l(g),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const g=P8(e.n);return mL(e.randomBytes(g),e.n)},precompute(g=8,y=u.BASE){return y._setWindowSize(g),y.multiply(BigInt(3)),y}};function b(g,y=!0){return u.fromPrivateKey(g).toRawBytes(y)}function B(g){if(typeof g=="bigint")return!1;if(g instanceof u)return!0;const v=wr("key",g).length,I=r.BYTES,E=I+1,A=2*I+1;if(!(e.allowedPrivateKeyLengths||i===E))return v===E||v===A}function F(g,y,v=!0){if(B(g)===!0)throw new Error("first arg must be private key");if(B(y)===!1)throw new Error("second arg must be public key");return u.fromHex(y).multiply(l(g)).toRawBytes(v)}const _=e.bits2int||function(g){if(g.length>8192)throw new Error("input is too large");const y=Gs(g),v=g.length*8-s;return v>0?y>>BigInt(v):y},N=e.bits2int_modN||function(g){return c(_(g))},P=Nu(s);function S(g){return No("num < 2^"+s,g,zn,P),Ec(g,i)}function T(g,y,v=L){if(["recovered","canonical"].some(z=>z in v))throw new Error("sign() legacy options not supported");const{hash:I,randomBytes:E}=e;let{lowS:A,prehash:U,extraEntropy:R}=v;A==null&&(A=!0),g=wr("msgHash",g),vw(v),U&&(g=wr("prehashed msgHash",I(g)));const q=N(g),j=l(y),k=[S(j),S(q)];if(R!=null&&R!==!1){const z=R===!0?E(r.BYTES):R;k.push(wr("extraEntropy",z))}const M=Qf(...k),H=q;function V(z){const K=_(z);if(!d(K))return;const Q=f(K),ee=u.BASE.multiply(K).toAffine(),ne=c(ee.x);if(ne===zn)return;const he=c(Q*c(H+ne*j));if(he===zn)return;let Bt=(ee.x===ne?0:2)|Number(ee.y&qe),Rt=he;return A&&p(he)&&(Rt=w(he),Bt^=1),new D(ne,Rt,Bt)}return{seed:M,k2sig:V}}const L={lowS:e.lowS,prehash:!1},O={lowS:e.lowS,prehash:!1};function x(g,y,v=L){const{seed:I,k2sig:E}=T(g,y,v),A=e;return ST(A.hash.outputLen,A.nByteLength,A.hmac)(I,E)}u.BASE._setWindowSize(8);function $(g,y,v,I=O){var Bt;const E=g;y=wr("msgHash",y),v=wr("publicKey",v);const{lowS:A,prehash:U,format:R}=I;if(vw(I),"strict"in I)throw new Error("options.strict was renamed to lowS");if(R!==void 0&&R!=="compact"&&R!=="der")throw new Error("format must be compact or der");const q=typeof E=="string"||mc(E),j=!q&&!R&&typeof E=="object"&&E!==null&&typeof E.r=="bigint"&&typeof E.s=="bigint";if(!q&&!j)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let k,M;try{if(j&&(k=new D(E.r,E.s)),q){try{R!=="compact"&&(k=D.fromDER(E))}catch(Rt){if(!(Rt instanceof jn.Err))throw Rt}!k&&R!=="der"&&(k=D.fromCompact(E))}M=u.fromHex(v)}catch{return!1}if(!k||A&&k.hasHighS())return!1;U&&(y=e.hash(y));const{r:H,s:V}=k,z=N(y),K=f(V),Q=c(z*K),ee=c(H*K),ne=(Bt=u.BASE.multiplyAndAddUnsafe(M,Q,ee))==null?void 0:Bt.toAffine();return ne?c(ne.x)===H:!1}return{CURVE:e,getPublicKey:b,getSharedSecret:F,sign:x,verify:$,ProjectivePoint:u,Signature:D,utils:C}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function DL(t){return{hash:t,hmac:(e,...r)=>M2(t,e,z4(...r)),randomBytes:M4}}function FL(t,e){const r=n=>_L({...t,...DL(n)});return{...r(e),create:r}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const L8=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),xw=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),UL=BigInt(0),CL=BigInt(1),r0=BigInt(2),$w=(t,e)=>(t+e/r0)/e;function PL(t){const e=L8,r=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),f=t*t*t%e,u=f*f*t%e,l=pr(u,r,e)*u%e,h=pr(l,r,e)*u%e,d=pr(h,r0,e)*f%e,p=pr(d,i,e)*d%e,w=pr(p,s,e)*p%e,m=pr(w,a,e)*w%e,D=pr(m,c,e)*m%e,C=pr(D,a,e)*w%e,b=pr(C,r,e)*u%e,B=pr(b,o,e)*p%e,F=pr(B,n,e)*f%e,_=pr(F,r0,e);if(!n0.eql(n0.sqr(_),t))throw new Error("Cannot find square root");return _}const n0=Fp(L8,void 0,void 0,{sqrt:PL}),RL=FL({a:UL,b:BigInt(7),Fp:n0,n:xw,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=xw,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-CL*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=$w(s*t,e),c=$w(-n*t,e);let f=Vt(t-a*r-c*i,e),u=Vt(-a*n-c*s,e);const l=f>o,h=u>o;if(l&&(f=e-f),h&&(u=e-u),f>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:l,k1:f,k2neg:h,k2:u}}}},X4);function NL(t){if(t.length!==130&&t.length!==132)throw new LL({signature:t});const e=BigInt(Tn(t,0,32)),r=BigInt(Tn(t,32,64)),n=(()=>{const i=+`0x${t.slice(130)}`;if(!Number.isNaN(i))try{return TL(i)}catch{throw new kL({value:i})}})();return typeof n>"u"?{r:e,s:r}:{r:e,s:r,yParity:n}}function TL(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new jL({value:t})}class LL extends Ae{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${ss(Dp(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class kL extends Ae{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class jL extends Ae{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}function qL(t){return fL(ML(t))}function ML(t){const{payload:e,signature:r}=t,{r:n,s:i,yParity:s}=r,a=new RL.Signature(BigInt(n),BigInt(i)).addRecoveryBit(s).recoverPublicKey(Dp(e).substring(2));return eL(a)}function zL(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let f=0;f<e.length;f++)e[f]=255;for(let f=0;f<t.length;f++){const u=t.charAt(f),l=u.charCodeAt(0);if(e[l]!==255)throw new TypeError(u+" is ambiguous");e[l]=f}const r=t.length,n=t.charAt(0),i=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function o(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";let u=0,l=0,h=0;const d=f.length;for(;h!==d&&f[h]===0;)h++,u++;const p=(d-h)*s+1>>>0,w=new Uint8Array(p);for(;h!==d;){let C=f[h],b=0;for(let B=p-1;(C!==0||b<l)&&B!==-1;B--,b++)C+=256*w[B]>>>0,w[B]=C%r>>>0,C=C/r>>>0;if(C!==0)throw new Error("Non-zero carry");l=b,h++}let m=p-l;for(;m!==p&&w[m]===0;)m++;let D=n.repeat(u);for(;m<p;++m)D+=t.charAt(w[m]);return D}function a(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;let u=0,l=0,h=0;for(;f[u]===n;)l++,u++;const d=(f.length-u)*i+1>>>0,p=new Uint8Array(d);for(;u<f.length;){const C=f.charCodeAt(u);if(C>255)return;let b=e[C];if(b===255)return;let B=0;for(let F=d-1;(b!==0||B<h)&&F!==-1;F--,B++)b+=r*p[F]>>>0,p[F]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");h=B,u++}let w=d-h;for(;w!==d&&p[w]===0;)w++;const m=new Uint8Array(l+(d-w));let D=l;for(;w!==d;)m[D++]=p[w++];return m}function c(f){const u=a(f);if(u)return u;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var HL="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const vc=zL(HL);function VL(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function k8(t,...e){if(!VL(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Aw(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function KL(t,e){k8(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const po=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ul=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function GL(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function j8(t){return typeof t=="string"&&(t=GL(t)),k8(t),t}let ZL=class{clone(){return this._cloneInto()}};function WL(t){const e=n=>t().update(j8(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function YL(t=32){if(po&&typeof po.getRandomValues=="function")return po.getRandomValues(new Uint8Array(t));if(po&&typeof po.randomBytes=="function")return po.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function XL(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}let JL=class extends ZL{constructor(e,r,n,i){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ul(this.buffer)}update(e){Aw(this);const{view:r,buffer:n,blockLen:i}=this;e=j8(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=ul(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Aw(this),KL(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let l=o;l<i;l++)r[l]=0;XL(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=ul(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)a.setUint32(4*l,u[l],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%r&&e.buffer.set(n),e}};const Yc=BigInt(2**32-1),i0=BigInt(32);function q8(t,e=!1){return e?{h:Number(t&Yc),l:Number(t>>i0&Yc)}:{h:Number(t>>i0&Yc)|0,l:Number(t&Yc)|0}}function QL(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=q8(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const ek=(t,e)=>BigInt(t>>>0)<<i0|BigInt(e>>>0),tk=(t,e,r)=>t>>>r,rk=(t,e,r)=>t<<32-r|e>>>r,nk=(t,e,r)=>t>>>r|e<<32-r,ik=(t,e,r)=>t<<32-r|e>>>r,sk=(t,e,r)=>t<<64-r|e>>>r-32,ok=(t,e,r)=>t>>>r-32|e<<64-r,ak=(t,e)=>e,ck=(t,e)=>t,fk=(t,e,r)=>t<<r|e>>>32-r,uk=(t,e,r)=>e<<r|t>>>32-r,hk=(t,e,r)=>e<<r-32|t>>>64-r,lk=(t,e,r)=>t<<r-32|e>>>64-r;function dk(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const pk=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),gk=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,yk=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),wk=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,bk=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),mk=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,oe={fromBig:q8,split:QL,toBig:ek,shrSH:tk,shrSL:rk,rotrSH:nk,rotrSL:ik,rotrBH:sk,rotrBL:ok,rotr32H:ak,rotr32L:ck,rotlSH:fk,rotlSL:uk,rotlBH:hk,rotlBL:lk,add:dk,add3L:pk,add3H:gk,add4L:yk,add4H:wk,add5H:mk,add5L:bk},[Ek,vk]=oe.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),bi=new Uint32Array(80),mi=new Uint32Array(80);let xk=class extends JL{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:f,El:u,Fh:l,Fl:h,Gh:d,Gl:p,Hh:w,Hl:m}=this;return[e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m]}set(e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=u|0,this.Fh=l|0,this.Fl=h|0,this.Gh=d|0,this.Gl=p|0,this.Hh=w|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)bi[b]=e.getUint32(r),mi[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const B=bi[b-15]|0,F=mi[b-15]|0,_=oe.rotrSH(B,F,1)^oe.rotrSH(B,F,8)^oe.shrSH(B,F,7),N=oe.rotrSL(B,F,1)^oe.rotrSL(B,F,8)^oe.shrSL(B,F,7),P=bi[b-2]|0,S=mi[b-2]|0,T=oe.rotrSH(P,S,19)^oe.rotrBH(P,S,61)^oe.shrSH(P,S,6),L=oe.rotrSL(P,S,19)^oe.rotrBL(P,S,61)^oe.shrSL(P,S,6),O=oe.add4L(N,L,mi[b-7],mi[b-16]),x=oe.add4H(O,_,T,bi[b-7],bi[b-16]);bi[b]=x|0,mi[b]=O|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:f,Dl:u,Eh:l,El:h,Fh:d,Fl:p,Gh:w,Gl:m,Hh:D,Hl:C}=this;for(let b=0;b<80;b++){const B=oe.rotrSH(l,h,14)^oe.rotrSH(l,h,18)^oe.rotrBH(l,h,41),F=oe.rotrSL(l,h,14)^oe.rotrSL(l,h,18)^oe.rotrBL(l,h,41),_=l&d^~l&w,N=h&p^~h&m,P=oe.add5L(C,F,N,vk[b],mi[b]),S=oe.add5H(P,D,B,_,Ek[b],bi[b]),T=P|0,L=oe.rotrSH(n,i,28)^oe.rotrBH(n,i,34)^oe.rotrBH(n,i,39),O=oe.rotrSL(n,i,28)^oe.rotrBL(n,i,34)^oe.rotrBL(n,i,39),x=n&s^n&a^s&a,$=i&o^i&c^o&c;D=w|0,C=m|0,w=d|0,m=p|0,d=l|0,p=h|0,{h:l,l:h}=oe.add(f|0,u|0,S|0,T|0),f=a|0,u=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const g=oe.add3L(T,O,$);n=oe.add3H(g,S,L,x),i=g|0}({h:n,l:i}=oe.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=oe.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=oe.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l:u}=oe.add(this.Dh|0,this.Dl|0,f|0,u|0),{h:l,l:h}=oe.add(this.Eh|0,this.El|0,l|0,h|0),{h:d,l:p}=oe.add(this.Fh|0,this.Fl|0,d|0,p|0),{h:w,l:m}=oe.add(this.Gh|0,this.Gl|0,w|0,m|0),{h:D,l:C}=oe.add(this.Hh|0,this.Hl|0,D|0,C|0),this.set(n,i,s,o,a,c,f,u,l,h,d,p,w,m,D,C)}roundClean(){bi.fill(0),mi.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const $k=WL(()=>new xk);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Up=BigInt(0),M8=BigInt(1),Ak=BigInt(2);function Cp(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Pp(t){if(!Cp(t))throw new Error("Uint8Array expected")}function hl(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const Ik=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Rp(t){Pp(t);let e="";for(let r=0;r<t.length;r++)e+=Ik[t[r]];return e}function z8(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Up:BigInt("0x"+t)}const Bn={_0:48,_9:57,A:65,F:70,a:97,f:102};function Iw(t){if(t>=Bn._0&&t<=Bn._9)return t-Bn._0;if(t>=Bn.A&&t<=Bn.F)return t-(Bn.A-10);if(t>=Bn.a&&t<=Bn.f)return t-(Bn.a-10)}function H8(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=Iw(t.charCodeAt(s)),a=Iw(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function Bk(t){return z8(Rp(t))}function Bf(t){return Pp(t),z8(Rp(Uint8Array.from(t).reverse()))}function V8(t,e){return H8(t.toString(16).padStart(e*2,"0"))}function s0(t,e){return V8(t,e).reverse()}function Sn(t,e,r){let n;if(typeof e=="string")try{n=H8(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Cp(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function Bw(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Pp(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const ll=t=>typeof t=="bigint"&&Up<=t;function Sk(t,e,r){return ll(t)&&ll(e)&&ll(r)&&e<=t&&t<r}function wa(t,e,r,n){if(!Sk(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Ok(t){let e;for(e=0;t>Up;t>>=M8,e+=1);return e}const _k=t=>(Ak<<BigInt(t-1))-M8,Dk={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Cp(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Np(t,e,r={}){const n=(i,s,o)=>{const a=Dk[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function Sw(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const Ve=BigInt(0),Oe=BigInt(1),_s=BigInt(2),Fk=BigInt(3),o0=BigInt(4),Ow=BigInt(5),_w=BigInt(8);function Te(t,e){const r=t%e;return r>=Ve?r:e+r}function Uk(t,e,r){if(e<Ve)throw new Error("invalid exponent, negatives unsupported");if(r<=Ve)throw new Error("invalid modulus");if(r===Oe)return Ve;let n=Oe;for(;e>Ve;)e&Oe&&(n=n*t%r),t=t*t%r,e>>=Oe;return n}function sn(t,e,r){let n=t;for(;e-- >Ve;)n*=n,n%=r;return n}function Dw(t,e){if(t===Ve)throw new Error("invert: expected non-zero number");if(e<=Ve)throw new Error("invert: expected positive modulus, got "+e);let r=Te(t,e),n=e,i=Ve,s=Oe;for(;r!==Ve;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==Oe)throw new Error("invert: does not exist");return Te(i,e)}function Ck(t){const e=(t-Oe)/_s;let r,n,i;for(r=t-Oe,n=0;r%_s===Ve;r/=_s,n++);for(i=_s;i<t&&Uk(i,e,t)!==t-Oe;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+Oe)/o0;return function(a,c){const f=a.pow(c,o);if(!a.eql(a.sqr(f),c))throw new Error("Cannot find square root");return f}}const s=(r+Oe)/_s;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,f=o.pow(o.mul(o.ONE,i),r),u=o.pow(a,s),l=o.pow(a,r);for(;!o.eql(l,o.ONE);){if(o.eql(l,o.ZERO))return o.ZERO;let h=1;for(let p=o.sqr(l);h<c&&!o.eql(p,o.ONE);h++)p=o.sqr(p);const d=o.pow(f,Oe<<BigInt(c-h-1));f=o.sqr(d),u=o.mul(u,d),l=o.mul(l,f),c=h}return u}}function Pk(t){if(t%o0===Fk){const e=(t+Oe)/o0;return function(r,n){const i=r.pow(n,e);if(!r.eql(r.sqr(i),n))throw new Error("Cannot find square root");return i}}if(t%_w===Ow){const e=(t-Ow)/_w;return function(r,n){const i=r.mul(n,_s),s=r.pow(i,e),o=r.mul(n,s),a=r.mul(r.mul(o,_s),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return Ck(t)}const Rk=(t,e)=>(Te(t,e)&Oe)===Oe,Nk=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Tk(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=Nk.reduce((n,i)=>(n[i]="function",n),e);return Np(t,r)}function Lk(t,e,r){if(r<Ve)throw new Error("invalid exponent, negatives unsupported");if(r===Ve)return t.ONE;if(r===Oe)return e;let n=t.ONE,i=e;for(;r>Ve;)r&Oe&&(n=t.mul(n,i)),i=t.sqr(i),r>>=Oe;return n}function kk(t,e){const r=new Array(e.length),n=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),i=t.inv(n);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),i),r}function K8(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function G8(t,e,r=!1,n={}){if(t<=Ve)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=K8(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:_k(i),ZERO:Ve,ONE:Oe,create:c=>Te(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ve<=c&&c<t},is0:c=>c===Ve,isOdd:c=>(c&Oe)===Oe,neg:c=>Te(-c,t),eql:(c,f)=>c===f,sqr:c=>Te(c*c,t),add:(c,f)=>Te(c+f,t),sub:(c,f)=>Te(c-f,t),mul:(c,f)=>Te(c*f,t),pow:(c,f)=>Lk(a,c,f),div:(c,f)=>Te(c*Dw(f,t),t),sqrN:c=>c*c,addN:(c,f)=>c+f,subN:(c,f)=>c-f,mulN:(c,f)=>c*f,inv:c=>Dw(c,t),sqrt:n.sqrt||(c=>(o||(o=Pk(t)),o(a,c))),invertBatch:c=>kk(a,c),cmov:(c,f,u)=>u?f:c,toBytes:c=>r?s0(c,s):V8(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Bf(c):Bk(c)}});return Object.freeze(a)}const Fw=BigInt(0),Xc=BigInt(1);function dl(t,e){const r=e.negate();return t?r:e}function Z8(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function pl(t,e){Z8(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function jk(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function qk(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const gl=new WeakMap,W8=new WeakMap;function yl(t){return W8.get(t)||1}function Mk(t,e){return{constTimeNegate:dl,hasPrecomputes(r){return yl(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Fw;)n&Xc&&(i=i.add(s)),s=s.double(),n>>=Xc;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=pl(n,e),o=[];let a=r,c=a;for(let f=0;f<i;f++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){const{windows:s,windowSize:o}=pl(r,e);let a=t.ZERO,c=t.BASE;const f=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<s;h++){const d=h*o;let p=Number(i&f);i>>=l,p>o&&(p-=u,i+=Xc);const w=d,m=d+Math.abs(p)-1,D=h%2!==0,C=p<0;p===0?c=c.add(dl(D,n[w])):a=a.add(dl(C,n[m]))}return{p:a,f:c}},wNAFUnsafe(r,n,i,s=t.ZERO){const{windows:o,windowSize:a}=pl(r,e),c=BigInt(2**r-1),f=2**r,u=BigInt(r);for(let l=0;l<o;l++){const h=l*a;if(i===Fw)break;let d=Number(i&c);if(i>>=u,d>a&&(d-=f,i+=Xc),d===0)continue;let p=n[h+Math.abs(d)-1];d<0&&(p=p.negate()),s=s.add(p)}return s},getPrecomputes(r,n,i){let s=gl.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&gl.set(n,i(s))),s},wNAFCached(r,n,i){const s=yl(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=yl(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Z8(n,e),W8.set(r,n),gl.delete(r)}}}function zk(t,e,r,n){if(jk(r,t),qk(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=Ok(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),f=Math.floor((e.BITS-1)/o)*o;let u=i;for(let l=f;l>=0;l-=o){c.fill(i);for(let d=0;d<n.length;d++){const p=n[d],w=Number(p>>BigInt(l)&BigInt(a));c[w]=c[w].add(r[d])}let h=i;for(let d=c.length-1,p=i;d>0;d--)p=p.add(c[d]),h=h.add(p);if(u=u.add(h),l!==0)for(let d=0;d<o;d++)u=u.double()}return u}function Hk(t){return Tk(t.Fp),Np(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...K8(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const Fr=BigInt(0),kt=BigInt(1),Jc=BigInt(2),Vk=BigInt(8),Kk={zip215:!0};function Gk(t){const e=Hk(t);return Np(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Zk(t){const e=Gk(t),{Fp:r,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,f=Jc<<BigInt(a*8)-kt,u=r.create,l=G8(e.n,e.nBitLength),h=e.uvRatio||((g,y)=>{try{return{isValid:!0,value:r.sqrt(g*r.inv(y))}}catch{return{isValid:!1,value:Fr}}}),d=e.adjustScalarBytes||(g=>g),p=e.domain||((g,y,v)=>{if(hl("phflag",v),y.length||v)throw new Error("Contexts/pre-hash are not supported");return g});function w(g,y){wa("coordinate "+g,y,Fr,f)}function m(g){if(!(g instanceof b))throw new Error("ExtendedPoint expected")}const D=Sw((g,y)=>{const{ex:v,ey:I,ez:E}=g,A=g.is0();y==null&&(y=A?Vk:r.inv(E));const U=u(v*y),R=u(I*y),q=u(E*y);if(A)return{x:Fr,y:kt};if(q!==kt)throw new Error("invZ was invalid");return{x:U,y:R}}),C=Sw(g=>{const{a:y,d:v}=e;if(g.is0())throw new Error("bad point: ZERO");const{ex:I,ey:E,ez:A,et:U}=g,R=u(I*I),q=u(E*E),j=u(A*A),k=u(j*j),M=u(R*y),H=u(j*u(M+q)),V=u(k+u(v*u(R*q)));if(H!==V)throw new Error("bad point: equation left != right (1)");const z=u(I*E),K=u(A*U);if(z!==K)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(y,v,I,E){this.ex=y,this.ey=v,this.ez=I,this.et=E,w("x",y),w("y",v),w("z",I),w("t",E),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(y){if(y instanceof b)throw new Error("extended point not allowed");const{x:v,y:I}=y||{};return w("x",v),w("y",I),new b(v,I,kt,u(v*I))}static normalizeZ(y){const v=r.invertBatch(y.map(I=>I.ez));return y.map((I,E)=>I.toAffine(v[E])).map(b.fromAffine)}static msm(y,v){return zk(b,l,y,v)}_setWindowSize(y){_.setWindowSize(this,y)}assertValidity(){C(this)}equals(y){m(y);const{ex:v,ey:I,ez:E}=this,{ex:A,ey:U,ez:R}=y,q=u(v*R),j=u(A*E),k=u(I*R),M=u(U*E);return q===j&&k===M}is0(){return this.equals(b.ZERO)}negate(){return new b(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:y}=e,{ex:v,ey:I,ez:E}=this,A=u(v*v),U=u(I*I),R=u(Jc*u(E*E)),q=u(y*A),j=v+I,k=u(u(j*j)-A-U),M=q+U,H=M-R,V=q-U,z=u(k*H),K=u(M*V),Q=u(k*V),ee=u(H*M);return new b(z,K,ee,Q)}add(y){m(y);const{a:v,d:I}=e,{ex:E,ey:A,ez:U,et:R}=this,{ex:q,ey:j,ez:k,et:M}=y;if(v===BigInt(-1)){const vr=u((A-E)*(j+q)),xr=u((A+E)*(j-q)),St=u(xr-vr);if(St===Fr)return this.double();const $r=u(U*Jc*M),Ar=u(R*Jc*k),Ir=Ar+$r,Br=xr+vr,Sr=Ar-$r,ys=u(Ir*St),ws=u(Br*Sr),bs=u(Ir*Sr),ms=u(St*Br);return new b(ys,ws,ms,bs)}const H=u(E*q),V=u(A*j),z=u(R*I*M),K=u(U*k),Q=u((E+A)*(q+j)-H-V),ee=K-z,ne=K+z,he=u(V-v*H),Bt=u(Q*ee),Rt=u(ne*he),ps=u(Q*he),gs=u(ee*ne);return new b(Bt,Rt,gs,ps)}subtract(y){return this.add(y.negate())}wNAF(y){return _.wNAFCached(this,y,b.normalizeZ)}multiply(y){const v=y;wa("scalar",v,kt,n);const{p:I,f:E}=this.wNAF(v);return b.normalizeZ([I,E])[0]}multiplyUnsafe(y,v=b.ZERO){const I=y;return wa("scalar",I,Fr,n),I===Fr?F:this.is0()||I===kt?this:_.wNAFCachedUnsafe(this,I,b.normalizeZ,v)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return _.unsafeLadder(this,n).is0()}toAffine(y){return D(this,y)}clearCofactor(){const{h:y}=e;return y===kt?this:this.multiplyUnsafe(y)}static fromHex(y,v=!1){const{d:I,a:E}=e,A=r.BYTES;y=Sn("pointHex",y,A),hl("zip215",v);const U=y.slice(),R=y[A-1];U[A-1]=R&-129;const q=Bf(U),j=v?f:r.ORDER;wa("pointHex.y",q,Fr,j);const k=u(q*q),M=u(k-kt),H=u(I*k-E);let{isValid:V,value:z}=h(M,H);if(!V)throw new Error("Point.fromHex: invalid y coordinate");const K=(z&kt)===kt,Q=(R&128)!==0;if(!v&&z===Fr&&Q)throw new Error("Point.fromHex: x=0 and x_0=1");return Q!==K&&(z=u(-z)),b.fromAffine({x:z,y:q})}static fromPrivateKey(y){return S(y).point}toRawBytes(){const{x:y,y:v}=this.toAffine(),I=s0(v,r.BYTES);return I[I.length-1]|=y&kt?128:0,I}toHex(){return Rp(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,kt,u(e.Gx*e.Gy)),b.ZERO=new b(Fr,kt,kt,Fr);const{BASE:B,ZERO:F}=b,_=Mk(b,a*8);function N(g){return Te(g,n)}function P(g){return N(Bf(g))}function S(g){const y=r.BYTES;g=Sn("private key",g,y);const v=Sn("hashed private key",s(g),2*y),I=d(v.slice(0,y)),E=v.slice(y,2*y),A=P(I),U=B.multiply(A),R=U.toRawBytes();return{head:I,prefix:E,scalar:A,point:U,pointBytes:R}}function T(g){return S(g).pointBytes}function L(g=new Uint8Array,...y){const v=Bw(...y);return P(s(p(v,Sn("context",g),!!i)))}function O(g,y,v={}){g=Sn("message",g),i&&(g=i(g));const{prefix:I,scalar:E,pointBytes:A}=S(y),U=L(v.context,I,g),R=B.multiply(U).toRawBytes(),q=L(v.context,R,A,g),j=N(U+q*E);wa("signature.s",j,Fr,n);const k=Bw(R,s0(j,r.BYTES));return Sn("result",k,r.BYTES*2)}const x=Kk;function $(g,y,v,I=x){const{context:E,zip215:A}=I,U=r.BYTES;g=Sn("signature",g,2*U),y=Sn("message",y),v=Sn("publicKey",v,U),A!==void 0&&hl("zip215",A),i&&(y=i(y));const R=Bf(g.slice(U,2*U));let q,j,k;try{q=b.fromHex(v,A),j=b.fromHex(g.slice(0,U),A),k=B.multiplyUnsafe(R)}catch{return!1}if(!A&&q.isSmallOrder())return!1;const M=L(E,j.toRawBytes(),q.toRawBytes(),y);return j.add(q.multiplyUnsafe(M)).subtract(k).clearCofactor().equals(b.ZERO)}return B._setWindowSize(8),{CURVE:e,getPublicKey:T,sign:O,verify:$,ExtendedPoint:b,utils:{getExtendedPublicKey:S,randomPrivateKey:()=>o(r.BYTES),precompute(g=8,y=b.BASE){return y._setWindowSize(g),y.multiply(BigInt(3)),y}}}}BigInt(0),BigInt(1);const Tp=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Uw=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Wk=BigInt(1),Cw=BigInt(2);BigInt(3);const Yk=BigInt(5),Xk=BigInt(8);function Jk(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=Tp,o=t*t%s*t%s,a=sn(o,Cw,s)*o%s,c=sn(a,Wk,s)*t%s,f=sn(c,Yk,s)*c%s,u=sn(f,e,s)*f%s,l=sn(u,r,s)*u%s,h=sn(l,n,s)*l%s,d=sn(h,i,s)*h%s,p=sn(d,i,s)*h%s,w=sn(p,e,s)*f%s;return{pow_p_5_8:sn(w,Cw,s)*t%s,b2:o}}function Qk(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function ej(t,e){const r=Tp,n=Te(e*e*e,r),i=Te(n*n*e,r),s=Jk(t*i).pow_p_5_8;let o=Te(t*n*s,r);const a=Te(e*o*o,r),c=o,f=Te(o*Uw,r),u=a===t,l=a===Te(-t,r),h=a===Te(-t*Uw,r);return u&&(o=c),(l||h)&&(o=f),Rk(o,r)&&(o=Te(-o,r)),{isValid:u||l,value:o}}const tj=G8(Tp,void 0,!0),rj={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:tj,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Xk,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:$k,randomBytes:YL,adjustScalarBytes:Qk,uvRatio:ej};Zk(rj);function nj(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),f=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var w=0,m=0,D=0,C=p.length;D!==C&&p[D]===0;)D++,w++;for(var b=(C-D)*u+1>>>0,B=new Uint8Array(b);D!==C;){for(var F=p[D],_=0,N=b-1;(F!==0||_<m)&&N!==-1;N--,_++)F+=256*B[N]>>>0,B[N]=F%a>>>0,F=F/a>>>0;if(F!==0)throw new Error("Non-zero carry");m=_,D++}for(var P=b-m;P!==b&&B[P]===0;)P++;for(var S=c.repeat(w);P<b;++P)S+=t.charAt(B[P]);return S}function h(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var w=0;if(p[w]!==" "){for(var m=0,D=0;p[w]===c;)m++,w++;for(var C=(p.length-w)*f+1>>>0,b=new Uint8Array(C);p[w];){var B=r[p.charCodeAt(w)];if(B===255)return;for(var F=0,_=C-1;(B!==0||F<D)&&_!==-1;_--,F++)B+=a*b[_]>>>0,b[_]=B%256>>>0,B=B/256>>>0;if(B!==0)throw new Error("Non-zero carry");D=F,w++}if(p[w]!==" "){for(var N=C-D;N!==C&&b[N]===0;)N++;for(var P=new Uint8Array(m+(C-N)),S=m;N!==C;)P[S++]=b[N++];return P}}}function d(p){var w=h(p);if(w)return w;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:h,decode:d}}var ij=nj,sj=ij;const Y8=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},oj=t=>new TextEncoder().encode(t),aj=t=>new TextDecoder().decode(t);let cj=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},fj=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return X8(this,e)}},uj=class{constructor(e){this.decoders=e}or(e){return X8(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const X8=(t,e)=>new uj({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let hj=class{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new cj(e,r,n),this.decoder=new fj(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Lu=({name:t,prefix:e,encode:r,decode:n})=>new hj(t,e,r,n),xc=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=sj(r,e);return Lu({prefix:t,name:e,encode:n,decode:s=>Y8(i(s))})},lj=(t,e,r,n)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,f=0;for(let u=0;u<s;++u){const l=i[t[u]];if(l===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|l,a+=r,a>=8&&(a-=8,o[f++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},dj=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},st=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Lu({prefix:e,name:t,encode(i){return dj(i,n,r)},decode(i){return lj(i,n,r,t)}}),pj=Lu({prefix:"\0",name:"identity",encode:t=>aj(t),decode:t=>oj(t)});var gj=Object.freeze({__proto__:null,identity:pj});const yj=st({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var wj=Object.freeze({__proto__:null,base2:yj});const bj=st({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var mj=Object.freeze({__proto__:null,base8:bj});const Ej=xc({prefix:"9",name:"base10",alphabet:"0123456789"});var vj=Object.freeze({__proto__:null,base10:Ej});const xj=st({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),$j=st({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Aj=Object.freeze({__proto__:null,base16:xj,base16upper:$j});const Ij=st({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Bj=st({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Sj=st({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Oj=st({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),_j=st({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Dj=st({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Fj=st({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Uj=st({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Cj=st({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Pj=Object.freeze({__proto__:null,base32:Ij,base32upper:Bj,base32pad:Sj,base32padupper:Oj,base32hex:_j,base32hexupper:Dj,base32hexpad:Fj,base32hexpadupper:Uj,base32z:Cj});const Rj=xc({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Nj=xc({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Tj=Object.freeze({__proto__:null,base36:Rj,base36upper:Nj});const Lj=xc({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),kj=xc({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var jj=Object.freeze({__proto__:null,base58btc:Lj,base58flickr:kj});const qj=st({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Mj=st({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),zj=st({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Hj=st({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Vj=Object.freeze({__proto__:null,base64:qj,base64pad:Mj,base64url:zj,base64urlpad:Hj});const J8=Array.from(""),Kj=J8.reduce((t,e,r)=>(t[r]=e,t),[]),Gj=J8.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Zj(t){return t.reduce((e,r)=>(e+=Kj[r],e),"")}function Wj(t){const e=[];for(const r of t){const n=Gj[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const Yj=Lu({prefix:"",name:"base256emoji",encode:Zj,decode:Wj});var Xj=Object.freeze({__proto__:null,base256emoji:Yj}),Jj=Q8,Pw=128,Qj=-128,eq=Math.pow(2,31);function Q8(t,e,r){e=e||[],r=r||0;for(var n=r;t>=eq;)e[r++]=t&255|Pw,t/=128;for(;t&Qj;)e[r++]=t&255|Pw,t>>>=7;return e[r]=t|0,Q8.bytes=r-n+1,e}var tq=a0,rq=128,Rw=127;function a0(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw a0.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&Rw)<<i:(o&Rw)*Math.pow(2,i),i+=7}while(o>=rq);return a0.bytes=s-n,r}var nq=Math.pow(2,7),iq=Math.pow(2,14),sq=Math.pow(2,21),oq=Math.pow(2,28),aq=Math.pow(2,35),cq=Math.pow(2,42),fq=Math.pow(2,49),uq=Math.pow(2,56),hq=Math.pow(2,63),lq=function(t){return t<nq?1:t<iq?2:t<sq?3:t<oq?4:t<aq?5:t<cq?6:t<fq?7:t<uq?8:t<hq?9:10},dq={encode:Jj,decode:tq,encodingLength:lq},ev=dq;const Nw=(t,e,r=0)=>(ev.encode(t,e,r),e),Tw=t=>ev.encodingLength(t),c0=(t,e)=>{const r=e.byteLength,n=Tw(t),i=n+Tw(r),s=new Uint8Array(i+r);return Nw(t,s,0),Nw(r,s,n),s.set(e,i),new pq(t,r,e,s)};let pq=class{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}};const tv=({name:t,code:e,encode:r})=>new gq(t,e,r);let gq=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?c0(this.code,r):r.then(n=>c0(this.code,n))}else throw Error("Unknown type, must be binary type")}};const rv=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),yq=tv({name:"sha2-256",code:18,encode:rv("SHA-256")}),wq=tv({name:"sha2-512",code:19,encode:rv("SHA-512")});var bq=Object.freeze({__proto__:null,sha256:yq,sha512:wq});const nv=0,mq="identity",iv=Y8,Eq=t=>c0(nv,iv(t)),vq={code:nv,name:mq,encode:iv,digest:Eq};var xq=Object.freeze({__proto__:null,identity:vq});new TextEncoder,new TextDecoder;({...gj,...wj,...mj,...vj,...Aj,...Pj,...Tj,...jj,...Vj,...Xj});({...bq,...xq});function sv(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function $q(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?sv(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ov(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const Lw=ov("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),wl=ov("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=$q(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),av={utf8:Lw,"utf-8":Lw,hex:Tf.base16,latin1:wl,ascii:wl,binary:wl,...Tf};function cv(t,e="utf8"){const r=av[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?sv(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function fv(t,e="utf8"){const r=av[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}var Aq={};const Iq=":";function Sf(t){const[e,r]=t.split(Iq);return{namespace:e,reference:r}}function uv(t,e){return t.includes(":")?[t]:e.chains||[]}var Bq=Object.defineProperty,Sq=Object.defineProperties,Oq=Object.getOwnPropertyDescriptors,kw=Object.getOwnPropertySymbols,_q=Object.prototype.hasOwnProperty,Dq=Object.prototype.propertyIsEnumerable,f0=(t,e,r)=>e in t?Bq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jw=(t,e)=>{for(var r in e||(e={}))_q.call(e,r)&&f0(t,r,e[r]);if(kw)for(var r of kw(e))Dq.call(e,r)&&f0(t,r,e[r]);return t},Fq=(t,e)=>Sq(t,Oq(e)),qw=(t,e,r)=>f0(t,typeof e!="symbol"?e+"":e,r);const Uq="ReactNative",Oo={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};function hv(){return typeof It<"u"&&typeof It.versions<"u"&&typeof It.versions.node<"u"}function lv(){return!ur.getDocument()&&!!ur.getNavigator()&&navigator.product===Uq}function dv(){return!hv()&&!!ur.getNavigator()&&!!ur.getDocument()}function Cq(){return lv()?Oo.reactNative:hv()?Oo.node:dv()?Oo.browser:Oo.unknown}function Pq(t){var e,r;const n=Rq();try{return t!=null&&t.url&&n.url&&new URL(t.url).host!==new URL(n.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${n.url}. This is probably unintended and can lead to issues.`),t.url=n.url),(e=t==null?void 0:t.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(i=>i!=="")),Fq(jw(jw({},n),t),{url:(t==null?void 0:t.url)||n.url,name:(t==null?void 0:t.name)||n.name,description:(t==null?void 0:t.description)||n.description,icons:(r=t==null?void 0:t.icons)!=null&&r.length&&t.icons.length>0?t.icons:n.icons})}catch(i){return console.warn("Error populating app metadata",i),t||n}}function Rq(){return K2.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function ks(t,e){return t.filter(r=>e.includes(r)).length===t.length}function go(t=Z.FIVE_MINUTES,e){const r=Z.toMiliseconds(t||Z.FIVE_MINUTES);let n,i,s,o;return{resolve:a=>{s&&n&&(clearTimeout(s),n(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const f=new Error(e);o=Promise.reject(f),c(f)},r),n=a,i=c})}}function Nq(t){const[e,r]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")n.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return n}function jt(t,e){return Z.fromMiliseconds(Date.now()+Z.toMiliseconds(t))}function yo(t){return Date.now()>=Z.toMiliseconds(t)}function ve(t,e){return`${t}${e?`:${e}`:""}`}function Zs(t=[],e=[]){return[...new Set([...t,...e])]}async function Tq({id:t,topic:e,wcDeepLink:r}){var n;try{if(!r)return;const i=typeof r=="string"?JSON.parse(r):r,s=i==null?void 0:i.href;if(typeof s!="string")return;const o=Lq(s,t,e),a=Cq();if(a===Oo.browser){if(!((n=ur.getDocument())!=null&&n.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}kq(o)}else a===Oo.reactNative&&typeof(re==null?void 0:re.Linking)<"u"&&await re.Linking.openURL(o)}catch(i){console.error(i)}}function Lq(t,e,r){const n=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let i=`${t}`;if(t.startsWith("https://t.me")){const s=t.includes("?")?"&startapp=":"?startapp=";i=`${i}${s}${Hq(n,!0)}`}else i=`${i}/wc?${n}`;return i}function kq(t){let e="_self";zq()?e="_top":(Mq()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function jq(t,e){let r="";try{if(dv()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(n){console.error(n)}return r}function Mw(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),n=r.indexOf(e);return r[n+2]}function qq(){return typeof It<"u"&&Aq.IS_VITEST==="true"}function Mq(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function zq(){try{return window.self!==window.top}catch{return!1}}function Hq(t,e=!1){const r=ue.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}class Vq{constructor({limit:e}){qw(this,"limit"),qw(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}}const Qc=BigInt(2**32-1),zw=BigInt(32);function pv(t,e=!1){return e?{h:Number(t&Qc),l:Number(t>>zw&Qc)}:{h:Number(t>>zw&Qc)|0,l:Number(t&Qc)|0}}function gv(t,e=!1){const r=t.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=pv(t[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const Hw=(t,e,r)=>t>>>r,Vw=(t,e,r)=>t<<32-r|e>>>r,qi=(t,e,r)=>t>>>r|e<<32-r,Mi=(t,e,r)=>t<<32-r|e>>>r,Pa=(t,e,r)=>t<<64-r|e>>>r-32,Ra=(t,e,r)=>t>>>r-32|e<<64-r,Kq=(t,e)=>e,Gq=(t,e)=>t,Zq=(t,e,r)=>t<<r|e>>>32-r,Wq=(t,e,r)=>e<<r|t>>>32-r,Yq=(t,e,r)=>e<<r-32|t>>>64-r,Xq=(t,e,r)=>t<<r-32|e>>>64-r;function jr(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const Lp=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),kp=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,Jq=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),Qq=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,eM=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),tM=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,wo=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function ku(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function os(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Zr(t,...e){if(!ku(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function yv(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");os(t.outputLen),os(t.blockLen)}function as(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function jp(t,e){Zr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function tc(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Wr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function bl(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function on(t,e){return t<<32-e|t>>>e}const wv=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function bv(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Rn=wv?t=>t:t=>bv(t);function rM(t){for(let e=0;e<t.length;e++)t[e]=bv(t[e]);return t}const zi=wv?t=>t:rM,mv=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",nM=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function To(t){if(Zr(t),mv)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=nM[t[r]];return e}const On={_0:48,_9:57,A:65,F:70,a:97,f:102};function Kw(t){if(t>=On._0&&t<=On._9)return t-On._0;if(t>=On.A&&t<=On.F)return t-(On.A-10);if(t>=On.a&&t<=On.f)return t-(On.a-10)}function tu(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(mv)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=Kw(t.charCodeAt(s)),a=Kw(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function Ev(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Wn(t){return typeof t=="string"&&(t=Ev(t)),Zr(t),t}function Wi(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Zr(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}let ju=class{};function $c(t){const e=n=>t().update(Wn(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function iM(t){const e=(n,i)=>t(i).update(Wn(n)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}function qp(t=32){if(wo&&typeof wo.getRandomValues=="function")return wo.getRandomValues(new Uint8Array(t));if(wo&&typeof wo.randomBytes=="function")return Uint8Array.from(wo.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const sM=BigInt(0),ba=BigInt(1),oM=BigInt(2),aM=BigInt(7),cM=BigInt(256),fM=BigInt(113),vv=[],xv=[],$v=[];for(let t=0,e=ba,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],vv.push(2*(5*n+r)),xv.push((t+1)*(t+2)/2%64);let i=sM;for(let s=0;s<7;s++)e=(e<<ba^(e>>aM)*fM)%cM,e&oM&&(i^=ba<<(ba<<BigInt(s))-ba);$v.push(i)}const Av=gv($v,!0),uM=Av[0],hM=Av[1],Gw=(t,e,r)=>r>32?Yq(t,e,r):Zq(t,e,r),Zw=(t,e,r)=>r>32?Xq(t,e,r):Wq(t,e,r);function lM(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,f=r[c],u=r[c+1],l=Gw(f,u,1)^r[a],h=Zw(f,u,1)^r[a+1];for(let d=0;d<50;d+=10)t[o+d]^=l,t[o+d+1]^=h}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=xv[o],c=Gw(i,s,a),f=Zw(i,s,a),u=vv[o];i=t[u],s=t[u+1],t[u]=c,t[u+1]=f}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=uM[n],t[1]^=hM[n]}Wr(r)}let dM=class Iv extends ju{constructor(e,r,n,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,os(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=tc(this.state)}clone(){return this._cloneInto()}keccak(){zi(this.state32),lM(this.state32,this.rounds),zi(this.state32),this.posOut=0,this.pos=0}update(e){as(this),e=Wn(e),Zr(e);const{blockLen:r,state:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){as(this,!1),Zr(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return os(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(jp(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Wr(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new Iv(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}};const pM=(t,e,r)=>$c(()=>new dM(e,t,r)),gM=pM(1,136,256/8);function yM(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}function wM(t,e,r){return t&e^~t&r}function bM(t,e,r){return t&e^t&r^e&r}let Bv=class extends ju{constructor(e,r,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=bl(this.buffer)}update(e){as(this),e=Wn(e),Zr(e);const{view:r,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=bl(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){as(this),jp(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,Wr(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let l=o;l<i;l++)r[l]=0;yM(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=bl(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)a.setUint32(4*l,u[l],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const Ei=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),pt=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),gt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),mM=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),vi=new Uint32Array(64);let EM=class extends Bv{constructor(e=32){super(64,e,8,!1),this.A=Ei[0]|0,this.B=Ei[1]|0,this.C=Ei[2]|0,this.D=Ei[3]|0,this.E=Ei[4]|0,this.F=Ei[5]|0,this.G=Ei[6]|0,this.H=Ei[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let l=0;l<16;l++,r+=4)vi[l]=e.getUint32(r,!1);for(let l=16;l<64;l++){const h=vi[l-15],d=vi[l-2],p=on(h,7)^on(h,18)^h>>>3,w=on(d,17)^on(d,19)^d>>>10;vi[l]=w+vi[l-7]+p+vi[l-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:f,H:u}=this;for(let l=0;l<64;l++){const h=on(a,6)^on(a,11)^on(a,25),d=u+h+wM(a,c,f)+mM[l]+vi[l]|0,p=(on(n,2)^on(n,13)^on(n,22))+bM(n,i,s)|0;u=f,f=c,c=a,a=o+d|0,o=s,s=i,i=n,n=d+p|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(n,i,s,o,a,c,f,u)}roundClean(){Wr(vi)}destroy(){this.set(0,0,0,0,0,0,0,0),Wr(this.buffer)}};const Sv=gv(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),vM=Sv[0],xM=Sv[1],xi=new Uint32Array(80),$i=new Uint32Array(80);let Mp=class extends Bv{constructor(e=64){super(128,e,16,!1),this.Ah=gt[0]|0,this.Al=gt[1]|0,this.Bh=gt[2]|0,this.Bl=gt[3]|0,this.Ch=gt[4]|0,this.Cl=gt[5]|0,this.Dh=gt[6]|0,this.Dl=gt[7]|0,this.Eh=gt[8]|0,this.El=gt[9]|0,this.Fh=gt[10]|0,this.Fl=gt[11]|0,this.Gh=gt[12]|0,this.Gl=gt[13]|0,this.Hh=gt[14]|0,this.Hl=gt[15]|0}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:f,El:u,Fh:l,Fl:h,Gh:d,Gl:p,Hh:w,Hl:m}=this;return[e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m]}set(e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=u|0,this.Fh=l|0,this.Fl=h|0,this.Gh=d|0,this.Gl=p|0,this.Hh=w|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)xi[b]=e.getUint32(r),$i[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const B=xi[b-15]|0,F=$i[b-15]|0,_=qi(B,F,1)^qi(B,F,8)^Hw(B,F,7),N=Mi(B,F,1)^Mi(B,F,8)^Vw(B,F,7),P=xi[b-2]|0,S=$i[b-2]|0,T=qi(P,S,19)^Pa(P,S,61)^Hw(P,S,6),L=Mi(P,S,19)^Ra(P,S,61)^Vw(P,S,6),O=Jq(N,L,$i[b-7],$i[b-16]),x=Qq(O,_,T,xi[b-7],xi[b-16]);xi[b]=x|0,$i[b]=O|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:f,Dl:u,Eh:l,El:h,Fh:d,Fl:p,Gh:w,Gl:m,Hh:D,Hl:C}=this;for(let b=0;b<80;b++){const B=qi(l,h,14)^qi(l,h,18)^Pa(l,h,41),F=Mi(l,h,14)^Mi(l,h,18)^Ra(l,h,41),_=l&d^~l&w,N=h&p^~h&m,P=eM(C,F,N,xM[b],$i[b]),S=tM(P,D,B,_,vM[b],xi[b]),T=P|0,L=qi(n,i,28)^Pa(n,i,34)^Pa(n,i,39),O=Mi(n,i,28)^Ra(n,i,34)^Ra(n,i,39),x=n&s^n&a^s&a,$=i&o^i&c^o&c;D=w|0,C=m|0,w=d|0,m=p|0,d=l|0,p=h|0,{h:l,l:h}=jr(f|0,u|0,S|0,T|0),f=a|0,u=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const g=Lp(T,O,$);n=kp(g,S,L,x),i=g|0}({h:n,l:i}=jr(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=jr(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=jr(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l:u}=jr(this.Dh|0,this.Dl|0,f|0,u|0),{h:l,l:h}=jr(this.Eh|0,this.El|0,l|0,h|0),{h:d,l:p}=jr(this.Fh|0,this.Fl|0,d|0,p|0),{h:w,l:m}=jr(this.Gh|0,this.Gl|0,w|0,m|0),{h:D,l:C}=jr(this.Hh|0,this.Hl|0,D|0,C|0),this.set(n,i,s,o,a,c,f,u,l,h,d,p,w,m,D,C)}roundClean(){Wr(xi,$i)}destroy(){Wr(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},$M=class extends Mp{constructor(){super(48),this.Ah=pt[0]|0,this.Al=pt[1]|0,this.Bh=pt[2]|0,this.Bl=pt[3]|0,this.Ch=pt[4]|0,this.Cl=pt[5]|0,this.Dh=pt[6]|0,this.Dl=pt[7]|0,this.Eh=pt[8]|0,this.El=pt[9]|0,this.Fh=pt[10]|0,this.Fl=pt[11]|0,this.Gh=pt[12]|0,this.Gl=pt[13]|0,this.Hh=pt[14]|0,this.Hl=pt[15]|0}};const yt=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);let AM=class extends Mp{constructor(){super(32),this.Ah=yt[0]|0,this.Al=yt[1]|0,this.Bh=yt[2]|0,this.Bl=yt[3]|0,this.Ch=yt[4]|0,this.Cl=yt[5]|0,this.Dh=yt[6]|0,this.Dl=yt[7]|0,this.Eh=yt[8]|0,this.El=yt[9]|0,this.Fh=yt[10]|0,this.Fl=yt[11]|0,this.Gh=yt[12]|0,this.Gl=yt[13]|0,this.Hh=yt[14]|0,this.Hl=yt[15]|0}};const qu=$c(()=>new EM),IM=$c(()=>new Mp),BM=$c(()=>new $M),SM=$c(()=>new AM),OM=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Ce=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),X=new Uint32Array(32);function Ai(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=X[2*t],f=X[2*t+1],u=X[2*e],l=X[2*e+1],h=X[2*r],d=X[2*r+1],p=X[2*n],w=X[2*n+1],m=Lp(c,u,o);f=kp(m,f,l,a),c=m|0,{Dh:w,Dl:p}={Dh:w^f,Dl:p^c},{Dh:w,Dl:p}={Dh:Kq(w,p),Dl:Gq(w)},{h:d,l:h}=jr(d,h,w,p),{Bh:l,Bl:u}={Bh:l^d,Bl:u^h},{Bh:l,Bl:u}={Bh:qi(l,u,24),Bl:Mi(l,u,24)},X[2*t]=c,X[2*t+1]=f,X[2*e]=u,X[2*e+1]=l,X[2*r]=h,X[2*r+1]=d,X[2*n]=p,X[2*n+1]=w}function Ii(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=X[2*t],f=X[2*t+1],u=X[2*e],l=X[2*e+1],h=X[2*r],d=X[2*r+1],p=X[2*n],w=X[2*n+1],m=Lp(c,u,o);f=kp(m,f,l,a),c=m|0,{Dh:w,Dl:p}={Dh:w^f,Dl:p^c},{Dh:w,Dl:p}={Dh:qi(w,p,16),Dl:Mi(w,p,16)},{h:d,l:h}=jr(d,h,w,p),{Bh:l,Bl:u}={Bh:l^d,Bl:u^h},{Bh:l,Bl:u}={Bh:Pa(l,u,63),Bl:Ra(l,u,63)},X[2*t]=c,X[2*t+1]=f,X[2*e]=u,X[2*e+1]=l,X[2*r]=h,X[2*r+1]=d,X[2*n]=p,X[2*n+1]=w}function _M(t,e={},r,n,i){if(os(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}let DM=class extends ju{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,os(e),os(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=tc(this.buffer)}update(e){as(this),e=Wn(e),Zr(e);const{blockLen:r,buffer:n,buffer32:i}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===r&&(zi(i),this.compress(i,0,!1),zi(i),this.pos=0);const f=Math.min(r-this.pos,s-c),u=o+c;if(f===r&&!(u%4)&&c+f<s){const l=new Uint32Array(a,u,Math.floor((s-c)/4));zi(l);for(let h=0;c+r<s;h+=i.length,c+=r)this.length+=r,this.compress(l,h,!1);zi(l);continue}n.set(e.subarray(c,c+f),this.pos),this.pos+=f,this.length+=f,c+=f}return this}digestInto(e){as(this),jp(e,this);const{pos:r,buffer32:n}=this;this.finished=!0,Wr(this.buffer.subarray(r)),zi(n),this.compress(n,0,!0),zi(n);const i=tc(e);this.get().forEach((s,o)=>i[o]=Rn(s))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){const{buffer:r,length:n,finished:i,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=s,e.finished=i,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}},FM=class extends DM{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=Ce[0]|0,this.v0h=Ce[1]|0,this.v1l=Ce[2]|0,this.v1h=Ce[3]|0,this.v2l=Ce[4]|0,this.v2h=Ce[5]|0,this.v3l=Ce[6]|0,this.v3h=Ce[7]|0,this.v4l=Ce[8]|0,this.v4h=Ce[9]|0,this.v5l=Ce[10]|0,this.v5h=Ce[11]|0,this.v6l=Ce[12]|0,this.v6h=Ce[13]|0,this.v7l=Ce[14]|0,this.v7h=Ce[15]|0,_M(r,e,64,16,16);let{key:n,personalization:i,salt:s}=e,o=0;if(n!==void 0&&(n=Wn(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=Wn(s);const a=tc(s);this.v4l^=Rn(a[0]),this.v4h^=Rn(a[1]),this.v5l^=Rn(a[2]),this.v5h^=Rn(a[3])}if(i!==void 0){i=Wn(i);const a=tc(i);this.v6l^=Rn(a[0]),this.v6h^=Rn(a[1]),this.v7l^=Rn(a[2]),this.v7h^=Rn(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:n,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:f,v4h:u,v5l:l,v5h:h,v6l:d,v6h:p,v7l:w,v7h:m}=this;return[e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m]}set(e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m){this.v0l=e|0,this.v0h=r|0,this.v1l=n|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=f|0,this.v4h=u|0,this.v5l=l|0,this.v5h=h|0,this.v6l=d|0,this.v6h=p|0,this.v7l=w|0,this.v7h=m|0}compress(e,r,n){this.get().forEach((c,f)=>X[f]=c),X.set(Ce,16);let{h:i,l:s}=pv(BigInt(this.length));X[24]=Ce[8]^s,X[25]=Ce[9]^i,n&&(X[28]=~X[28],X[29]=~X[29]);let o=0;const a=OM;for(let c=0;c<12;c++)Ai(0,4,8,12,e,r+2*a[o++]),Ii(0,4,8,12,e,r+2*a[o++]),Ai(1,5,9,13,e,r+2*a[o++]),Ii(1,5,9,13,e,r+2*a[o++]),Ai(2,6,10,14,e,r+2*a[o++]),Ii(2,6,10,14,e,r+2*a[o++]),Ai(3,7,11,15,e,r+2*a[o++]),Ii(3,7,11,15,e,r+2*a[o++]),Ai(0,5,10,15,e,r+2*a[o++]),Ii(0,5,10,15,e,r+2*a[o++]),Ai(1,6,11,12,e,r+2*a[o++]),Ii(1,6,11,12,e,r+2*a[o++]),Ai(2,7,8,13,e,r+2*a[o++]),Ii(2,7,8,13,e,r+2*a[o++]),Ai(3,4,9,14,e,r+2*a[o++]),Ii(3,4,9,14,e,r+2*a[o++]);this.v0l^=X[0]^X[16],this.v0h^=X[1]^X[17],this.v1l^=X[2]^X[18],this.v1h^=X[3]^X[19],this.v2l^=X[4]^X[20],this.v2h^=X[5]^X[21],this.v3l^=X[6]^X[22],this.v3h^=X[7]^X[23],this.v4l^=X[8]^X[24],this.v4h^=X[9]^X[25],this.v5l^=X[10]^X[26],this.v5h^=X[11]^X[27],this.v6l^=X[12]^X[28],this.v6h^=X[13]^X[29],this.v7l^=X[14]^X[30],this.v7h^=X[15]^X[31],Wr(X)}destroy(){this.destroyed=!0,Wr(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const UM=iM(t=>new FM(t)),CM="https://rpc.walletconnect.org/v1";function Ov(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+ue.from(gM(r)).toString("hex")}async function PM(t,e,r,n,i,s){switch(r.t){case"eip191":return await RM(t,e,r.s);case"eip1271":return await NM(t,e,r.s,n,i,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}function RM(t,e,r){const n=NL(r);return qL({payload:Ov(e),signature:n}).toLowerCase()===t.toLowerCase()}async function NM(t,e,r,n,i,s){const o=Sf(n);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${n}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",f=r.substring(2),u=(f.length/2).toString(16).padStart(64,"0"),l=(e.startsWith("0x")?e:Ov(e)).substring(2),h=a+l+c+u+f,d=await fetch(`${s||CM}/?chainId=${n}&projectId=${i}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:TM(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:h},"latest"]})}),{result:p}=await d.json();return p?p.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function TM(){return Date.now()+Math.floor(Math.random()*1e3)}function LM(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const n=r[0];if(n===0)throw new Error("No signatures found");const i=1+n*64;if(r.length<i)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const s=ue.from(t,"base64").slice(1,65);return vc.encode(s)}function kM(t){const e=new Uint8Array(ue.from(t,"base64")),r=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),n=new Uint8Array(r.length+e.length);n.set(r),n.set(e,r.length);const i=UM(n,{dkLen:32});return vc.encode(i)}function Ww(t){const e=new Uint8Array(qu(jM(t)));return vc.encode(e)}function jM(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function Yw(t){const e=ue.from(t,"base64"),r=Px(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");const n=Ix(r),i=ue.from("TX"),s=ue.concat([i,ue.from(n)]),o=SM(s);return Y5.encode(o).replace(/=+$/,"")}function ml(t){const e=[];let r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),ue.from(e)}function qM(t){const e=ue.from(t.signed.bodyBytes,"base64"),r=ue.from(t.signed.authInfoBytes,"base64"),n=ue.from(t.signature.signature,"base64"),i=[];i.push(ue.from([10])),i.push(ml(e.length)),i.push(e),i.push(ue.from([18])),i.push(ml(r.length)),i.push(r),i.push(ue.from([26])),i.push(ml(n.length)),i.push(n);const s=ue.concat(i),o=qu(s);return ue.from(o).toString("hex").toUpperCase()}function MM(t){var e,r;const n=[];try{if(typeof t=="string")return n.push(t),n;if(typeof t!="object")return n;t!=null&&t.id&&n.push(t.id);const i=(r=(e=t==null?void 0:t.capabilities)==null?void 0:e.caip345)==null?void 0:r.transactionHashes;i&&n.push(...i)}catch(i){console.warn("getWalletSendCallsHashes failed: ",i)}return n}var zM=Object.defineProperty,HM=Object.defineProperties,VM=Object.getOwnPropertyDescriptors,Xw=Object.getOwnPropertySymbols,KM=Object.prototype.hasOwnProperty,GM=Object.prototype.propertyIsEnumerable,Jw=(t,e,r)=>e in t?zM(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ZM=(t,e)=>{for(var r in e||(e={}))KM.call(e,r)&&Jw(t,r,e[r]);if(Xw)for(var r of Xw(e))GM.call(e,r)&&Jw(t,r,e[r]);return t},WM=(t,e)=>HM(t,VM(e));const YM="did:pkh:",zp=t=>t==null?void 0:t.split(":"),XM=t=>{const e=t&&zp(t);if(e)return t.includes(YM)?e[3]:e[1]},u0=t=>{const e=t&&zp(t);if(e)return e[2]+":"+e[3]},ru=t=>{const e=t&&zp(t);if(e)return e.pop()};async function Qw(t){const{cacao:e,projectId:r}=t,{s:n,p:i}=e,s=_v(i,i.iss),o=ru(i.iss);return await PM(o,s,n,u0(i.iss),r)}const _v=(t,e)=>{const r=`${t.domain} wants you to sign in with your Ethereum account:`,n=ru(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let i=t.statement||void 0;const s=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${XM(e)}`,c=`Nonce: ${t.nonce}`,f=`Issued At: ${t.iat}`,u=t.exp?`Expiration Time: ${t.exp}`:void 0,l=t.nbf?`Not Before: ${t.nbf}`:void 0,h=t.requestId?`Request ID: ${t.requestId}`:void 0,d=t.resources?`Resources:${t.resources.map(w=>`
- ${w}`).join("")}`:void 0,p=Of(t.resources);if(p){const w=rc(p);i=oz(i,w)}return[r,n,"",i,"",s,o,a,c,f,u,l,h,d].filter(w=>w!=null).join(`
`)};function JM(t){return ue.from(JSON.stringify(t)).toString("base64")}function QM(t){return JSON.parse(ue.from(t,"base64").toString("utf-8"))}function Xs(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const n=t.att[r];if(Array.isArray(n))throw new Error(`Resource must be an object: ${r}`);if(typeof n!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(n).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(n).forEach(i=>{const s=n[i];if(!Array.isArray(s))throw new Error(`Ability limits ${i} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function ez(t,e,r,n={}){return r==null||r.sort((i,s)=>i.localeCompare(s)),{att:{[t]:tz(e,r,n)}}}function tz(t,e,r={}){e=e==null?void 0:e.sort((i,s)=>i.localeCompare(s));const n=e.map(i=>({[`${t}/${i}`]:[r]}));return Object.assign({},...n)}function Dv(t){return Xs(t),`urn:recap:${JM(t).replace(/=/g,"")}`}function rc(t){const e=QM(t.replace("urn:recap:",""));return Xs(e),e}function rz(t,e,r){const n=ez(t,e,r);return Dv(n)}function nz(t){return t&&t.includes("urn:recap:")}function iz(t,e){const r=rc(t),n=rc(e),i=sz(r,n);return Dv(i)}function sz(t,e){Xs(t),Xs(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((i,s)=>i.localeCompare(s)),n={att:{}};return r.forEach(i=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[i])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,f;n.att[i]=WM(ZM({},n.att[i]),{[a]:((c=t.att[i])==null?void 0:c[a])||((f=e.att[i])==null?void 0:f[a])})})}),n}function oz(t="",e){Xs(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const n=[];let i=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(l=>({ability:l.split("/")[0],action:l.split("/")[1]}));c.sort((l,h)=>l.action.localeCompare(h.action));const f={};c.forEach(l=>{f[l.ability]||(f[l.ability]=[]),f[l.ability].push(l.action)});const u=Object.keys(f).map(l=>(i++,`(${i}) '${l}': '${f[l].join("', '")}' for '${a}'.`));n.push(u.join(", ").replace(".,","."))});const s=n.join(" "),o=`${r}${s}`;return`${t?t+" ":""}${o}`}function eb(t){var e;const r=rc(t);Xs(r);const n=(e=r.att)==null?void 0:e.eip155;return n?Object.keys(n).map(i=>i.split("/")[1]):[]}function tb(t){const e=rc(t);Xs(e);const r=[];return Object.values(e.att).forEach(n=>{Object.values(n).forEach(i=>{var s;(s=i==null?void 0:i[0])!=null&&s.chains&&r.push(i[0].chains)})}),[...new Set(r.flat())]}function Of(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return nz(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function Fv(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function h0(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function El(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Kt(t,...e){if(!Fv(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function rb(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function az(t,e){Kt(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function es(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Go(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function cz(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const fz=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function uz(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function l0(t){if(typeof t=="string")t=uz(t);else if(Fv(t))t=d0(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function hz(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function lz(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const dz=(t,e)=>{function r(n,...i){if(Kt(n),!fz)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const f=i[0];if(!f)throw new Error("nonce / iv required");t.varSizeNonce?Kt(f):Kt(f,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&Kt(i[1]);const o=e(n,...i),a=(f,u)=>{if(u!==void 0){if(f!==2)throw new Error("cipher output not supported");Kt(u)}};let c=!1;return{encrypt(f,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Kt(f),a(o.encrypt.length,u),o.encrypt(f,u)},decrypt(f,u){if(Kt(f),s&&f.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,u),o.decrypt(f,u)}}}return Object.assign(r,t),r};function nb(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!gz(e))throw new Error("invalid output, must be aligned");return e}function ib(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function pz(t,e,r){h0(r);const n=new Uint8Array(16),i=cz(n);return ib(i,0,BigInt(e),r),ib(i,8,BigInt(t),r),n}function gz(t){return t.byteOffset%4===0}function d0(t){return Uint8Array.from(t)}const Uv=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),yz=Uv("expand 16-byte k"),wz=Uv("expand 32-byte k"),bz=es(yz),mz=es(wz);function ge(t,e){return t<<e|t>>>32-e}function p0(t){return t.byteOffset%4===0}const ef=64,Ez=16,Cv=2**32-1,sb=new Uint32Array;function vz(t,e,r,n,i,s,o,a){const c=i.length,f=new Uint8Array(ef),u=es(f),l=p0(i)&&p0(s),h=l?es(i):sb,d=l?es(s):sb;for(let p=0;p<c;o++){if(t(e,r,n,u,o,a),o>=Cv)throw new Error("arx: counter overflow");const w=Math.min(ef,c-p);if(l&&w===ef){const m=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let D=0,C;D<Ez;D++)C=m+D,d[C]=h[C]^u[D];p+=ef;continue}for(let m=0,D;m<w;m++)D=p+m,s[D]=i[D]^f[m];p+=w}}function xz(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=hz({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return El(i),El(o),h0(s),h0(r),(a,c,f,u,l=0)=>{Kt(a),Kt(c),Kt(f);const h=f.length;if(u===void 0&&(u=new Uint8Array(h)),Kt(u),El(l),l<0||l>=Cv)throw new Error("arx: counter overflow");if(u.length<h)throw new Error(`arx: output (${u.length}) is shorter than data (${h})`);const d=[];let p=a.length,w,m;if(p===32)d.push(w=d0(a)),m=mz;else if(p===16&&r)w=new Uint8Array(32),w.set(a),w.set(a,16),m=bz,d.push(w);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);p0(c)||d.push(c=d0(c));const D=es(w);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(m,D,es(c.subarray(0,16)),D),c=c.subarray(16)}const C=16-i;if(C!==c.length)throw new Error(`arx: nonce must be ${C} or 16 bytes`);if(C!==12){const B=new Uint8Array(12);B.set(c,s?0:12-c.length),c=B,d.push(c)}const b=es(c);return vz(t,m,D,b,f,u,l,o),Go(...d),u}}const Xe=(t,e)=>t[e++]&255|(t[e++]&255)<<8;let $z=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=l0(e),Kt(e,32);const r=Xe(e,0),n=Xe(e,2),i=Xe(e,4),s=Xe(e,6),o=Xe(e,8),a=Xe(e,10),c=Xe(e,12),f=Xe(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|f<<8)&8191,this.r[9]=f>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Xe(e,16+2*u)}process(e,r,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],f=o[2],u=o[3],l=o[4],h=o[5],d=o[6],p=o[7],w=o[8],m=o[9],D=Xe(e,r+0),C=Xe(e,r+2),b=Xe(e,r+4),B=Xe(e,r+6),F=Xe(e,r+8),_=Xe(e,r+10),N=Xe(e,r+12),P=Xe(e,r+14);let S=s[0]+(D&8191),T=s[1]+((D>>>13|C<<3)&8191),L=s[2]+((C>>>10|b<<6)&8191),O=s[3]+((b>>>7|B<<9)&8191),x=s[4]+((B>>>4|F<<12)&8191),$=s[5]+(F>>>1&8191),g=s[6]+((F>>>14|_<<2)&8191),y=s[7]+((_>>>11|N<<5)&8191),v=s[8]+((N>>>8|P<<8)&8191),I=s[9]+(P>>>5|i),E=0,A=E+S*a+T*(5*m)+L*(5*w)+O*(5*p)+x*(5*d);E=A>>>13,A&=8191,A+=$*(5*h)+g*(5*l)+y*(5*u)+v*(5*f)+I*(5*c),E+=A>>>13,A&=8191;let U=E+S*c+T*a+L*(5*m)+O*(5*w)+x*(5*p);E=U>>>13,U&=8191,U+=$*(5*d)+g*(5*h)+y*(5*l)+v*(5*u)+I*(5*f),E+=U>>>13,U&=8191;let R=E+S*f+T*c+L*a+O*(5*m)+x*(5*w);E=R>>>13,R&=8191,R+=$*(5*p)+g*(5*d)+y*(5*h)+v*(5*l)+I*(5*u),E+=R>>>13,R&=8191;let q=E+S*u+T*f+L*c+O*a+x*(5*m);E=q>>>13,q&=8191,q+=$*(5*w)+g*(5*p)+y*(5*d)+v*(5*h)+I*(5*l),E+=q>>>13,q&=8191;let j=E+S*l+T*u+L*f+O*c+x*a;E=j>>>13,j&=8191,j+=$*(5*m)+g*(5*w)+y*(5*p)+v*(5*d)+I*(5*h),E+=j>>>13,j&=8191;let k=E+S*h+T*l+L*u+O*f+x*c;E=k>>>13,k&=8191,k+=$*a+g*(5*m)+y*(5*w)+v*(5*p)+I*(5*d),E+=k>>>13,k&=8191;let M=E+S*d+T*h+L*l+O*u+x*f;E=M>>>13,M&=8191,M+=$*c+g*a+y*(5*m)+v*(5*w)+I*(5*p),E+=M>>>13,M&=8191;let H=E+S*p+T*d+L*h+O*l+x*u;E=H>>>13,H&=8191,H+=$*f+g*c+y*a+v*(5*m)+I*(5*w),E+=H>>>13,H&=8191;let V=E+S*w+T*p+L*d+O*h+x*l;E=V>>>13,V&=8191,V+=$*u+g*f+y*c+v*a+I*(5*m),E+=V>>>13,V&=8191;let z=E+S*m+T*w+L*p+O*d+x*h;E=z>>>13,z&=8191,z+=$*l+g*u+y*f+v*c+I*a,E+=z>>>13,z&=8191,E=(E<<2)+E|0,E=E+A|0,A=E&8191,E=E>>>13,U+=E,s[0]=A,s[1]=U,s[2]=R,s[3]=q,s[4]=j,s[5]=k,s[6]=M,s[7]=H,s[8]=V,s[9]=z}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;Go(n)}update(e){rb(this),e=l0(e),Kt(e);const{buffer:r,blockLen:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Go(this.h,this.r,this.buffer,this.pad)}digestInto(e){rb(this),az(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:i}=this;if(i){for(r[i++]=1;i<16;i++)r[i]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}};function Az(t){const e=(n,i)=>t(i).update(l0(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const Iz=Az(t=>new $z(t));function Bz(t,e,r,n,i,s=20){let o=t[0],a=t[1],c=t[2],f=t[3],u=e[0],l=e[1],h=e[2],d=e[3],p=e[4],w=e[5],m=e[6],D=e[7],C=i,b=r[0],B=r[1],F=r[2],_=o,N=a,P=c,S=f,T=u,L=l,O=h,x=d,$=p,g=w,y=m,v=D,I=C,E=b,A=B,U=F;for(let q=0;q<s;q+=2)_=_+T|0,I=ge(I^_,16),$=$+I|0,T=ge(T^$,12),_=_+T|0,I=ge(I^_,8),$=$+I|0,T=ge(T^$,7),N=N+L|0,E=ge(E^N,16),g=g+E|0,L=ge(L^g,12),N=N+L|0,E=ge(E^N,8),g=g+E|0,L=ge(L^g,7),P=P+O|0,A=ge(A^P,16),y=y+A|0,O=ge(O^y,12),P=P+O|0,A=ge(A^P,8),y=y+A|0,O=ge(O^y,7),S=S+x|0,U=ge(U^S,16),v=v+U|0,x=ge(x^v,12),S=S+x|0,U=ge(U^S,8),v=v+U|0,x=ge(x^v,7),_=_+L|0,U=ge(U^_,16),y=y+U|0,L=ge(L^y,12),_=_+L|0,U=ge(U^_,8),y=y+U|0,L=ge(L^y,7),N=N+O|0,I=ge(I^N,16),v=v+I|0,O=ge(O^v,12),N=N+O|0,I=ge(I^N,8),v=v+I|0,O=ge(O^v,7),P=P+x|0,E=ge(E^P,16),$=$+E|0,x=ge(x^$,12),P=P+x|0,E=ge(E^P,8),$=$+E|0,x=ge(x^$,7),S=S+T|0,A=ge(A^S,16),g=g+A|0,T=ge(T^g,12),S=S+T|0,A=ge(A^S,8),g=g+A|0,T=ge(T^g,7);let R=0;n[R++]=o+_|0,n[R++]=a+N|0,n[R++]=c+P|0,n[R++]=f+S|0,n[R++]=u+T|0,n[R++]=l+L|0,n[R++]=h+O|0,n[R++]=d+x|0,n[R++]=p+$|0,n[R++]=w+g|0,n[R++]=m+y|0,n[R++]=D+v|0,n[R++]=C+I|0,n[R++]=b+E|0,n[R++]=B+A|0,n[R++]=F+U|0}const Sz=xz(Bz,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Oz=new Uint8Array(16),ob=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(Oz.subarray(r))},_z=new Uint8Array(32);function ab(t,e,r,n,i){const s=t(e,r,_z),o=Iz.create(s);i&&ob(o,i),ob(o,n);const a=pz(n.length,i?i.length:0,!0);o.update(a);const c=o.digest();return Go(s,a),c}const Dz=t=>(e,r,n)=>({encrypt(i,s){const o=i.length;s=nb(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=ab(t,e,r,a,n);return s.set(c,o),Go(c),s},decrypt(i,s){s=nb(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=ab(t,e,r,o,n);if(!lz(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,r,s,s,1),Go(c),s}});dz({blockSize:64,nonceLength:12,tagLength:16},Dz(Sz));let Pv=class extends ju{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,yv(e);const n=Wn(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Wr(s)}update(e){return as(this),this.iHash.update(e),this}digestInto(e){as(this),Zr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Rv=(t,e,r)=>new Pv(t,e).update(r).digest();Rv.create=(t,e)=>new Pv(t,e);Uint8Array.from([0]);const Nv=qu,Hp=BigInt(0),g0=BigInt(1);function nu(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function js(t,e,r=""){const n=ku(t),i=t==null?void 0:t.length,s=e!==void 0;if(!n||s&&i!==e){const o=r&&`"${r}" `,a=s?` of length ${e}`:"",c=n?`length=${i}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function tf(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Tv(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Hp:BigInt("0x"+t)}function Mu(t){return Tv(To(t))}function iu(t){return Zr(t),Tv(To(Uint8Array.from(t).reverse()))}function Vp(t,e){return tu(t.toString(16).padStart(e*2,"0"))}function Kp(t,e){return Vp(t,e).reverse()}function $t(t,e,r){let n;if(typeof e=="string")try{n=tu(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(ku(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}const vl=t=>typeof t=="bigint"&&Hp<=t;function Fz(t,e,r){return vl(t)&&vl(e)&&vl(r)&&e<=t&&t<r}function y0(t,e,r,n){if(!Fz(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Lv(t){let e;for(e=0;t>Hp;t>>=g0,e+=1);return e}const Ac=t=>(g0<<BigInt(t))-g0;function Uz(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const n=h=>new Uint8Array(h),i=h=>Uint8Array.of(h);let s=n(t),o=n(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},f=(...h)=>r(o,s,...h),u=(h=n(0))=>{o=f(i(0),h),s=f(),h.length!==0&&(o=f(i(1),h),s=f())},l=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const d=[];for(;h<e;){s=f();const p=s.slice();d.push(p),h+=s.length}return Wi(...d)};return(h,d)=>{c(),u(h);let p;for(;!(p=d(l()));)u();return c(),p}}function zu(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(i,s,o){const a=t[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>n(i,s,!1)),Object.entries(r).forEach(([i,s])=>n(i,s,!0))}function cb(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const Jt=BigInt(0),Ut=BigInt(1),qs=BigInt(2),kv=BigInt(3),jv=BigInt(4),qv=BigInt(5),Cz=BigInt(7),Mv=BigInt(8),Pz=BigInt(9),zv=BigInt(16);function cr(t,e){const r=t%e;return r>=Jt?r:e+r}function Nr(t,e,r){let n=t;for(;e-- >Jt;)n*=n,n%=r;return n}function fb(t,e){if(t===Jt)throw new Error("invert: expected non-zero number");if(e<=Jt)throw new Error("invert: expected positive modulus, got "+e);let r=cr(t,e),n=e,i=Jt,s=Ut;for(;r!==Jt;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==Ut)throw new Error("invert: does not exist");return cr(i,e)}function Gp(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function Hv(t,e){const r=(t.ORDER+Ut)/jv,n=t.pow(e,r);return Gp(t,n,e),n}function Rz(t,e){const r=(t.ORDER-qv)/Mv,n=t.mul(e,qs),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,qs),i),a=t.mul(s,t.sub(o,t.ONE));return Gp(t,a,e),a}function Nz(t){const e=ls(t),r=Vv(t),n=r(e,e.neg(e.ONE)),i=r(e,n),s=r(e,e.neg(n)),o=(t+Cz)/zv;return(a,c)=>{let f=a.pow(c,o),u=a.mul(f,n);const l=a.mul(f,i),h=a.mul(f,s),d=a.eql(a.sqr(u),c),p=a.eql(a.sqr(l),c);f=a.cmov(f,u,d),u=a.cmov(h,l,p);const w=a.eql(a.sqr(u),c),m=a.cmov(f,u,w);return Gp(a,m,c),m}}function Vv(t){if(t<kv)throw new Error("sqrt is not defined for small field");let e=t-Ut,r=0;for(;e%qs===Jt;)e/=qs,r++;let n=qs;const i=ls(t);for(;ub(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Hv;let s=i.pow(n,e);const o=(e+Ut)/qs;return function(a,c){if(a.is0(c))return c;if(ub(a,c)!==1)throw new Error("Cannot find square root");let f=r,u=a.mul(a.ONE,s),l=a.pow(c,e),h=a.pow(c,o);for(;!a.eql(l,a.ONE);){if(a.is0(l))return a.ZERO;let d=1,p=a.sqr(l);for(;!a.eql(p,a.ONE);)if(d++,p=a.sqr(p),d===f)throw new Error("Cannot find square root");const w=Ut<<BigInt(f-d-1),m=a.pow(u,w);f=d,u=a.sqr(m),l=a.mul(l,u),h=a.mul(h,m)}return h}}function Tz(t){return t%jv===kv?Hv:t%Mv===qv?Rz:t%zv===Pz?Nz(t):Vv(t)}const Lz=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function kz(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=Lz.reduce((n,i)=>(n[i]="function",n),e);return zu(t,r),t}function jz(t,e,r){if(r<Jt)throw new Error("invalid exponent, negatives unsupported");if(r===Jt)return t.ONE;if(r===Ut)return e;let n=t.ONE,i=e;for(;r>Jt;)r&Ut&&(n=t.mul(n,i)),i=t.sqr(i),r>>=Ut;return n}function Kv(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),s),n}function ub(t,e){const r=(t.ORDER-Ut)/qs,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function Gv(t,e){e!==void 0&&os(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function ls(t,e,r=!1,n={}){if(t<=Jt)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const h=e;h.BITS&&(i=h.BITS),h.sqrt&&(s=h.sqrt),typeof h.isLE=="boolean"&&(r=h.isLE),typeof h.modFromBytes=="boolean"&&(o=h.modFromBytes),a=h.allowedLengths}else typeof e=="number"&&(i=e),n.sqrt&&(s=n.sqrt);const{nBitLength:c,nByteLength:f}=Gv(t,i);if(f>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const l=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:f,MASK:Ac(c),ZERO:Jt,ONE:Ut,allowedLengths:a,create:h=>cr(h,t),isValid:h=>{if(typeof h!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof h);return Jt<=h&&h<t},is0:h=>h===Jt,isValidNot0:h=>!l.is0(h)&&l.isValid(h),isOdd:h=>(h&Ut)===Ut,neg:h=>cr(-h,t),eql:(h,d)=>h===d,sqr:h=>cr(h*h,t),add:(h,d)=>cr(h+d,t),sub:(h,d)=>cr(h-d,t),mul:(h,d)=>cr(h*d,t),pow:(h,d)=>jz(l,h,d),div:(h,d)=>cr(h*fb(d,t),t),sqrN:h=>h*h,addN:(h,d)=>h+d,subN:(h,d)=>h-d,mulN:(h,d)=>h*d,inv:h=>fb(h,t),sqrt:s||(h=>(u||(u=Tz(t)),u(l,h))),toBytes:h=>r?Kp(h,f):Vp(h,f),fromBytes:(h,d=!0)=>{if(a){if(!a.includes(h.length)||h.length>f)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+h.length);const w=new Uint8Array(f);w.set(h,r?0:w.length-h.length),h=w}if(h.length!==f)throw new Error("Field.fromBytes: expected "+f+" bytes, got "+h.length);let p=r?iu(h):Mu(h);if(o&&(p=cr(p,t)),!d&&!l.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:h=>Kv(l,h),cmov:(h,d,p)=>p?d:h});return Object.freeze(l)}function Zv(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Wv(t){const e=Zv(t);return e+Math.ceil(e/2)}function qz(t,e,r=!1){const n=t.length,i=Zv(e),s=Wv(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?iu(t):Mu(t),a=cr(o,e-Ut)+Ut;return r?Kp(a,i):Vp(a,i)}const Zo=BigInt(0),Ms=BigInt(1);function su(t,e){const r=e.negate();return t?r:e}function xl(t,e){const r=Kv(t.Fp,e.map(n=>n.Z));return e.map((n,i)=>t.fromAffine(n.toAffine(r[i])))}function Yv(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function $l(t,e){Yv(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=Ac(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function hb(t,e,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(t&i),c=t>>o;a>n&&(a-=s,c+=Ms);const f=e*n,u=f+Math.abs(a)-1,l=a===0,h=a<0,d=e%2!==0;return{nextN:c,offset:u,isZero:l,isNeg:h,isNegF:d,offsetF:f}}function Mz(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function zz(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Al=new WeakMap,Xv=new WeakMap;function Il(t){return Xv.get(t)||1}function lb(t){if(t!==Zo)throw new Error("invalid wNAF")}let Hz=class{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let i=e;for(;r>Zo;)r&Ms&&(n=n.add(i)),i=i.double(),r>>=Ms;return n}precomputeWindow(e,r){const{windows:n,windowSize:i}=$l(r,this.bits),s=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,s.push(a);for(let f=1;f<i;f++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=$l(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:f,isZero:u,isNeg:l,isNegF:h,offsetF:d}=hb(n,a,o);n=c,u?s=s.add(su(h,r[d])):i=i.add(su(l,r[f]))}return lb(n),{p:i,f:s}}wNAFUnsafe(e,r,n,i=this.ZERO){const s=$l(e,this.bits);for(let o=0;o<s.windows&&n!==Zo;o++){const{nextN:a,offset:c,isZero:f,isNeg:u}=hb(n,o,s);if(n=a,!f){const l=r[c];i=i.add(u?l.negate():l)}}return lb(n),i}getPrecomputes(e,r,n){let i=Al.get(r);return i||(i=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(i=n(i)),Al.set(r,i))),i}cached(e,r,n){const i=Il(e);return this.wNAF(i,this.getPrecomputes(i,e,n),r)}unsafe(e,r,n,i){const s=Il(e);return s===1?this._unsafeLadder(e,r,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,n),r,i)}createCache(e,r){Yv(r,this.bits),Xv.set(e,r),Al.delete(e)}hasCache(e){return Il(e)!==1}};function Vz(t,e,r,n){let i=e,s=t.ZERO,o=t.ZERO;for(;r>Zo||n>Zo;)r&Ms&&(s=s.add(i)),n&Ms&&(o=o.add(i)),i=i.double(),r>>=Ms,n>>=Ms;return{p1:s,p2:o}}function Kz(t,e,r,n){Mz(r,t),zz(n,e);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Lv(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const f=Ac(c),u=new Array(Number(f)+1).fill(o),l=Math.floor((e.BITS-1)/c)*c;let h=o;for(let d=l;d>=0;d-=c){u.fill(o);for(let w=0;w<s;w++){const m=n[w],D=Number(m>>BigInt(d)&f);u[D]=u[D].add(r[w])}let p=o;for(let w=u.length-1,m=o;w>0;w--)m=m.add(u[w]),p=p.add(m);if(h=h.add(p),d!==0)for(let w=0;w<c;w++)h=h.double()}return h}function db(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return kz(e),e}else return ls(t,{isLE:r})}function Gz(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>Zo))throw new Error(`CURVE.${a} must be positive bigint`)}const i=db(e.p,r.Fp,n),s=db(e.n,r.Fn,n),o=["Gx","Gy","a","b"];for(const a of o)if(!i.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),Ev("HashToScalar-");const ma=BigInt(0),bo=BigInt(1),rf=BigInt(2);function Zz(t){return zu(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function Wz(t){const e=Zz(t),{P:r,type:n,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||qp,f=a?255:448,u=a?32:56,l=BigInt(a?9:5),h=BigInt(a?121665:39081),d=a?rf**BigInt(254):rf**BigInt(447),p=a?BigInt(8)*rf**BigInt(251)-bo:BigInt(4)*rf**BigInt(445)-bo,w=d+p+bo,m=O=>cr(O,r),D=C(l);function C(O){return Kp(m(O),u)}function b(O){const x=$t("u coordinate",O,u);return a&&(x[31]&=127),m(iu(x))}function B(O){return iu(i($t("scalar",O,u)))}function F(O,x){const $=P(b(x),B(O));if($===ma)throw new Error("invalid private or public key received");return C($)}function _(O){return F(O,D)}function N(O,x,$){const g=m(O*(x-$));return x=m(x-g),$=m($+g),{x_2:x,x_3:$}}function P(O,x){y0("u",O,ma,r),y0("scalar",x,d,w);const $=x,g=O;let y=bo,v=ma,I=O,E=bo,A=ma;for(let R=BigInt(f-1);R>=ma;R--){const q=$>>R&bo;A^=q,{x_2:y,x_3:I}=N(A,y,I),{x_2:v,x_3:E}=N(A,v,E),A=q;const j=y+v,k=m(j*j),M=y-v,H=m(M*M),V=k-H,z=I+E,K=I-E,Q=m(K*j),ee=m(z*M),ne=Q+ee,he=Q-ee;I=m(ne*ne),E=m(g*m(he*he)),y=m(k*H),v=m(V*(k+m(h*V)))}({x_2:y,x_3:I}=N(A,y,I)),{x_2:v,x_3:E}=N(A,v,E);const U=s(v);return m(y*U)}const S={secretKey:u,publicKey:u,seed:u},T=(O=c(u))=>(Zr(O,S.seed),O);function L(O){const x=T(O);return{secretKey:x,publicKey:_(x)}}return{keygen:L,getSharedSecret:(O,x)=>F(O,x),getPublicKey:O=>_(O),scalarMult:F,scalarMultBase:_,utils:{randomSecretKey:T,randomPrivateKey:T},GuBytes:D.slice(),lengths:S}}const Yz=BigInt(1),pb=BigInt(2),Xz=BigInt(3),Jz=BigInt(5);BigInt(8);const Jv=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Qz={p:Jv,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function eH(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=Jv,o=t*t%s*t%s,a=Nr(o,pb,s)*o%s,c=Nr(a,Yz,s)*t%s,f=Nr(c,Jz,s)*c%s,u=Nr(f,e,s)*f%s,l=Nr(u,r,s)*u%s,h=Nr(l,n,s)*l%s,d=Nr(h,i,s)*h%s,p=Nr(d,i,s)*h%s,w=Nr(p,e,s)*f%s;return{pow_p_5_8:Nr(w,pb,s)*t%s,b2:o}}function tH(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const rH=ls(Qz.p,{isLE:!0});(()=>{const t=rH.ORDER;return Wz({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:n}=eH(e);return cr(Nr(r,Xz,t)*n,t)},adjustScalarBytes:tH})})();const gb=(t,e)=>(t+(t>=0?e:-e)/Qv)/e;function nH(t,e,r){const[[n,i],[s,o]]=e,a=gb(o*t,r),c=gb(-i*t,r);let f=t-a*n-c*s,u=-a*i-c*o;const l=f<Kn,h=u<Kn;l&&(f=-f),h&&(u=-u);const d=Ac(Math.ceil(Lv(r)/2))+Lo;if(f<Kn||f>=d||u<Kn||u>=d)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:l,k1:f,k2neg:h,k2:u}}function w0(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function Bl(t,e){const r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return nu(r.lowS,"lowS"),nu(r.prehash,"prehash"),r.format!==void 0&&w0(r.format),r}let iH=class extends Error{constructor(e=""){super(e)}};const qn={Err:iH,_tlv:{encode:(t,e)=>{const{Err:r}=qn;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=tf(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?tf(i.length/2|128):"";return tf(t)+s+i+e},decode(t,e){const{Err:r}=qn;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const f=e.subarray(n,n+c);if(f.length!==c)throw new r("tlv.decode: length bytes not complete");if(f[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of f)o=o<<8|u;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=qn;if(t<Kn)throw new e("integer: negative integers are not allowed");let r=tf(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=qn;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Mu(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=qn,i=$t("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:f,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(f)}},hexFromSig(t){const{_tlv:e,_int:r}=qn,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}},Kn=BigInt(0),Lo=BigInt(1),Qv=BigInt(2),nf=BigInt(3),sH=BigInt(4);function _o(t,e){const{BYTES:r}=t;let n;if(typeof e=="bigint")n=e;else{let i=$t("private key",e);try{n=t.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function oH(t,e={}){const r=Gz("weierstrass",t,e),{Fp:n,Fn:i}=r;let s=r.CURVE;const{h:o,n:a}=s;zu(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const f=t6(n,i);function u(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function l(O,x,$){const{x:g,y}=x.toAffine(),v=n.toBytes(g);if(nu($,"isCompressed"),$){u();const I=!n.isOdd(y);return Wi(e6(I),v)}else return Wi(Uint8Array.of(4),v,n.toBytes(y))}function h(O){js(O,void 0,"Point");const{publicKey:x,publicKeyUncompressed:$}=f,g=O.length,y=O[0],v=O.subarray(1);if(g===x&&(y===2||y===3)){const I=n.fromBytes(v);if(!n.isValid(I))throw new Error("bad point: is not on curve, wrong x");const E=w(I);let A;try{A=n.sqrt(E)}catch(R){const q=R instanceof Error?": "+R.message:"";throw new Error("bad point: is not on curve, sqrt error"+q)}u();const U=n.isOdd(A);return(y&1)===1!==U&&(A=n.neg(A)),{x:I,y:A}}else if(g===$&&y===4){const I=n.BYTES,E=n.fromBytes(v.subarray(0,I)),A=n.fromBytes(v.subarray(I,I*2));if(!m(E,A))throw new Error("bad point: is not on curve");return{x:E,y:A}}else throw new Error(`bad point: got length ${g}, expected compressed=${x} or uncompressed=${$}`)}const d=e.toBytes||l,p=e.fromBytes||h;function w(O){const x=n.sqr(O),$=n.mul(x,O);return n.add(n.add($,n.mul(O,s.a)),s.b)}function m(O,x){const $=n.sqr(x),g=w(O);return n.eql($,g)}if(!m(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const D=n.mul(n.pow(s.a,nf),sH),C=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(D,C)))throw new Error("bad curve params: a or b");function b(O,x,$=!1){if(!n.isValid(x)||$&&n.is0(x))throw new Error(`bad point coordinate ${O}`);return x}function B(O){if(!(O instanceof S))throw new Error("ProjectivePoint expected")}function F(O){if(!c||!c.basises)throw new Error("no endo");return nH(O,c.basises,i.ORDER)}const _=cb((O,x)=>{const{X:$,Y:g,Z:y}=O;if(n.eql(y,n.ONE))return{x:$,y:g};const v=O.is0();x==null&&(x=v?n.ONE:n.inv(y));const I=n.mul($,x),E=n.mul(g,x),A=n.mul(y,x);if(v)return{x:n.ZERO,y:n.ZERO};if(!n.eql(A,n.ONE))throw new Error("invZ was invalid");return{x:I,y:E}}),N=cb(O=>{if(O.is0()){if(e.allowInfinityPoint&&!n.is0(O.Y))return;throw new Error("bad point: ZERO")}const{x,y:$}=O.toAffine();if(!n.isValid(x)||!n.isValid($))throw new Error("bad point: x or y not field elements");if(!m(x,$))throw new Error("bad point: equation left != right");if(!O.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function P(O,x,$,g,y){return $=new S(n.mul($.X,O),$.Y,$.Z),x=su(g,x),$=su(y,$),x.add($)}class S{constructor(x,$,g){this.X=b("x",x),this.Y=b("y",$,!0),this.Z=b("z",g),Object.freeze(this)}static CURVE(){return s}static fromAffine(x){const{x:$,y:g}=x||{};if(!x||!n.isValid($)||!n.isValid(g))throw new Error("invalid affine point");if(x instanceof S)throw new Error("projective point not allowed");return n.is0($)&&n.is0(g)?S.ZERO:new S($,g,n.ONE)}static fromBytes(x){const $=S.fromAffine(p(js(x,void 0,"point")));return $.assertValidity(),$}static fromHex(x){return S.fromBytes($t("pointHex",x))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(x=8,$=!0){return L.createCache(this,x),$||this.multiply(nf),this}assertValidity(){N(this)}hasEvenY(){const{y:x}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(x)}equals(x){B(x);const{X:$,Y:g,Z:y}=this,{X:v,Y:I,Z:E}=x,A=n.eql(n.mul($,E),n.mul(v,y)),U=n.eql(n.mul(g,E),n.mul(I,y));return A&&U}negate(){return new S(this.X,n.neg(this.Y),this.Z)}double(){const{a:x,b:$}=s,g=n.mul($,nf),{X:y,Y:v,Z:I}=this;let E=n.ZERO,A=n.ZERO,U=n.ZERO,R=n.mul(y,y),q=n.mul(v,v),j=n.mul(I,I),k=n.mul(y,v);return k=n.add(k,k),U=n.mul(y,I),U=n.add(U,U),E=n.mul(x,U),A=n.mul(g,j),A=n.add(E,A),E=n.sub(q,A),A=n.add(q,A),A=n.mul(E,A),E=n.mul(k,E),U=n.mul(g,U),j=n.mul(x,j),k=n.sub(R,j),k=n.mul(x,k),k=n.add(k,U),U=n.add(R,R),R=n.add(U,R),R=n.add(R,j),R=n.mul(R,k),A=n.add(A,R),j=n.mul(v,I),j=n.add(j,j),R=n.mul(j,k),E=n.sub(E,R),U=n.mul(j,q),U=n.add(U,U),U=n.add(U,U),new S(E,A,U)}add(x){B(x);const{X:$,Y:g,Z:y}=this,{X:v,Y:I,Z:E}=x;let A=n.ZERO,U=n.ZERO,R=n.ZERO;const q=s.a,j=n.mul(s.b,nf);let k=n.mul($,v),M=n.mul(g,I),H=n.mul(y,E),V=n.add($,g),z=n.add(v,I);V=n.mul(V,z),z=n.add(k,M),V=n.sub(V,z),z=n.add($,y);let K=n.add(v,E);return z=n.mul(z,K),K=n.add(k,H),z=n.sub(z,K),K=n.add(g,y),A=n.add(I,E),K=n.mul(K,A),A=n.add(M,H),K=n.sub(K,A),R=n.mul(q,z),A=n.mul(j,H),R=n.add(A,R),A=n.sub(M,R),R=n.add(M,R),U=n.mul(A,R),M=n.add(k,k),M=n.add(M,k),H=n.mul(q,H),z=n.mul(j,z),M=n.add(M,H),H=n.sub(k,H),H=n.mul(q,H),z=n.add(z,H),k=n.mul(M,z),U=n.add(U,k),k=n.mul(K,z),A=n.mul(V,A),A=n.sub(A,k),k=n.mul(V,M),R=n.mul(K,R),R=n.add(R,k),new S(A,U,R)}subtract(x){return this.add(x.negate())}is0(){return this.equals(S.ZERO)}multiply(x){const{endo:$}=e;if(!i.isValidNot0(x))throw new Error("invalid scalar: out of range");let g,y;const v=I=>L.cached(this,I,E=>xl(S,E));if($){const{k1neg:I,k1:E,k2neg:A,k2:U}=F(x),{p:R,f:q}=v(E),{p:j,f:k}=v(U);y=q.add(k),g=P($.beta,R,j,I,A)}else{const{p:I,f:E}=v(x);g=I,y=E}return xl(S,[g,y])[0]}multiplyUnsafe(x){const{endo:$}=e,g=this;if(!i.isValid(x))throw new Error("invalid scalar: out of range");if(x===Kn||g.is0())return S.ZERO;if(x===Lo)return g;if(L.hasCache(this))return this.multiply(x);if($){const{k1neg:y,k1:v,k2neg:I,k2:E}=F(x),{p1:A,p2:U}=Vz(S,g,v,E);return P($.beta,A,U,y,I)}else return L.unsafe(g,x)}multiplyAndAddUnsafe(x,$,g){const y=this.multiplyUnsafe($).add(x.multiplyUnsafe(g));return y.is0()?void 0:y}toAffine(x){return _(this,x)}isTorsionFree(){const{isTorsionFree:x}=e;return o===Lo?!0:x?x(S,this):L.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:x}=e;return o===Lo?this:x?x(S,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(x=!0){return nu(x,"isCompressed"),this.assertValidity(),d(S,this,x)}toHex(x=!0){return To(this.toBytes(x))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(x=!0){return this.toBytes(x)}_setWindowSize(x){this.precompute(x)}static normalizeZ(x){return xl(S,x)}static msm(x,$){return Kz(S,i,x,$)}static fromPrivateKey(x){return S.BASE.multiply(_o(i,x))}}S.BASE=new S(s.Gx,s.Gy,n.ONE),S.ZERO=new S(n.ZERO,n.ONE,n.ZERO),S.Fp=n,S.Fn=i;const T=i.BITS,L=new Hz(S,e.endo?Math.ceil(T/2):T);return S.BASE.precompute(8),S}function e6(t){return Uint8Array.of(t?2:3)}function t6(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function aH(t,e={}){const{Fn:r}=t,n=e.randomBytes||qp,i=Object.assign(t6(t.Fp,r),{seed:Wv(r.ORDER)});function s(h){try{return!!_o(r,h)}catch{return!1}}function o(h,d){const{publicKey:p,publicKeyUncompressed:w}=i;try{const m=h.length;return d===!0&&m!==p||d===!1&&m!==w?!1:!!t.fromBytes(h)}catch{return!1}}function a(h=n(i.seed)){return qz(js(h,i.seed,"seed"),r.ORDER)}function c(h,d=!0){return t.BASE.multiply(_o(r,h)).toBytes(d)}function f(h){const d=a(h);return{secretKey:d,publicKey:c(d)}}function u(h){if(typeof h=="bigint")return!1;if(h instanceof t)return!0;const{secretKey:d,publicKey:p,publicKeyUncompressed:w}=i;if(r.allowedLengths||d===p)return;const m=$t("key",h).length;return m===p||m===w}function l(h,d,p=!0){if(u(h)===!0)throw new Error("first arg must be private key");if(u(d)===!1)throw new Error("second arg must be public key");const w=_o(r,h);return t.fromHex(d).multiply(w).toBytes(p)}return Object.freeze({getPublicKey:c,getSharedSecret:l,keygen:f,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:h=>_o(r,h),precompute(h=8,d=t.BASE){return d.precompute(h,!1)}},lengths:i})}function cH(t,e,r={}){yv(e),zu(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=r.randomBytes||qp,i=r.hmac||(($,...g)=>Rv(e,$,Wi(...g))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:f,getPublicKey:u,getSharedSecret:l,utils:h,lengths:d}=aH(t,r),p={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},w="compact";function m($){const g=a>>Lo;return $>g}function D($,g){if(!o.isValidNot0(g))throw new Error(`invalid signature ${$}: out of range 1..Point.Fn.ORDER`);return g}function C($,g){w0(g);const y=d.signature,v=g==="compact"?y:g==="recovered"?y+1:void 0;return js($,v,`${g} signature`)}class b{constructor(g,y,v){this.r=D("r",g),this.s=D("s",y),v!=null&&(this.recovery=v),Object.freeze(this)}static fromBytes(g,y=w){C(g,y);let v;if(y==="der"){const{r:U,s:R}=qn.toSig(js(g));return new b(U,R)}y==="recovered"&&(v=g[0],y="compact",g=g.subarray(1));const I=o.BYTES,E=g.subarray(0,I),A=g.subarray(I,I*2);return new b(o.fromBytes(E),o.fromBytes(A),v)}static fromHex(g,y){return this.fromBytes(tu(g),y)}addRecoveryBit(g){return new b(this.r,this.s,g)}recoverPublicKey(g){const y=s.ORDER,{r:v,s:I,recovery:E}=this;if(E==null||![0,1,2,3].includes(E))throw new Error("recovery id invalid");if(a*Qv<y&&E>1)throw new Error("recovery id is ambiguous for h>1 curve");const A=E===2||E===3?v+a:v;if(!s.isValid(A))throw new Error("recovery id 2 or 3 invalid");const U=s.toBytes(A),R=t.fromBytes(Wi(e6((E&1)===0),U)),q=o.inv(A),j=F($t("msgHash",g)),k=o.create(-j*q),M=o.create(I*q),H=t.BASE.multiplyUnsafe(k).add(R.multiplyUnsafe(M));if(H.is0())throw new Error("point at infinify");return H.assertValidity(),H}hasHighS(){return m(this.s)}toBytes(g=w){if(w0(g),g==="der")return tu(qn.hexFromSig(this));const y=o.toBytes(this.r),v=o.toBytes(this.s);if(g==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Wi(Uint8Array.of(this.recovery),y,v)}return Wi(y,v)}toHex(g){return To(this.toBytes(g))}assertValidity(){}static fromCompact(g){return b.fromBytes($t("sig",g),"compact")}static fromDER(g){return b.fromBytes($t("sig",g),"der")}normalizeS(){return this.hasHighS()?new b(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return To(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return To(this.toBytes("compact"))}}const B=r.bits2int||function($){if($.length>8192)throw new Error("input is too large");const g=Mu($),y=$.length*8-c;return y>0?g>>BigInt(y):g},F=r.bits2int_modN||function($){return o.create(B($))},_=Ac(c);function N($){return y0("num < 2^"+c,$,Kn,_),o.toBytes($)}function P($,g){return js($,void 0,"message"),g?js(e($),void 0,"prehashed message"):$}function S($,g,y){if(["recovered","canonical"].some(M=>M in y))throw new Error("sign() legacy options not supported");const{lowS:v,prehash:I,extraEntropy:E}=Bl(y,p);$=P($,I);const A=F($),U=_o(o,g),R=[N(U),N(A)];if(E!=null&&E!==!1){const M=E===!0?n(d.secretKey):E;R.push($t("extraEntropy",M))}const q=Wi(...R),j=A;function k(M){const H=B(M);if(!o.isValidNot0(H))return;const V=o.inv(H),z=t.BASE.multiply(H).toAffine(),K=o.create(z.x);if(K===Kn)return;const Q=o.create(V*o.create(j+K*U));if(Q===Kn)return;let ee=(z.x===K?0:2)|Number(z.y&Lo),ne=Q;return v&&m(Q)&&(ne=o.neg(Q),ee^=1),new b(K,ne,ee)}return{seed:q,k2sig:k}}function T($,g,y={}){$=$t("message",$);const{seed:v,k2sig:I}=S($,g,y);return Uz(e.outputLen,o.BYTES,i)(v,I)}function L($){let g;const y=typeof $=="string"||ku($),v=!y&&$!==null&&typeof $=="object"&&typeof $.r=="bigint"&&typeof $.s=="bigint";if(!y&&!v)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(v)g=new b($.r,$.s);else if(y){try{g=b.fromBytes($t("sig",$),"der")}catch(I){if(!(I instanceof qn.Err))throw I}if(!g)try{g=b.fromBytes($t("sig",$),"compact")}catch{return!1}}return g||!1}function O($,g,y,v={}){const{lowS:I,prehash:E,format:A}=Bl(v,p);if(y=$t("publicKey",y),g=P($t("message",g),E),"strict"in v)throw new Error("options.strict was renamed to lowS");const U=A===void 0?L($):b.fromBytes($t("sig",$),A);if(U===!1)return!1;try{const R=t.fromBytes(y);if(I&&U.hasHighS())return!1;const{r:q,s:j}=U,k=F(g),M=o.inv(j),H=o.create(k*M),V=o.create(q*M),z=t.BASE.multiplyUnsafe(H).add(R.multiplyUnsafe(V));return z.is0()?!1:o.create(z.x)===q}catch{return!1}}function x($,g,y={}){const{prehash:v}=Bl(y,p);return g=P(g,v),b.fromBytes($,"recovered").recoverPublicKey(g).toBytes()}return Object.freeze({keygen:f,getPublicKey:u,getSharedSecret:l,utils:h,lengths:d,Point:t,sign:T,verify:O,recoverPublicKey:x,Signature:b,hash:e})}function fH(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=ls(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),s={Fp:r,Fn:i,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function uH(t){const{CURVE:e,curveOpts:r}=fH(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function hH(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,Gv(r.Fn.ORDER,r.Fn.BITS))})}function lH(t){const{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:i}=uH(t),s=oH(e,r),o=cH(s,n,i);return hH(t,o)}function b0(t,e){const r=n=>lH({...t,hash:n});return{...r(e),create:r}}const r6={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},n6={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},i6={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},dH=ls(r6.p),pH=ls(n6.p),gH=ls(i6.p);b0({...r6,Fp:dH,lowS:!1},qu);b0({...n6,Fp:pH,lowS:!1},BM),b0({...i6,Fp:gH,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},IM);const m0="base16",$s="base64pad",Ea="base64url",yH="utf8",Sl=1,wH=2;function Ol(t){const e=Nv(cv(t,m0));return fv(e,m0)}function Bi(t){const e=Nv(cv(t,yH));return fv(e,m0)}function sf(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var bH=Object.defineProperty,mH=Object.defineProperties,EH=Object.getOwnPropertyDescriptors,yb=Object.getOwnPropertySymbols,vH=Object.prototype.hasOwnProperty,xH=Object.prototype.propertyIsEnumerable,wb=(t,e,r)=>e in t?bH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$H=(t,e)=>{for(var r in e||(e={}))vH.call(e,r)&&wb(t,r,e[r]);if(yb)for(var r of yb(e))xH.call(e,r)&&wb(t,r,e[r]);return t},AH=(t,e)=>mH(t,EH(e));function ea(t){const e=[];return t.forEach(r=>{const[n,i]=r.split(":");e.push(`${n}:${i}`)}),e}function IH(t){const e=[];return Object.values(t).forEach(r=>{e.push(...ea(r.accounts))}),e}function BH(t,e){const r=[];return Object.values(t).forEach(n=>{ea(n.accounts).includes(e)&&r.push(...n.methods)}),r}function SH(t,e){const r=[];return Object.values(t).forEach(n=>{ea(n.accounts).includes(e)&&r.push(...n.events)}),r}function s6(t){return t.includes(":")}function OH(t){return s6(t)?t.split(":")[0]:t}function bb(t){var e,r,n;const i={};if(!nc(t))return i;for(const[s,o]of Object.entries(t)){const a=s6(s)?[s]:o.chains,c=o.methods||[],f=o.events||[],u=OH(s);i[u]=AH($H({},i[u]),{chains:Zs(a,(e=i[u])==null?void 0:e.chains),methods:Zs(c,(r=i[u])==null?void 0:r.methods),events:Zs(f,(n=i[u])==null?void 0:n.events)})}return i}function _H(t){const e={};return t==null||t.forEach(r=>{var n;const[i,s]=r.split(":");e[i]||(e[i]={accounts:[],chains:[],events:[],methods:[]}),e[i].accounts.push(r),(n=e[i].chains)==null||n.push(`${i}:${s}`)}),e}function mb(t,e){e=e.map(n=>n.replace("did:pkh:",""));const r=_H(e);for(const[n,i]of Object.entries(r))i.methods?i.methods=Zs(i.methods,t):i.methods=t,i.events=["chainChanged","accountsChanged"];return r}function DH(t,e){var r,n,i,s,o,a;const c=bb(t),f=bb(e),u={},l=Object.keys(c).concat(Object.keys(f));for(const h of l)u[h]={chains:Zs((r=c[h])==null?void 0:r.chains,(n=f[h])==null?void 0:n.chains),methods:Zs((i=c[h])==null?void 0:i.methods,(s=f[h])==null?void 0:s.methods),events:Zs((o=c[h])==null?void 0:o.events,(a=f[h])==null?void 0:a.events)};return u}const FH={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},UH={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function te(t,e){const{message:r,code:n}=UH[t];return{message:e?`${r} ${e}`:r,code:n}}function et(t,e){const{message:r,code:n}=FH[t];return{message:e?`${r} ${e}`:r,code:n}}function Wo(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function nc(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Gt(t){return typeof t>"u"}function Me(t,e){return e&&Gt(t)?!0:typeof t=="string"&&!!t.trim().length}function Zp(t,e){return e&&Gt(t)?!0:typeof t=="number"&&!isNaN(t)}function CH(t,e){const{requiredNamespaces:r}=e,n=Object.keys(t.namespaces),i=Object.keys(r);let s=!0;return ks(i,n)?(n.forEach(o=>{const{accounts:a,methods:c,events:f}=t.namespaces[o],u=ea(a),l=r[o];(!ks(uv(o,l),u)||!ks(l.methods,c)||!ks(l.events,f))&&(s=!1)}),s):!1}function ou(t){return Me(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function PH(t){if(Me(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&ou(r)}}return!1}function RH(t,e){let r=null;return Me(t==null?void 0:t.publicKey,!1)||(r=te("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Eb(t){let e=!0;return Wo(t)?t.length&&(e=t.every(r=>Me(r,!1))):e=!1,e}function NH(t,e,r){let n=null;return Wo(e)&&e.length?e.forEach(i=>{n||ou(i)||(n=et("UNSUPPORTED_CHAINS",`${r}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):ou(t)||(n=et("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function TH(t,e,r){let n=null;return Object.entries(t).forEach(([i,s])=>{if(n)return;const o=NH(i,uv(i,s),`${e} ${r}`);o&&(n=o)}),n}function LH(t,e){let r=null;return Wo(t)?t.forEach(n=>{r||PH(n)||(r=et("UNSUPPORTED_ACCOUNTS",`${e}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):r=et("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function kH(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;const i=LH(n==null?void 0:n.accounts,`${e} namespace`);i&&(r=i)}),r}function jH(t,e){let r=null;return Eb(t==null?void 0:t.methods)?Eb(t==null?void 0:t.events)||(r=et("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=et("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function o6(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;const i=jH(n,`${e}, namespace`);i&&(r=i)}),r}function qH(t,e,r){let n=null;if(t&&nc(t)){const i=o6(t,e);i&&(n=i);const s=TH(t,e,r);s&&(n=s)}else n=te("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return n}function _l(t,e){let r=null;if(t&&nc(t)){const n=o6(t,e);n&&(r=n);const i=kH(t,e);i&&(r=i)}else r=te("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function a6(t){return Me(t.protocol,!0)}function MH(t,e){let r=!1;return t?t&&Wo(t)&&t.length&&t.forEach(n=>{r=a6(n)}):r=!0,r}function zH(t){return typeof t=="number"}function Ur(t){return typeof t<"u"&&typeof t!==null}function HH(t){return!(!t||typeof t!="object"||!t.code||!Zp(t.code,!1)||!t.message||!Me(t.message,!1))}function VH(t){return!(Gt(t)||!Me(t.method,!1))}function KH(t){return!(Gt(t)||Gt(t.result)&&Gt(t.error)||!Zp(t.id,!1)||!Me(t.jsonrpc,!1))}function GH(t){return!(Gt(t)||!Me(t.name,!1))}function vb(t,e){return!(!ou(e)||!IH(t).includes(e))}function ZH(t,e,r){return Me(r,!1)?BH(t,e).includes(r):!1}function WH(t,e,r){return Me(r,!1)?SH(t,e).includes(r):!1}function xb(t,e,r){let n=null;const i=YH(t),s=XH(e),o=Object.keys(i),a=Object.keys(s),c=$b(Object.keys(t)),f=$b(Object.keys(e)),u=c.filter(l=>!f.includes(l));return u.length&&(n=te("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),ks(o,a)||(n=te("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(l=>{if(!l.includes(":")||n)return;const h=ea(e[l].accounts);h.includes(l)||(n=te("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${l}
        Required: ${l}
        Approved: ${h.toString()}`))}),o.forEach(l=>{n||(ks(i[l].methods,s[l].methods)?ks(i[l].events,s[l].events)||(n=te("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${l}`)):n=te("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${l}`))}),n}function YH(t){const e={};return Object.keys(t).forEach(r=>{var n;r.includes(":")?e[r]=t[r]:(n=t[r].chains)==null||n.forEach(i=>{e[i]={methods:t[r].methods,events:t[r].events}})}),e}function $b(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function XH(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const n=ea(t[r].accounts);n==null||n.forEach(i=>{e[i]={accounts:t[r].accounts.filter(s=>s.includes(`${i}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function JH(t,e){return Zp(t,!1)&&t<=e.max&&t>=e.min}const Dl={};class va{static get(e){return Dl[e]}static set(e,r){Dl[e]=r}static delete(e){delete Dl[e]}}function QH(t){const e=vc.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function eV({publicKey:t,signature:e,payload:r}){var n;const i=E0(r.method),s=128|parseInt(((n=r.version)==null?void 0:n.toString())||"4"),o=nV(r.address),a=r.era==="00"?new Uint8Array([0]):E0(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(r.nonce,16),f=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${rV(r.tip)}`),l=sV(u),h=new Uint8Array([0,...t,o,...e,...a,...f,...l,...i]),d=iV(h.length+1);return new Uint8Array([...d,s,...h])}function tV(t){const e=E0(t),r=gA.blake2b(e,void 0,32);return"0x"+ue.from(r).toString("hex")}function E0(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function rV(t){return t.startsWith("0x")?t.slice(2):t}function nV(t){const e=vc.decode(t)[0];return e===42?0:e===60?2:1}function iV(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function sV(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function oV(t){const e=Uint8Array.from(ue.from(t.signature,"hex")),r=QH(t.transaction.address),n=eV({publicKey:r,signature:e,payload:t.transaction}),i=ue.from(n).toString("hex");return tV(i)}const c6="wc",f6=2,u6="client",Wp=`${c6}@${f6}:${u6}:`,Fl={name:u6,logger:"error"},Ab="WALLETCONNECT_DEEPLINK_CHOICE",aV="proposal",Ib="Proposal expired",cV="session",mo=Z.SEVEN_DAYS,fV="engine",Je={wc_sessionPropose:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1114},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:Z.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:Z.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1119}}},Ul={min:Z.FIVE_MINUTES,max:Z.SEVEN_DAYS},an={idle:"IDLE",active:"ACTIVE"},uV={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},hV="request",lV=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],dV="wc",pV="auth",gV="authKeys",yV="pairingTopics",wV="requests",Hu=`${dV}@${1.5}:${pV}:`,_f=`${Hu}:PUB_KEY`;var bV=Object.defineProperty,mV=Object.defineProperties,EV=Object.getOwnPropertyDescriptors,Bb=Object.getOwnPropertySymbols,vV=Object.prototype.hasOwnProperty,xV=Object.prototype.propertyIsEnumerable,v0=(t,e,r)=>e in t?bV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,be=(t,e)=>{for(var r in e||(e={}))vV.call(e,r)&&v0(t,r,e[r]);if(Bb)for(var r of Bb(e))xV.call(e,r)&&v0(t,r,e[r]);return t},wt=(t,e)=>mV(t,EV(e)),G=(t,e,r)=>v0(t,typeof e!="symbol"?e+"":e,r);class $V extends xT{constructor(e){super(e),G(this,"name",fV),G(this,"events",new j0),G(this,"initialized",!1),G(this,"requestQueue",{state:an.idle,queue:[]}),G(this,"sessionRequestQueue",{state:an.idle,queue:[]}),G(this,"emittedSessionRequests",new Vq({limit:500})),G(this,"requestQueueDelay",Z.ONE_SECOND),G(this,"expectedPairingMethodMap",new Map),G(this,"recentlyDeletedMap",new Map),G(this,"recentlyDeletedLimit",200),G(this,"relayMessageCache",[]),G(this,"pendingSessions",new Map),G(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Je)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},Z.toMiliseconds(this.requestQueueDelay)))}),G(this,"connect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const n=wt(be({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n),n.optionalNamespaces=DH(n.requiredNamespaces,n.optionalNamespaces),n.requiredNamespaces={};const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:f}=n;let u=i,l,h=!1;try{if(u){const _=this.client.core.pairing.pairings.get(u);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),h=_.active}}catch(_){throw this.client.logger.error(`connect() -> pairing.get(${u}) failed`),_}if(!u||!h){const{topic:_,uri:N}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});u=_,l=N}if(!u){const{message:_}=te("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(_)}const d=await this.client.core.crypto.generateKeyPair(),p=Je.wc_sessionPropose.req.ttl||Z.FIVE_MINUTES,w=jt(p),m=wt(be(be({requiredNamespaces:s,optionalNamespaces:o,relays:f??[{protocol:JE}],proposer:{publicKey:d,metadata:this.client.metadata},expiryTimestamp:w,pairingTopic:u},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:hn()}),D=ve("session_connect",m.id),{reject:C,resolve:b,done:B}=go(p,Ib),F=({id:_})=>{_===m.id&&(this.client.events.off("proposal_expire",F),this.pendingSessions.delete(m.id),this.events.emit(D,{error:{message:Ib,code:0}}))};return this.client.events.on("proposal_expire",F),this.events.once(D,({error:_,session:N})=>{this.client.events.off("proposal_expire",F),_?C(_):N&&b(N)}),await this.sendProposeSession({proposal:m,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:m.id}}}),await this.setProposal(m.id,m),{uri:l,approval:B}}),G(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(n){throw this.client.logger.error("pair() failed"),n}}),G(this,"approve",async r=>{var n,i,s;const o=this.client.core.eventClient.createEvent({properties:{topic:(n=r==null?void 0:r.id)==null?void 0:n.toString(),trace:[wi.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(S){throw o.setError(da.no_internet_connection),S}try{await this.isValidProposalId(r==null?void 0:r.id)}catch(S){throw this.client.logger.error(`approve() -> proposal.get(${r==null?void 0:r.id}) failed`),o.setError(da.proposal_not_found),S}try{await this.isValidApprove(r)}catch(S){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(da.session_approve_namespace_validation_failure),S}const{id:a,relayProtocol:c,namespaces:f,sessionProperties:u,scopedProperties:l,sessionConfig:h}=r,d=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:p,proposer:w,requiredNamespaces:m,optionalNamespaces:D}=d;let C=(i=this.client.core.eventClient)==null?void 0:i.getEvent({topic:p});C||(C=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:wi.session_approve_started,properties:{topic:p,trace:[wi.session_approve_started,wi.session_namespaces_validation_success]}}));const b=await this.client.core.crypto.generateKeyPair(),B=w.publicKey,F=await this.client.core.crypto.generateSharedKey(b,B),_=be(be(be({relay:{protocol:c??"irn"},namespaces:f,controller:{publicKey:b,metadata:this.client.metadata},expiry:jt(mo)},u&&{sessionProperties:u}),l&&{scopedProperties:l}),h&&{sessionConfig:h}),N=$e.relay;C.addTrace(wi.subscribing_session_topic);try{await this.client.core.relayer.subscribe(F,{transportType:N,internal:{skipSubscribe:!0}})}catch(S){throw C.setError(da.subscribe_session_topic_failure),S}C.addTrace(wi.subscribe_session_topic_success);const P=wt(be({},_),{topic:F,requiredNamespaces:m,optionalNamespaces:D,pairingTopic:p,acknowledged:!1,self:_.controller,peer:{publicKey:w.publicKey,metadata:w.metadata},controller:b,transportType:$e.relay});await this.client.session.set(F,P),C.addTrace(wi.store_session);try{await this.sendApproveSession({sessionTopic:F,proposal:d,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:b},sessionSettleRequest:_,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:a}}}),C.addTrace(wi.session_approve_publish_success)}catch(S){throw this.client.logger.error(S),this.client.session.delete(F,et("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(F),S}return this.client.core.eventClient.deleteEvent({eventId:C.eventId}),await this.client.core.pairing.updateMetadata({topic:p,metadata:w.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:p}),await this.setExpiry(F,jt(mo)),{topic:F,acknowledged:()=>Promise.resolve(this.client.session.get(F))}}),G(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:n,reason:i}=r;let s;try{s=this.client.proposal.get(n).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${n}) failed`),o}s&&await this.sendError({id:n,topic:s,error:i,rpcOpts:Je.wc_sessionPropose.reject}),await this.deleteProposal(n)}),G(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(l){throw this.client.logger.error("update() -> isValidUpdate() failed"),l}const{topic:n,namespaces:i}=r,{done:s,resolve:o,reject:a}=go(),c=hn(),f=Xi().toString(),u=this.client.session.get(n).namespaces;return this.events.once(ve("session_update",c),({error:l})=>{l?a(l):o()}),await this.client.session.update(n,{namespaces:i}),await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:f}).catch(l=>{this.client.logger.error(l),this.client.session.update(n,{namespaces:u}),a(l)}),{acknowledged:s}}),G(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:n}=r,i=hn(),{done:s,resolve:o,reject:a}=go();return this.events.once(ve("session_extend",i),({error:c})=>{c?a(c):o()}),await this.setExpiry(n,jt(mo)),this.sendRequest({topic:n,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),G(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}const{chainId:n,request:i,topic:s,expiry:o=Je.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(s);(a==null?void 0:a.transportType)===$e.relay&&await this.confirmOnlineStateOrThrow();const c=hn(),f=Xi().toString(),{done:u,resolve:l,reject:h}=go(o,"Request expired. Please try again.");this.events.once(ve("session_request",c),({error:m,result:D})=>{m?h(m):l(D)});const d="wc_sessionRequest",p=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(p)return await this.sendRequest({clientRpcId:c,relayRpcId:f,topic:s,method:d,params:{request:wt(be({},i),{expiryTimestamp:jt(o)}),chainId:n},expiry:o,throwOnFailedPublish:!0,appLink:p}).catch(m=>h(m)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:n,id:c}),await u();const w={request:wt(be({},i),{expiryTimestamp:jt(o)}),chainId:n};return await Promise.all([new Promise(async m=>{await this.sendRequest({clientRpcId:c,relayRpcId:f,topic:s,method:d,params:w,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,w)}).catch(D=>h(D)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:n,id:c}),m()}),new Promise(async m=>{var D;if(!((D=a.sessionConfig)!=null&&D.disableDeepLink)){const C=await jq(this.client.core.storage,Ab);await Tq({id:c,topic:s,wcDeepLink:C})}m()}),u()]).then(m=>m[2])}),G(this,"respond",async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:n,response:i}=r,{id:s}=i,o=this.client.session.get(n);o.transportType===$e.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);ln(i)?await this.sendResult({id:s,topic:n,result:i.result,throwOnFailedPublish:!0,appLink:a}):br(i)&&await this.sendError({id:s,topic:n,error:i.error,appLink:a}),this.cleanupAfterResponse(r)}),G(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}const{topic:n}=r;if(this.client.session.keys.includes(n)){const i=hn(),s=Xi().toString(),{done:o,resolve:a,reject:c}=go();this.events.once(ve("session_ping",i),({error:f})=>{f?c(f):a()}),await Promise.all([this.sendRequest({topic:n,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:i,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(n)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:n}))}),G(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:n,event:i,chainId:s}=r,o=Xi().toString(),a=hn();await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:i,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),G(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:n}=r;if(this.client.session.keys.includes(n))await this.sendRequest({topic:n,method:"wc_sessionDelete",params:et("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:n,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(n))await this.client.core.pairing.disconnect({topic:n});else{const{message:i}=te("MISMATCHED_TOPIC",`Session or pairing topic not found: ${n}`);throw new Error(i)}}),G(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(n=>CH(n,r)))),G(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),G(this,"authenticate",async(r,n)=>{var i;this.isInitialized(),this.isValidAuthenticate(r);const s=n&&this.client.core.linkModeSupportedApps.includes(n)&&((i=this.client.metadata.redirect)==null?void 0:i.linkMode),o=s?$e.link_mode:$e.relay;o===$e.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:f,domain:u,nonce:l,type:h,exp:d,nbf:p,methods:w=[],expiry:m}=r,D=[...r.resources||[]],{topic:C,uri:b}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:C,uri:b}});const B=await this.client.core.crypto.generateKeyPair(),F=Ol(B);if(await Promise.all([this.client.auth.authKeys.set(_f,{responseTopic:F,publicKey:B}),this.client.auth.pairingTopics.set(F,{topic:F,pairingTopic:C})]),await this.client.core.relayer.subscribe(F,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${C}`),w.length>0){const{namespace:E}=Sf(a[0]);let A=rz(E,"request",w);Of(D)&&(A=iz(A,D.pop())),D.push(A)}const _=m&&m>Je.wc_sessionAuthenticate.req.ttl?m:Je.wc_sessionAuthenticate.req.ttl,N={authPayload:{type:h??"caip122",chains:a,statement:c,aud:f,domain:u,version:"1",nonce:l,iat:new Date().toISOString(),exp:d,nbf:p,resources:D},requester:{publicKey:B,metadata:this.client.metadata},expiryTimestamp:jt(_)},P={eip155:{chains:a,methods:[...new Set(["personal_sign",...w])],events:["chainChanged","accountsChanged"]}},S={requiredNamespaces:{},optionalNamespaces:P,relays:[{protocol:"irn"}],pairingTopic:C,proposer:{publicKey:B,metadata:this.client.metadata},expiryTimestamp:jt(Je.wc_sessionPropose.req.ttl),id:hn()},{done:T,resolve:L,reject:O}=go(_,"Request expired"),x=hn(),$=ve("session_connect",S.id),g=ve("session_request",x),y=async({error:E,session:A})=>{this.events.off(g,v),E?O(E):A&&L({session:A})},v=async E=>{var A,U,R;if(await this.deletePendingAuthRequest(x,{message:"fulfilled",code:0}),E.error){const z=et("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return E.error.code===z.code?void 0:(this.events.off($,y),O(E.error.message))}await this.deleteProposal(S.id),this.events.off($,y);const{cacaos:q,responder:j}=E.result,k=[],M=[];for(const z of q){await Qw({cacao:z,projectId:this.client.core.projectId})||(this.client.logger.error(z,"Signature verification failed"),O(et("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:K}=z,Q=Of(K.resources),ee=[u0(K.iss)],ne=ru(K.iss);if(Q){const he=eb(Q),Bt=tb(Q);k.push(...he),ee.push(...Bt)}for(const he of ee)M.push(`${he}:${ne}`)}const H=await this.client.core.crypto.generateSharedKey(B,j.publicKey);let V;k.length>0&&(V={topic:H,acknowledged:!0,self:{publicKey:B,metadata:this.client.metadata},peer:j,controller:j.publicKey,expiry:jt(mo),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:C,namespaces:mb([...new Set(k)],[...new Set(M)]),transportType:o},await this.client.core.relayer.subscribe(H,{transportType:o}),await this.client.session.set(H,V),C&&await this.client.core.pairing.updateMetadata({topic:C,metadata:j.metadata}),V=this.client.session.get(H)),(A=this.client.metadata.redirect)!=null&&A.linkMode&&(U=j.metadata.redirect)!=null&&U.linkMode&&(R=j.metadata.redirect)!=null&&R.universal&&n&&(this.client.core.addLinkModeSupportedApp(j.metadata.redirect.universal),this.client.session.update(H,{transportType:$e.link_mode})),L({auths:q,session:V})};this.events.once($,y),this.events.once(g,v);let I;try{if(s){const E=Mr("wc_sessionAuthenticate",N,x);this.client.core.history.set(C,E);const A=await this.client.core.crypto.encode("",E,{type:wH,encoding:Ea});I=sf(n,C,A)}else await Promise.all([this.sendRequest({topic:C,method:"wc_sessionAuthenticate",params:N,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:x}),this.sendRequest({topic:C,method:"wc_sessionPropose",params:S,expiry:Je.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:S.id})])}catch(E){throw this.events.off($,y),this.events.off(g,v),E}return await this.setProposal(S.id,S),await this.setAuthRequest(x,{request:wt(be({},N),{verifyContext:{}}),pairingTopic:C,transportType:o}),{uri:I??b,response:T}}),G(this,"approveSessionAuthenticate",async r=>{const{id:n,auths:i}=r,s=this.client.core.eventClient.createEvent({properties:{topic:n.toString(),trace:[xs.authenticated_session_approve_started]}});try{this.isInitialized()}catch(m){throw s.setError(pa.no_internet_connection),m}const o=this.getPendingAuthRequest(n);if(!o)throw s.setError(pa.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${n}`);const a=o.transportType||$e.relay;a===$e.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,f=await this.client.core.crypto.generateKeyPair(),u=Ol(c),l={type:Sl,receiverPublicKey:c,senderPublicKey:f},h=[],d=[];for(const m of i){if(!await Qw({cacao:m,projectId:this.client.core.projectId})){s.setError(pa.invalid_cacao);const F=et("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:n,topic:u,error:F,encodeOpts:l}),new Error(F.message)}s.addTrace(xs.cacaos_verified);const{p:D}=m,C=Of(D.resources),b=[u0(D.iss)],B=ru(D.iss);if(C){const F=eb(C),_=tb(C);h.push(...F),b.push(..._)}for(const F of b)d.push(`${F}:${B}`)}const p=await this.client.core.crypto.generateSharedKey(f,c);s.addTrace(xs.create_authenticated_session_topic);let w;if((h==null?void 0:h.length)>0){w={topic:p,acknowledged:!0,self:{publicKey:f,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:jt(mo),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:mb([...new Set(h)],[...new Set(d)]),transportType:a},s.addTrace(xs.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(m){throw s.setError(pa.subscribe_authenticated_session_topic_failure),m}s.addTrace(xs.subscribe_authenticated_session_topic_success),await this.client.session.set(p,w),s.addTrace(xs.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(xs.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:n,result:{cacaos:i,responder:{publicKey:f,metadata:this.client.metadata}},encodeOpts:l,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(m){throw s.setError(pa.authenticated_session_approve_publish_failure),m}return await this.client.auth.requests.delete(n,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:w}}),G(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:n,reason:i}=r,s=this.getPendingAuthRequest(n);if(!s)throw new Error(`Could not find pending auth request with id ${n}`);s.transportType===$e.relay&&await this.confirmOnlineStateOrThrow();const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Ol(o),f={type:Sl,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:n,topic:c,error:i,encodeOpts:f,rpcOpts:Je.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(n,{message:"rejected",code:0}),await this.deleteProposal(n)}),G(this,"formatAuthMessage",r=>{this.isInitialized();const{request:n,iss:i}=r;return _v(n,i)}),G(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),G(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&s.topic&&s.topic!==n.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}}),G(this,"deleteSession",async r=>{var n;const{topic:i,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,et("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),s||this.client.core.expirer.del(i),this.client.core.storage.removeItem(Ab).catch(f=>this.client.logger.warn(f)),this.getPendingSessionRequests().forEach(f=>{f.topic===i&&this.deletePendingSessionRequest(f.id,et("USER_DISCONNECTED"))}),i===((n=this.sessionRequestQueue.queue[0])==null?void 0:n.topic)&&(this.sessionRequestQueue.state=an.idle),o&&this.client.events.emit("session_delete",{id:a,topic:i})}),G(this,"deleteProposal",async(r,n)=>{if(n)try{const i=this.client.proposal.get(r),s=this.client.core.eventClient.getEvent({topic:i.pairingTopic});s==null||s.setError(da.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,et("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),G(this,"deletePendingSessionRequest",async(r,n,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==r),i&&(this.sessionRequestQueue.state=an.idle,this.client.events.emit("session_request_expire",{id:r}))}),G(this,"deletePendingAuthRequest",async(r,n,i=!1)=>{await Promise.all([this.client.auth.requests.delete(r,n),i?Promise.resolve():this.client.core.expirer.del(r)])}),G(this,"setExpiry",async(r,n)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,n),await this.client.session.update(r,{expiry:n}))}),G(this,"setProposal",async(r,n)=>{this.client.core.expirer.set(r,jt(Je.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,n)}),G(this,"setAuthRequest",async(r,n)=>{const{request:i,pairingTopic:s,transportType:o=$e.relay}=n;this.client.core.expirer.set(r,i.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:r,pairingTopic:s,verifyContext:i.verifyContext,transportType:o})}),G(this,"setPendingSessionRequest",async r=>{const{id:n,topic:i,params:s,verifyContext:o}=r,a=s.request.expiryTimestamp||jt(Je.wc_sessionRequest.req.ttl);this.client.core.expirer.set(n,a),await this.client.pendingRequest.set(n,{id:n,topic:i,params:s,verifyContext:o})}),G(this,"sendRequest",async r=>{const{topic:n,method:i,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:f,appLink:u,tvf:l,publishOpts:h={}}=r,d=Mr(i,s,c);let p;const w=!!u;try{const C=w?Ea:$s;p=await this.client.core.crypto.encode(n,d,{encoding:C})}catch(C){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),C}let m;if(lV.includes(i)){const C=Bi(JSON.stringify(d)),b=Bi(p);m=await this.client.core.verify.register({id:b,decryptedId:C})}const D=be(be({},Je[i].req),h);if(D.attestation=m,o&&(D.ttl=o),a&&(D.id=a),this.client.core.history.set(n,d),w){const C=sf(u,n,p);await re.Linking.openURL(C,this.client.name)}else D.tvf=wt(be({},l),{correlationId:d.id}),f?(D.internal=wt(be({},D.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,p,D)):this.client.core.relayer.publish(n,p,D).catch(C=>this.client.logger.error(C));return d.id}),G(this,"sendProposeSession",async r=>{const{proposal:n,publishOpts:i}=r,s=Mr("wc_sessionPropose",n,n.id);this.client.core.history.set(n.pairingTopic,s);const o=await this.client.core.crypto.encode(n.pairingTopic,s,{encoding:$s}),a=Bi(JSON.stringify(s)),c=Bi(o),f=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:n.pairingTopic,sessionProposal:o},opts:wt(be({},i),{publishMethod:"wc_proposeSession",attestation:f})})}),G(this,"sendApproveSession",async r=>{const{sessionTopic:n,pairingProposalResponse:i,proposal:s,sessionSettleRequest:o,publishOpts:a}=r,c=Ja(s.id,i),f=await this.client.core.crypto.encode(s.pairingTopic,c,{encoding:$s}),u=Mr("wc_sessionSettle",o,a==null?void 0:a.id),l=await this.client.core.crypto.encode(n,u,{encoding:$s});this.client.core.history.set(n,u),await this.client.core.relayer.publishCustom({payload:{sessionTopic:n,pairingTopic:s.pairingTopic,sessionProposalResponse:f,sessionSettlementRequest:l},opts:wt(be({},a),{publishMethod:"wc_approveSession"})})}),G(this,"sendResult",async r=>{const{id:n,topic:i,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,f=Ja(n,s);let u;const l=c&&typeof(re==null?void 0:re.Linking)<"u";try{const p=l?Ea:$s;u=await this.client.core.crypto.encode(i,f,wt(be({},a||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),p}let h,d;try{h=await this.client.core.history.get(i,n);const p=h.request;try{d=this.getTVFParams(n,p.params,s)}catch(w){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${w==null?void 0:w.message}`)}}catch(p){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${n}) failed`),p}if(l){const p=sf(c,i,u);await re.Linking.openURL(p,this.client.name)}else{const p=h.request.method,w=Je[p].res;w.tvf=wt(be({},d),{correlationId:n}),o?(w.internal=wt(be({},w.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,u,w)):this.client.core.relayer.publish(i,u,w).catch(m=>this.client.logger.error(m))}await this.client.core.history.resolve(f)}),G(this,"sendError",async r=>{const{id:n,topic:i,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=r,f=Cu(n,s);let u;const l=c&&typeof(re==null?void 0:re.Linking)<"u";try{const d=l?Ea:$s;u=await this.client.core.crypto.encode(i,f,wt(be({},o||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),d}let h;try{h=await this.client.core.history.get(i,n)}catch(d){throw this.client.logger.error(`sendError() -> history.get(${i}, ${n}) failed`),d}if(l){const d=sf(c,i,u);await re.Linking.openURL(d,this.client.name)}else{const d=h.request.method,p=a||Je[d].res;this.client.core.relayer.publish(i,u,p)}await this.client.core.history.resolve(f)}),G(this,"cleanup",async()=>{const r=[],n=[];this.client.session.getAll().forEach(i=>{let s=!1;yo(i.expiry)&&(s=!0),this.client.core.crypto.keychain.has(i.topic)||(s=!0),s&&r.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{yo(i.expiryTimestamp)&&n.push(i.id)}),await Promise.all([...r.map(i=>this.deleteSession({topic:i})),...n.map(i=>this.deleteProposal(i))])}),G(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),G(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),G(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===an.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=an.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=an.idle}),G(this,"processRequest",async r=>{const{topic:n,payload:i,attestation:s,transportType:o,encryptedId:a}=r,c=i.method;if(!this.shouldIgnorePairingRequest({topic:n,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:n,payload:i,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(n,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(n,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(n,i);case"wc_sessionPing":return await this.onSessionPingRequest(n,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(n,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:n,payload:i,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(n,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:n,payload:i,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),G(this,"onRelayEventResponse",async r=>{const{topic:n,payload:i,transportType:s}=r,o=(await this.client.core.history.get(n,i.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(n,i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(n,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,i);case"wc_sessionExtend":return this.onSessionExtendResponse(n,i);case"wc_sessionPing":return this.onSessionPingResponse(n,i);case"wc_sessionRequest":return this.onSessionRequestResponse(n,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(n,i);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),G(this,"onRelayEventUnknownPayload",r=>{const{topic:n}=r,{message:i}=te("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)}),G(this,"shouldIgnorePairingRequest",r=>{const{topic:n,requestMethod:i}=r,s=this.expectedPairingMethodMap.get(n);return!s||s.includes(i)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),G(this,"onSessionProposeRequest",async r=>{const{topic:n,payload:i,attestation:s,encryptedId:o}=r,{params:a,id:c}=i;try{const f=this.client.core.eventClient.getEvent({topic:n});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),f==null||f.setError(Pn.proposal_listener_not_found)),this.isValidConnect(be({},i.params));const u=a.expiryTimestamp||jt(Je.wc_sessionPropose.req.ttl),l=be({id:c,pairingTopic:n,expiryTimestamp:u,attestation:s,encryptedId:o},a);await this.setProposal(c,l);const h=await this.getVerifyContext({attestationId:s,hash:Bi(JSON.stringify(i)),encryptedId:o,metadata:l.proposer.metadata});f==null||f.addTrace(un.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:l,verifyContext:h})}catch(f){await this.sendError({id:c,topic:n,error:f,rpcOpts:Je.wc_sessionPropose.autoReject}),this.client.logger.error(f)}}),G(this,"onSessionProposeResponse",async(r,n,i)=>{const{id:s}=n;if(ln(n)){const{result:o}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const f=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:f});const u=await this.client.core.crypto.generateSharedKey(c,f);this.pendingSessions.set(s,{sessionTopic:u,pairingTopic:r,proposalId:s,publicKey:c});const l=await this.client.core.relayer.subscribe(u,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),await this.client.core.pairing.activate({topic:r})}else if(br(n)){await this.deleteProposal(s);const o=ve("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:n.error})}}),G(this,"onSessionSettleRequest",async(r,n)=>{const{id:i,params:s}=n;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:a,expiry:c,namespaces:f,sessionProperties:u,scopedProperties:l,sessionConfig:h}=n.params,d=[...this.pendingSessions.values()].find(m=>m.sessionTopic===r);if(!d)return this.client.logger.error(`Pending session not found for topic ${r}`);const p=this.client.proposal.get(d.proposalId),w=wt(be(be(be({topic:r,relay:o,expiry:c,namespaces:f,acknowledged:!0,pairingTopic:d.pairingTopic,requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces,controller:a.publicKey,self:{publicKey:d.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),l&&{scopedProperties:l}),h&&{sessionConfig:h}),{transportType:$e.relay});await this.client.session.set(w.topic,w),await this.setExpiry(w.topic,w.expiry),await this.client.core.pairing.updateMetadata({topic:d.pairingTopic,metadata:w.peer.metadata}),this.client.events.emit("session_connect",{session:w}),this.events.emit(ve("session_connect",d.proposalId),{session:w}),this.pendingSessions.delete(d.proposalId),this.deleteProposal(d.proposalId,!1),this.cleanupDuplicatePairings(w),await this.sendResult({id:n.id,topic:r,result:!0})}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}}),G(this,"onSessionSettleResponse",async(r,n)=>{const{id:i}=n;ln(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(ve("session_approve",i),{})):br(n)&&(await this.client.session.delete(r,et("USER_DISCONNECTED")),this.events.emit(ve("session_approve",i),{error:n.error}))}),G(this,"onSessionUpdateRequest",async(r,n)=>{const{params:i,id:s}=n;try{const o=`${r}_session_update`,a=va.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:r,error:et("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(be({topic:r},i));try{va.set(o,s),await this.client.session.update(r,{namespaces:i.namespaces}),await this.sendResult({id:s,topic:r,result:!0})}catch(c){throw va.delete(o),c}this.client.events.emit("session_update",{id:s,topic:r,params:i})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),G(this,"isRequestOutOfSync",(r,n)=>n.toString().slice(0,-3)<r.toString().slice(0,-3)),G(this,"onSessionUpdateResponse",(r,n)=>{const{id:i}=n,s=ve("session_update",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);ln(n)?this.events.emit(ve("session_update",i),{}):br(n)&&this.events.emit(ve("session_update",i),{error:n.error})}),G(this,"onSessionExtendRequest",async(r,n)=>{const{id:i}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,jt(mo)),await this.sendResult({id:i,topic:r,result:!0}),this.client.events.emit("session_extend",{id:i,topic:r})}catch(s){await this.sendError({id:i,topic:r,error:s}),this.client.logger.error(s)}}),G(this,"onSessionExtendResponse",(r,n)=>{const{id:i}=n,s=ve("session_extend",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);ln(n)?this.events.emit(ve("session_extend",i),{}):br(n)&&this.events.emit(ve("session_extend",i),{error:n.error})}),G(this,"onSessionPingRequest",async(r,n)=>{const{id:i}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:i,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:r})}catch(s){await this.sendError({id:i,topic:r,error:s}),this.client.logger.error(s)}}),G(this,"onSessionPingResponse",(r,n)=>{const{id:i}=n,s=ve("session_ping",i);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);ln(n)?this.events.emit(ve("session_ping",i),{}):br(n)&&this.events.emit(ve("session_ping",i),{error:n.error})},500)}),G(this,"onSessionDeleteRequest",async(r,n)=>{const{id:i}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(s=>{this.client.core.relayer.once(Ie.publish,async()=>{s(await this.deleteSession({topic:r,id:i}))})}),this.sendResult({id:i,topic:r,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:et("USER_DISCONNECTED")})]).catch(s=>this.client.logger.error(s))}catch(s){this.client.logger.error(s)}}),G(this,"onSessionRequest",async r=>{var n,i,s;const{topic:o,payload:a,attestation:c,encryptedId:f,transportType:u}=r,{id:l,params:h}=a;try{await this.isValidRequest(be({topic:o},h));const d=this.client.session.get(o),p=await this.getVerifyContext({attestationId:c,hash:Bi(JSON.stringify(Mr("wc_sessionRequest",h,l))),encryptedId:f,metadata:d.peer.metadata,transportType:u}),w={id:l,topic:o,params:h,verifyContext:p};await this.setPendingSessionRequest(w),u===$e.link_mode&&(n=d.peer.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp((i=d.peer.metadata.redirect)==null?void 0:i.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(w):(this.addSessionRequestToSessionRequestQueue(w),this.processSessionRequestQueue())}catch(d){await this.sendError({id:l,topic:o,error:d}),this.client.logger.error(d)}}),G(this,"onSessionRequestResponse",(r,n)=>{const{id:i}=n,s=ve("session_request",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);ln(n)?this.events.emit(ve("session_request",i),{result:n.result}):br(n)&&this.events.emit(ve("session_request",i),{error:n.error})}),G(this,"onSessionEventRequest",async(r,n)=>{const{id:i,params:s}=n;try{const o=`${r}_session_event_${s.event.name}`,a=va.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidEmit(be({topic:r},s)),this.client.events.emit("session_event",{id:i,topic:r,params:s}),va.set(o,i)}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}}),G(this,"onSessionAuthenticateResponse",(r,n)=>{const{id:i}=n;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:n}),ln(n)?this.events.emit(ve("session_request",i),{result:n.result}):br(n)&&this.events.emit(ve("session_request",i),{error:n.error})}),G(this,"onSessionAuthenticateRequest",async r=>{var n;const{topic:i,payload:s,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:f,authPayload:u,expiryTimestamp:l}=s.params,h=await this.getVerifyContext({attestationId:o,hash:Bi(JSON.stringify(s)),encryptedId:a,metadata:f.metadata,transportType:c}),d={requester:f,pairingTopic:i,id:s.id,authPayload:u,verifyContext:h,expiryTimestamp:l};await this.setAuthRequest(s.id,{request:d,pairingTopic:i,transportType:c}),c===$e.link_mode&&(n=f.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp(f.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:s.params,id:s.id,verifyContext:h})}catch(f){this.client.logger.error(f);const u=s.params.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),h=this.getAppLinkIfEnabled(s.params.requester.metadata,c),d={type:Sl,receiverPublicKey:u,senderPublicKey:l};await this.sendError({id:s.id,topic:i,error:f,encodeOpts:d,rpcOpts:Je.wc_sessionAuthenticate.autoReject,appLink:h})}}),G(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),G(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=an.idle,this.processSessionRequestQueue()},Z.toMiliseconds(this.requestQueueDelay))}),G(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:n})=>{const i=this.client.core.history.pending;i.length>0&&i.filter(s=>s.topic===r&&s.request.method==="wc_sessionRequest").forEach(s=>{const o=s.request.id,a=ve("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(ve("session_request",s.request.id),{error:n})})}),G(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===an.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(n){this.client.logger.error(n)}}),G(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=an.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),G(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const n=this.client.proposal.getAll().find(i=>i.pairingTopic===r.topic);n&&this.onSessionProposeRequest({topic:r.topic,payload:Mr("wc_sessionPropose",wt(be({},n),{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties,scopedProperties:n.scopedProperties}),n.id),attestation:n.attestation,encryptedId:n.encryptedId})}),G(this,"isValidConnect",async r=>{if(!Ur(r)){const{message:f}=te("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(f)}const{pairingTopic:n,requiredNamespaces:i,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=r;if(Gt(n)||await this.isValidPairingTopic(n),!MH(c)){const{message:f}=te("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(f)}if(!Gt(i)&&nc(i)!==0){const f="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(f):this.client.logger.warn(f),this.validateNamespaces(i,"requiredNamespaces")}if(!Gt(s)&&nc(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),Gt(o)||this.validateSessionProps(o,"sessionProperties"),!Gt(a)){this.validateSessionProps(a,"scopedProperties");const f=Object.keys(i||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(u=>f.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(f)}`)}}),G(this,"validateNamespaces",(r,n)=>{const i=qH(r,"connect()",n);if(i)throw new Error(i.message)}),G(this,"isValidApprove",async r=>{if(!Ur(r))throw new Error(te("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:i,relayProtocol:s,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(n),await this.isValidProposalId(n);const c=this.client.proposal.get(n),f=_l(i,"approve()");if(f)throw new Error(f.message);const u=xb(c.requiredNamespaces,i,"approve()");if(u)throw new Error(u.message);if(!Me(s,!0)){const{message:l}=te("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(l)}if(Gt(o)||this.validateSessionProps(o,"sessionProperties"),!Gt(a)){this.validateSessionProps(a,"scopedProperties");const l=new Set(Object.keys(i));if(!Object.keys(a).every(h=>l.has(h.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(l).join(", ")}`)}}),G(this,"isValidReject",async r=>{if(!Ur(r)){const{message:s}=te("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(s)}const{id:n,reason:i}=r;if(this.checkRecentlyDeleted(n),await this.isValidProposalId(n),!HH(i)){const{message:s}=te("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(s)}}),G(this,"isValidSessionSettleRequest",r=>{if(!Ur(r)){const{message:f}=te("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(f)}const{relay:n,controller:i,namespaces:s,expiry:o}=r;if(!a6(n)){const{message:f}=te("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(f)}const a=RH(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=_l(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(yo(o)){const{message:f}=te("EXPIRED","onSessionSettleRequest()");throw new Error(f)}}),G(this,"isValidUpdate",async r=>{if(!Ur(r)){const{message:c}=te("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:n,namespaces:i}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const s=this.client.session.get(n),o=_l(i,"update()");if(o)throw new Error(o.message);const a=xb(s.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)}),G(this,"isValidExtend",async r=>{if(!Ur(r)){const{message:i}=te("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(i)}const{topic:n}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n)}),G(this,"isValidRequest",async r=>{if(!Ur(r)){const{message:c}=te("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:n,request:i,chainId:s,expiry:o}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const{namespaces:a}=this.client.session.get(n);if(!vb(a,s)){const{message:c}=te("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!VH(i)){const{message:c}=te("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(c)}if(!ZH(a,s,i.method)){const{message:c}=te("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(c)}if(o&&!JH(o,Ul)){const{message:c}=te("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Ul.min} and ${Ul.max}`);throw new Error(c)}}),G(this,"isValidRespond",async r=>{var n;if(!Ur(r)){const{message:o}=te("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(o)}const{topic:i,response:s}=r;try{await this.isValidSessionTopic(i)}catch(o){throw(n=r==null?void 0:r.response)!=null&&n.id&&this.cleanupAfterResponse(r),o}if(!KH(s)){const{message:o}=te("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(o)}}),G(this,"isValidPing",async r=>{if(!Ur(r)){const{message:i}=te("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(i)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),G(this,"isValidEmit",async r=>{if(!Ur(r)){const{message:a}=te("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:n,event:i,chainId:s}=r;await this.isValidSessionTopic(n);const{namespaces:o}=this.client.session.get(n);if(!vb(o,s)){const{message:a}=te("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!GH(i)){const{message:a}=te("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!WH(o,s,i.name)){const{message:a}=te("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}}),G(this,"isValidDisconnect",async r=>{if(!Ur(r)){const{message:i}=te("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(i)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),G(this,"isValidAuthenticate",r=>{const{chains:n,uri:i,domain:s,nonce:o}=r;if(!Array.isArray(n)||n.length===0)throw new Error("chains is required and must be a non-empty array");if(!Me(i,!1))throw new Error("uri is required parameter");if(!Me(s,!1))throw new Error("domain is required parameter");if(!Me(o,!1))throw new Error("nonce is required parameter");if([...new Set(n.map(c=>Sf(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Sf(n[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),G(this,"getVerifyContext",async r=>{const{attestationId:n,hash:i,encryptedId:s,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||Ha,validation:"UNKNOWN",origin:o.url||""}};try{if(a===$e.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const f=await this.client.core.verify.resolve({attestationId:n,hash:i,encryptedId:s,verifyUrl:o.verifyUrl});f&&(c.verified.origin=f.origin,c.verified.isScam=f.isScam,c.verified.validation=f.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(f){this.client.logger.warn(f)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),G(this,"validateSessionProps",(r,n)=>{Object.values(r).forEach((i,s)=>{if(i==null){const{message:o}=te("MISSING_OR_INVALID",`${n} must contain an existing value for each key. Received: ${i} for key ${Object.keys(r)[s]}`);throw new Error(o)}})}),G(this,"getPendingAuthRequest",r=>{const n=this.client.auth.requests.get(r);return typeof n=="object"?n:void 0}),G(this,"addToRecentlyDeleted",(r,n)=>{if(this.recentlyDeletedMap.set(r,n),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let i=0;const s=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(i++>=s)break;this.recentlyDeletedMap.delete(o)}}}),G(this,"checkRecentlyDeleted",r=>{const n=this.recentlyDeletedMap.get(r);if(n){const{message:i}=te("MISSING_OR_INVALID",`Record was recently deleted - ${n}: ${r}`);throw new Error(i)}}),G(this,"isLinkModeEnabled",(r,n)=>{var i,s,o,a,c,f,u,l,h;return!r||n!==$e.link_mode?!1:((s=(i=this.client.metadata)==null?void 0:i.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((f=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:f.universal)!==""&&((u=r==null?void 0:r.redirect)==null?void 0:u.universal)!==void 0&&((l=r==null?void 0:r.redirect)==null?void 0:l.universal)!==""&&((h=r==null?void 0:r.redirect)==null?void 0:h.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(re==null?void 0:re.Linking)<"u"}),G(this,"getAppLinkIfEnabled",(r,n)=>{var i;return this.isLinkModeEnabled(r,n)?(i=r==null?void 0:r.redirect)==null?void 0:i.universal:void 0}),G(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const n=Mw(r,"topic")||"",i=decodeURIComponent(Mw(r,"wc_ev")||""),s=this.client.session.keys.includes(n);s&&this.client.session.update(n,{transportType:$e.link_mode}),this.client.core.dispatchEnvelope({topic:n,message:i,sessionExists:s})}),G(this,"registerLinkModeListeners",async()=>{var r;if(qq()||lv()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const n=re==null?void 0:re.Linking;if(typeof n<"u"){n.addEventListener("url",this.handleLinkModeMessage,this.client.name);const i=await n.getInitialURL();i&&setTimeout(()=>{this.handleLinkModeMessage({url:i})},50)}}}),G(this,"getTVFParams",(r,n,i)=>{var s,o,a;if(!((s=n.request)!=null&&s.method))return{};const c={correlationId:r,rpcMethods:[n.request.method],chainId:n.chainId};try{const f=this.extractTxHashesFromResult(n.request,i);c.txHashes=f,c.contractAddresses=this.isValidContractData(n.request.params)?[(a=(o=n.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(f){this.client.logger.warn("Error getting TVF params",f)}return c}),G(this,"isValidContractData",r=>{var n;if(!r)return!1;try{const i=(r==null?void 0:r.data)||((n=r==null?void 0:r[0])==null?void 0:n.data);if(!i.startsWith("0x"))return!1;const s=i.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),G(this,"extractTxHashesFromResult",(r,n)=>{var i;try{if(!n)return[];const s=r.method,o=uV[s];if(s==="sui_signTransaction")return[kM(n.transactionBytes)];if(s==="near_signTransaction")return[Ww(n)];if(s==="near_signTransactions")return n.map(c=>Ww(c));if(s==="xrpl_signTransactionFor"||s==="xrpl_signTransaction")return[(i=n.tx_json)==null?void 0:i.hash];if(s==="polkadot_signTransaction")return[oV({transaction:r.params.transactionPayload,signature:n.signature})];if(s==="algo_signTxn")return Wo(n)?n.map(c=>Yw(c)):[Yw(n)];if(s==="cosmos_signDirect")return[qM(n)];if(s==="wallet_sendCalls")return MM(n);if(typeof n=="string")return[n];const a=n[o.key];if(Wo(a))return s==="solana_signAllTransactions"?a.map(c=>LM(c)):a;if(typeof a=="string")return[a]}catch(s){this.client.logger.warn("Error extracting tx hashes from result",s)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[n,i]of Object.entries(r))for(const s of i)try{await this.onProviderMessageEvent({topic:n,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${n}, message: ${s}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Ie.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:n,attestation:i,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(_f)?this.client.auth.authKeys.get(_f):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,n,{receiverPublicKey:o,encoding:s===$e.link_mode?Ea:$s});Ap(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:i,transportType:s,encryptedId:Bi(n)})):Pu(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:s}),this.client.core.history.delete(r,a.id)):await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:s}),await this.client.core.relayer.messages.ack(r,n)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(yr.expired,async e=>{const{topic:r,id:n}=Nq(e.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,te("EXPIRED"),!0);if(n&&this.client.auth.requests.keys.includes(n))return await this.deletePendingAuthRequest(n,te("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Os.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Os.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!Me(e,!1)){const{message:r}=te("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=te("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(yo(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=te("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!Me(e,!1)){const{message:r}=te("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=te("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(yo(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=te("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=te("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Me(e,!1)){const{message:r}=te("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=te("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!zH(e)){const{message:r}=te("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=te("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(yo(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=te("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class AV extends no{constructor(e,r){super(e,r,aV,Wp),this.core=e,this.logger=r}}let IV=class extends no{constructor(e,r){super(e,r,cV,Wp),this.core=e,this.logger=r}};class BV extends no{constructor(e,r){super(e,r,hV,Wp,n=>n.id),this.core=e,this.logger=r}}class SV extends no{constructor(e,r){super(e,r,gV,Hu,()=>_f),this.core=e,this.logger=r}}class OV extends no{constructor(e,r){super(e,r,yV,Hu),this.core=e,this.logger=r}}class _V extends no{constructor(e,r){super(e,r,wV,Hu,n=>n.id),this.core=e,this.logger=r}}var DV=Object.defineProperty,FV=(t,e,r)=>e in t?DV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Cl=(t,e,r)=>FV(t,typeof e!="symbol"?e+"":e,r);class UV{constructor(e,r){this.core=e,this.logger=r,Cl(this,"authKeys"),Cl(this,"pairingTopics"),Cl(this,"requests"),this.authKeys=new SV(this.core,this.logger),this.pairingTopics=new OV(this.core,this.logger),this.requests=new _V(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var CV=Object.defineProperty,PV=(t,e,r)=>e in t?CV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fe=(t,e,r)=>PV(t,typeof e!="symbol"?e+"":e,r);let RV=class h6 extends vT{constructor(e){super(e),fe(this,"protocol",c6),fe(this,"version",f6),fe(this,"name",Fl.name),fe(this,"metadata"),fe(this,"core"),fe(this,"logger"),fe(this,"events",new hr.EventEmitter),fe(this,"engine"),fe(this,"session"),fe(this,"proposal"),fe(this,"pendingRequest"),fe(this,"auth"),fe(this,"signConfig"),fe(this,"on",(n,i)=>this.events.on(n,i)),fe(this,"once",(n,i)=>this.events.once(n,i)),fe(this,"off",(n,i)=>this.events.off(n,i)),fe(this,"removeListener",(n,i)=>this.events.removeListener(n,i)),fe(this,"removeAllListeners",n=>this.events.removeAllListeners(n)),fe(this,"connect",async n=>{try{return await this.engine.connect(n)}catch(i){throw this.logger.error(i.message),i}}),fe(this,"pair",async n=>{try{return await this.engine.pair(n)}catch(i){throw this.logger.error(i.message),i}}),fe(this,"approve",async n=>{try{return await this.engine.approve(n)}catch(i){throw this.logger.error(i.message),i}}),fe(this,"reject",async n=>{try{return await this.engine.reject(n)}catch(i){throw this.logger.error(i.message),i}}),fe(this,"update",async n=>{try{return await this.engine.update(n)}catch(i){throw this.logger.error(i.message),i}}),fe(this,"extend",async n=>{try{return await this.engine.extend(n)}catch(i){throw this.logger.error(i.message),i}}),fe(this,"request",async n=>{try{return await this.engine.request(n)}catch(i){throw this.logger.error(i.message),i}}),fe(this,"respond",async n=>{try{return await this.engine.respond(n)}catch(i){throw this.logger.error(i.message),i}}),fe(this,"ping",async n=>{try{return await this.engine.ping(n)}catch(i){throw this.logger.error(i.message),i}}),fe(this,"emit",async n=>{try{return await this.engine.emit(n)}catch(i){throw this.logger.error(i.message),i}}),fe(this,"disconnect",async n=>{try{return await this.engine.disconnect(n)}catch(i){throw this.logger.error(i.message),i}}),fe(this,"find",n=>{try{return this.engine.find(n)}catch(i){throw this.logger.error(i.message),i}}),fe(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}}),fe(this,"authenticate",async(n,i)=>{try{return await this.engine.authenticate(n,i)}catch(s){throw this.logger.error(s.message),s}}),fe(this,"formatAuthMessage",n=>{try{return this.engine.formatAuthMessage(n)}catch(i){throw this.logger.error(i.message),i}}),fe(this,"approveSessionAuthenticate",async n=>{try{return await this.engine.approveSessionAuthenticate(n)}catch(i){throw this.logger.error(i.message),i}}),fe(this,"rejectSessionAuthenticate",async n=>{try{return await this.engine.rejectSessionAuthenticate(n)}catch(i){throw this.logger.error(i.message),i}}),this.name=(e==null?void 0:e.name)||Fl.name,this.metadata=Pq(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:hc(Eu({level:(e==null?void 0:e.logger)||Fl.logger}));this.core=(e==null?void 0:e.core)||new bT(e),this.logger=Pt(r,this.name),this.session=new IV(this.core,this.logger),this.proposal=new AV(this.core,this.logger),this.pendingRequest=new BV(this.core,this.logger),this.engine=new $V(this),this.auth=new UV(this.core,this.logger)}static async init(e){const r=new h6(e);return await r.initialize(),r}get context(){return tr(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};function NV(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let f=0;f<e.length;f++)e[f]=255;for(let f=0;f<t.length;f++){const u=t.charAt(f),l=u.charCodeAt(0);if(e[l]!==255)throw new TypeError(u+" is ambiguous");e[l]=f}const r=t.length,n=t.charAt(0),i=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function o(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";let u=0,l=0,h=0;const d=f.length;for(;h!==d&&f[h]===0;)h++,u++;const p=(d-h)*s+1>>>0,w=new Uint8Array(p);for(;h!==d;){let C=f[h],b=0;for(let B=p-1;(C!==0||b<l)&&B!==-1;B--,b++)C+=256*w[B]>>>0,w[B]=C%r>>>0,C=C/r>>>0;if(C!==0)throw new Error("Non-zero carry");l=b,h++}let m=p-l;for(;m!==p&&w[m]===0;)m++;let D=n.repeat(u);for(;m<p;++m)D+=t.charAt(w[m]);return D}function a(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;let u=0,l=0,h=0;for(;f[u]===n;)l++,u++;const d=(f.length-u)*i+1>>>0,p=new Uint8Array(d);for(;u<f.length;){const C=f.charCodeAt(u);if(C>255)return;let b=e[C];if(b===255)return;let B=0;for(let F=d-1;(b!==0||B<h)&&F!==-1;F--,B++)b+=r*p[F]>>>0,p[F]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");h=B,u++}let w=d-h;for(;w!==d&&p[w]===0;)w++;const m=new Uint8Array(l+(d-w));let D=l;for(;w!==d;)m[D++]=p[w++];return m}function c(f){const u=a(f);if(u)return u;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var TV="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";NV(TV);function LV(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function l6(t,...e){if(!LV(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Sb(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function kV(t,e){l6(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const Eo=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Pl=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function jV(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function d6(t){return typeof t=="string"&&(t=jV(t)),l6(t),t}let qV=class{clone(){return this._cloneInto()}};function MV(t){const e=n=>t().update(d6(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function zV(t=32){if(Eo&&typeof Eo.getRandomValues=="function")return Eo.getRandomValues(new Uint8Array(t));if(Eo&&typeof Eo.randomBytes=="function")return Eo.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function HV(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}let VV=class extends qV{constructor(e,r,n,i){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Pl(this.buffer)}update(e){Sb(this);const{view:r,buffer:n,blockLen:i}=this;e=d6(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Pl(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Sb(this),kV(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let l=o;l<i;l++)r[l]=0;HV(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Pl(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)a.setUint32(4*l,u[l],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%r&&e.buffer.set(n),e}};const of=BigInt(2**32-1),x0=BigInt(32);function p6(t,e=!1){return e?{h:Number(t&of),l:Number(t>>x0&of)}:{h:Number(t>>x0&of)|0,l:Number(t&of)|0}}function KV(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=p6(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const GV=(t,e)=>BigInt(t>>>0)<<x0|BigInt(e>>>0),ZV=(t,e,r)=>t>>>r,WV=(t,e,r)=>t<<32-r|e>>>r,YV=(t,e,r)=>t>>>r|e<<32-r,XV=(t,e,r)=>t<<32-r|e>>>r,JV=(t,e,r)=>t<<64-r|e>>>r-32,QV=(t,e,r)=>t>>>r-32|e<<64-r,eK=(t,e)=>e,tK=(t,e)=>t,rK=(t,e,r)=>t<<r|e>>>32-r,nK=(t,e,r)=>e<<r|t>>>32-r,iK=(t,e,r)=>e<<r-32|t>>>64-r,sK=(t,e,r)=>t<<r-32|e>>>64-r;function oK(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const aK=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),cK=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,fK=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),uK=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,hK=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),lK=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,ae={fromBig:p6,split:KV,toBig:GV,shrSH:ZV,shrSL:WV,rotrSH:YV,rotrSL:XV,rotrBH:JV,rotrBL:QV,rotr32H:eK,rotr32L:tK,rotlSH:rK,rotlSL:nK,rotlBH:iK,rotlBL:sK,add:oK,add3L:aK,add3H:cK,add4L:fK,add4H:uK,add5H:lK,add5L:hK},[dK,pK]=ae.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Si=new Uint32Array(80),Oi=new Uint32Array(80);let gK=class extends VV{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:f,El:u,Fh:l,Fl:h,Gh:d,Gl:p,Hh:w,Hl:m}=this;return[e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m]}set(e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=u|0,this.Fh=l|0,this.Fl=h|0,this.Gh=d|0,this.Gl=p|0,this.Hh=w|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)Si[b]=e.getUint32(r),Oi[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const B=Si[b-15]|0,F=Oi[b-15]|0,_=ae.rotrSH(B,F,1)^ae.rotrSH(B,F,8)^ae.shrSH(B,F,7),N=ae.rotrSL(B,F,1)^ae.rotrSL(B,F,8)^ae.shrSL(B,F,7),P=Si[b-2]|0,S=Oi[b-2]|0,T=ae.rotrSH(P,S,19)^ae.rotrBH(P,S,61)^ae.shrSH(P,S,6),L=ae.rotrSL(P,S,19)^ae.rotrBL(P,S,61)^ae.shrSL(P,S,6),O=ae.add4L(N,L,Oi[b-7],Oi[b-16]),x=ae.add4H(O,_,T,Si[b-7],Si[b-16]);Si[b]=x|0,Oi[b]=O|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:f,Dl:u,Eh:l,El:h,Fh:d,Fl:p,Gh:w,Gl:m,Hh:D,Hl:C}=this;for(let b=0;b<80;b++){const B=ae.rotrSH(l,h,14)^ae.rotrSH(l,h,18)^ae.rotrBH(l,h,41),F=ae.rotrSL(l,h,14)^ae.rotrSL(l,h,18)^ae.rotrBL(l,h,41),_=l&d^~l&w,N=h&p^~h&m,P=ae.add5L(C,F,N,pK[b],Oi[b]),S=ae.add5H(P,D,B,_,dK[b],Si[b]),T=P|0,L=ae.rotrSH(n,i,28)^ae.rotrBH(n,i,34)^ae.rotrBH(n,i,39),O=ae.rotrSL(n,i,28)^ae.rotrBL(n,i,34)^ae.rotrBL(n,i,39),x=n&s^n&a^s&a,$=i&o^i&c^o&c;D=w|0,C=m|0,w=d|0,m=p|0,d=l|0,p=h|0,{h:l,l:h}=ae.add(f|0,u|0,S|0,T|0),f=a|0,u=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const g=ae.add3L(T,O,$);n=ae.add3H(g,S,L,x),i=g|0}({h:n,l:i}=ae.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=ae.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=ae.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l:u}=ae.add(this.Dh|0,this.Dl|0,f|0,u|0),{h:l,l:h}=ae.add(this.Eh|0,this.El|0,l|0,h|0),{h:d,l:p}=ae.add(this.Fh|0,this.Fl|0,d|0,p|0),{h:w,l:m}=ae.add(this.Gh|0,this.Gl|0,w|0,m|0),{h:D,l:C}=ae.add(this.Hh|0,this.Hl|0,D|0,C|0),this.set(n,i,s,o,a,c,f,u,l,h,d,p,w,m,D,C)}roundClean(){Si.fill(0),Oi.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const yK=MV(()=>new gK);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Yp=BigInt(0),g6=BigInt(1),wK=BigInt(2);function Xp(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Jp(t){if(!Xp(t))throw new Error("Uint8Array expected")}function Rl(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const bK=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Qp(t){Jp(t);let e="";for(let r=0;r<t.length;r++)e+=bK[t[r]];return e}function y6(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Yp:BigInt("0x"+t)}const _n={_0:48,_9:57,A:65,F:70,a:97,f:102};function Ob(t){if(t>=_n._0&&t<=_n._9)return t-_n._0;if(t>=_n.A&&t<=_n.F)return t-(_n.A-10);if(t>=_n.a&&t<=_n.f)return t-(_n.a-10)}function w6(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=Ob(t.charCodeAt(s)),a=Ob(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function mK(t){return y6(Qp(t))}function Df(t){return Jp(t),y6(Qp(Uint8Array.from(t).reverse()))}function b6(t,e){return w6(t.toString(16).padStart(e*2,"0"))}function $0(t,e){return b6(t,e).reverse()}function Dn(t,e,r){let n;if(typeof e=="string")try{n=w6(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Xp(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function _b(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Jp(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const Nl=t=>typeof t=="bigint"&&Yp<=t;function EK(t,e,r){return Nl(t)&&Nl(e)&&Nl(r)&&e<=t&&t<r}function xa(t,e,r,n){if(!EK(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function vK(t){let e;for(e=0;t>Yp;t>>=g6,e+=1);return e}const xK=t=>(wK<<BigInt(t-1))-g6,$K={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Xp(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function e1(t,e,r={}){const n=(i,s,o)=>{const a=$K[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function Db(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const Ke=BigInt(0),_e=BigInt(1),Ds=BigInt(2),AK=BigInt(3),A0=BigInt(4),Fb=BigInt(5),Ub=BigInt(8);function Le(t,e){const r=t%e;return r>=Ke?r:e+r}function IK(t,e,r){if(e<Ke)throw new Error("invalid exponent, negatives unsupported");if(r<=Ke)throw new Error("invalid modulus");if(r===_e)return Ke;let n=_e;for(;e>Ke;)e&_e&&(n=n*t%r),t=t*t%r,e>>=_e;return n}function cn(t,e,r){let n=t;for(;e-- >Ke;)n*=n,n%=r;return n}function Cb(t,e){if(t===Ke)throw new Error("invert: expected non-zero number");if(e<=Ke)throw new Error("invert: expected positive modulus, got "+e);let r=Le(t,e),n=e,i=Ke,s=_e;for(;r!==Ke;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==_e)throw new Error("invert: does not exist");return Le(i,e)}function BK(t){const e=(t-_e)/Ds;let r,n,i;for(r=t-_e,n=0;r%Ds===Ke;r/=Ds,n++);for(i=Ds;i<t&&IK(i,e,t)!==t-_e;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+_e)/A0;return function(a,c){const f=a.pow(c,o);if(!a.eql(a.sqr(f),c))throw new Error("Cannot find square root");return f}}const s=(r+_e)/Ds;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,f=o.pow(o.mul(o.ONE,i),r),u=o.pow(a,s),l=o.pow(a,r);for(;!o.eql(l,o.ONE);){if(o.eql(l,o.ZERO))return o.ZERO;let h=1;for(let p=o.sqr(l);h<c&&!o.eql(p,o.ONE);h++)p=o.sqr(p);const d=o.pow(f,_e<<BigInt(c-h-1));f=o.sqr(d),u=o.mul(u,d),l=o.mul(l,f),c=h}return u}}function SK(t){if(t%A0===AK){const e=(t+_e)/A0;return function(r,n){const i=r.pow(n,e);if(!r.eql(r.sqr(i),n))throw new Error("Cannot find square root");return i}}if(t%Ub===Fb){const e=(t-Fb)/Ub;return function(r,n){const i=r.mul(n,Ds),s=r.pow(i,e),o=r.mul(n,s),a=r.mul(r.mul(o,Ds),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return BK(t)}const OK=(t,e)=>(Le(t,e)&_e)===_e,_K=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function DK(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=_K.reduce((n,i)=>(n[i]="function",n),e);return e1(t,r)}function FK(t,e,r){if(r<Ke)throw new Error("invalid exponent, negatives unsupported");if(r===Ke)return t.ONE;if(r===_e)return e;let n=t.ONE,i=e;for(;r>Ke;)r&_e&&(n=t.mul(n,i)),i=t.sqr(i),r>>=_e;return n}function UK(t,e){const r=new Array(e.length),n=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),i=t.inv(n);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),i),r}function m6(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function E6(t,e,r=!1,n={}){if(t<=Ke)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=m6(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:xK(i),ZERO:Ke,ONE:_e,create:c=>Le(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ke<=c&&c<t},is0:c=>c===Ke,isOdd:c=>(c&_e)===_e,neg:c=>Le(-c,t),eql:(c,f)=>c===f,sqr:c=>Le(c*c,t),add:(c,f)=>Le(c+f,t),sub:(c,f)=>Le(c-f,t),mul:(c,f)=>Le(c*f,t),pow:(c,f)=>FK(a,c,f),div:(c,f)=>Le(c*Cb(f,t),t),sqrN:c=>c*c,addN:(c,f)=>c+f,subN:(c,f)=>c-f,mulN:(c,f)=>c*f,inv:c=>Cb(c,t),sqrt:n.sqrt||(c=>(o||(o=SK(t)),o(a,c))),invertBatch:c=>UK(a,c),cmov:(c,f,u)=>u?f:c,toBytes:c=>r?$0(c,s):b6(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Df(c):mK(c)}});return Object.freeze(a)}const Pb=BigInt(0),af=BigInt(1);function Tl(t,e){const r=e.negate();return t?r:e}function v6(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Ll(t,e){v6(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function CK(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function PK(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const kl=new WeakMap,x6=new WeakMap;function jl(t){return x6.get(t)||1}function RK(t,e){return{constTimeNegate:Tl,hasPrecomputes(r){return jl(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Pb;)n&af&&(i=i.add(s)),s=s.double(),n>>=af;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=Ll(n,e),o=[];let a=r,c=a;for(let f=0;f<i;f++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){const{windows:s,windowSize:o}=Ll(r,e);let a=t.ZERO,c=t.BASE;const f=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<s;h++){const d=h*o;let p=Number(i&f);i>>=l,p>o&&(p-=u,i+=af);const w=d,m=d+Math.abs(p)-1,D=h%2!==0,C=p<0;p===0?c=c.add(Tl(D,n[w])):a=a.add(Tl(C,n[m]))}return{p:a,f:c}},wNAFUnsafe(r,n,i,s=t.ZERO){const{windows:o,windowSize:a}=Ll(r,e),c=BigInt(2**r-1),f=2**r,u=BigInt(r);for(let l=0;l<o;l++){const h=l*a;if(i===Pb)break;let d=Number(i&c);if(i>>=u,d>a&&(d-=f,i+=af),d===0)continue;let p=n[h+Math.abs(d)-1];d<0&&(p=p.negate()),s=s.add(p)}return s},getPrecomputes(r,n,i){let s=kl.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&kl.set(n,i(s))),s},wNAFCached(r,n,i){const s=jl(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=jl(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){v6(n,e),x6.set(r,n),kl.delete(r)}}}function NK(t,e,r,n){if(CK(r,t),PK(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=vK(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),f=Math.floor((e.BITS-1)/o)*o;let u=i;for(let l=f;l>=0;l-=o){c.fill(i);for(let d=0;d<n.length;d++){const p=n[d],w=Number(p>>BigInt(l)&BigInt(a));c[w]=c[w].add(r[d])}let h=i;for(let d=c.length-1,p=i;d>0;d--)p=p.add(c[d]),h=h.add(p);if(u=u.add(h),l!==0)for(let d=0;d<o;d++)u=u.double()}return u}function TK(t){return DK(t.Fp),e1(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...m6(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const Cr=BigInt(0),qt=BigInt(1),cf=BigInt(2),LK=BigInt(8),kK={zip215:!0};function jK(t){const e=TK(t);return e1(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function qK(t){const e=jK(t),{Fp:r,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,f=cf<<BigInt(a*8)-qt,u=r.create,l=E6(e.n,e.nBitLength),h=e.uvRatio||((g,y)=>{try{return{isValid:!0,value:r.sqrt(g*r.inv(y))}}catch{return{isValid:!1,value:Cr}}}),d=e.adjustScalarBytes||(g=>g),p=e.domain||((g,y,v)=>{if(Rl("phflag",v),y.length||v)throw new Error("Contexts/pre-hash are not supported");return g});function w(g,y){xa("coordinate "+g,y,Cr,f)}function m(g){if(!(g instanceof b))throw new Error("ExtendedPoint expected")}const D=Db((g,y)=>{const{ex:v,ey:I,ez:E}=g,A=g.is0();y==null&&(y=A?LK:r.inv(E));const U=u(v*y),R=u(I*y),q=u(E*y);if(A)return{x:Cr,y:qt};if(q!==qt)throw new Error("invZ was invalid");return{x:U,y:R}}),C=Db(g=>{const{a:y,d:v}=e;if(g.is0())throw new Error("bad point: ZERO");const{ex:I,ey:E,ez:A,et:U}=g,R=u(I*I),q=u(E*E),j=u(A*A),k=u(j*j),M=u(R*y),H=u(j*u(M+q)),V=u(k+u(v*u(R*q)));if(H!==V)throw new Error("bad point: equation left != right (1)");const z=u(I*E),K=u(A*U);if(z!==K)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(y,v,I,E){this.ex=y,this.ey=v,this.ez=I,this.et=E,w("x",y),w("y",v),w("z",I),w("t",E),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(y){if(y instanceof b)throw new Error("extended point not allowed");const{x:v,y:I}=y||{};return w("x",v),w("y",I),new b(v,I,qt,u(v*I))}static normalizeZ(y){const v=r.invertBatch(y.map(I=>I.ez));return y.map((I,E)=>I.toAffine(v[E])).map(b.fromAffine)}static msm(y,v){return NK(b,l,y,v)}_setWindowSize(y){_.setWindowSize(this,y)}assertValidity(){C(this)}equals(y){m(y);const{ex:v,ey:I,ez:E}=this,{ex:A,ey:U,ez:R}=y,q=u(v*R),j=u(A*E),k=u(I*R),M=u(U*E);return q===j&&k===M}is0(){return this.equals(b.ZERO)}negate(){return new b(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:y}=e,{ex:v,ey:I,ez:E}=this,A=u(v*v),U=u(I*I),R=u(cf*u(E*E)),q=u(y*A),j=v+I,k=u(u(j*j)-A-U),M=q+U,H=M-R,V=q-U,z=u(k*H),K=u(M*V),Q=u(k*V),ee=u(H*M);return new b(z,K,ee,Q)}add(y){m(y);const{a:v,d:I}=e,{ex:E,ey:A,ez:U,et:R}=this,{ex:q,ey:j,ez:k,et:M}=y;if(v===BigInt(-1)){const vr=u((A-E)*(j+q)),xr=u((A+E)*(j-q)),St=u(xr-vr);if(St===Cr)return this.double();const $r=u(U*cf*M),Ar=u(R*cf*k),Ir=Ar+$r,Br=xr+vr,Sr=Ar-$r,ys=u(Ir*St),ws=u(Br*Sr),bs=u(Ir*Sr),ms=u(St*Br);return new b(ys,ws,ms,bs)}const H=u(E*q),V=u(A*j),z=u(R*I*M),K=u(U*k),Q=u((E+A)*(q+j)-H-V),ee=K-z,ne=K+z,he=u(V-v*H),Bt=u(Q*ee),Rt=u(ne*he),ps=u(Q*he),gs=u(ee*ne);return new b(Bt,Rt,gs,ps)}subtract(y){return this.add(y.negate())}wNAF(y){return _.wNAFCached(this,y,b.normalizeZ)}multiply(y){const v=y;xa("scalar",v,qt,n);const{p:I,f:E}=this.wNAF(v);return b.normalizeZ([I,E])[0]}multiplyUnsafe(y,v=b.ZERO){const I=y;return xa("scalar",I,Cr,n),I===Cr?F:this.is0()||I===qt?this:_.wNAFCachedUnsafe(this,I,b.normalizeZ,v)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return _.unsafeLadder(this,n).is0()}toAffine(y){return D(this,y)}clearCofactor(){const{h:y}=e;return y===qt?this:this.multiplyUnsafe(y)}static fromHex(y,v=!1){const{d:I,a:E}=e,A=r.BYTES;y=Dn("pointHex",y,A),Rl("zip215",v);const U=y.slice(),R=y[A-1];U[A-1]=R&-129;const q=Df(U),j=v?f:r.ORDER;xa("pointHex.y",q,Cr,j);const k=u(q*q),M=u(k-qt),H=u(I*k-E);let{isValid:V,value:z}=h(M,H);if(!V)throw new Error("Point.fromHex: invalid y coordinate");const K=(z&qt)===qt,Q=(R&128)!==0;if(!v&&z===Cr&&Q)throw new Error("Point.fromHex: x=0 and x_0=1");return Q!==K&&(z=u(-z)),b.fromAffine({x:z,y:q})}static fromPrivateKey(y){return S(y).point}toRawBytes(){const{x:y,y:v}=this.toAffine(),I=$0(v,r.BYTES);return I[I.length-1]|=y&qt?128:0,I}toHex(){return Qp(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,qt,u(e.Gx*e.Gy)),b.ZERO=new b(Cr,qt,qt,Cr);const{BASE:B,ZERO:F}=b,_=RK(b,a*8);function N(g){return Le(g,n)}function P(g){return N(Df(g))}function S(g){const y=r.BYTES;g=Dn("private key",g,y);const v=Dn("hashed private key",s(g),2*y),I=d(v.slice(0,y)),E=v.slice(y,2*y),A=P(I),U=B.multiply(A),R=U.toRawBytes();return{head:I,prefix:E,scalar:A,point:U,pointBytes:R}}function T(g){return S(g).pointBytes}function L(g=new Uint8Array,...y){const v=_b(...y);return P(s(p(v,Dn("context",g),!!i)))}function O(g,y,v={}){g=Dn("message",g),i&&(g=i(g));const{prefix:I,scalar:E,pointBytes:A}=S(y),U=L(v.context,I,g),R=B.multiply(U).toRawBytes(),q=L(v.context,R,A,g),j=N(U+q*E);xa("signature.s",j,Cr,n);const k=_b(R,$0(j,r.BYTES));return Dn("result",k,r.BYTES*2)}const x=kK;function $(g,y,v,I=x){const{context:E,zip215:A}=I,U=r.BYTES;g=Dn("signature",g,2*U),y=Dn("message",y),v=Dn("publicKey",v,U),A!==void 0&&Rl("zip215",A),i&&(y=i(y));const R=Df(g.slice(U,2*U));let q,j,k;try{q=b.fromHex(v,A),j=b.fromHex(g.slice(0,U),A),k=B.multiplyUnsafe(R)}catch{return!1}if(!A&&q.isSmallOrder())return!1;const M=L(E,j.toRawBytes(),q.toRawBytes(),y);return j.add(q.multiplyUnsafe(M)).subtract(k).clearCofactor().equals(b.ZERO)}return B._setWindowSize(8),{CURVE:e,getPublicKey:T,sign:O,verify:$,ExtendedPoint:b,utils:{getExtendedPublicKey:S,randomPrivateKey:()=>o(r.BYTES),precompute(g=8,y=b.BASE){return y._setWindowSize(g),y.multiply(BigInt(3)),y}}}}BigInt(0),BigInt(1);const t1=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Rb=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const MK=BigInt(1),Nb=BigInt(2);BigInt(3);const zK=BigInt(5),HK=BigInt(8);function VK(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=t1,o=t*t%s*t%s,a=cn(o,Nb,s)*o%s,c=cn(a,MK,s)*t%s,f=cn(c,zK,s)*c%s,u=cn(f,e,s)*f%s,l=cn(u,r,s)*u%s,h=cn(l,n,s)*l%s,d=cn(h,i,s)*h%s,p=cn(d,i,s)*h%s,w=cn(p,e,s)*f%s;return{pow_p_5_8:cn(w,Nb,s)*t%s,b2:o}}function KK(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function GK(t,e){const r=t1,n=Le(e*e*e,r),i=Le(n*n*e,r),s=VK(t*i).pow_p_5_8;let o=Le(t*n*s,r);const a=Le(e*o*o,r),c=o,f=Le(o*Rb,r),u=a===t,l=a===Le(-t,r),h=a===Le(-t*Rb,r);return u&&(o=c),(l||h)&&(o=f),OK(o,r)&&(o=Le(-o,r)),{isValid:u||l,value:o}}const ZK=E6(t1,void 0,!0),WK={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:ZK,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:HK,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:yK,randomBytes:zV,adjustScalarBytes:KK,uvRatio:GK};qK(WK);function YK(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),f=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var w=0,m=0,D=0,C=p.length;D!==C&&p[D]===0;)D++,w++;for(var b=(C-D)*u+1>>>0,B=new Uint8Array(b);D!==C;){for(var F=p[D],_=0,N=b-1;(F!==0||_<m)&&N!==-1;N--,_++)F+=256*B[N]>>>0,B[N]=F%a>>>0,F=F/a>>>0;if(F!==0)throw new Error("Non-zero carry");m=_,D++}for(var P=b-m;P!==b&&B[P]===0;)P++;for(var S=c.repeat(w);P<b;++P)S+=t.charAt(B[P]);return S}function h(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var w=0;if(p[w]!==" "){for(var m=0,D=0;p[w]===c;)m++,w++;for(var C=(p.length-w)*f+1>>>0,b=new Uint8Array(C);p[w];){var B=r[p.charCodeAt(w)];if(B===255)return;for(var F=0,_=C-1;(B!==0||F<D)&&_!==-1;_--,F++)B+=a*b[_]>>>0,b[_]=B%256>>>0,B=B/256>>>0;if(B!==0)throw new Error("Non-zero carry");D=F,w++}if(p[w]!==" "){for(var N=C-D;N!==C&&b[N]===0;)N++;for(var P=new Uint8Array(m+(C-N)),S=m;N!==C;)P[S++]=b[N++];return P}}}function d(p){var w=h(p);if(w)return w;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:h,decode:d}}var XK=YK,JK=XK;const $6=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},QK=t=>new TextEncoder().encode(t),eG=t=>new TextDecoder().decode(t);let tG=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}};class rG{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return A6(this,e)}}let nG=class{constructor(e){this.decoders=e}or(e){return A6(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const A6=(t,e)=>new nG({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class iG{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new tG(e,r,n),this.decoder=new rG(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Vu=({name:t,prefix:e,encode:r,decode:n})=>new iG(t,e,r,n),Ic=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=JK(r,e);return Vu({prefix:t,name:e,encode:n,decode:s=>$6(i(s))})},sG=(t,e,r,n)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,f=0;for(let u=0;u<s;++u){const l=i[t[u]];if(l===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|l,a+=r,a>=8&&(a-=8,o[f++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},oG=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},ot=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Vu({prefix:e,name:t,encode(i){return oG(i,n,r)},decode(i){return sG(i,n,r,t)}}),aG=Vu({prefix:"\0",name:"identity",encode:t=>eG(t),decode:t=>QK(t)});var cG=Object.freeze({__proto__:null,identity:aG});const fG=ot({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var uG=Object.freeze({__proto__:null,base2:fG});const hG=ot({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var lG=Object.freeze({__proto__:null,base8:hG});const dG=Ic({prefix:"9",name:"base10",alphabet:"0123456789"});var pG=Object.freeze({__proto__:null,base10:dG});const gG=ot({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),yG=ot({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var wG=Object.freeze({__proto__:null,base16:gG,base16upper:yG});const bG=ot({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),mG=ot({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),EG=ot({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),vG=ot({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),xG=ot({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),$G=ot({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),AG=ot({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),IG=ot({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),BG=ot({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var SG=Object.freeze({__proto__:null,base32:bG,base32upper:mG,base32pad:EG,base32padupper:vG,base32hex:xG,base32hexupper:$G,base32hexpad:AG,base32hexpadupper:IG,base32z:BG});const OG=Ic({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),_G=Ic({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var DG=Object.freeze({__proto__:null,base36:OG,base36upper:_G});const FG=Ic({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),UG=Ic({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var CG=Object.freeze({__proto__:null,base58btc:FG,base58flickr:UG});const PG=ot({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),RG=ot({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),NG=ot({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),TG=ot({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var LG=Object.freeze({__proto__:null,base64:PG,base64pad:RG,base64url:NG,base64urlpad:TG});const I6=Array.from(""),kG=I6.reduce((t,e,r)=>(t[r]=e,t),[]),jG=I6.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function qG(t){return t.reduce((e,r)=>(e+=kG[r],e),"")}function MG(t){const e=[];for(const r of t){const n=jG[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const zG=Vu({prefix:"",name:"base256emoji",encode:qG,decode:MG});var HG=Object.freeze({__proto__:null,base256emoji:zG}),VG=B6,Tb=128,KG=-128,GG=Math.pow(2,31);function B6(t,e,r){e=e||[],r=r||0;for(var n=r;t>=GG;)e[r++]=t&255|Tb,t/=128;for(;t&KG;)e[r++]=t&255|Tb,t>>>=7;return e[r]=t|0,B6.bytes=r-n+1,e}var ZG=I0,WG=128,Lb=127;function I0(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw I0.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&Lb)<<i:(o&Lb)*Math.pow(2,i),i+=7}while(o>=WG);return I0.bytes=s-n,r}var YG=Math.pow(2,7),XG=Math.pow(2,14),JG=Math.pow(2,21),QG=Math.pow(2,28),eZ=Math.pow(2,35),tZ=Math.pow(2,42),rZ=Math.pow(2,49),nZ=Math.pow(2,56),iZ=Math.pow(2,63),sZ=function(t){return t<YG?1:t<XG?2:t<JG?3:t<QG?4:t<eZ?5:t<tZ?6:t<rZ?7:t<nZ?8:t<iZ?9:10},oZ={encode:VG,decode:ZG,encodingLength:sZ},S6=oZ;const kb=(t,e,r=0)=>(S6.encode(t,e,r),e),jb=t=>S6.encodingLength(t),B0=(t,e)=>{const r=e.byteLength,n=jb(t),i=n+jb(r),s=new Uint8Array(i+r);return kb(t,s,0),kb(r,s,n),s.set(e,i),new aZ(t,r,e,s)};let aZ=class{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}};const O6=({name:t,code:e,encode:r})=>new cZ(t,e,r);let cZ=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?B0(this.code,r):r.then(n=>B0(this.code,n))}else throw Error("Unknown type, must be binary type")}};const _6=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),fZ=O6({name:"sha2-256",code:18,encode:_6("SHA-256")}),uZ=O6({name:"sha2-512",code:19,encode:_6("SHA-512")});var hZ=Object.freeze({__proto__:null,sha256:fZ,sha512:uZ});const D6=0,lZ="identity",F6=$6,dZ=t=>B0(D6,F6(t)),pZ={code:D6,name:lZ,encode:F6,digest:dZ};var gZ=Object.freeze({__proto__:null,identity:pZ});new TextEncoder,new TextDecoder;({...cG,...uG,...lG,...pG,...wG,...SG,...DG,...CG,...LG,...HG});({...hZ,...gZ});const yZ=":";function Ka(t){const[e,r]=t.split(yZ);return{namespace:e,reference:r}}function wZ(t,e){return Z.fromMiliseconds(Date.now()+Z.toMiliseconds(t))}function U6(t){return Date.now()>=Z.toMiliseconds(t)}function ql(t=[],e=[]){return[...new Set([...t,...e])]}const ff=BigInt(2**32-1),qb=BigInt(32);function C6(t,e=!1){return e?{h:Number(t&ff),l:Number(t>>qb&ff)}:{h:Number(t>>qb&ff)|0,l:Number(t&ff)|0}}function P6(t,e=!1){const r=t.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=C6(t[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const Mb=(t,e,r)=>t>>>r,zb=(t,e,r)=>t<<32-r|e>>>r,Hi=(t,e,r)=>t>>>r|e<<32-r,Vi=(t,e,r)=>t<<32-r|e>>>r,Na=(t,e,r)=>t<<64-r|e>>>r-32,Ta=(t,e,r)=>t>>>r-32|e<<64-r,bZ=(t,e)=>e,mZ=(t,e)=>t,EZ=(t,e,r)=>t<<r|e>>>32-r,vZ=(t,e,r)=>e<<r|t>>>32-r,xZ=(t,e,r)=>e<<r-32|t>>>64-r,$Z=(t,e,r)=>t<<r-32|e>>>64-r;function qr(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const r1=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),n1=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,AZ=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),IZ=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,BZ=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),SZ=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,vo=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Ku(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function cs(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Yr(t,...e){if(!Ku(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function R6(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");cs(t.outputLen),cs(t.blockLen)}function fs(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function i1(t,e){Yr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function ic(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Xr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Ml(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function fn(t,e){return t<<32-e|t>>>e}const N6=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function T6(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Nn=N6?t=>t:t=>T6(t);function OZ(t){for(let e=0;e<t.length;e++)t[e]=T6(t[e]);return t}const Ki=N6?t=>t:OZ,L6=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",_Z=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ko(t){if(Yr(t),L6)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=_Z[t[r]];return e}const Fn={_0:48,_9:57,A:65,F:70,a:97,f:102};function Hb(t){if(t>=Fn._0&&t<=Fn._9)return t-Fn._0;if(t>=Fn.A&&t<=Fn.F)return t-(Fn.A-10);if(t>=Fn.a&&t<=Fn.f)return t-(Fn.a-10)}function au(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(L6)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=Hb(t.charCodeAt(s)),a=Hb(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function k6(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Yn(t){return typeof t=="string"&&(t=k6(t)),Yr(t),t}function Yi(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Yr(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}class Gu{}function Bc(t){const e=n=>t().update(Yn(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function DZ(t){const e=(n,i)=>t(i).update(Yn(n)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}function s1(t=32){if(vo&&typeof vo.getRandomValues=="function")return vo.getRandomValues(new Uint8Array(t));if(vo&&typeof vo.randomBytes=="function")return Uint8Array.from(vo.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const FZ=BigInt(0),$a=BigInt(1),UZ=BigInt(2),CZ=BigInt(7),PZ=BigInt(256),RZ=BigInt(113),j6=[],q6=[],M6=[];for(let t=0,e=$a,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],j6.push(2*(5*n+r)),q6.push((t+1)*(t+2)/2%64);let i=FZ;for(let s=0;s<7;s++)e=(e<<$a^(e>>CZ)*RZ)%PZ,e&UZ&&(i^=$a<<($a<<BigInt(s))-$a);M6.push(i)}const z6=P6(M6,!0),NZ=z6[0],TZ=z6[1],Vb=(t,e,r)=>r>32?xZ(t,e,r):EZ(t,e,r),Kb=(t,e,r)=>r>32?$Z(t,e,r):vZ(t,e,r);function LZ(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,f=r[c],u=r[c+1],l=Vb(f,u,1)^r[a],h=Kb(f,u,1)^r[a+1];for(let d=0;d<50;d+=10)t[o+d]^=l,t[o+d+1]^=h}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=q6[o],c=Vb(i,s,a),f=Kb(i,s,a),u=j6[o];i=t[u],s=t[u+1],t[u]=c,t[u+1]=f}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=NZ[n],t[1]^=TZ[n]}Xr(r)}class o1 extends Gu{constructor(e,r,n,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,cs(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=ic(this.state)}clone(){return this._cloneInto()}keccak(){Ki(this.state32),LZ(this.state32,this.rounds),Ki(this.state32),this.posOut=0,this.pos=0}update(e){fs(this),e=Yn(e),Yr(e);const{blockLen:r,state:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){fs(this,!1),Yr(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return cs(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(i1(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Xr(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new o1(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const kZ=(t,e,r)=>Bc(()=>new o1(e,t,r));kZ(1,136,256/8);function jZ(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}function qZ(t,e,r){return t&e^~t&r}function MZ(t,e,r){return t&e^t&r^e&r}class H6 extends Gu{constructor(e,r,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=Ml(this.buffer)}update(e){fs(this),e=Yn(e),Yr(e);const{view:r,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Ml(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){fs(this),i1(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,Xr(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let l=o;l<i;l++)r[l]=0;jZ(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Ml(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)a.setUint32(4*l,u[l],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const _i=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),bt=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),mt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),zZ=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Di=new Uint32Array(64);class HZ extends H6{constructor(e=32){super(64,e,8,!1),this.A=_i[0]|0,this.B=_i[1]|0,this.C=_i[2]|0,this.D=_i[3]|0,this.E=_i[4]|0,this.F=_i[5]|0,this.G=_i[6]|0,this.H=_i[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let l=0;l<16;l++,r+=4)Di[l]=e.getUint32(r,!1);for(let l=16;l<64;l++){const h=Di[l-15],d=Di[l-2],p=fn(h,7)^fn(h,18)^h>>>3,w=fn(d,17)^fn(d,19)^d>>>10;Di[l]=w+Di[l-7]+p+Di[l-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:f,H:u}=this;for(let l=0;l<64;l++){const h=fn(a,6)^fn(a,11)^fn(a,25),d=u+h+qZ(a,c,f)+zZ[l]+Di[l]|0,p=(fn(n,2)^fn(n,13)^fn(n,22))+MZ(n,i,s)|0;u=f,f=c,c=a,a=o+d|0,o=s,s=i,i=n,n=d+p|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(n,i,s,o,a,c,f,u)}roundClean(){Xr(Di)}destroy(){this.set(0,0,0,0,0,0,0,0),Xr(this.buffer)}}const V6=P6(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),VZ=V6[0],KZ=V6[1],Fi=new Uint32Array(80),Ui=new Uint32Array(80);class a1 extends H6{constructor(e=64){super(128,e,16,!1),this.Ah=mt[0]|0,this.Al=mt[1]|0,this.Bh=mt[2]|0,this.Bl=mt[3]|0,this.Ch=mt[4]|0,this.Cl=mt[5]|0,this.Dh=mt[6]|0,this.Dl=mt[7]|0,this.Eh=mt[8]|0,this.El=mt[9]|0,this.Fh=mt[10]|0,this.Fl=mt[11]|0,this.Gh=mt[12]|0,this.Gl=mt[13]|0,this.Hh=mt[14]|0,this.Hl=mt[15]|0}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:f,El:u,Fh:l,Fl:h,Gh:d,Gl:p,Hh:w,Hl:m}=this;return[e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m]}set(e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=u|0,this.Fh=l|0,this.Fl=h|0,this.Gh=d|0,this.Gl=p|0,this.Hh=w|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)Fi[b]=e.getUint32(r),Ui[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const B=Fi[b-15]|0,F=Ui[b-15]|0,_=Hi(B,F,1)^Hi(B,F,8)^Mb(B,F,7),N=Vi(B,F,1)^Vi(B,F,8)^zb(B,F,7),P=Fi[b-2]|0,S=Ui[b-2]|0,T=Hi(P,S,19)^Na(P,S,61)^Mb(P,S,6),L=Vi(P,S,19)^Ta(P,S,61)^zb(P,S,6),O=AZ(N,L,Ui[b-7],Ui[b-16]),x=IZ(O,_,T,Fi[b-7],Fi[b-16]);Fi[b]=x|0,Ui[b]=O|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:f,Dl:u,Eh:l,El:h,Fh:d,Fl:p,Gh:w,Gl:m,Hh:D,Hl:C}=this;for(let b=0;b<80;b++){const B=Hi(l,h,14)^Hi(l,h,18)^Na(l,h,41),F=Vi(l,h,14)^Vi(l,h,18)^Ta(l,h,41),_=l&d^~l&w,N=h&p^~h&m,P=BZ(C,F,N,KZ[b],Ui[b]),S=SZ(P,D,B,_,VZ[b],Fi[b]),T=P|0,L=Hi(n,i,28)^Na(n,i,34)^Na(n,i,39),O=Vi(n,i,28)^Ta(n,i,34)^Ta(n,i,39),x=n&s^n&a^s&a,$=i&o^i&c^o&c;D=w|0,C=m|0,w=d|0,m=p|0,d=l|0,p=h|0,{h:l,l:h}=qr(f|0,u|0,S|0,T|0),f=a|0,u=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const g=r1(T,O,$);n=n1(g,S,L,x),i=g|0}({h:n,l:i}=qr(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=qr(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=qr(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l:u}=qr(this.Dh|0,this.Dl|0,f|0,u|0),{h:l,l:h}=qr(this.Eh|0,this.El|0,l|0,h|0),{h:d,l:p}=qr(this.Fh|0,this.Fl|0,d|0,p|0),{h:w,l:m}=qr(this.Gh|0,this.Gl|0,w|0,m|0),{h:D,l:C}=qr(this.Hh|0,this.Hl|0,D|0,C|0),this.set(n,i,s,o,a,c,f,u,l,h,d,p,w,m,D,C)}roundClean(){Xr(Fi,Ui)}destroy(){Xr(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class GZ extends a1{constructor(){super(48),this.Ah=bt[0]|0,this.Al=bt[1]|0,this.Bh=bt[2]|0,this.Bl=bt[3]|0,this.Ch=bt[4]|0,this.Cl=bt[5]|0,this.Dh=bt[6]|0,this.Dl=bt[7]|0,this.Eh=bt[8]|0,this.El=bt[9]|0,this.Fh=bt[10]|0,this.Fl=bt[11]|0,this.Gh=bt[12]|0,this.Gl=bt[13]|0,this.Hh=bt[14]|0,this.Hl=bt[15]|0}}const Et=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class ZZ extends a1{constructor(){super(32),this.Ah=Et[0]|0,this.Al=Et[1]|0,this.Bh=Et[2]|0,this.Bl=Et[3]|0,this.Ch=Et[4]|0,this.Cl=Et[5]|0,this.Dh=Et[6]|0,this.Dl=Et[7]|0,this.Eh=Et[8]|0,this.El=Et[9]|0,this.Fh=Et[10]|0,this.Fl=Et[11]|0,this.Gh=Et[12]|0,this.Gl=Et[13]|0,this.Hh=Et[14]|0,this.Hl=Et[15]|0}}const WZ=Bc(()=>new HZ),YZ=Bc(()=>new a1),XZ=Bc(()=>new GZ);Bc(()=>new ZZ);const JZ=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Pe=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),J=new Uint32Array(32);function Ci(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=J[2*t],f=J[2*t+1],u=J[2*e],l=J[2*e+1],h=J[2*r],d=J[2*r+1],p=J[2*n],w=J[2*n+1],m=r1(c,u,o);f=n1(m,f,l,a),c=m|0,{Dh:w,Dl:p}={Dh:w^f,Dl:p^c},{Dh:w,Dl:p}={Dh:bZ(w,p),Dl:mZ(w)},{h:d,l:h}=qr(d,h,w,p),{Bh:l,Bl:u}={Bh:l^d,Bl:u^h},{Bh:l,Bl:u}={Bh:Hi(l,u,24),Bl:Vi(l,u,24)},J[2*t]=c,J[2*t+1]=f,J[2*e]=u,J[2*e+1]=l,J[2*r]=h,J[2*r+1]=d,J[2*n]=p,J[2*n+1]=w}function Pi(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=J[2*t],f=J[2*t+1],u=J[2*e],l=J[2*e+1],h=J[2*r],d=J[2*r+1],p=J[2*n],w=J[2*n+1],m=r1(c,u,o);f=n1(m,f,l,a),c=m|0,{Dh:w,Dl:p}={Dh:w^f,Dl:p^c},{Dh:w,Dl:p}={Dh:Hi(w,p,16),Dl:Vi(w,p,16)},{h:d,l:h}=qr(d,h,w,p),{Bh:l,Bl:u}={Bh:l^d,Bl:u^h},{Bh:l,Bl:u}={Bh:Na(l,u,63),Bl:Ta(l,u,63)},J[2*t]=c,J[2*t+1]=f,J[2*e]=u,J[2*e+1]=l,J[2*r]=h,J[2*r+1]=d,J[2*n]=p,J[2*n+1]=w}function QZ(t,e={},r,n,i){if(cs(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}class eW extends Gu{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,cs(e),cs(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=ic(this.buffer)}update(e){fs(this),e=Yn(e),Yr(e);const{blockLen:r,buffer:n,buffer32:i}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===r&&(Ki(i),this.compress(i,0,!1),Ki(i),this.pos=0);const f=Math.min(r-this.pos,s-c),u=o+c;if(f===r&&!(u%4)&&c+f<s){const l=new Uint32Array(a,u,Math.floor((s-c)/4));Ki(l);for(let h=0;c+r<s;h+=i.length,c+=r)this.length+=r,this.compress(l,h,!1);Ki(l);continue}n.set(e.subarray(c,c+f),this.pos),this.pos+=f,this.length+=f,c+=f}return this}digestInto(e){fs(this),i1(e,this);const{pos:r,buffer32:n}=this;this.finished=!0,Xr(this.buffer.subarray(r)),Ki(n),this.compress(n,0,!0),Ki(n);const i=ic(e);this.get().forEach((s,o)=>i[o]=Nn(s))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){const{buffer:r,length:n,finished:i,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=s,e.finished=i,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class tW extends eW{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=Pe[0]|0,this.v0h=Pe[1]|0,this.v1l=Pe[2]|0,this.v1h=Pe[3]|0,this.v2l=Pe[4]|0,this.v2h=Pe[5]|0,this.v3l=Pe[6]|0,this.v3h=Pe[7]|0,this.v4l=Pe[8]|0,this.v4h=Pe[9]|0,this.v5l=Pe[10]|0,this.v5h=Pe[11]|0,this.v6l=Pe[12]|0,this.v6h=Pe[13]|0,this.v7l=Pe[14]|0,this.v7h=Pe[15]|0,QZ(r,e,64,16,16);let{key:n,personalization:i,salt:s}=e,o=0;if(n!==void 0&&(n=Yn(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=Yn(s);const a=ic(s);this.v4l^=Nn(a[0]),this.v4h^=Nn(a[1]),this.v5l^=Nn(a[2]),this.v5h^=Nn(a[3])}if(i!==void 0){i=Yn(i);const a=ic(i);this.v6l^=Nn(a[0]),this.v6h^=Nn(a[1]),this.v7l^=Nn(a[2]),this.v7h^=Nn(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:n,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:f,v4h:u,v5l:l,v5h:h,v6l:d,v6h:p,v7l:w,v7h:m}=this;return[e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m]}set(e,r,n,i,s,o,a,c,f,u,l,h,d,p,w,m){this.v0l=e|0,this.v0h=r|0,this.v1l=n|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=f|0,this.v4h=u|0,this.v5l=l|0,this.v5h=h|0,this.v6l=d|0,this.v6h=p|0,this.v7l=w|0,this.v7h=m|0}compress(e,r,n){this.get().forEach((c,f)=>J[f]=c),J.set(Pe,16);let{h:i,l:s}=C6(BigInt(this.length));J[24]=Pe[8]^s,J[25]=Pe[9]^i,n&&(J[28]=~J[28],J[29]=~J[29]);let o=0;const a=JZ;for(let c=0;c<12;c++)Ci(0,4,8,12,e,r+2*a[o++]),Pi(0,4,8,12,e,r+2*a[o++]),Ci(1,5,9,13,e,r+2*a[o++]),Pi(1,5,9,13,e,r+2*a[o++]),Ci(2,6,10,14,e,r+2*a[o++]),Pi(2,6,10,14,e,r+2*a[o++]),Ci(3,7,11,15,e,r+2*a[o++]),Pi(3,7,11,15,e,r+2*a[o++]),Ci(0,5,10,15,e,r+2*a[o++]),Pi(0,5,10,15,e,r+2*a[o++]),Ci(1,6,11,12,e,r+2*a[o++]),Pi(1,6,11,12,e,r+2*a[o++]),Ci(2,7,8,13,e,r+2*a[o++]),Pi(2,7,8,13,e,r+2*a[o++]),Ci(3,4,9,14,e,r+2*a[o++]),Pi(3,4,9,14,e,r+2*a[o++]);this.v0l^=J[0]^J[16],this.v0h^=J[1]^J[17],this.v1l^=J[2]^J[18],this.v1h^=J[3]^J[19],this.v2l^=J[4]^J[20],this.v2h^=J[5]^J[21],this.v3l^=J[6]^J[22],this.v3h^=J[7]^J[23],this.v4l^=J[8]^J[24],this.v4h^=J[9]^J[25],this.v5l^=J[10]^J[26],this.v5h^=J[11]^J[27],this.v6l^=J[12]^J[28],this.v6h^=J[13]^J[29],this.v7l^=J[14]^J[30],this.v7h^=J[15]^J[31],Xr(J)}destroy(){this.destroyed=!0,Xr(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}DZ(t=>new tW(t));/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function K6(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function S0(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function zl(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Zt(t,...e){if(!K6(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Gb(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function rW(t,e){Zt(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function ts(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Yo(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function nW(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const iW=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function sW(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function O0(t){if(typeof t=="string")t=sW(t);else if(K6(t))t=_0(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function oW(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function aW(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const cW=(t,e)=>{function r(n,...i){if(Zt(n),!iW)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const f=i[0];if(!f)throw new Error("nonce / iv required");t.varSizeNonce?Zt(f):Zt(f,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&Zt(i[1]);const o=e(n,...i),a=(f,u)=>{if(u!==void 0){if(f!==2)throw new Error("cipher output not supported");Zt(u)}};let c=!1;return{encrypt(f,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Zt(f),a(o.encrypt.length,u),o.encrypt(f,u)},decrypt(f,u){if(Zt(f),s&&f.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,u),o.decrypt(f,u)}}}return Object.assign(r,t),r};function Zb(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!uW(e))throw new Error("invalid output, must be aligned");return e}function Wb(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function fW(t,e,r){S0(r);const n=new Uint8Array(16),i=nW(n);return Wb(i,0,BigInt(e),r),Wb(i,8,BigInt(t),r),n}function uW(t){return t.byteOffset%4===0}function _0(t){return Uint8Array.from(t)}const G6=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),hW=G6("expand 16-byte k"),lW=G6("expand 32-byte k"),dW=ts(hW),pW=ts(lW);function ye(t,e){return t<<e|t>>>32-e}function D0(t){return t.byteOffset%4===0}const uf=64,gW=16,Z6=2**32-1,Yb=new Uint32Array;function yW(t,e,r,n,i,s,o,a){const c=i.length,f=new Uint8Array(uf),u=ts(f),l=D0(i)&&D0(s),h=l?ts(i):Yb,d=l?ts(s):Yb;for(let p=0;p<c;o++){if(t(e,r,n,u,o,a),o>=Z6)throw new Error("arx: counter overflow");const w=Math.min(uf,c-p);if(l&&w===uf){const m=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let D=0,C;D<gW;D++)C=m+D,d[C]=h[C]^u[D];p+=uf;continue}for(let m=0,D;m<w;m++)D=p+m,s[D]=i[D]^f[m];p+=w}}function wW(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=oW({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return zl(i),zl(o),S0(s),S0(r),(a,c,f,u,l=0)=>{Zt(a),Zt(c),Zt(f);const h=f.length;if(u===void 0&&(u=new Uint8Array(h)),Zt(u),zl(l),l<0||l>=Z6)throw new Error("arx: counter overflow");if(u.length<h)throw new Error(`arx: output (${u.length}) is shorter than data (${h})`);const d=[];let p=a.length,w,m;if(p===32)d.push(w=_0(a)),m=pW;else if(p===16&&r)w=new Uint8Array(32),w.set(a),w.set(a,16),m=dW,d.push(w);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);D0(c)||d.push(c=_0(c));const D=ts(w);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(m,D,ts(c.subarray(0,16)),D),c=c.subarray(16)}const C=16-i;if(C!==c.length)throw new Error(`arx: nonce must be ${C} or 16 bytes`);if(C!==12){const B=new Uint8Array(12);B.set(c,s?0:12-c.length),c=B,d.push(c)}const b=ts(c);return yW(t,m,D,b,f,u,l,o),Yo(...d),u}}const Qe=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class bW{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=O0(e),Zt(e,32);const r=Qe(e,0),n=Qe(e,2),i=Qe(e,4),s=Qe(e,6),o=Qe(e,8),a=Qe(e,10),c=Qe(e,12),f=Qe(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|f<<8)&8191,this.r[9]=f>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Qe(e,16+2*u)}process(e,r,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],f=o[2],u=o[3],l=o[4],h=o[5],d=o[6],p=o[7],w=o[8],m=o[9],D=Qe(e,r+0),C=Qe(e,r+2),b=Qe(e,r+4),B=Qe(e,r+6),F=Qe(e,r+8),_=Qe(e,r+10),N=Qe(e,r+12),P=Qe(e,r+14);let S=s[0]+(D&8191),T=s[1]+((D>>>13|C<<3)&8191),L=s[2]+((C>>>10|b<<6)&8191),O=s[3]+((b>>>7|B<<9)&8191),x=s[4]+((B>>>4|F<<12)&8191),$=s[5]+(F>>>1&8191),g=s[6]+((F>>>14|_<<2)&8191),y=s[7]+((_>>>11|N<<5)&8191),v=s[8]+((N>>>8|P<<8)&8191),I=s[9]+(P>>>5|i),E=0,A=E+S*a+T*(5*m)+L*(5*w)+O*(5*p)+x*(5*d);E=A>>>13,A&=8191,A+=$*(5*h)+g*(5*l)+y*(5*u)+v*(5*f)+I*(5*c),E+=A>>>13,A&=8191;let U=E+S*c+T*a+L*(5*m)+O*(5*w)+x*(5*p);E=U>>>13,U&=8191,U+=$*(5*d)+g*(5*h)+y*(5*l)+v*(5*u)+I*(5*f),E+=U>>>13,U&=8191;let R=E+S*f+T*c+L*a+O*(5*m)+x*(5*w);E=R>>>13,R&=8191,R+=$*(5*p)+g*(5*d)+y*(5*h)+v*(5*l)+I*(5*u),E+=R>>>13,R&=8191;let q=E+S*u+T*f+L*c+O*a+x*(5*m);E=q>>>13,q&=8191,q+=$*(5*w)+g*(5*p)+y*(5*d)+v*(5*h)+I*(5*l),E+=q>>>13,q&=8191;let j=E+S*l+T*u+L*f+O*c+x*a;E=j>>>13,j&=8191,j+=$*(5*m)+g*(5*w)+y*(5*p)+v*(5*d)+I*(5*h),E+=j>>>13,j&=8191;let k=E+S*h+T*l+L*u+O*f+x*c;E=k>>>13,k&=8191,k+=$*a+g*(5*m)+y*(5*w)+v*(5*p)+I*(5*d),E+=k>>>13,k&=8191;let M=E+S*d+T*h+L*l+O*u+x*f;E=M>>>13,M&=8191,M+=$*c+g*a+y*(5*m)+v*(5*w)+I*(5*p),E+=M>>>13,M&=8191;let H=E+S*p+T*d+L*h+O*l+x*u;E=H>>>13,H&=8191,H+=$*f+g*c+y*a+v*(5*m)+I*(5*w),E+=H>>>13,H&=8191;let V=E+S*w+T*p+L*d+O*h+x*l;E=V>>>13,V&=8191,V+=$*u+g*f+y*c+v*a+I*(5*m),E+=V>>>13,V&=8191;let z=E+S*m+T*w+L*p+O*d+x*h;E=z>>>13,z&=8191,z+=$*l+g*u+y*f+v*c+I*a,E+=z>>>13,z&=8191,E=(E<<2)+E|0,E=E+A|0,A=E&8191,E=E>>>13,U+=E,s[0]=A,s[1]=U,s[2]=R,s[3]=q,s[4]=j,s[5]=k,s[6]=M,s[7]=H,s[8]=V,s[9]=z}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;Yo(n)}update(e){Gb(this),e=O0(e),Zt(e);const{buffer:r,blockLen:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Yo(this.h,this.r,this.buffer,this.pad)}digestInto(e){Gb(this),rW(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:i}=this;if(i){for(r[i++]=1;i<16;i++)r[i]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}}function mW(t){const e=(n,i)=>t(i).update(O0(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const EW=mW(t=>new bW(t));function vW(t,e,r,n,i,s=20){let o=t[0],a=t[1],c=t[2],f=t[3],u=e[0],l=e[1],h=e[2],d=e[3],p=e[4],w=e[5],m=e[6],D=e[7],C=i,b=r[0],B=r[1],F=r[2],_=o,N=a,P=c,S=f,T=u,L=l,O=h,x=d,$=p,g=w,y=m,v=D,I=C,E=b,A=B,U=F;for(let q=0;q<s;q+=2)_=_+T|0,I=ye(I^_,16),$=$+I|0,T=ye(T^$,12),_=_+T|0,I=ye(I^_,8),$=$+I|0,T=ye(T^$,7),N=N+L|0,E=ye(E^N,16),g=g+E|0,L=ye(L^g,12),N=N+L|0,E=ye(E^N,8),g=g+E|0,L=ye(L^g,7),P=P+O|0,A=ye(A^P,16),y=y+A|0,O=ye(O^y,12),P=P+O|0,A=ye(A^P,8),y=y+A|0,O=ye(O^y,7),S=S+x|0,U=ye(U^S,16),v=v+U|0,x=ye(x^v,12),S=S+x|0,U=ye(U^S,8),v=v+U|0,x=ye(x^v,7),_=_+L|0,U=ye(U^_,16),y=y+U|0,L=ye(L^y,12),_=_+L|0,U=ye(U^_,8),y=y+U|0,L=ye(L^y,7),N=N+O|0,I=ye(I^N,16),v=v+I|0,O=ye(O^v,12),N=N+O|0,I=ye(I^N,8),v=v+I|0,O=ye(O^v,7),P=P+x|0,E=ye(E^P,16),$=$+E|0,x=ye(x^$,12),P=P+x|0,E=ye(E^P,8),$=$+E|0,x=ye(x^$,7),S=S+T|0,A=ye(A^S,16),g=g+A|0,T=ye(T^g,12),S=S+T|0,A=ye(A^S,8),g=g+A|0,T=ye(T^g,7);let R=0;n[R++]=o+_|0,n[R++]=a+N|0,n[R++]=c+P|0,n[R++]=f+S|0,n[R++]=u+T|0,n[R++]=l+L|0,n[R++]=h+O|0,n[R++]=d+x|0,n[R++]=p+$|0,n[R++]=w+g|0,n[R++]=m+y|0,n[R++]=D+v|0,n[R++]=C+I|0,n[R++]=b+E|0,n[R++]=B+A|0,n[R++]=F+U|0}const xW=wW(vW,{counterRight:!1,counterLength:4,allowShortKeys:!1}),$W=new Uint8Array(16),Xb=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update($W.subarray(r))},AW=new Uint8Array(32);function Jb(t,e,r,n,i){const s=t(e,r,AW),o=EW.create(s);i&&Xb(o,i),Xb(o,n);const a=fW(n.length,i?i.length:0,!0);o.update(a);const c=o.digest();return Yo(s,a),c}const IW=t=>(e,r,n)=>({encrypt(i,s){const o=i.length;s=Zb(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=Jb(t,e,r,a,n);return s.set(c,o),Yo(c),s},decrypt(i,s){s=Zb(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=Jb(t,e,r,o,n);if(!aW(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,r,s,s,1),Yo(c),s}});cW({blockSize:64,nonceLength:12,tagLength:16},IW(xW));class W6 extends Gu{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,R6(e);const n=Yn(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Xr(s)}update(e){return fs(this),this.iHash.update(e),this}digestInto(e){fs(this),Yr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Y6=(t,e,r)=>new W6(t,e).update(r).digest();Y6.create=(t,e)=>new W6(t,e);Uint8Array.from([0]);const c1=BigInt(0),F0=BigInt(1);function cu(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function zs(t,e,r=""){const n=Ku(t),i=t==null?void 0:t.length,s=e!==void 0;if(!n||s&&i!==e){const o=r&&`"${r}" `,a=s?` of length ${e}`:"",c=n?`length=${i}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function hf(t){const e=t.toString(16);return e.length&1?"0"+e:e}function X6(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?c1:BigInt("0x"+t)}function Zu(t){return X6(ko(t))}function fu(t){return Yr(t),X6(ko(Uint8Array.from(t).reverse()))}function f1(t,e){return au(t.toString(16).padStart(e*2,"0"))}function u1(t,e){return f1(t,e).reverse()}function At(t,e,r){let n;if(typeof e=="string")try{n=au(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Ku(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}const Hl=t=>typeof t=="bigint"&&c1<=t;function BW(t,e,r){return Hl(t)&&Hl(e)&&Hl(r)&&e<=t&&t<r}function U0(t,e,r,n){if(!BW(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function J6(t){let e;for(e=0;t>c1;t>>=F0,e+=1);return e}const Sc=t=>(F0<<BigInt(t))-F0;function SW(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const n=h=>new Uint8Array(h),i=h=>Uint8Array.of(h);let s=n(t),o=n(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},f=(...h)=>r(o,s,...h),u=(h=n(0))=>{o=f(i(0),h),s=f(),h.length!==0&&(o=f(i(1),h),s=f())},l=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const d=[];for(;h<e;){s=f();const p=s.slice();d.push(p),h+=s.length}return Yi(...d)};return(h,d)=>{c(),u(h);let p;for(;!(p=d(l()));)u();return c(),p}}function Wu(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(i,s,o){const a=t[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>n(i,s,!1)),Object.entries(r).forEach(([i,s])=>n(i,s,!0))}function Qb(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const Qt=BigInt(0),Ct=BigInt(1),Hs=BigInt(2),Q6=BigInt(3),e4=BigInt(4),t4=BigInt(5),OW=BigInt(7),r4=BigInt(8),_W=BigInt(9),n4=BigInt(16);function fr(t,e){const r=t%e;return r>=Qt?r:e+r}function Tr(t,e,r){let n=t;for(;e-- >Qt;)n*=n,n%=r;return n}function e2(t,e){if(t===Qt)throw new Error("invert: expected non-zero number");if(e<=Qt)throw new Error("invert: expected positive modulus, got "+e);let r=fr(t,e),n=e,i=Qt,s=Ct;for(;r!==Qt;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==Ct)throw new Error("invert: does not exist");return fr(i,e)}function h1(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function i4(t,e){const r=(t.ORDER+Ct)/e4,n=t.pow(e,r);return h1(t,n,e),n}function DW(t,e){const r=(t.ORDER-t4)/r4,n=t.mul(e,Hs),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,Hs),i),a=t.mul(s,t.sub(o,t.ONE));return h1(t,a,e),a}function FW(t){const e=ds(t),r=s4(t),n=r(e,e.neg(e.ONE)),i=r(e,n),s=r(e,e.neg(n)),o=(t+OW)/n4;return(a,c)=>{let f=a.pow(c,o),u=a.mul(f,n);const l=a.mul(f,i),h=a.mul(f,s),d=a.eql(a.sqr(u),c),p=a.eql(a.sqr(l),c);f=a.cmov(f,u,d),u=a.cmov(h,l,p);const w=a.eql(a.sqr(u),c),m=a.cmov(f,u,w);return h1(a,m,c),m}}function s4(t){if(t<Q6)throw new Error("sqrt is not defined for small field");let e=t-Ct,r=0;for(;e%Hs===Qt;)e/=Hs,r++;let n=Hs;const i=ds(t);for(;t2(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return i4;let s=i.pow(n,e);const o=(e+Ct)/Hs;return function(a,c){if(a.is0(c))return c;if(t2(a,c)!==1)throw new Error("Cannot find square root");let f=r,u=a.mul(a.ONE,s),l=a.pow(c,e),h=a.pow(c,o);for(;!a.eql(l,a.ONE);){if(a.is0(l))return a.ZERO;let d=1,p=a.sqr(l);for(;!a.eql(p,a.ONE);)if(d++,p=a.sqr(p),d===f)throw new Error("Cannot find square root");const w=Ct<<BigInt(f-d-1),m=a.pow(u,w);f=d,u=a.sqr(m),l=a.mul(l,u),h=a.mul(h,m)}return h}}function UW(t){return t%e4===Q6?i4:t%r4===t4?DW:t%n4===_W?FW(t):s4(t)}const CW=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function PW(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=CW.reduce((n,i)=>(n[i]="function",n),e);return Wu(t,r),t}function RW(t,e,r){if(r<Qt)throw new Error("invalid exponent, negatives unsupported");if(r===Qt)return t.ONE;if(r===Ct)return e;let n=t.ONE,i=e;for(;r>Qt;)r&Ct&&(n=t.mul(n,i)),i=t.sqr(i),r>>=Ct;return n}function o4(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),s),n}function t2(t,e){const r=(t.ORDER-Ct)/Hs,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function a4(t,e){e!==void 0&&cs(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function ds(t,e,r=!1,n={}){if(t<=Qt)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const h=e;h.BITS&&(i=h.BITS),h.sqrt&&(s=h.sqrt),typeof h.isLE=="boolean"&&(r=h.isLE),typeof h.modFromBytes=="boolean"&&(o=h.modFromBytes),a=h.allowedLengths}else typeof e=="number"&&(i=e),n.sqrt&&(s=n.sqrt);const{nBitLength:c,nByteLength:f}=a4(t,i);if(f>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const l=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:f,MASK:Sc(c),ZERO:Qt,ONE:Ct,allowedLengths:a,create:h=>fr(h,t),isValid:h=>{if(typeof h!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof h);return Qt<=h&&h<t},is0:h=>h===Qt,isValidNot0:h=>!l.is0(h)&&l.isValid(h),isOdd:h=>(h&Ct)===Ct,neg:h=>fr(-h,t),eql:(h,d)=>h===d,sqr:h=>fr(h*h,t),add:(h,d)=>fr(h+d,t),sub:(h,d)=>fr(h-d,t),mul:(h,d)=>fr(h*d,t),pow:(h,d)=>RW(l,h,d),div:(h,d)=>fr(h*e2(d,t),t),sqrN:h=>h*h,addN:(h,d)=>h+d,subN:(h,d)=>h-d,mulN:(h,d)=>h*d,inv:h=>e2(h,t),sqrt:s||(h=>(u||(u=UW(t)),u(l,h))),toBytes:h=>r?u1(h,f):f1(h,f),fromBytes:(h,d=!0)=>{if(a){if(!a.includes(h.length)||h.length>f)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+h.length);const w=new Uint8Array(f);w.set(h,r?0:w.length-h.length),h=w}if(h.length!==f)throw new Error("Field.fromBytes: expected "+f+" bytes, got "+h.length);let p=r?fu(h):Zu(h);if(o&&(p=fr(p,t)),!d&&!l.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:h=>o4(l,h),cmov:(h,d,p)=>p?d:h});return Object.freeze(l)}function c4(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function f4(t){const e=c4(t);return e+Math.ceil(e/2)}function NW(t,e,r=!1){const n=t.length,i=c4(e),s=f4(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?fu(t):Zu(t),a=fr(o,e-Ct)+Ct;return r?u1(a,i):f1(a,i)}const Xo=BigInt(0),Vs=BigInt(1);function uu(t,e){const r=e.negate();return t?r:e}function Vl(t,e){const r=o4(t.Fp,e.map(n=>n.Z));return e.map((n,i)=>t.fromAffine(n.toAffine(r[i])))}function u4(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Kl(t,e){u4(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=Sc(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function r2(t,e,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(t&i),c=t>>o;a>n&&(a-=s,c+=Vs);const f=e*n,u=f+Math.abs(a)-1,l=a===0,h=a<0,d=e%2!==0;return{nextN:c,offset:u,isZero:l,isNeg:h,isNegF:d,offsetF:f}}function TW(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function LW(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Gl=new WeakMap,h4=new WeakMap;function Zl(t){return h4.get(t)||1}function n2(t){if(t!==Xo)throw new Error("invalid wNAF")}class kW{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let i=e;for(;r>Xo;)r&Vs&&(n=n.add(i)),i=i.double(),r>>=Vs;return n}precomputeWindow(e,r){const{windows:n,windowSize:i}=Kl(r,this.bits),s=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,s.push(a);for(let f=1;f<i;f++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=Kl(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:f,isZero:u,isNeg:l,isNegF:h,offsetF:d}=r2(n,a,o);n=c,u?s=s.add(uu(h,r[d])):i=i.add(uu(l,r[f]))}return n2(n),{p:i,f:s}}wNAFUnsafe(e,r,n,i=this.ZERO){const s=Kl(e,this.bits);for(let o=0;o<s.windows&&n!==Xo;o++){const{nextN:a,offset:c,isZero:f,isNeg:u}=r2(n,o,s);if(n=a,!f){const l=r[c];i=i.add(u?l.negate():l)}}return n2(n),i}getPrecomputes(e,r,n){let i=Gl.get(r);return i||(i=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(i=n(i)),Gl.set(r,i))),i}cached(e,r,n){const i=Zl(e);return this.wNAF(i,this.getPrecomputes(i,e,n),r)}unsafe(e,r,n,i){const s=Zl(e);return s===1?this._unsafeLadder(e,r,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,n),r,i)}createCache(e,r){u4(r,this.bits),h4.set(e,r),Gl.delete(e)}hasCache(e){return Zl(e)!==1}}function jW(t,e,r,n){let i=e,s=t.ZERO,o=t.ZERO;for(;r>Xo||n>Xo;)r&Vs&&(s=s.add(i)),n&Vs&&(o=o.add(i)),i=i.double(),r>>=Vs,n>>=Vs;return{p1:s,p2:o}}function qW(t,e,r,n){TW(r,t),LW(n,e);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=J6(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const f=Sc(c),u=new Array(Number(f)+1).fill(o),l=Math.floor((e.BITS-1)/c)*c;let h=o;for(let d=l;d>=0;d-=c){u.fill(o);for(let w=0;w<s;w++){const m=n[w],D=Number(m>>BigInt(d)&f);u[D]=u[D].add(r[w])}let p=o;for(let w=u.length-1,m=o;w>0;w--)m=m.add(u[w]),p=p.add(m);if(h=h.add(p),d!==0)for(let w=0;w<c;w++)h=h.double()}return h}function i2(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return PW(e),e}else return ds(t,{isLE:r})}function MW(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>Xo))throw new Error(`CURVE.${a} must be positive bigint`)}const i=i2(e.p,r.Fp,n),s=i2(e.n,r.Fn,n),o=["Gx","Gy","a","b"];for(const a of o)if(!i.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),k6("HashToScalar-");const Aa=BigInt(0),xo=BigInt(1),lf=BigInt(2);function zW(t){return Wu(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function HW(t){const e=zW(t),{P:r,type:n,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||s1,f=a?255:448,u=a?32:56,l=BigInt(a?9:5),h=BigInt(a?121665:39081),d=a?lf**BigInt(254):lf**BigInt(447),p=a?BigInt(8)*lf**BigInt(251)-xo:BigInt(4)*lf**BigInt(445)-xo,w=d+p+xo,m=O=>fr(O,r),D=C(l);function C(O){return u1(m(O),u)}function b(O){const x=At("u coordinate",O,u);return a&&(x[31]&=127),m(fu(x))}function B(O){return fu(i(At("scalar",O,u)))}function F(O,x){const $=P(b(x),B(O));if($===Aa)throw new Error("invalid private or public key received");return C($)}function _(O){return F(O,D)}function N(O,x,$){const g=m(O*(x-$));return x=m(x-g),$=m($+g),{x_2:x,x_3:$}}function P(O,x){U0("u",O,Aa,r),U0("scalar",x,d,w);const $=x,g=O;let y=xo,v=Aa,I=O,E=xo,A=Aa;for(let R=BigInt(f-1);R>=Aa;R--){const q=$>>R&xo;A^=q,{x_2:y,x_3:I}=N(A,y,I),{x_2:v,x_3:E}=N(A,v,E),A=q;const j=y+v,k=m(j*j),M=y-v,H=m(M*M),V=k-H,z=I+E,K=I-E,Q=m(K*j),ee=m(z*M),ne=Q+ee,he=Q-ee;I=m(ne*ne),E=m(g*m(he*he)),y=m(k*H),v=m(V*(k+m(h*V)))}({x_2:y,x_3:I}=N(A,y,I)),{x_2:v,x_3:E}=N(A,v,E);const U=s(v);return m(y*U)}const S={secretKey:u,publicKey:u,seed:u},T=(O=c(u))=>(Yr(O,S.seed),O);function L(O){const x=T(O);return{secretKey:x,publicKey:_(x)}}return{keygen:L,getSharedSecret:(O,x)=>F(O,x),getPublicKey:O=>_(O),scalarMult:F,scalarMultBase:_,utils:{randomSecretKey:T,randomPrivateKey:T},GuBytes:D.slice(),lengths:S}}const VW=BigInt(1),s2=BigInt(2),KW=BigInt(3),GW=BigInt(5);BigInt(8);const l4=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),ZW={p:l4,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function WW(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=l4,o=t*t%s*t%s,a=Tr(o,s2,s)*o%s,c=Tr(a,VW,s)*t%s,f=Tr(c,GW,s)*c%s,u=Tr(f,e,s)*f%s,l=Tr(u,r,s)*u%s,h=Tr(l,n,s)*l%s,d=Tr(h,i,s)*h%s,p=Tr(d,i,s)*h%s,w=Tr(p,e,s)*f%s;return{pow_p_5_8:Tr(w,s2,s)*t%s,b2:o}}function YW(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const XW=ds(ZW.p,{isLE:!0});(()=>{const t=XW.ORDER;return HW({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:n}=WW(e);return fr(Tr(r,KW,t)*n,t)},adjustScalarBytes:YW})})();const o2=(t,e)=>(t+(t>=0?e:-e)/d4)/e;function JW(t,e,r){const[[n,i],[s,o]]=e,a=o2(o*t,r),c=o2(-i*t,r);let f=t-a*n-c*s,u=-a*i-c*o;const l=f<Gn,h=u<Gn;l&&(f=-f),h&&(u=-u);const d=Sc(Math.ceil(J6(r)/2))+jo;if(f<Gn||f>=d||u<Gn||u>=d)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:l,k1:f,k2neg:h,k2:u}}function C0(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function Wl(t,e){const r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return cu(r.lowS,"lowS"),cu(r.prehash,"prehash"),r.format!==void 0&&C0(r.format),r}class QW extends Error{constructor(e=""){super(e)}}const Mn={Err:QW,_tlv:{encode:(t,e)=>{const{Err:r}=Mn;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=hf(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?hf(i.length/2|128):"";return hf(t)+s+i+e},decode(t,e){const{Err:r}=Mn;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const f=e.subarray(n,n+c);if(f.length!==c)throw new r("tlv.decode: length bytes not complete");if(f[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of f)o=o<<8|u;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=Mn;if(t<Gn)throw new e("integer: negative integers are not allowed");let r=hf(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Mn;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Zu(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=Mn,i=At("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:f,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(f)}},hexFromSig(t){const{_tlv:e,_int:r}=Mn,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}},Gn=BigInt(0),jo=BigInt(1),d4=BigInt(2),df=BigInt(3),eY=BigInt(4);function Do(t,e){const{BYTES:r}=t;let n;if(typeof e=="bigint")n=e;else{let i=At("private key",e);try{n=t.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function tY(t,e={}){const r=MW("weierstrass",t,e),{Fp:n,Fn:i}=r;let s=r.CURVE;const{h:o,n:a}=s;Wu(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const f=g4(n,i);function u(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function l(O,x,$){const{x:g,y}=x.toAffine(),v=n.toBytes(g);if(cu($,"isCompressed"),$){u();const I=!n.isOdd(y);return Yi(p4(I),v)}else return Yi(Uint8Array.of(4),v,n.toBytes(y))}function h(O){zs(O,void 0,"Point");const{publicKey:x,publicKeyUncompressed:$}=f,g=O.length,y=O[0],v=O.subarray(1);if(g===x&&(y===2||y===3)){const I=n.fromBytes(v);if(!n.isValid(I))throw new Error("bad point: is not on curve, wrong x");const E=w(I);let A;try{A=n.sqrt(E)}catch(R){const q=R instanceof Error?": "+R.message:"";throw new Error("bad point: is not on curve, sqrt error"+q)}u();const U=n.isOdd(A);return(y&1)===1!==U&&(A=n.neg(A)),{x:I,y:A}}else if(g===$&&y===4){const I=n.BYTES,E=n.fromBytes(v.subarray(0,I)),A=n.fromBytes(v.subarray(I,I*2));if(!m(E,A))throw new Error("bad point: is not on curve");return{x:E,y:A}}else throw new Error(`bad point: got length ${g}, expected compressed=${x} or uncompressed=${$}`)}const d=e.toBytes||l,p=e.fromBytes||h;function w(O){const x=n.sqr(O),$=n.mul(x,O);return n.add(n.add($,n.mul(O,s.a)),s.b)}function m(O,x){const $=n.sqr(x),g=w(O);return n.eql($,g)}if(!m(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const D=n.mul(n.pow(s.a,df),eY),C=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(D,C)))throw new Error("bad curve params: a or b");function b(O,x,$=!1){if(!n.isValid(x)||$&&n.is0(x))throw new Error(`bad point coordinate ${O}`);return x}function B(O){if(!(O instanceof S))throw new Error("ProjectivePoint expected")}function F(O){if(!c||!c.basises)throw new Error("no endo");return JW(O,c.basises,i.ORDER)}const _=Qb((O,x)=>{const{X:$,Y:g,Z:y}=O;if(n.eql(y,n.ONE))return{x:$,y:g};const v=O.is0();x==null&&(x=v?n.ONE:n.inv(y));const I=n.mul($,x),E=n.mul(g,x),A=n.mul(y,x);if(v)return{x:n.ZERO,y:n.ZERO};if(!n.eql(A,n.ONE))throw new Error("invZ was invalid");return{x:I,y:E}}),N=Qb(O=>{if(O.is0()){if(e.allowInfinityPoint&&!n.is0(O.Y))return;throw new Error("bad point: ZERO")}const{x,y:$}=O.toAffine();if(!n.isValid(x)||!n.isValid($))throw new Error("bad point: x or y not field elements");if(!m(x,$))throw new Error("bad point: equation left != right");if(!O.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function P(O,x,$,g,y){return $=new S(n.mul($.X,O),$.Y,$.Z),x=uu(g,x),$=uu(y,$),x.add($)}class S{constructor(x,$,g){this.X=b("x",x),this.Y=b("y",$,!0),this.Z=b("z",g),Object.freeze(this)}static CURVE(){return s}static fromAffine(x){const{x:$,y:g}=x||{};if(!x||!n.isValid($)||!n.isValid(g))throw new Error("invalid affine point");if(x instanceof S)throw new Error("projective point not allowed");return n.is0($)&&n.is0(g)?S.ZERO:new S($,g,n.ONE)}static fromBytes(x){const $=S.fromAffine(p(zs(x,void 0,"point")));return $.assertValidity(),$}static fromHex(x){return S.fromBytes(At("pointHex",x))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(x=8,$=!0){return L.createCache(this,x),$||this.multiply(df),this}assertValidity(){N(this)}hasEvenY(){const{y:x}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(x)}equals(x){B(x);const{X:$,Y:g,Z:y}=this,{X:v,Y:I,Z:E}=x,A=n.eql(n.mul($,E),n.mul(v,y)),U=n.eql(n.mul(g,E),n.mul(I,y));return A&&U}negate(){return new S(this.X,n.neg(this.Y),this.Z)}double(){const{a:x,b:$}=s,g=n.mul($,df),{X:y,Y:v,Z:I}=this;let E=n.ZERO,A=n.ZERO,U=n.ZERO,R=n.mul(y,y),q=n.mul(v,v),j=n.mul(I,I),k=n.mul(y,v);return k=n.add(k,k),U=n.mul(y,I),U=n.add(U,U),E=n.mul(x,U),A=n.mul(g,j),A=n.add(E,A),E=n.sub(q,A),A=n.add(q,A),A=n.mul(E,A),E=n.mul(k,E),U=n.mul(g,U),j=n.mul(x,j),k=n.sub(R,j),k=n.mul(x,k),k=n.add(k,U),U=n.add(R,R),R=n.add(U,R),R=n.add(R,j),R=n.mul(R,k),A=n.add(A,R),j=n.mul(v,I),j=n.add(j,j),R=n.mul(j,k),E=n.sub(E,R),U=n.mul(j,q),U=n.add(U,U),U=n.add(U,U),new S(E,A,U)}add(x){B(x);const{X:$,Y:g,Z:y}=this,{X:v,Y:I,Z:E}=x;let A=n.ZERO,U=n.ZERO,R=n.ZERO;const q=s.a,j=n.mul(s.b,df);let k=n.mul($,v),M=n.mul(g,I),H=n.mul(y,E),V=n.add($,g),z=n.add(v,I);V=n.mul(V,z),z=n.add(k,M),V=n.sub(V,z),z=n.add($,y);let K=n.add(v,E);return z=n.mul(z,K),K=n.add(k,H),z=n.sub(z,K),K=n.add(g,y),A=n.add(I,E),K=n.mul(K,A),A=n.add(M,H),K=n.sub(K,A),R=n.mul(q,z),A=n.mul(j,H),R=n.add(A,R),A=n.sub(M,R),R=n.add(M,R),U=n.mul(A,R),M=n.add(k,k),M=n.add(M,k),H=n.mul(q,H),z=n.mul(j,z),M=n.add(M,H),H=n.sub(k,H),H=n.mul(q,H),z=n.add(z,H),k=n.mul(M,z),U=n.add(U,k),k=n.mul(K,z),A=n.mul(V,A),A=n.sub(A,k),k=n.mul(V,M),R=n.mul(K,R),R=n.add(R,k),new S(A,U,R)}subtract(x){return this.add(x.negate())}is0(){return this.equals(S.ZERO)}multiply(x){const{endo:$}=e;if(!i.isValidNot0(x))throw new Error("invalid scalar: out of range");let g,y;const v=I=>L.cached(this,I,E=>Vl(S,E));if($){const{k1neg:I,k1:E,k2neg:A,k2:U}=F(x),{p:R,f:q}=v(E),{p:j,f:k}=v(U);y=q.add(k),g=P($.beta,R,j,I,A)}else{const{p:I,f:E}=v(x);g=I,y=E}return Vl(S,[g,y])[0]}multiplyUnsafe(x){const{endo:$}=e,g=this;if(!i.isValid(x))throw new Error("invalid scalar: out of range");if(x===Gn||g.is0())return S.ZERO;if(x===jo)return g;if(L.hasCache(this))return this.multiply(x);if($){const{k1neg:y,k1:v,k2neg:I,k2:E}=F(x),{p1:A,p2:U}=jW(S,g,v,E);return P($.beta,A,U,y,I)}else return L.unsafe(g,x)}multiplyAndAddUnsafe(x,$,g){const y=this.multiplyUnsafe($).add(x.multiplyUnsafe(g));return y.is0()?void 0:y}toAffine(x){return _(this,x)}isTorsionFree(){const{isTorsionFree:x}=e;return o===jo?!0:x?x(S,this):L.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:x}=e;return o===jo?this:x?x(S,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(x=!0){return cu(x,"isCompressed"),this.assertValidity(),d(S,this,x)}toHex(x=!0){return ko(this.toBytes(x))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(x=!0){return this.toBytes(x)}_setWindowSize(x){this.precompute(x)}static normalizeZ(x){return Vl(S,x)}static msm(x,$){return qW(S,i,x,$)}static fromPrivateKey(x){return S.BASE.multiply(Do(i,x))}}S.BASE=new S(s.Gx,s.Gy,n.ONE),S.ZERO=new S(n.ZERO,n.ONE,n.ZERO),S.Fp=n,S.Fn=i;const T=i.BITS,L=new kW(S,e.endo?Math.ceil(T/2):T);return S.BASE.precompute(8),S}function p4(t){return Uint8Array.of(t?2:3)}function g4(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function rY(t,e={}){const{Fn:r}=t,n=e.randomBytes||s1,i=Object.assign(g4(t.Fp,r),{seed:f4(r.ORDER)});function s(h){try{return!!Do(r,h)}catch{return!1}}function o(h,d){const{publicKey:p,publicKeyUncompressed:w}=i;try{const m=h.length;return d===!0&&m!==p||d===!1&&m!==w?!1:!!t.fromBytes(h)}catch{return!1}}function a(h=n(i.seed)){return NW(zs(h,i.seed,"seed"),r.ORDER)}function c(h,d=!0){return t.BASE.multiply(Do(r,h)).toBytes(d)}function f(h){const d=a(h);return{secretKey:d,publicKey:c(d)}}function u(h){if(typeof h=="bigint")return!1;if(h instanceof t)return!0;const{secretKey:d,publicKey:p,publicKeyUncompressed:w}=i;if(r.allowedLengths||d===p)return;const m=At("key",h).length;return m===p||m===w}function l(h,d,p=!0){if(u(h)===!0)throw new Error("first arg must be private key");if(u(d)===!1)throw new Error("second arg must be public key");const w=Do(r,h);return t.fromHex(d).multiply(w).toBytes(p)}return Object.freeze({getPublicKey:c,getSharedSecret:l,keygen:f,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:h=>Do(r,h),precompute(h=8,d=t.BASE){return d.precompute(h,!1)}},lengths:i})}function nY(t,e,r={}){R6(e),Wu(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=r.randomBytes||s1,i=r.hmac||(($,...g)=>Y6(e,$,Yi(...g))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:f,getPublicKey:u,getSharedSecret:l,utils:h,lengths:d}=rY(t,r),p={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},w="compact";function m($){const g=a>>jo;return $>g}function D($,g){if(!o.isValidNot0(g))throw new Error(`invalid signature ${$}: out of range 1..Point.Fn.ORDER`);return g}function C($,g){C0(g);const y=d.signature,v=g==="compact"?y:g==="recovered"?y+1:void 0;return zs($,v,`${g} signature`)}class b{constructor(g,y,v){this.r=D("r",g),this.s=D("s",y),v!=null&&(this.recovery=v),Object.freeze(this)}static fromBytes(g,y=w){C(g,y);let v;if(y==="der"){const{r:U,s:R}=Mn.toSig(zs(g));return new b(U,R)}y==="recovered"&&(v=g[0],y="compact",g=g.subarray(1));const I=o.BYTES,E=g.subarray(0,I),A=g.subarray(I,I*2);return new b(o.fromBytes(E),o.fromBytes(A),v)}static fromHex(g,y){return this.fromBytes(au(g),y)}addRecoveryBit(g){return new b(this.r,this.s,g)}recoverPublicKey(g){const y=s.ORDER,{r:v,s:I,recovery:E}=this;if(E==null||![0,1,2,3].includes(E))throw new Error("recovery id invalid");if(a*d4<y&&E>1)throw new Error("recovery id is ambiguous for h>1 curve");const A=E===2||E===3?v+a:v;if(!s.isValid(A))throw new Error("recovery id 2 or 3 invalid");const U=s.toBytes(A),R=t.fromBytes(Yi(p4((E&1)===0),U)),q=o.inv(A),j=F(At("msgHash",g)),k=o.create(-j*q),M=o.create(I*q),H=t.BASE.multiplyUnsafe(k).add(R.multiplyUnsafe(M));if(H.is0())throw new Error("point at infinify");return H.assertValidity(),H}hasHighS(){return m(this.s)}toBytes(g=w){if(C0(g),g==="der")return au(Mn.hexFromSig(this));const y=o.toBytes(this.r),v=o.toBytes(this.s);if(g==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Yi(Uint8Array.of(this.recovery),y,v)}return Yi(y,v)}toHex(g){return ko(this.toBytes(g))}assertValidity(){}static fromCompact(g){return b.fromBytes(At("sig",g),"compact")}static fromDER(g){return b.fromBytes(At("sig",g),"der")}normalizeS(){return this.hasHighS()?new b(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return ko(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return ko(this.toBytes("compact"))}}const B=r.bits2int||function($){if($.length>8192)throw new Error("input is too large");const g=Zu($),y=$.length*8-c;return y>0?g>>BigInt(y):g},F=r.bits2int_modN||function($){return o.create(B($))},_=Sc(c);function N($){return U0("num < 2^"+c,$,Gn,_),o.toBytes($)}function P($,g){return zs($,void 0,"message"),g?zs(e($),void 0,"prehashed message"):$}function S($,g,y){if(["recovered","canonical"].some(M=>M in y))throw new Error("sign() legacy options not supported");const{lowS:v,prehash:I,extraEntropy:E}=Wl(y,p);$=P($,I);const A=F($),U=Do(o,g),R=[N(U),N(A)];if(E!=null&&E!==!1){const M=E===!0?n(d.secretKey):E;R.push(At("extraEntropy",M))}const q=Yi(...R),j=A;function k(M){const H=B(M);if(!o.isValidNot0(H))return;const V=o.inv(H),z=t.BASE.multiply(H).toAffine(),K=o.create(z.x);if(K===Gn)return;const Q=o.create(V*o.create(j+K*U));if(Q===Gn)return;let ee=(z.x===K?0:2)|Number(z.y&jo),ne=Q;return v&&m(Q)&&(ne=o.neg(Q),ee^=1),new b(K,ne,ee)}return{seed:q,k2sig:k}}function T($,g,y={}){$=At("message",$);const{seed:v,k2sig:I}=S($,g,y);return SW(e.outputLen,o.BYTES,i)(v,I)}function L($){let g;const y=typeof $=="string"||Ku($),v=!y&&$!==null&&typeof $=="object"&&typeof $.r=="bigint"&&typeof $.s=="bigint";if(!y&&!v)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(v)g=new b($.r,$.s);else if(y){try{g=b.fromBytes(At("sig",$),"der")}catch(I){if(!(I instanceof Mn.Err))throw I}if(!g)try{g=b.fromBytes(At("sig",$),"compact")}catch{return!1}}return g||!1}function O($,g,y,v={}){const{lowS:I,prehash:E,format:A}=Wl(v,p);if(y=At("publicKey",y),g=P(At("message",g),E),"strict"in v)throw new Error("options.strict was renamed to lowS");const U=A===void 0?L($):b.fromBytes(At("sig",$),A);if(U===!1)return!1;try{const R=t.fromBytes(y);if(I&&U.hasHighS())return!1;const{r:q,s:j}=U,k=F(g),M=o.inv(j),H=o.create(k*M),V=o.create(q*M),z=t.BASE.multiplyUnsafe(H).add(R.multiplyUnsafe(V));return z.is0()?!1:o.create(z.x)===q}catch{return!1}}function x($,g,y={}){const{prehash:v}=Wl(y,p);return g=P(g,v),b.fromBytes($,"recovered").recoverPublicKey(g).toBytes()}return Object.freeze({keygen:f,getPublicKey:u,getSharedSecret:l,utils:h,lengths:d,Point:t,sign:T,verify:O,recoverPublicKey:x,Signature:b,hash:e})}function iY(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=ds(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),s={Fp:r,Fn:i,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function sY(t){const{CURVE:e,curveOpts:r}=iY(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function oY(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,a4(r.Fn.ORDER,r.Fn.BITS))})}function aY(t){const{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:i}=sY(t),s=tY(e,r),o=nY(s,n,i);return oY(t,o)}function P0(t,e){const r=n=>aY({...t,hash:n});return{...r(e),create:r}}const y4={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},w4={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},b4={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},cY=ds(y4.p),fY=ds(w4.p),uY=ds(b4.p);P0({...y4,Fp:cY,lowS:!1},WZ);P0({...w4,Fp:fY,lowS:!1},XZ),P0({...b4,Fp:uY,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},YZ);function l1(t){return t.includes(":")}function La(t){return l1(t)?t.split(":")[0]:t}const hY={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function a2(t,e){const{message:r,code:n}=hY[t];return{message:e?`${r} ${e}`:r,code:n}}function Yl(t,e){return!!Array.isArray(t)}function Ga(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}var pf={exports:{}},c2;function lY(){return c2||(c2=1,(function(t,e){var r=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof dn<"u"&&dn,n=(function(){function s(){this.fetch=!1,this.DOMException=r.DOMException}return s.prototype=r,new s})();(function(s){(function(o){var a=typeof s<"u"&&s||typeof self<"u"&&self||typeof dn<"u"&&dn||{},c={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function f(g){return g&&DataView.prototype.isPrototypeOf(g)}if(c.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(g){return g&&u.indexOf(Object.prototype.toString.call(g))>-1};function h(g){if(typeof g!="string"&&(g=String(g)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(g)||g==="")throw new TypeError('Invalid character in header field name: "'+g+'"');return g.toLowerCase()}function d(g){return typeof g!="string"&&(g=String(g)),g}function p(g){var y={next:function(){var v=g.shift();return{done:v===void 0,value:v}}};return c.iterable&&(y[Symbol.iterator]=function(){return y}),y}function w(g){this.map={},g instanceof w?g.forEach(function(y,v){this.append(v,y)},this):Array.isArray(g)?g.forEach(function(y){if(y.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+y.length);this.append(y[0],y[1])},this):g&&Object.getOwnPropertyNames(g).forEach(function(y){this.append(y,g[y])},this)}w.prototype.append=function(g,y){g=h(g),y=d(y);var v=this.map[g];this.map[g]=v?v+", "+y:y},w.prototype.delete=function(g){delete this.map[h(g)]},w.prototype.get=function(g){return g=h(g),this.has(g)?this.map[g]:null},w.prototype.has=function(g){return this.map.hasOwnProperty(h(g))},w.prototype.set=function(g,y){this.map[h(g)]=d(y)},w.prototype.forEach=function(g,y){for(var v in this.map)this.map.hasOwnProperty(v)&&g.call(y,this.map[v],v,this)},w.prototype.keys=function(){var g=[];return this.forEach(function(y,v){g.push(v)}),p(g)},w.prototype.values=function(){var g=[];return this.forEach(function(y){g.push(y)}),p(g)},w.prototype.entries=function(){var g=[];return this.forEach(function(y,v){g.push([v,y])}),p(g)},c.iterable&&(w.prototype[Symbol.iterator]=w.prototype.entries);function m(g){if(!g._noBody){if(g.bodyUsed)return Promise.reject(new TypeError("Already read"));g.bodyUsed=!0}}function D(g){return new Promise(function(y,v){g.onload=function(){y(g.result)},g.onerror=function(){v(g.error)}})}function C(g){var y=new FileReader,v=D(y);return y.readAsArrayBuffer(g),v}function b(g){var y=new FileReader,v=D(y),I=/charset=([A-Za-z0-9_-]+)/.exec(g.type),E=I?I[1]:"utf-8";return y.readAsText(g,E),v}function B(g){for(var y=new Uint8Array(g),v=new Array(y.length),I=0;I<y.length;I++)v[I]=String.fromCharCode(y[I]);return v.join("")}function F(g){if(g.slice)return g.slice(0);var y=new Uint8Array(g.byteLength);return y.set(new Uint8Array(g)),y.buffer}function _(){return this.bodyUsed=!1,this._initBody=function(g){this.bodyUsed=this.bodyUsed,this._bodyInit=g,g?typeof g=="string"?this._bodyText=g:c.blob&&Blob.prototype.isPrototypeOf(g)?this._bodyBlob=g:c.formData&&FormData.prototype.isPrototypeOf(g)?this._bodyFormData=g:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(g)?this._bodyText=g.toString():c.arrayBuffer&&c.blob&&f(g)?(this._bodyArrayBuffer=F(g.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(g)||l(g))?this._bodyArrayBuffer=F(g):this._bodyText=g=Object.prototype.toString.call(g):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof g=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(g)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var g=m(this);if(g)return g;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var g=m(this);return g||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(c.blob)return this.blob().then(C);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var g=m(this);if(g)return g;if(this._bodyBlob)return b(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(B(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(T)}),this.json=function(){return this.text().then(JSON.parse)},this}var N=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function P(g){var y=g.toUpperCase();return N.indexOf(y)>-1?y:g}function S(g,y){if(!(this instanceof S))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');y=y||{};var v=y.body;if(g instanceof S){if(g.bodyUsed)throw new TypeError("Already read");this.url=g.url,this.credentials=g.credentials,y.headers||(this.headers=new w(g.headers)),this.method=g.method,this.mode=g.mode,this.signal=g.signal,!v&&g._bodyInit!=null&&(v=g._bodyInit,g.bodyUsed=!0)}else this.url=String(g);if(this.credentials=y.credentials||this.credentials||"same-origin",(y.headers||!this.headers)&&(this.headers=new w(y.headers)),this.method=P(y.method||this.method||"GET"),this.mode=y.mode||this.mode||null,this.signal=y.signal||this.signal||(function(){if("AbortController"in a){var A=new AbortController;return A.signal}})(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&v)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(v),(this.method==="GET"||this.method==="HEAD")&&(y.cache==="no-store"||y.cache==="no-cache")){var I=/([?&])_=[^&]*/;if(I.test(this.url))this.url=this.url.replace(I,"$1_="+new Date().getTime());else{var E=/\?/;this.url+=(E.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}S.prototype.clone=function(){return new S(this,{body:this._bodyInit})};function T(g){var y=new FormData;return g.trim().split("&").forEach(function(v){if(v){var I=v.split("="),E=I.shift().replace(/\+/g," "),A=I.join("=").replace(/\+/g," ");y.append(decodeURIComponent(E),decodeURIComponent(A))}}),y}function L(g){var y=new w,v=g.replace(/\r?\n[\t ]+/g," ");return v.split("\r").map(function(I){return I.indexOf(`
`)===0?I.substr(1,I.length):I}).forEach(function(I){var E=I.split(":"),A=E.shift().trim();if(A){var U=E.join(":").trim();try{y.append(A,U)}catch(R){console.warn("Response "+R.message)}}}),y}_.call(S.prototype);function O(g,y){if(!(this instanceof O))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(y||(y={}),this.type="default",this.status=y.status===void 0?200:y.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=y.statusText===void 0?"":""+y.statusText,this.headers=new w(y.headers),this.url=y.url||"",this._initBody(g)}_.call(O.prototype),O.prototype.clone=function(){return new O(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new w(this.headers),url:this.url})},O.error=function(){var g=new O(null,{status:200,statusText:""});return g.ok=!1,g.status=0,g.type="error",g};var x=[301,302,303,307,308];O.redirect=function(g,y){if(x.indexOf(y)===-1)throw new RangeError("Invalid status code");return new O(null,{status:y,headers:{location:g}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(y,v){this.message=y,this.name=v;var I=Error(y);this.stack=I.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function $(g,y){return new Promise(function(v,I){var E=new S(g,y);if(E.signal&&E.signal.aborted)return I(new o.DOMException("Aborted","AbortError"));var A=new XMLHttpRequest;function U(){A.abort()}A.onload=function(){var j={statusText:A.statusText,headers:L(A.getAllResponseHeaders()||"")};E.url.indexOf("file://")===0&&(A.status<200||A.status>599)?j.status=200:j.status=A.status,j.url="responseURL"in A?A.responseURL:j.headers.get("X-Request-URL");var k="response"in A?A.response:A.responseText;setTimeout(function(){v(new O(k,j))},0)},A.onerror=function(){setTimeout(function(){I(new TypeError("Network request failed"))},0)},A.ontimeout=function(){setTimeout(function(){I(new TypeError("Network request timed out"))},0)},A.onabort=function(){setTimeout(function(){I(new o.DOMException("Aborted","AbortError"))},0)};function R(j){try{return j===""&&a.location.href?a.location.href:j}catch{return j}}if(A.open(E.method,R(E.url),!0),E.credentials==="include"?A.withCredentials=!0:E.credentials==="omit"&&(A.withCredentials=!1),"responseType"in A&&(c.blob?A.responseType="blob":c.arrayBuffer&&(A.responseType="arraybuffer")),y&&typeof y.headers=="object"&&!(y.headers instanceof w||a.Headers&&y.headers instanceof a.Headers)){var q=[];Object.getOwnPropertyNames(y.headers).forEach(function(j){q.push(h(j)),A.setRequestHeader(j,d(y.headers[j]))}),E.headers.forEach(function(j,k){q.indexOf(k)===-1&&A.setRequestHeader(k,j)})}else E.headers.forEach(function(j,k){A.setRequestHeader(k,j)});E.signal&&(E.signal.addEventListener("abort",U),A.onreadystatechange=function(){A.readyState===4&&E.signal.removeEventListener("abort",U)}),A.send(typeof E._bodyInit>"u"?null:E._bodyInit)})}return $.polyfill=!0,a.fetch||(a.fetch=$,a.Headers=w,a.Request=S,a.Response=O),o.Headers=w,o.Request=S,o.Response=O,o.fetch=$,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var i=r.fetch?r:n;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,t.exports=e})(pf,pf.exports)),pf.exports}var dY=lY();const f2=k0(dY);var pY=Object.defineProperty,gY=Object.defineProperties,yY=Object.getOwnPropertyDescriptors,u2=Object.getOwnPropertySymbols,wY=Object.prototype.hasOwnProperty,bY=Object.prototype.propertyIsEnumerable,h2=(t,e,r)=>e in t?pY(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,l2=(t,e)=>{for(var r in e||(e={}))wY.call(e,r)&&h2(t,r,e[r]);if(u2)for(var r of u2(e))bY.call(e,r)&&h2(t,r,e[r]);return t},d2=(t,e)=>gY(t,yY(e));const mY={Accept:"application/json","Content-Type":"application/json"},EY="POST",p2={headers:mY,method:EY},g2=10;let m4=class{constructor(e,r=!1){if(this.url=e,this.disableProviderPing=r,this.events=new hr.EventEmitter,this.isAvailable=!1,this.registering=!1,!Cy(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const r=Xn(e),n=await(await f2(this.url,d2(l2({},p2),{body:r}))).json();this.onPayload({data:n})}catch(r){this.onError(e.id,r)}}async register(e=this.url){if(!Cy(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return i(new Error("HTTP connection is missing or invalid"));n()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const r=Xn({id:1,jsonrpc:"2.0",method:"test",params:[]});await f2(e,d2(l2({},p2),{body:r}))}this.onOpen()}catch(r){const n=this.parseError(r);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Ws(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const n=this.parseError(r),i=n.message||n.toString(),s=Cu(e,i);this.events.emit("payload",s)}parseError(e,r=this.url){return GE(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>g2&&this.events.setMaxListeners(g2)}};const y2="error",vY="wss://relay.walletconnect.org",xY="wc",$Y="universal_provider",gf=`${xY}@2:${$Y}:`,E4="https://rpc.walletconnect.org/v1/",v4="generic",AY=`${E4}bundler`,qo="call_status",IY=86400,d1={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function p1(t){return t==null||typeof t!="object"&&typeof t!="function"}function x4(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function $4(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const BY="[object RegExp]",A4="[object String]",I4="[object Number]",B4="[object Boolean]",S4="[object Arguments]",SY="[object Symbol]",OY="[object Date]",_Y="[object Map]",DY="[object Set]",FY="[object Array]",UY="[object ArrayBuffer]",CY="[object Object]",PY="[object DataView]",RY="[object Uint8Array]",NY="[object Uint8ClampedArray]",TY="[object Uint16Array]",LY="[object Uint32Array]",kY="[object Int8Array]",jY="[object Int16Array]",qY="[object Int32Array]",MY="[object Float32Array]",zY="[object Float64Array]";function g1(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function HY(t,e){return Fo(t,void 0,t,new Map,e)}function Fo(t,e,r,n=new Map,i=void 0){const s=i==null?void 0:i(t,e,r,n);if(s!=null)return s;if(p1(t))return t;if(n.has(t))return n.get(t);if(Array.isArray(t)){const o=new Array(t.length);n.set(t,o);for(let a=0;a<t.length;a++)o[a]=Fo(t[a],a,r,n,i);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){const o=new Map;n.set(t,o);for(const[a,c]of t)o.set(a,Fo(c,a,r,n,i));return o}if(t instanceof Set){const o=new Set;n.set(t,o);for(const a of t)o.add(Fo(a,void 0,r,n,i));return o}if(typeof ue<"u"&&ue.isBuffer(t))return t.subarray();if(g1(t)){const o=new(Object.getPrototypeOf(t)).constructor(t.length);n.set(t,o);for(let a=0;a<t.length;a++)o[a]=Fo(t[a],a,r,n,i);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return n.set(t,o),Fs(o,t,r,n,i),o}if(typeof File<"u"&&t instanceof File){const o=new File([t],t.name,{type:t.type});return n.set(t,o),Fs(o,t,r,n,i),o}if(t instanceof Blob){const o=new Blob([t],{type:t.type});return n.set(t,o),Fs(o,t,r,n,i),o}if(t instanceof Error){const o=new t.constructor;return n.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,Fs(o,t,r,n,i),o}if(typeof t=="object"&&VY(t)){const o=Object.create(Object.getPrototypeOf(t));return n.set(t,o),Fs(o,t,r,n,i),o}return t}function Fs(t,e,r=t,n,i){const s=[...Object.keys(e),...x4(e)];for(let o=0;o<s.length;o++){const a=s[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=Fo(e[a],a,r,n,i))}}function VY(t){switch($4(t)){case S4:case FY:case UY:case PY:case B4:case OY:case MY:case zY:case kY:case jY:case qY:case _Y:case I4:case CY:case BY:case DY:case A4:case SY:case RY:case NY:case TY:case LY:return!0;default:return!1}}function KY(t,e){return HY(t,(r,n,i,s)=>{if(typeof t=="object")switch(Object.prototype.toString.call(t)){case I4:case A4:case B4:{const o=new t.constructor(t==null?void 0:t.valueOf());return Fs(o,t),o}case S4:{const o={};return Fs(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}})}function w2(t){return KY(t)}function b2(t){return t!==null&&typeof t=="object"&&$4(t)==="[object Arguments]"}function m2(t){return typeof t=="object"&&t!==null}function GY(){}function ZY(t){return g1(t)}function WY(t){var r;if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const n=t[Symbol.toStringTag];return n==null||!((r=Object.getOwnPropertyDescriptor(t,Symbol.toStringTag))!=null&&r.writable)?!1:t.toString()===`[object ${n}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function YY(t){if(p1(t))return t;if(Array.isArray(t)||g1(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t),r=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new r(t);if(t instanceof RegExp){const n=new r(t);return n.lastIndex=t.lastIndex,n}if(t instanceof DataView)return new r(t.buffer.slice(0));if(t instanceof Error){const n=new r(t.message);return n.stack=t.stack,n.name=t.name,n.cause=t.cause,n}if(typeof File<"u"&&t instanceof File)return new r([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const n=Object.create(e);return Object.assign(n,t)}return t}function XY(t,...e){const r=e.slice(0,-1),n=e[e.length-1];let i=t;for(let s=0;s<r.length;s++){const o=r[s];i=R0(i,o,n,new Map)}return i}function R0(t,e,r,n){if(p1(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(n.has(e))return YY(n.get(e));if(n.set(e,t),Array.isArray(e)){e=e.slice();for(let s=0;s<e.length;s++)e[s]=e[s]??void 0}const i=[...Object.keys(e),...x4(e)];for(let s=0;s<i.length;s++){const o=i[s];let a=e[o],c=t[o];if(b2(a)&&(a={...a}),b2(c)&&(c={...c}),typeof ue<"u"&&ue.isBuffer(a)&&(a=w2(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const u=[],l=Reflect.ownKeys(c);for(let h=0;h<l.length;h++){const d=l[h];u[d]=c[d]}c=u}else c=[];const f=r(c,a,o,t,e,n);f!=null?t[o]=f:Array.isArray(a)||m2(c)&&m2(a)?t[o]=R0(c,a,r,n):c==null&&WY(a)?t[o]=R0({},a,r,n):c==null&&ZY(a)?t[o]=w2(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function JY(t,...e){return XY(t,...e,GY)}var QY=Object.defineProperty,eX=Object.defineProperties,tX=Object.getOwnPropertyDescriptors,E2=Object.getOwnPropertySymbols,rX=Object.prototype.hasOwnProperty,nX=Object.prototype.propertyIsEnumerable,v2=(t,e,r)=>e in t?QY(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yf=(t,e)=>{for(var r in e||(e={}))rX.call(e,r)&&v2(t,r,e[r]);if(E2)for(var r of E2(e))nX.call(e,r)&&v2(t,r,e[r]);return t},iX=(t,e)=>eX(t,tX(e));function O4(t,e,r){var n;const i=Ka(t);return((n=e.rpcMap)==null?void 0:n[i.reference])||`${E4}?chainId=${i.namespace}:${i.reference}&projectId=${r}`}function sX(t){return t.includes(":")?t.split(":")[1]:t}function _4(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function oX(t,e){const r=Object.keys(e.namespaces).filter(i=>i.includes(t));if(!r.length)return[];const n=[];return r.forEach(i=>{const s=e.namespaces[i].accounts;n.push(...s)}),n}function x2(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>{var n,i;return((n=r==null?void 0:r.chains)==null?void 0:n.length)&&((i=r==null?void 0:r.chains)==null?void 0:i.length)>0}))}function wf(t={},e={}){const r=x2($2(t)),n=x2($2(e));return JY(r,n)}function $2(t){var e,r,n,i,s;const o={};if(!Ga(t))return o;for(const[a,c]of Object.entries(t)){const f=l1(a)?[a]:c.chains,u=c.methods||[],l=c.events||[],h=c.rpcMap||{},d=La(a);o[d]=iX(yf(yf({},o[d]),c),{chains:ql(f,(e=o[d])==null?void 0:e.chains),methods:ql(u,(r=o[d])==null?void 0:r.methods),events:ql(l,(n=o[d])==null?void 0:n.events)}),(Ga(h)||Ga(((i=o[d])==null?void 0:i.rpcMap)||{}))&&(o[d].rpcMap=yf(yf({},h),(s=o[d])==null?void 0:s.rpcMap))}return o}function A2(t){return t.includes(":")?t.split(":")[2]:t}function I2(t){const e={};for(const[r,n]of Object.entries(t)){const i=n.methods||[],s=n.events||[],o=n.accounts||[],a=l1(r)?[r]:n.chains?n.chains:_4(n.accounts);e[r]={chains:a,methods:i,events:s,accounts:o}}return e}function Xl(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}function aX(t){try{const e=JSON.parse(t);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}const D4={},Mo=t=>D4[t],Jl=(t,e)=>{D4[t]=e};var cX=Object.defineProperty,B2=Object.getOwnPropertySymbols,fX=Object.prototype.hasOwnProperty,uX=Object.prototype.propertyIsEnumerable,S2=(t,e,r)=>e in t?cX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,O2=(t,e)=>{for(var r in e||(e={}))fX.call(e,r)&&S2(t,r,e[r]);if(B2)for(var r of B2(e))uX.call(e,r)&&S2(t,r,e[r]);return t};const _2="eip155",hX=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],lX=t=>t&&t.startsWith("0x")?BigInt(t).toString(10):t,Ql=t=>t&&t.startsWith("0x")?t:`0x${BigInt(t).toString(16)}`,D2=t=>Object.keys(t).filter(e=>hX.includes(e)).reduce((e,r)=>(e[r]=dX(t[r]),e),{}),dX=t=>typeof t=="string"&&aX(t)?JSON.parse(t):t,pX=(t,e,r)=>{const{sessionProperties:n={},scopedProperties:i={}}=t,s={};if(!Ga(i)&&!Ga(n))return;const o=D2(n);for(const a of r){const c=lX(a);if(!c)continue;s[Ql(c)]=o;const f=i==null?void 0:i[`${_2}:${c}`];if(f){const u=f==null?void 0:f[`${_2}:${c}:${e}`];s[Ql(c)]=O2(O2({},s[Ql(c)]),D2(u||f))}}for(const[a,c]of Object.entries(s))Object.keys(c).length===0&&delete s[a];return Object.keys(s).length>0?s:void 0};var gX=Object.defineProperty,yX=(t,e,r)=>e in t?gX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wX=(t,e,r)=>yX(t,e+"",r);let ed,bX=class F4{constructor(e){wX(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,r){return await this.storage.setItem(e,r)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return ed||(ed=new F4(e)),ed}};var mX=Object.defineProperty,EX=Object.defineProperties,vX=Object.getOwnPropertyDescriptors,F2=Object.getOwnPropertySymbols,xX=Object.prototype.hasOwnProperty,$X=Object.prototype.propertyIsEnumerable,U2=(t,e,r)=>e in t?mX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,AX=(t,e)=>{for(var r in e||(e={}))xX.call(e,r)&&U2(t,r,e[r]);if(F2)for(var r of F2(e))$X.call(e,r)&&U2(t,r,e[r]);return t},IX=(t,e)=>EX(t,vX(e));async function BX(t,e){const r=Ka(t.result.capabilities.caip345.caip2),n=t.result.capabilities.caip345.transactionHashes,i=await Promise.allSettled(n.map(l=>SX(r.reference,l,e))),s=i.filter(l=>l.status==="fulfilled").map(l=>l.value).filter(l=>l);i.filter(l=>l.status==="rejected").forEach(l=>console.warn("Failed to fetch transaction receipt:",l.reason));const o=!s.length||s.some(l=>!l),a=s.every(l=>(l==null?void 0:l.status)==="0x1"),c=s.every(l=>(l==null?void 0:l.status)==="0x0"),f=s.some(l=>(l==null?void 0:l.status)==="0x0");let u;return o?u=100:a?u=200:c?u=500:f&&(u=600),{id:t.result.id,version:t.request.version,atomic:t.request.atomicRequired,chainId:t.request.chainId,capabilities:t.result.capabilities,receipts:s,status:u}}async function SX(t,e,r){return await r(parseInt(t)).request(Mr("eth_getTransactionReceipt",[e]))}async function OX({sendCalls:t,storage:e}){const r=await e.getItem(qo);await e.setItem(qo,IX(AX({},r),{[t.result.id]:{request:t.request,result:t.result,expiry:wZ(IY)}}))}async function _X({resultId:t,storage:e}){const r=await e.getItem(qo);if(r){delete r[t],await e.setItem(qo,r);for(const n in r)U6(r[n].expiry)&&delete r[n];await e.setItem(qo,r)}}async function DX({resultId:t,storage:e}){const r=await e.getItem(qo),n=r==null?void 0:r[t];if(n&&!U6(n.expiry))return n;await _X({resultId:t,storage:e})}var FX=Object.defineProperty,UX=Object.defineProperties,CX=Object.getOwnPropertyDescriptors,C2=Object.getOwnPropertySymbols,PX=Object.prototype.hasOwnProperty,RX=Object.prototype.propertyIsEnumerable,N0=(t,e,r)=>e in t?FX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,td=(t,e)=>{for(var r in e||(e={}))PX.call(e,r)&&N0(t,r,e[r]);if(C2)for(var r of C2(e))RX.call(e,r)&&N0(t,r,e[r]);return t},rd=(t,e)=>UX(t,CX(e)),As=(t,e,r)=>N0(t,typeof e!="symbol"?e+"":e,r);class NX{constructor(e){As(this,"name","eip155"),As(this,"client"),As(this,"chainId"),As(this,"namespace"),As(this,"httpProviders"),As(this,"events"),As(this,"storage"),this.namespace=e.namespace,this.events=Mo("events"),this.client=Mo("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=bX.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r);const n=this.chainId;this.chainId=parseInt(e),this.events.emit(d1.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${n}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){const n=r||O4(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ip(new m4(n,Mo("disableProviderPing")))}setHttpProvider(e,r){const n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var n;const i=parseInt(sX(r));e[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[r])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(e){const r=e||this.chainId;return this.httpProviders[r]||(this.httpProviders=rd(td({},this.httpProviders),{[r]:this.createHttpProvider(r)}),this.httpProviders[r])}async handleSwitchChain(e){var r,n;let i=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";i=i.startsWith("0x")?i:`0x${i}`;const s=parseInt(i,16);if(this.isChainApproved(s))this.setDefaultChain(`${s}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:i}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${s}`);else throw new Error(`Failed to switch to chain 'eip155:${s}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var r,n,i,s,o;const a=(n=(r=e.request)==null?void 0:r.params)==null?void 0:n[0],c=((s=(i=e.request)==null?void 0:i.params)==null?void 0:s[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const f=this.client.session.get(e.topic),u=((o=f==null?void 0:f.sessionProperties)==null?void 0:o.capabilities)||{},l=`${a}${c.join(",")}`,h=u==null?void 0:u[l];if(h)return h;let d;try{d=pX(f,a,c)}catch(w){console.warn("Failed to extract capabilities from session",w)}if(d)return d;const p=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:rd(td({},f.sessionProperties||{}),{capabilities:rd(td({},u||{}),{[l]:p})})})}catch(w){console.warn("Failed to update session with capabilities",w)}return p}async getCallStatus(e){var r,n,i;const s=this.client.session.get(e.topic),o=(r=s.sessionProperties)==null?void 0:r.bundler_name;if(o){const f=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(f,e)}catch(u){console.warn("Failed to fetch call status from bundler",u,f)}}const a=(n=s.sessionProperties)==null?void 0:n.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(f){console.warn("Failed to fetch call status from custom bundler",f,a)}const c=await DX({resultId:(i=e.request.params)==null?void 0:i[0],storage:this.storage});if(c)try{return await BX(c,this.getHttpProvider.bind(this))}catch(f){console.warn("Failed to fetch call status from stored send calls",f,c)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,r){var n;const i=new URL(e),s=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Mr("eth_getUserOperationReceipt",[(n=r.request.params)==null?void 0:n[0]]))});if(!s.ok)throw new Error(`Failed to fetch user operation receipt - ${s.status}`);return await s.json()}getBundlerUrl(e,r){return`${AY}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${r}`}async sendCalls(e){var r,n,i;const s=await this.client.request(e),o=(r=e.request.params)==null?void 0:r[0],a=s==null?void 0:s.id,c=(s==null?void 0:s.capabilities)||{},f=(n=c==null?void 0:c.caip345)==null?void 0:n.caip2,u=(i=c==null?void 0:c.caip345)==null?void 0:i.transactionHashes;return!a||!f||!(u!=null&&u.length)||await OX({sendCalls:{request:o,result:s},storage:this.storage}),s}}var TX=Object.defineProperty,LX=(t,e,r)=>e in t?TX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$o=(t,e,r)=>LX(t,typeof e!="symbol"?e+"":e,r);class kX{constructor(e){$o(this,"name",v4),$o(this,"client"),$o(this,"httpProviders"),$o(this,"events"),$o(this,"namespace"),$o(this,"chainId"),this.namespace=e.namespace,this.events=Mo("events"),this.client=Mo("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r);const n=this.chainId;this.chainId=e,this.events.emit(d1.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${n}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return Ka(e).namespace}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){var e,r;const n={};return(r=(e=this.namespace)==null?void 0:e.accounts)==null||r.forEach(i=>{var s,o;const a=Ka(i),c=(o=(s=this.namespace)==null?void 0:s.rpcMap)==null?void 0:o[`${a.namespace}:${a.reference}`];n[a.reference]=this.createHttpProvider(i,c)}),n}getHttpProvider(e){const r=Ka(e).reference,n=this.httpProviders[r];if(typeof n>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return n}setHttpProvider(e,r){const n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProvider(e,r){const n=r||O4(e,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ip(new m4(n,Mo("disableProviderPing")))}}var jX=Object.defineProperty,qX=Object.defineProperties,MX=Object.getOwnPropertyDescriptors,P2=Object.getOwnPropertySymbols,zX=Object.prototype.hasOwnProperty,HX=Object.prototype.propertyIsEnumerable,T0=(t,e,r)=>e in t?jX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ia=(t,e)=>{for(var r in e||(e={}))zX.call(e,r)&&T0(t,r,e[r]);if(P2)for(var r of P2(e))HX.call(e,r)&&T0(t,r,e[r]);return t},bf=(t,e)=>qX(t,MX(e)),gr=(t,e,r)=>T0(t,typeof e!="symbol"?e+"":e,r);class y1{constructor(e){gr(this,"client"),gr(this,"namespaces"),gr(this,"optionalNamespaces"),gr(this,"sessionProperties"),gr(this,"scopedProperties"),gr(this,"events",new j0),gr(this,"rpcProviders",{}),gr(this,"session"),gr(this,"providerOpts"),gr(this,"logger"),gr(this,"uri"),gr(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:hc(Eu({level:(e==null?void 0:e.logger)||y2})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const r=new y1(e);return await r.initialize(),r}async request(e,r,n){const[i,s]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:Ia({},e),chainId:`${i}:${s}`,topic:this.session.topic,expiry:n})}sendAsync(e,r,n,i){const s=new Date().getTime();this.request(e,n,i).then(o=>r(null,Ja(s,o))).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:a2("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,r){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:n,response:i}=await this.client.authenticate(e,r);n&&(this.uri=n,this.events.emit("display_uri",n));const s=await i();if(this.session=s.session,this.session){const o=I2(this.session.namespaces);this.namespaces=wf(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return s}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){const{uri:r,approval:n}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});r&&(this.uri=r,this.events.emit("display_uri",r));const i=await n();this.session=i;const s=I2(i.namespaces);return this.namespaces=wf(this.namespaces,s),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;const[n,i]=this.validateChain(e);this.getProvider(n).setDefaultChain(i,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(!Yl(r))return;for(const n of r)e.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}catch(r){this.logger.warn("Failed to cleanup pending pairings",r)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,r;if(this.client=this.providerOpts.client||await RV.init({core:this.providerOpts.core,logger:this.providerOpts.logger||y2,relayUrl:this.providerOpts.relayUrl||vY,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(n){throw this.logger.error("Failed to get session",n),new Error(`The provided session: ${(r=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:r.topic} doesn't exist in the Sign client`)}else{const n=this.client.session.getAll();this.session=n[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(r=>La(r)))];Jl("client",this.client),Jl("events",this.events),Jl("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;const n=oX(r,this.session);if((n==null?void 0:n.length)===0)return;const i=_4(n),s=wf(this.namespaces,this.optionalNamespaces),o=bf(Ia({},s[r]),{accounts:n,chains:i});switch(r){case"eip155":this.rpcProviders[r]=new NX({namespace:o});break;default:this.rpcProviders[r]=new kX({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var r;const{topic:n}=e;n===((r=this.session)==null?void 0:r.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var r;const{params:n,topic:i}=e;if(i!==((r=this.session)==null?void 0:r.topic))return;const{event:s}=n;if(s.name==="accountsChanged"){const o=s.data;o&&Yl(o)&&this.events.emit("accountsChanged",o.map(A2))}else if(s.name==="chainChanged"){const o=n.chainId,a=n.event.data,c=La(o),f=Xl(o)!==Xl(a)?`${c}:${Xl(a)}`:o;this.onChainChanged({currentCaipChainId:f})}else this.events.emit(s.name,s.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var n,i;if(e!==((n=this.session)==null?void 0:n.topic))return;const{namespaces:s}=r,o=(i=this.client)==null?void 0:i.session.get(e);this.session=bf(Ia({},o),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{var r;e.topic===((r=this.session)==null?void 0:r.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",bf(Ia({},a2("USER_DISCONNECTED")),{data:e.topic})))}),this.on(d1.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(bf(Ia({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[v4]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){const{namespaces:r={},optionalNamespaces:n={},sessionProperties:i,scopedProperties:s}=e;this.optionalNamespaces=wf(r,n),this.sessionProperties=i,this.scopedProperties=s}validateChain(e){const[r,n]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(o=>La(o)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const i=La(Object.keys(this.namespaces)[0]),s=this.rpcProviders[i].getDefaultChain();return[i,s]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:r,internal:n=!1}){if(!this.namespaces)return;const[i,s]=this.validateChain(e);s&&(this.updateNamespaceChain(i,s),n?(this.events.emit("chainChanged",s),this.emitAccountsChangedOnChainChange({namespace:i,currentCaipChainId:e,previousCaipChainId:r})):this.getProvider(i).setDefaultChain(s),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:r,previousCaipChainId:n}){var i,s;try{if(n===r)return;const o=(s=(i=this.session)==null?void 0:i.namespaces[e])==null?void 0:s.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${r}:`)).map(A2);if(!Yl(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,r){if(!this.namespaces)return;const n=this.namespaces[e]?e:`${e}:${r}`,i={chains:[],methods:[],events:[],defaultChain:r};this.namespaces[n]?this.namespaces[n]&&(this.namespaces[n].defaultChain=r):this.namespaces[n]=i}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,r){var n;const i=((n=this.session)==null?void 0:n.topic)||"";await this.client.core.storage.setItem(`${gf}/${e}${i}`,r)}async getFromStore(e){var r;const n=((r=this.session)==null?void 0:r.topic)||"";return await this.client.core.storage.getItem(`${gf}/${e}${n}`)}async deleteFromStore(e){var r;const n=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.removeItem(`${gf}/${e}${n}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const r=await this.client.core.storage.getKeys();for(const n of r)n.startsWith(gf)&&await this.client.core.storage.removeItem(n)}catch(r){this.logger.warn("Failed to cleanup storage",r)}}}const VX=y1,KX="wc",GX="ethereum_provider",ZX=`${KX}@2:${GX}:`,WX="https://rpc.walletconnect.org/v1/",hu=["eth_sendTransaction","personal_sign"],U4=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],lu=["chainChanged","accountsChanged"],C4=["chainChanged","accountsChanged","message","disconnect","connect"],YX=async()=>{const{createAppKit:t}=await H4(()=>import("./core-CHTdmtIq.js").then(e=>e.$),__vite__mapDeps([0,1,2]));return t};var XX=Object.defineProperty,JX=Object.defineProperties,QX=Object.getOwnPropertyDescriptors,R2=Object.getOwnPropertySymbols,eJ=Object.prototype.hasOwnProperty,tJ=Object.prototype.propertyIsEnumerable,L0=(t,e,r)=>e in t?XX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Is=(t,e)=>{for(var r in e||(e={}))eJ.call(e,r)&&L0(t,r,e[r]);if(R2)for(var r of R2(e))tJ.call(e,r)&&L0(t,r,e[r]);return t},Ba=(t,e)=>JX(t,QX(e)),nr=(t,e,r)=>L0(t,typeof e!="symbol"?e+"":e,r);function du(t){return Number(t[0].split(":")[1])}function mf(t){return`0x${t.toString(16)}`}function rJ(t){const{chains:e,optionalChains:r,methods:n,optionalMethods:i,events:s,optionalEvents:o,rpcMap:a}=t;if(!xd(e))throw new Error("Invalid chains");const c={chains:e,methods:n||hu,events:s||lu,rpcMap:Is({},e.length?{[du(e)]:a[du(e)]}:{})},f=s==null?void 0:s.filter(d=>!lu.includes(d)),u=n==null?void 0:n.filter(d=>!hu.includes(d));if(!r&&!o&&!i&&!(f!=null&&f.length)&&!(u!=null&&u.length))return{required:e.length?c:void 0};const l=(f==null?void 0:f.length)&&(u==null?void 0:u.length)||!r,h={chains:[...new Set(l?c.chains.concat(r||[]):r)],methods:[...new Set(c.methods.concat(i!=null&&i.length?i:U4))],events:[...new Set(c.events.concat(o!=null&&o.length?o:C4))],rpcMap:a};return{required:e.length?c:void 0,optional:r.length?h:void 0}}class Yu{constructor(){nr(this,"events",new hr.EventEmitter),nr(this,"namespace","eip155"),nr(this,"accounts",[]),nr(this,"signer"),nr(this,"chainId",1),nr(this,"modal"),nr(this,"rpc"),nr(this,"STORAGE_KEY",ZX),nr(this,"on",(e,r)=>(this.events.on(e,r),this)),nr(this,"once",(e,r)=>(this.events.once(e,r),this)),nr(this,"removeListener",(e,r)=>(this.events.removeListener(e,r),this)),nr(this,"off",(e,r)=>(this.events.off(e,r),this)),nr(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const r=new Yu;return await r.initialize(e),r}async request(e,r){return await this.signer.request(e,this.formatChainId(this.chainId),r)}sendAsync(e,r,n){this.signer.sendAsync(e,r,this.formatChainId(this.chainId),n)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var r;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:n,optional:i}=rJ(this.rpc);try{const s=await new Promise(async(a,c)=>{var f,u;this.rpc.showQrModal&&((f=this.modal)==null||f.open(),(u=this.modal)==null||u.subscribeState(h=>{!h.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))}));const l=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(Ba(Is({namespaces:Is({},n&&{[this.namespace]:n})},i&&{optionalNamespaces:{[this.namespace]:i}}),{pairingTopic:e==null?void 0:e.pairingTopic,scopedProperties:l})).then(h=>{a(h)}).catch(h=>{var d;(d=this.modal)==null||d.showErrorMessage("Unable to connect"),c(new Error(h.message))})});if(!s)return;const o=Q1(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:mf(this.chainId)})}catch(s){throw this.signer.logger.error(s),s}finally{(r=this.modal)==null||r.close()}}async authenticate(e,r){var n;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e==null?void 0:e.chains});try{const i=await new Promise(async(o,a)=>{var c,f;this.rpc.showQrModal&&((c=this.modal)==null||c.open(),(f=this.modal)==null||f.subscribeState(u=>{!u.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(Ba(Is({},e),{chains:this.rpc.chains}),r).then(u=>{o(u)}).catch(u=>{var l;(l=this.modal)==null||l.showErrorMessage("Unable to connect"),a(new Error(u.message))})}),s=i.session;if(s){const o=Q1(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:mf(this.chainId)})}return i}catch(i){throw this.signer.logger.error(i),i}finally{(n=this.modal)==null||n.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:r}=e,{event:n}=r;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const r=parseInt(e);this.chainId=r,this.events.emit("chainChanged",mf(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",Ba(Is({},hB("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const r=e.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",mf(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const r=this.parseChainId(e);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(e){const[r,n,i]=e.split(":");return{chainId:`${r}:${n}`,address:i}}setAccounts(e){this.accounts=e.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var r,n;const i=(r=e==null?void 0:e.chains)!=null?r:[],s=(n=e==null?void 0:e.optionalChains)!=null?n:[],o=i.concat(s);if(!o.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const a=i.length?(e==null?void 0:e.methods)||hu:[],c=i.length?(e==null?void 0:e.events)||lu:[],f=(e==null?void 0:e.optionalMethods)||[],u=(e==null?void 0:e.optionalEvents)||[],l=(e==null?void 0:e.rpcMap)||this.buildRpcMap(o,e.projectId),h=(e==null?void 0:e.qrModalOptions)||void 0;return{chains:i==null?void 0:i.map(d=>this.formatChainId(d)),optionalChains:s.map(d=>this.formatChainId(d)),methods:a,events:c,optionalMethods:f,optionalEvents:u,rpcMap:l,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:h,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,r){const n={};return e.forEach(i=>{n[i]=this.getRpcUrl(i,r)}),n}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?du(this.rpc.chains):du(this.rpc.optionalChains),this.signer=await VX.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const n=await YX(),{convertWCMToAppKitOptions:i}=await Promise.resolve().then(function(){return dJ}),s=i(Ba(Is({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!s.networks.length)throw new Error("No networks found for WalletConnect");r=n(Ba(Is({},s),{universalProvider:this.signer,manualWCControl:!0}))}catch(n){throw console.warn(n),new Error("To use QR modal, please install @reown/appkit package")}if(r)try{this.modal=r}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:r,optionalChains:n,rpcMap:i}=e;r&&xd(r)&&(this.rpc.chains=r.map(s=>this.formatChainId(s)),r.forEach(s=>{this.rpc.rpcMap[s]=(i==null?void 0:i[s])||this.getRpcUrl(s)})),n&&xd(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(s=>this.formatChainId(s)),n.forEach(s=>{this.rpc.rpcMap[s]=(i==null?void 0:i[s])||this.getRpcUrl(s)}))}getRpcUrl(e,r){var n;return((n=this.rpc.rpcMap)==null?void 0:n[e])||`${WX}?chainId=eip155:${e}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(r=>this.signer.logger.warn(r))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(r=>this.parseAccount(r))}}const nJ=Yu;var iJ=Object.defineProperty,sJ=Object.defineProperties,oJ=Object.getOwnPropertyDescriptors,N2=Object.getOwnPropertySymbols,aJ=Object.prototype.hasOwnProperty,cJ=Object.prototype.propertyIsEnumerable,T2=(t,e,r)=>e in t?iJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,P4=(t,e)=>{for(var r in e||(e={}))aJ.call(e,r)&&T2(t,r,e[r]);if(N2)for(var r of N2(e))cJ.call(e,r)&&T2(t,r,e[r]);return t},fJ=(t,e)=>sJ(t,oJ(e));function uJ(t){if(t)return{"--w3m-font-family":t["--wcm-font-family"],"--w3m-accent":t["--wcm-accent-color"],"--w3m-color-mix":t["--wcm-background-color"],"--w3m-z-index":t["--wcm-z-index"]?Number(t["--wcm-z-index"]):void 0,"--w3m-qr-color":t["--wcm-accent-color"],"--w3m-font-size-master":t["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":t["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const hJ=t=>{const[e,r]=t.split(":");return R4({id:r,caipNetworkId:t,chainNamespace:e,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function lJ(t){var e,r,n,i,s,o,a;const c=(e=t.chains)==null?void 0:e.map(hJ).filter(Boolean);if(c.length===0)throw new Error("At least one chain must be specified");const f=c.find(l=>{var h;return l.id===((h=t.defaultChain)==null?void 0:h.id)}),u={projectId:t.projectId,networks:c,themeMode:t.themeMode,themeVariables:uJ(t.themeVariables),chainImages:t.chainImages,connectorImages:t.walletImages,defaultNetwork:f,metadata:fJ(P4({},t.metadata),{name:((r=t.metadata)==null?void 0:r.name)||"WalletConnect",description:((n=t.metadata)==null?void 0:n.description)||"Connect to WalletConnect-compatible wallets",url:((i=t.metadata)==null?void 0:i.url)||"https://walletconnect.org",icons:((s=t.metadata)==null?void 0:s.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:t.explorerRecommendedWalletIds==="NONE"?[]:Array.isArray(t.explorerRecommendedWalletIds)?t.explorerRecommendedWalletIds:[],excludeWalletIds:t.explorerExcludedWalletIds==="ALL"?[]:Array.isArray(t.explorerExcludedWalletIds)?t.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if((o=t.mobileWallets)!=null&&o.length||(a=t.desktopWallets)!=null&&a.length){const l=[...(t.mobileWallets||[]).map(p=>({id:p.id,name:p.name,links:p.links})),...(t.desktopWallets||[]).map(p=>({id:p.id,name:p.name,links:{native:p.links.native,universal:p.links.universal}}))],h=[...u.featuredWalletIds||[],...u.excludeWalletIds||[]],d=l.filter(p=>!h.includes(p.id));d.length&&(u.customWallets=d)}return u}function R4(t){return P4({formatters:void 0,fees:void 0,serializers:void 0},t)}var dJ=Object.freeze({__proto__:null,convertWCMToAppKitOptions:lJ,defineChain:R4});const $ee=Object.freeze(Object.defineProperty({__proto__:null,EthereumProvider:nJ,OPTIONAL_EVENTS:C4,OPTIONAL_METHODS:U4,REQUIRED_EVENTS:lu,REQUIRED_METHODS:hu,default:Yu},Symbol.toStringTag,{value:"Module"}));export{uS as A,Xi as B,hA as C,Cu as D,Pt as E,ln as F,br as G,hn as H,Js as I,m4 as J,M2 as K,X4 as L,$ee as M,Xn as a,Tf as b,Z as c,K2 as d,ur as e,a5 as f,re as g,Px as h,Ix as i,Y5 as j,gA as k,hr as l,Eu as m,dB as n,GB as o,Mr as p,hc as q,Qs as r,Ws as s,Ip as t,PC as u,Ap as v,Pu as w,Ja as x,tr as y,j0 as z};
